# presets

**Type:** File Overview
**Repository:** Yoshi-Audit
**File:** internal/docker/presets.go
**Language:** go
**Lines:** 1-75
**Complexity:** 0.0

---

## Source Code

```go
// ©AngelaMos | 2026
// presets.go

package docker

import (
	"github.com/CarterPerez-dev/yoshi-audit/internal/config"
)

func ApplyPreset(preset config.PrunePreset, images []ImageInfo, volumes []VolumeInfo, protection *ProtectionEngine) (imageIDs []string, volumeNames []string) {
	hasDangling := false
	hasStopped := false
	for _, p := range preset.Patterns {
		switch p {
		case "dangling":
			hasDangling = true
		case "stopped":
			hasStopped = true
		}
	}
	_ = hasStopped

	if hasDangling {
		for _, img := range images {
			if img.Dangling && !protection.IsProtected(img.Repository) && !protection.IsProtected(img.ID) {
				imageIDs = append(imageIDs, img.ID)
			}
		}
	}

	for _, p := range preset.Patterns {
		if p == "dangling" || p == "buildcache" || p == "stopped" {
			continue
		}
		pe := NewProtectionEngine([]string{p})
		for _, img := range images {
			if !img.Dangling && pe.MatchesPattern(img.Repository) && !protection.IsProtected(img.Repository) && !protection.IsProtected(img.ID) {
				imageIDs = append(imageIDs, img.ID)
			}
		}
		for _, vol := range volumes {
			if pe.MatchesPattern(vol.Name) && !protection.IsProtected(vol.Name) {
				volumeNames = append(volumeNames, vol.Name)
			}
		}
	}

	return imageIDs, volumeNames
}

func EstimateReclaimable(images []ImageInfo, selectedImageIDs []string, volumes []VolumeInfo, selectedVolumeNames []string) int64 {
	imageSet := make(map[string]bool, len(selectedImageIDs))
	for _, id := range selectedImageIDs {
		imageSet[id] = true
	}

	volumeSet := make(map[string]bool, len(selectedVolumeNames))
	for _, name := range selectedVolumeNames {
		volumeSet[name] = true
	}

	var total int64
	for _, img := range images {
		if imageSet[img.ID] {
			total += img.Size
		}
	}
	for _, vol := range volumes {
		if volumeSet[vol.Name] {
			total += vol.Size
		}
	}
	return total
}

```

---

## File Overview

// ©AngelaMos | 2026
// presets.go

This file is responsible for applying Docker pruning presets to manage images and volumes based on specified patterns.

### Key Exports and Public API
- `ApplyPreset`: Applies a set of pruning rules (patterns) to filter out dangling, stopped, or other protected images and volumes.
- `EstimateReclaimable`: Estimates the total reclaimable space from selected images and volumes.

### How It Fits into the Project
This file is part of the `docker` package within the `yoshi-audit` project. It interacts with the `config` package to handle pruning presets, uses a `ProtectionEngine` for protection checks, and calculates the reclaimable space based on filtered results. The output from `ApplyPreset` can be used by other parts of the audit tool to clean up unused resources.

### Notable Design Decisions
- **Pattern Matching**: Uses a switch statement to handle different pruning patterns like "dangling" and "stopped".
- **Protection Engine**: Leverages an instance of `ProtectionEngine` to skip protected images and volumes.
- **Efficient Filtering**: Utilizes maps (`imageSet`, `volumeSet`) for quick lookup of selected IDs/names, optimizing the estimation process.
```

This documentation provides a high-level overview of the file's role within the project, its public interface, and key design choices.

---

*Generated by CodeWorm on 2026-03-01 13:57*
