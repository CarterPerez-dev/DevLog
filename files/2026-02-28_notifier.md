# notifier

**Type:** File Overview
**Repository:** CodeWorm
**File:** codeworm/core/notifier.py
**Language:** python
**Lines:** 1-96
**Complexity:** 0.0

---

## Source Code

```python
"""
Â©AngelaMos | 2026
notifier.py
"""
from __future__ import annotations

from typing import TYPE_CHECKING

from telehook import Notifier, TelehookConfig
from telehook.formatters import alert_formatter, error_formatter
from telehook.middleware import Dedup, RateLimiter, Retry

if TYPE_CHECKING:
    from codeworm.core.config import TelegramSettings


class CodeWormNotifier:
    """
    Telegram notification wrapper for the CodeWorm daemon
    """
    def __init__(self, settings: TelegramSettings) -> None:
        self._notifier = Notifier(
            config = TelehookConfig(
                bot_token = settings.bot_token,
                chat_id = settings.chat_id,
            ),
            middleware = [
                RateLimiter(max_per_second = 1,
                            burst = 3),
                Dedup(window_seconds = 300),
                Retry(max_attempts = 3),
            ],
        )

    async def send_alert(
        self,
        title: str,
        last_error: str | None = None,
        details: str | None = None,
    ) -> None:
        try:
            msg = alert_formatter(
                title = title,
                app = "CodeWorm",
                last_error = last_error,
                details = details,
            )
            await self._notifier.send(msg)
        except Exception:  # noqa: S110
            pass

    async def send_error(self, exc: BaseException, component: str) -> None:
        try:
            msg = error_formatter(
                exception = exc,
                component = component,
                app = "CodeWorm"
            )
            await self._notifier.send(msg)
        except Exception:  # noqa: S110
            pass

    def send_alert_sync(
        self,
        title: str,
        last_error: str | None = None,
        details: str | None = None,
    ) -> None:
        try:
            msg = alert_formatter(
                title = title,
                app = "CodeWorm",
                last_error = last_error,
                details = details,
            )
            self._notifier.send_sync(msg)
        except Exception:  # noqa: S110
            pass

    def send_error_sync(self, exc: BaseException, component: str) -> None:
        try:
            msg = error_formatter(
                exception = exc,
                component = component,
                app = "CodeWorm"
            )
            self._notifier.send_sync(msg)
        except Exception:  # noqa: S110
            pass

    async def close(self) -> None:
        try:  # noqa: SIM105
            await self._notifier.close()
        except Exception:  # noqa: S110
            pass

```

---

## File Overview

## notifier.py

### Purpose and Responsibility
This Python source file, `notifier.py`, is responsible for handling Telegram notifications within the CodeWorm daemon. It encapsulates the logic for sending both alert and error messages to a specified Telegram chat.

### Key Exports and Public Interface
- **CodeWormNotifier**: A class that provides methods for sending alerts and errors via Telegram.
  - `__init__(self, settings: TelegramSettings)`: Initializes the notifier with configuration settings.
  - `send_alert(self, title: str, last_error: str | None = None, details: str | None = None)`: Asynchronously sends an alert message.
  - `send_error(self, exc: BaseException, component: str)`: Asynchronously sends an error message.
  - `send_alert_sync(self, title: str, last_error: str | None = None, details: str | None = None)`: Synchronously sends an alert message.
  - `send_error_sync(self, exc: BaseException, component: str)`: Synchronously sends an error message.
  - `close(self)`: Closes the notifier.

### How It Fits into the Project
This file acts as a central hub for all Telegram notifications in the CodeWorm project. It is imported and used by other components of the daemon to report status updates, errors, or critical alerts to the designated chat.

### Notable Design Decisions
- **Asynchronous Operations**: The `send_alert` and `send_error` methods are asynchronous, allowing for non-blocking operations during notification sending.
- **Middleware Integration**: Middleware such as `RateLimiter`, `Dedup`, and `Retry` are used to manage the frequency of messages, prevent duplicates, and ensure retries on failures.
- **Type Hints and Annotations**: The use of type hints (`TelegramSettings`, `BaseException`) ensures clear interfaces and helps with static analysis.

---

*Generated by CodeWorm on 2026-02-28 20:00*
