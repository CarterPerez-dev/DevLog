# user

**Type:** File Overview
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/auth/services/user.py
**Language:** python
**Lines:** 1-220
**Complexity:** 0.0

---

## Source Code

```python
"""
ⒸAngelaMos | 2025
user.py
"""

from uuid import UUID
from sqlalchemy.ext.asyncio import (
    AsyncSession,
)

from core.exceptions import (
    EmailAlreadyExists,
    InvalidCredentials,
    UserNotFound,
)
from core.security.auth.jwt import (
    hash_password,
    verify_password,
)
from aspects.auth.schemas.user import (
    AdminUserCreate,
    UserCreate,
    UserListResponse,
    UserResponse,
    UserUpdate,
    UserUpdateAdmin,
)
from aspects.auth.models.User import User
from aspects.auth.repositories.user import UserRepository


class UserService:
    """
    Business logic for user operations
    """
    @staticmethod
    async def create_user(
        session: AsyncSession,
        user_data: UserCreate,
    ) -> UserResponse:
        """
        Register a new user
        """
        if await UserRepository.email_exists(session, user_data.email):
            raise EmailAlreadyExists(user_data.email)

        hashed = await hash_password(user_data.password)
        user = await UserRepository.create_user(
            session,
            email = user_data.email,
            hashed_password = hashed,
            full_name = user_data.full_name,
        )
        return UserResponse.model_validate(user)

    @staticmethod
    async def get_user_by_id(
        session: AsyncSession,
        user_id: UUID,
    ) -> UserResponse:
        """
        Get user by ID
        """
        user = await UserRepository.get_by_id(session, user_id)
        if not user:
            raise UserNotFound(str(user_id))
        return UserResponse.model_validate(user)

    @staticmethod
    async def get_user_model_by_id(
        session: AsyncSession,
        user_id: UUID,
    ) -> User:
        """
        Get user model by ID (for internal use)
        """
        user = await UserRepository.get_by_id(session, user_id)
        if not user:
            raise UserNotFound(str(user_id))
        return user

    @staticmethod
    async def update_user(
        session: AsyncSession,
        user: User,
        user_data: UserUpdate,
    ) -> UserResponse:
        """
        Update user profile
        """
        update_dict = user_data.model_dump(exclude_unset = True)
        updated_user = await UserRepository.update(
            session,
            user,
            **update_dict
        )
        return UserResponse.model_validate(updated_user)

    @staticmethod
    async def change_password(
        session: AsyncSession,
        user: User,
        current_password: str,
        new_password: str,
    ) -> None:
        """
        Change user password
        """
        is_valid, _ = await verify_password(current_password, user.hashed_password)
        if not is_valid:
            raise InvalidCredentials()

        hashed = await hash_password(new_password)
        await UserRepository.update_password(session, user, hashed)

    @staticmethod
    async def deactivate_user(
        session: AsyncSession,
        user: User,
    ) -> UserRe
```

---

## File Overview

### user.py

**Purpose and Responsibility:**
This Python file contains business logic for managing user operations within the authentication system of a larger project. It handles creating, updating, deactivating, listing, and validating users.

**Key Exports or Public Interface:**
- `create_user`: Registers a new user.
- `get_user_by_id`: Retrieves a user by ID.
- `update_user`: Updates a user's profile.
- `change_password`: Changes a user’s password.
- `deactivate_user`: Deactivates a user account.
- `list_users`: Lists users with pagination.
- `admin_create_user`: Allows admins to create new users.
- `admin_update_user`: Enables admins to update existing users.

**How it Fits in the Project:**
This service acts as an intermediary between the database and application logic, ensuring that all user-related operations adhere to defined business rules. It interacts with the `UserRepository` for data persistence and uses security utilities like password hashing and verification.

**Notable Design Decisions:**
- **Static Methods**: All methods are static to ensure they can be called without instantiating the class.
- **Dependency Injection**: The `AsyncSession` is passed as a parameter, promoting loose coupling and testability.
- **Error Handling**: Custom exceptions (`EmailAlreadyExists`, `InvalidCredentials`, `UserNotFound`) are used for robust error handling.
- **Security**: Passwords are hashed using `hash_password` and verified with `verify_password`.
```

This documentation provides an overview of the file's purpose, key functionalities, integration within the project, and design choices.

---

*Generated by CodeWorm on 2026-02-19 18:07*
