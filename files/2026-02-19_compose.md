# compose

**Type:** File Overview
**Repository:** angelamos-operations
**File:** Docker-Kentros/internal/docker/compose.go
**Language:** go
**Lines:** 1-191
**Complexity:** 0.0

---

## Source Code

```go
/*
AngelaMos | 2026
compose.go
*/

package docker

import (
	"bytes"
	"context"
	"encoding/json"
	"fmt"
	"os/exec"
	"path/filepath"
	"strings"
	"time"
)

type ComposeResult struct {
	Success bool   `json:"success"`
	Output  string `json:"output"`
	Error   string `json:"error,omitempty"`
}

/*
ComposeUp starts services defined in a compose file.
Equivalent to: docker compose -f <file> up -d
*/
func ComposeUp(
	ctx context.Context,
	composePath string,
) (*ComposeResult, error) {
	return runComposeCommand(ctx, composePath, "up", "-d", "--remove-orphans")
}

/*
ComposeDown stops and removes services defined in a compose file.
Equivalent to: docker compose -f <file> down
*/
func ComposeDown(
	ctx context.Context,
	composePath string,
) (*ComposeResult, error) {
	return runComposeCommand(ctx, composePath, "down")
}

/*
ComposeRestart restarts services defined in a compose file.
*/
func ComposeRestart(
	ctx context.Context,
	composePath string,
) (*ComposeResult, error) {
	return runComposeCommand(ctx, composePath, "restart")
}

/*
ComposePull pulls latest images for services defined in a compose file.
*/
func ComposePull(
	ctx context.Context,
	composePath string,
) (*ComposeResult, error) {
	return runComposeCommand(ctx, composePath, "pull")
}

/*
ComposePs lists containers for a compose project.
*/
func ComposePs(
	ctx context.Context,
	composePath string,
) (*ComposeResult, error) {
	return runComposeCommand(ctx, composePath, "ps", "--format", "json")
}

/*
ComposeLogs gets logs from compose services.
*/
func ComposeLogs(
	ctx context.Context,
	composePath, tail string,
) (*ComposeResult, error) {
	if tail == "" {
		tail = "100"
	}
	return runComposeCommand(
		ctx,
		composePath,
		"logs",
		"--tail",
		tail,
		"--no-color",
	)
}

/*
ComposeConfig validates and returns the compose configuration.
*/
func ComposeConfig(
	ctx context.Context,
	composePath string,
) (*ComposeResult, error) {
	return runComposeCommand(ctx, composePath, "config")
}

func runComposeCommand(
	ctx context.Context,
	composePath string,
	args ...string,
) (*ComposeResult, error) {
	dir := filepath.Dir(composePath)
	file := filepath.Base(composePath)

	cmdArgs := []string{"compose", "-f", file}
	cmdArgs = append(cmdArgs, args...)

	cmd := exec.CommandContext(ctx, "docker", cmdArgs...)
	cmd.Dir = dir

	var stdout, stderr bytes.Buffer
	cmd.Stdout = &stdout
	cmd.Stderr = &stderr

	err := cmd.Run()

	result := &ComposeResult{
		Success: err == nil,
		Output:  strings.TrimSpace(stdout.String()),
		Error:   strings.TrimSpace(stderr.String()),
	}

	if err != nil {
		if result.Error == "" {
			result.Error = err.Error()
		}
		return result, fmt.Errorf("compose command failed: %w", err)
	}

	return result, nil
}

/*
GetComposeProjectName extracts the actual project name from a compose file.
Uses docker compose config to get the resolved project name.
*/
func GetComposeProjectName(composePath string) string {
	ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
	defe
```

---

## File Overview

## compose.go

### Purpose and Responsibility
This Go source file provides a high-level abstraction for managing Docker Compose operations within the `angelamos-operations` project. It encapsulates common commands like `up`, `down`, `restart`, `pull`, `ps`, and `logs` using the `docker compose` CLI.

### Key Exports and Public Interface
The file exports functions to run various Docker Compose commands:
- `ComposeUp`: Starts services defined in a compose file.
- `ComposeDown`: Stops and removes services.
- `ComposeRestart`: Restarts services.
- `ComposePull`: Pulls latest images for services.
- `ComposePs`: Lists containers for a compose project.
- `ComposeLogs`: Gets logs from compose services.
- `ComposeConfig`: Validates and returns the compose configuration.
- `GetComposeProjectName`: Extracts the actual project name from a compose file.
- `IsComposeInstalled`: Checks if Docker Compose is available.

### How It Fits in the Project
This file serves as a utility module for managing Docker Compose operations within the `angelamos-operations` project. It abstracts away the complexities of running CLI commands, providing a clean and consistent API for developers to interact with Docker Compose services.

### Notable Design Decisions
1. **Error Handling**: The functions handle errors by checking if `err == nil` and setting the `Success` field in the `ComposeResult`. If an error occurs but no specific error message is available, a generic error message is provided.
2. **Context Management**: Contexts are used to manage timeouts and cancellations, ensuring that operations can be safely interrupted.
3. **JSON Parsing**: The `GetComposeProjectName` function uses JSON parsing to extract the project name from the compose configuration output.
4. **Command Execution**: Commands are executed using `exec.CommandContext`, which allows for context-aware execution of commands with timeouts and cancellation support.

---

*Generated by CodeWorm on 2026-02-19 19:12*
