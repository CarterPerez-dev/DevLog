# useAuth

**Type:** File Overview
**Repository:** social-media-notes
**File:** frontend/src/api/hooks/useAuth.ts
**Language:** typescript
**Lines:** 1-271
**Complexity:** 0.0

---

## Source Code

```typescript
/**
 * AngelaMos | 2025
 * useAuth.ts
 */

import { Alert } from 'react-native'
import {
  type UseMutationResult,
  type UseQueryResult,
  useMutation,
  useQuery,
  useQueryClient,
} from '@tanstack/react-query'
import { router } from 'expo-router'
import {
  AUTH_ERROR_MESSAGES,
  AUTH_SUCCESS_MESSAGES,
  AuthResponseError,
  isValidLogoutAllResponse,
  isValidTokenResponse,
  isValidTokenWithUserResponse,
  isValidUserResponse,
  type LoginRequest,
  type LogoutAllResponse,
  type PasswordChangeRequest,
  type RegisterRequest,
  type TokenWithUserResponse,
  type UserResponse,
} from '@/api/types'
import { API_ENDPOINTS, QUERY_KEYS } from '@/config'
import { apiClient, QUERY_STRATEGIES } from '@/core/api'
import { useAuthStore } from '@/core/lib'

export const authQueries = {
  all: () => QUERY_KEYS.AUTH.ALL,
  me: () => QUERY_KEYS.AUTH.ME(),
} as const

const fetchCurrentUser = async (): Promise<UserResponse> => {
  const response = await apiClient.get<unknown>(API_ENDPOINTS.AUTH.ME)
  const data: unknown = response.data

  if (!isValidUserResponse(data)) {
    throw new AuthResponseError(
      AUTH_ERROR_MESSAGES.INVALID_USER_RESPONSE,
      API_ENDPOINTS.AUTH.ME
    )
  }

  return data
}

export const useCurrentUser = (): UseQueryResult<UserResponse, Error> => {
  const isAuthenticated = useAuthStore((s) => s.isAuthenticated)

  return useQuery({
    queryKey: authQueries.me(),
    queryFn: fetchCurrentUser,
    enabled: isAuthenticated,
    ...QUERY_STRATEGIES.auth,
  })
}

const performLogin = async (
  credentials: LoginRequest
): Promise<TokenWithUserResponse> => {
  const formData = new URLSearchParams()
  formData.append('username', credentials.username)
  formData.append('password', credentials.password)

  const response = await apiClient.post<unknown>(
    API_ENDPOINTS.AUTH.LOGIN,
    formData,
    {
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    }
  )

  const data: unknown = response.data

  if (!isValidTokenWithUserResponse(data)) {
    throw new AuthResponseError(
      AUTH_ERROR_MESSAGES.INVALID_LOGIN_RESPONSE,
      API_ENDPOINTS.AUTH.LOGIN
    )
  }

  return data
}

export const useLogin = (): UseMutationResult<
  TokenWithUserResponse,
  Error,
  LoginRequest
> => {
  const queryClient = useQueryClient()
  const login = useAuthStore((s) => s.login)

  return useMutation({
    mutationFn: performLogin,
    onSuccess: (data: TokenWithUserResponse): void => {
      login(data.user, data.access_token)
      queryClient.setQueryData(authQueries.me(), data.user)

      const welcomeMessage = AUTH_SUCCESS_MESSAGES.WELCOME_BACK(
        data.user.full_name
      )
      Alert.alert('Success', welcomeMessage)
    },
    onError: (error: Error): void => {
      const message =
        error instanceof AuthResponseError ? error.message : 'Login failed'
      Alert.alert('Error', message)
    },
  })
}

const performRegister = async (data: RegisterRequest): Promise<UserResponse> => {
  const response 
```

---

## File Overview

### Document for `useAuth.ts`

**File Purpose and Responsibility:**
This TypeScript file is responsible for managing authentication-related hooks within a React Native application using the `@tanstack/react-query` library. It provides functions to handle user login, registration, logout, and fetching the current user's information.

**Key Exports or Public Interface:**
- **useCurrentUser:** A query hook that fetches the currently authenticated user.
- **useLogin:** A mutation hook for logging in a user with their credentials.
- **useRegister:** A mutation hook for registering new users.
- **useLogout:** A mutation hook for logging out the current user.
- **useLogoutAll:** A mutation hook for logging out all sessions associated with the user.

**How It Fits In The Project:**
This file is a crucial part of the authentication module, providing reusable hooks that can be used throughout the application. These hooks are integrated into various screens and components to handle user authentication seamlessly. They leverage `@tanstack/react-query` for efficient data fetching and caching strategies defined in `QUERY_STRATEGIES`.

**Notable Design Decisions:**
- **Validation:** The file includes validation functions (`isValidTokenResponse`, etc.) to ensure that API responses are correctly formatted, enhancing the robustness of the authentication process.
- **Error Handling:** Custom error handling is implemented using `AuthResponseError` to provide clear and user-friendly messages via `Alert`.
- **Query Keys and Strategies:** Utilizes predefined query keys and strategies from `QUERY_STRATEGIES` for consistent behavior across different hooks.

---

*Generated by CodeWorm on 2026-02-20 21:37*
