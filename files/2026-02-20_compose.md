# compose

**Type:** File Overview
**Repository:** docksec
**File:** internal/analyzer/compose.go
**Language:** go
**Lines:** 1-624
**Complexity:** 0.0

---

## Source Code

```go
/*
AngelaMos | 2025
compose.go
*/

package analyzer

import (
	"context"
	"os"
	"strconv"
	"strings"

	"github.com/CarterPerez-dev/docksec/internal/finding"
	"github.com/CarterPerez-dev/docksec/internal/rules"
	"gopkg.in/yaml.v3"
)

// ComposeAnalyzer performs security analysis on docker-compose.yml files,
// checking for misconfigurations like privileged containers, sensitive mounts,
// and hardcoded secrets.
type ComposeAnalyzer struct {
	path string
}

// NewComposeAnalyzer creates a new analyzer for the specified compose file path.
func NewComposeAnalyzer(path string) *ComposeAnalyzer {
	return &ComposeAnalyzer{path: path}
}

// Name returns the identifier for this analyzer, prefixed with "compose:".
func (a *ComposeAnalyzer) Name() string {
	return "compose:" + a.path
}

// Analyze parses the compose file and checks all service definitions
// for security misconfigurations.
func (a *ComposeAnalyzer) Analyze(
	ctx context.Context,
) (finding.Collection, error) {
	data, err := os.ReadFile(a.path)
	if err != nil {
		return nil, err
	}

	var root yaml.Node
	if err := yaml.Unmarshal(data, &root); err != nil {
		return nil, err
	}

	target := finding.Target{
		Type: finding.TargetCompose,
		Name: a.path,
	}

	var findings finding.Collection

	services := findNode(&root, "services")
	if services == nil {
		return findings, nil
	}

	for i := 0; i < len(services.Content); i += 2 {
		if i+1 >= len(services.Content) {
			break
		}
		serviceName := services.Content[i].Value
		serviceNode := services.Content[i+1]

		findings = append(
			findings,
			a.analyzeService(target, serviceName, serviceNode)...)
	}

	return findings, nil
}

func (a *ComposeAnalyzer) analyzeService(
	target finding.Target,
	serviceName string,
	node *yaml.Node,
) finding.Collection {
	var findings finding.Collection

	findings = append(findings, a.checkPrivileged(target, serviceName, node)...)
	findings = append(
		findings,
		a.checkCapabilities(target, serviceName, node)...)
	findings = append(findings, a.checkVolumes(target, serviceName, node)...)
	findings = append(
		findings,
		a.checkNetworkMode(target, serviceName, node)...)
	findings = append(findings, a.checkPidMode(target, serviceName, node)...)
	findings = append(findings, a.checkIpcMode(target, serviceName, node)...)
	findings = append(
		findings,
		a.checkSecurityOpt(target, serviceName, node)...)
	findings = append(
		findings,
		a.checkResourceLimits(target, serviceName, node)...)
	findings = append(
		findings,
		a.checkEnvironment(target, serviceName, node)...)
	findings = append(findings, a.checkPorts(target, serviceName, node)...)
	findings = append(findings, a.checkUser(target, serviceName, node)...)
	findings = append(findings, a.checkReadOnly(target, serviceName, node)...)

	return findings
}

func (a *ComposeAnalyzer) checkPrivileged(
	target finding.Target,
	serviceName string,
	node *yaml.Node,
) finding.Collection {
	var findings finding.Collection

	privNode := findNode(node, "privileged")
	if privNod
```

---

## File Overview

## compose.go

### Purpose and Responsibility
This Go source file, `compose.go`, is part of the `analyzer` package within the `docksec` project. Its primary responsibility is to perform security analysis on Docker Compose files (`docker-compose.yml`). It checks for various misconfigurations such as privileged containers, sensitive mounts, hardcoded secrets, and more.

### Key Exports and Public Interface
- **ComposeAnalyzer**: A struct that encapsulates the logic for analyzing a specific Docker Compose file.
  - `NewComposeAnalyzer(path string) *ComposeAnalyzer`: Creates a new analyzer instance for a given compose file path.
  - `Name() string`: Returns an identifier prefixed with "compose:".
  - `Analyze(ctx context.Context) (finding.Collection, error)`: Analyzes the specified Compose file and returns findings.

### How It Fits into the Project
This file is crucial as part of the broader security analysis framework within `docksec`. It integrates with other components like `finding` for generating detailed security findings and `rules` for defining and checking against specific security rules. The analyzer reads and parses the Compose file, identifies services, and checks each service's configuration for potential security issues.

### Notable Design Decisions
- **Error Handling**: Uses standard Go error handling practices to manage I/O errors during file reading and YAML parsing.
- **YAML Parsing**: Utilizes `yaml.v3` for parsing the Compose file, ensuring structured data processing.
- **Modular Analysis**: Breaks down the analysis process into smaller functions (`checkPrivileged`, `checkCapabilities`, etc.) for better readability and maintainability.
- **Context Passing**: Uses a context to handle cancellation or timeouts during analysis, adhering to Go's best practices for concurrency and error handling.

---

*Generated by CodeWorm on 2026-02-20 18:59*
