# executor

**Type:** File Overview
**Repository:** oneIsNun_
**File:** go-backend/internal/backup/executor.go
**Language:** go
**Lines:** 1-107
**Complexity:** 0.0

---

## Source Code

```go
/*
AngelaMos | 2026
executor.go
*/

package backup

import (
	"context"
	"fmt"
	"os"
	"os/exec"
	"path/filepath"
	"time"

	"github.com/carterperez-dev/templates/go-backend/internal/config"
)

type Executor struct {
	mongodumpPath    string
	mongorestorePath string
	outputDir        string
	mongoURI         string
}

func NewExecutor(cfg config.BackupConfig, mongoURI string) *Executor {
	return &Executor{
		mongodumpPath:    cfg.MongodumpPath,
		mongorestorePath: cfg.MongorestorePath,
		outputDir:        cfg.OutputDir,
		mongoURI:         mongoURI,
	}
}

type BackupResult struct {
	FilePath  string
	SizeBytes int64
	Duration  time.Duration
}

func (e *Executor) Execute(ctx context.Context, dbName string) (*BackupResult, error) {
	if err := os.MkdirAll(e.outputDir, 0755); err != nil {
		return nil, fmt.Errorf("create output dir: %w", err)
	}

	timestamp := time.Now().Format("2006-01-02_15-04-05")
	filename := fmt.Sprintf("%s_%s.gz", dbName, timestamp)
	outputPath := filepath.Join(e.outputDir, filename)

	start := time.Now()

	cmd := exec.CommandContext(ctx, e.mongodumpPath,
		"--uri", e.mongoURI,
		"--db", dbName,
		"--archive="+outputPath,
		"--gzip",
	)

	output, err := cmd.CombinedOutput()
	if err != nil {
		return nil, fmt.Errorf("mongodump failed: %w, output: %s", err, string(output))
	}

	info, err := os.Stat(outputPath)
	if err != nil {
		return nil, fmt.Errorf("stat backup file: %w", err)
	}

	return &BackupResult{
		FilePath:  outputPath,
		SizeBytes: info.Size(),
		Duration:  time.Since(start),
	}, nil
}

func (e *Executor) Restore(ctx context.Context, backupPath, dbName string) error {
	cmd := exec.CommandContext(ctx, e.mongorestorePath,
		"--uri", e.mongoURI,
		"--db", dbName,
		"--archive="+backupPath,
		"--gzip",
		"--drop",
	)

	output, err := cmd.CombinedOutput()
	if err != nil {
		return fmt.Errorf("mongorestore failed: %w, output: %s", err, string(output))
	}

	return nil
}

func (e *Executor) DeleteFile(path string) error {
	if err := os.Remove(path); err != nil && !os.IsNotExist(err) {
		return fmt.Errorf("delete backup file: %w", err)
	}
	return nil
}

func (e *Executor) GetFileSize(path string) (int64, error) {
	info, err := os.Stat(path)
	if err != nil {
		return 0, err
	}
	return info.Size(), nil
}

```

---

## File Overview

# executor.go

## Purpose and Responsibility
This Go source file defines an `Executor` struct responsible for executing MongoDB backup and restore operations using command-line tools (`mongodump` and `mongorestore`). The file provides methods to create backups, restore from backups, delete files, and retrieve file sizes.

## Key Exports and Public Interface
- **Executor**: A struct that encapsulates the paths to `mongodump` and `mongorestore`, the output directory for backups, and the MongoDB URI.
- **NewExecutor**: Constructs an `Executor` instance with necessary configuration.
- **BackupResult**: Represents the result of a backup operation, including file path, size in bytes, and duration.
- **Execute**: Executes a backup operation for a specified database.
- **Restore**: Restores a database from a given backup file.
- **DeleteFile**: Deletes a specified backup file.
- **GetFileSize**: Retrieves the size of a specified file.

## How It Fits into the Project
This file is part of the `backup` package, which handles all aspects of MongoDB data backups and restores. The `Executor` struct provides a high-level interface for managing these operations, making it easier to integrate backup and restore functionalities across different parts of the application.

## Notable Design Decisions
- **Error Handling**: Uses Go's idiomatic error handling with `fmt.Errorf` to provide clear and descriptive error messages.
- **Context Management**: Utilizes context.Context for graceful shutdowns and cancellations during operations, ensuring that long-running processes can be interrupted if needed.
- **Command Execution**: Leverages the `exec.CommandContext` method to execute shell commands securely and efficiently.
- **File Operations**: Implements methods to manage backup files, including creation, deletion, and size retrieval, ensuring data integrity and cleanup.
```

This documentation provides a concise overview of the file's purpose, key components, integration within the project, and notable design choices.

---

*Generated by CodeWorm on 2026-02-20 01:20*
