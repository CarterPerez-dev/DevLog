# transport

**Type:** File Overview
**Repository:** Telehook
**File:** src/telehook/transport.py
**Language:** python
**Lines:** 1-59
**Complexity:** 0.0

---

## Source Code

```python
"""
Â©AngelaMos | 2026
transport.py
"""

from typing import Any

import httpx

from telehook.config import TelehookConfig
from telehook.message import Message


class TelegramAPIError(Exception):
    def __init__(
        self,
        status_code: int,
        description: str,
        retry_after: int | None = None
    ):
        self.status_code = status_code
        self.description = description
        self.retry_after = retry_after
        super().__init__(f"Telegram API error {status_code}: {description}")


class Transport:
    def __init__(self, config: TelehookConfig):
        self._config = config
        self._client = httpx.AsyncClient()

    async def send(self, message: Message) -> dict[str, Any]:
        payload = message.to_payload(chat_id = self._config.chat_id)
        response = await self._client.post(self._config.send_url, json = payload)
        data = response.json()

        if not data.get("ok"):
            retry_after = None
            params = data.get("parameters", {})
            if params:
                retry_after = params.get("retry_after")
            raise TelegramAPIError(
                status_code = response.status_code,
                description = data.get("description",
                                       "Unknown error"),
                retry_after = retry_after,
            )

        return data["result"]

    async def close(self) -> None:
        await self._client.aclose()

    async def __aenter__(self) -> "Transport":
        return self

    async def __aexit__(self, *exc: object) -> None:
        await self.close()

```

---

## File Overview

## transport.py

**Purpose and Responsibility:**
This file defines the `Transport` class, responsible for interfacing with Telegram's API to send messages. It handles HTTP requests using `httpx`, manages configuration through `TelehookConfig`, and raises custom exceptions for API errors.

**Key Exports/Interface:**
- **Class:** `Transport`
  - **Methods:** `send()`, `close()`, `__aenter__()`, `__aexit__()`  
  - **Properties:** `_config` (private), `_client` (private)

**Project Integration:**
The `Transport` class is a core component of the Telehook project, facilitating message sending functionality. It interacts with other modules like `TelehookConfig` and `Message` to construct and send messages.

**Design Decisions:**
- **Asynchronous Operations:** Uses `httpx.AsyncClient` for asynchronous HTTP requests.
- **Custom Exception Handling:** Implements `TelegramAPIError` to handle specific API errors gracefully, including retry logic based on `retry_after`.
- **Context Management:** Supports context management with `__aenter__()` and `__aexit__()` methods, ensuring proper cleanup of the `httpx.AsyncClient`.

This design ensures efficient and robust message sending while maintaining a clean separation of concerns within the Telehook project.

---

*Generated by CodeWorm on 2026-02-28 23:50*
