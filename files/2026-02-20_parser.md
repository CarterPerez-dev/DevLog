# parser

**Type:** File Overview
**Repository:** angela
**File:** internal/pyproject/parser.go
**Language:** go
**Lines:** 1-118
**Complexity:** 0.0

---

## Source Code

```go
// ©AngelaMos | 2026
// parser.go

package pyproject

import (
	"fmt"
	"os"
	"strings"

	"github.com/CarterPerez-dev/angela/pkg/types"
	toml "github.com/pelletier/go-toml/v2"
)

type pyProjectFile struct {
	Project struct {
		Name                 string              `toml:"name"`
		Version              string              `toml:"version"`
		Dependencies         []string            `toml:"dependencies"`
		OptionalDependencies map[string][]string `toml:"optional-dependencies"`
	} `toml:"project"`
}

// ParseFile reads a pyproject.toml and extracts all dependency declarations
func ParseFile(path string) ([]types.Dependency, error) {
	data, err := os.ReadFile(path) //nolint:gosec
	if err != nil {
		if os.IsNotExist(err) {
			return nil, fmt.Errorf(
				"open %s: file not found (run from your project root)",
				path,
			)
		}
		return nil, fmt.Errorf("read %s: %w", path, err)
	}

	var proj pyProjectFile
	if err := toml.Unmarshal(data, &proj); err != nil {
		return nil, fmt.Errorf(
			"parse %s: invalid TOML syntax: %w", path, err,
		)
	}

	var deps []types.Dependency

	for _, raw := range proj.Project.Dependencies {
		deps = append(deps, ParseDependency(raw, ""))
	}

	for group, entries := range proj.Project.OptionalDependencies {
		for _, raw := range entries {
			deps = append(deps, ParseDependency(raw, group))
		}
	}

	if len(deps) == 0 {
		return nil, fmt.Errorf(
			"%s: no dependencies found in [project.dependencies] or [project.optional-dependencies]",
			path,
		)
	}
	return deps, nil
}

// ParseDependency splits a PEP 508 dependency string into its components
func ParseDependency(raw, group string) types.Dependency {
	dep := types.Dependency{Group: group}
	s := strings.TrimSpace(raw)

	if idx := strings.Index(s, ";"); idx >= 0 {
		dep.Markers = strings.TrimSpace(s[idx+1:])
		s = s[:idx]
	}
	s = strings.TrimSpace(s)

	if start := strings.Index(s, "["); start >= 0 {
		end := strings.Index(s, "]")
		if end > start {
			for _, e := range strings.Split(s[start+1:end], ",") {
				dep.Extras = append(
					dep.Extras,
					strings.TrimSpace(e),
				)
			}
			s = s[:start] + s[end+1:]
		}
	}

	if idx := strings.IndexAny(s, "><=!~"); idx >= 0 {
		dep.Name = strings.TrimSpace(s[:idx])
		dep.Spec = strings.TrimSpace(s[idx:])
	} else {
		dep.Name = strings.TrimSpace(s)
	}

	return dep
}

// ExtractMinVersion returns the first pinned or lower-bound version from a
// PEP 440 version specifier string. Returns empty if no version is specified.
func ExtractMinVersion(spec string) string {
	for _, part := range strings.Split(spec, ",") {
		part = strings.TrimSpace(part)
		switch {
		case strings.HasPrefix(part, ">="):
			return strings.TrimSpace(part[2:])
		case strings.HasPrefix(part, "=="):
			return strings.TrimSuffix(
				strings.TrimSpace(part[2:]),
				".*",
			)
		case strings.HasPrefix(part, "~="):
			return strings.TrimSpace(part[2:])
		}
	}
	return ""
}

```

---

## File Overview

// ©AngelaMos | 2026
// parser.go

### Purpose and Responsibility
This file is responsible for parsing `pyproject.toml` files to extract dependency declarations, including both mandatory and optional dependencies. It ensures that the project's dependency requirements are correctly identified and structured.

### Key Exports and Public Interface
- **ParseFile**: The primary function that reads a `pyproject.toml` file, parses its contents, and returns a list of `types.Dependency` objects.
- **ParseDependency**: A helper function to split PEP 508 dependency strings into their components (name, specifiers, markers, extras).
- **ExtractMinVersion**: Utility function to extract the minimum version from a PEP 440 version specifier string.

### How It Fits in the Project
This file is part of the `pyproject` package within the larger `angela` project. Its role is crucial for handling Python project configuration files, enabling the tool to understand and manage dependencies as specified by the user or project setup.

### Notable Design Decisions
- **Error Handling**: The function `ParseFile` returns detailed error messages, helping users identify issues such as missing files or malformed TOML syntax.
- **PEP 508 Compliance**: The implementation adheres to PEP 508 standards for dependency specifications, ensuring compatibility with a wide range of package managers and tools.
- **Modular Structure**: Functions are designed to be modular and reusable, promoting clear separation of concerns and making the codebase easier to maintain.
```

This documentation provides an overview of the file's purpose, key functions, integration within the project, and important design choices.

---

*Generated by CodeWorm on 2026-02-20 17:58*
