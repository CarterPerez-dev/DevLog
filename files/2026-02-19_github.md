# github

**Type:** File Overview
**Repository:** kill-pr0cess.inc
**File:** backend/src/routes/github.rs
**Language:** rust
**Lines:** 1-512
**Complexity:** 0.0

---

## Source Code

```rust
/*
 * Â©AngelaMos | 2025
 */

use axum::{
    extract::{Path, Query, State},
    http::StatusCode,
    Json,
    response::Json as JsonResponse,
};
use serde::{Deserialize, Serialize};
use std::collections::HashMap;
use tracing::{info, warn, error, debug};
use uuid::Uuid;

use crate::{
    models::github::{
        Repository, RepositoryDetailed, RepositoryCollection, RepositoryFilter,
        RepositorySort, CollectionStats, RateLimitInfo, calculate_collection_stats
    },
    utils::error::{AppError, Result},
    AppState,
};

#[derive(Debug, Deserialize)]
pub struct RepositoryQuery {
    pub page: Option<i32>,
    pub per_page: Option<i32>,
    pub sort: Option<String>,
    pub direction: Option<String>,
    pub language: Option<String>,
    pub min_stars: Option<i32>,
    pub max_stars: Option<i32>,
    pub is_fork: Option<bool>,
    pub is_archived: Option<bool>,
    pub search: Option<String>,
}

#[derive(Debug, Serialize)]
pub struct RepositoryResponse {
    pub repositories: Vec<Repository>,
    pub pagination: PaginationInfo,
    pub statistics: CollectionStats,
    pub rate_limit: RateLimitInfo,
    pub cache_info: CacheInfo,
}

#[derive(Debug, Serialize)]
pub struct PaginationInfo {
    pub current_page: i32,
    pub per_page: i32,
    pub total_pages: i32,
    pub total_count: i32,
    pub has_next_page: bool,
    pub has_previous_page: bool,
}

#[derive(Debug, Serialize)]
pub struct CacheInfo {
    pub cached: bool,
    pub cache_age_seconds: i64,
    pub expires_in_seconds: i64,
}

/// Get paginated list of repositories with comprehensive filtering and sorting
/// I'm providing a full-featured repository listing endpoint with performance optimization
pub async fn get_repositories(
    State(app_state): State<AppState>,
    Query(params): Query<RepositoryQuery>,
) -> Result<JsonResponse<RepositoryResponse>> {
    info!("Fetching repositories with params: {:?}", params);

    // I'm setting sensible defaults for pagination and validation
    let page = params.page.unwrap_or(1).max(1);
    let per_page = params.per_page.unwrap_or(20).clamp(1, 100);
    let offset = (page - 1) * per_page;

    // Get GitHub username from config
    let username = &app_state.config.github_username;

    // Try to get fresh repositories from GitHub API
    let repositories = match app_state.github_service.get_user_repositories(username).await {
        Ok(repos) => {
            // Store in database for caching
            if let Err(e) = app_state.github_service.store_repositories_in_db(&app_state.db_pool, &repos).await {
                warn!("Failed to store repositories in database: {}", e);
            }
            repos
        }
        Err(e) => {
            warn!("GitHub API failed, falling back to database cache: {}", e);
            // Fallback to database cache
            get_repositories_from_db(&app_state, username).await?
        }
    };

    // Apply filtering
    let filter = create_filter_from_params(&params);
    let filtered_repos =
```

---

## File Overview

# Documentation for `github.rs`

## Purpose and Responsibility

This file defines an endpoint for fetching paginated repositories from GitHub with comprehensive filtering, sorting, and caching mechanisms. It integrates with the `AppState` to handle database operations and rate limiting.

## Key Exports and Public Interface

- **`RepositoryQuery`**: A struct representing query parameters for repository listing.
- **`RepositoryResponse`**: A struct containing the paginated repositories, pagination info, statistics, and rate limit information.
- **`get_repositories`**: The main function that handles the request to fetch repositories based on provided filters and returns a `JsonResponse`.

## How It Fits in the Project

This file is part of the backend API for managing GitHub repositories. It interacts with other modules like `AppState`, `github_service`, and database operations through dependencies defined in the `Cargo.toml`. The function `get_repositories` is registered as an endpoint in the `axum` router, making it accessible via HTTP requests.

## Notable Design Decisions

- **Caching**: Repositories are stored in a database for caching to reduce API calls and improve performance.
- **Rate Limiting**: Rate limit information is fetched from the GitHub API and included in the response headers.
- **Pagination and Sorting**: Comprehensive pagination and sorting logic ensures flexibility in querying repositories based on various criteria.
- **Error Handling**: The function uses `Result` to handle potential errors, ensuring robustness and clear error messages.
```

This documentation provides a high-level overview of the file's purpose, key components, integration within the project, and notable design choices.

---

*Generated by CodeWorm on 2026-02-19 21:24*
