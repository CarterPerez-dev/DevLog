# json

**Type:** File Overview
**Repository:** docksec
**File:** internal/report/json.go
**Language:** go
**Lines:** 1-147
**Complexity:** 0.0

---

## Source Code

```go
/*
AngelaMos | 2025
json.go
*/

package report

import (
	"encoding/json"
	"io"
	"time"

	"github.com/CarterPerez-dev/docksec/internal/finding"
)

type JSONReporter struct {
	w      io.Writer
	closer func() error
}

type jsonReport struct {
	Version   string        `json:"version"`
	Timestamp string        `json:"timestamp"`
	Summary   jsonSummary   `json:"summary"`
	Findings  []jsonFinding `json:"findings"`
}

type jsonSummary struct {
	Total      int            `json:"total"`
	BySeverity map[string]int `json:"by_severity"`
}

type jsonFinding struct {
	ID          string        `json:"id"`
	RuleID      string        `json:"rule_id"`
	Title       string        `json:"title"`
	Description string        `json:"description,omitempty"`
	Severity    string        `json:"severity"`
	Category    string        `json:"category,omitempty"`
	Target      jsonTarget    `json:"target"`
	Location    *jsonLocation `json:"location,omitempty"`
	Remediation string        `json:"remediation,omitempty"`
	References  []string      `json:"references,omitempty"`
	CISControl  *jsonCIS      `json:"cis_control,omitempty"`
	Timestamp   string        `json:"timestamp"`
}

type jsonTarget struct {
	Type string `json:"type"`
	Name string `json:"name"`
	ID   string `json:"id,omitempty"`
}

type jsonLocation struct {
	Path   string `json:"path"`
	Line   int    `json:"line,omitempty"`
	Column int    `json:"column,omitempty"`
}

type jsonCIS struct {
	ID          string `json:"id"`
	Section     string `json:"section,omitempty"`
	Title       string `json:"title"`
	Description string `json:"description,omitempty"`
	Scored      bool   `json:"scored"`
	Level       int    `json:"level"`
}

func (r *JSONReporter) Report(findings finding.Collection) error {
	defer func() {
		if r.closer != nil {
			_ = r.closer()
		}
	}()

	report := r.buildReport(findings)

	enc := json.NewEncoder(r.w)
	enc.SetIndent("", "  ")
	enc.SetEscapeHTML(false)

	return enc.Encode(report)
}

func (r *JSONReporter) buildReport(findings finding.Collection) jsonReport {
	counts := findings.CountBySeverity()
	bySeverity := make(map[string]int)
	for sev, count := range counts {
		bySeverity[sev.String()] = count
	}

	jsonFindings := make([]jsonFinding, 0, len(findings))
	for _, f := range findings {
		jsonFindings = append(jsonFindings, r.convertFinding(f))
	}

	return jsonReport{
		Version:   "1.0.0",
		Timestamp: time.Now().UTC().Format(time.RFC3339),
		Summary: jsonSummary{
			Total:      len(findings),
			BySeverity: bySeverity,
		},
		Findings: jsonFindings,
	}
}

func (r *JSONReporter) convertFinding(f *finding.Finding) jsonFinding {
	jf := jsonFinding{
		ID:          f.ID,
		RuleID:      f.RuleID,
		Title:       f.Title,
		Description: f.Description,
		Severity:    f.Severity.String(),
		Category:    f.Category,
		Target: jsonTarget{
			Type: string(f.Target.Type),
			Name: f.Target.Name,
			ID:   f.Target.ID,
		},
		Remediation: f.Remediation,
		References:  f.References,
		Timestamp:   f.Timestamp.UTC().For
```

---

## File Overview

# json.go

## Purpose and Responsibility
This Go source file defines a JSON reporter for generating structured reports of security findings. It serializes findings into a JSON format, including metadata such as version, timestamp, summary statistics, and detailed finding information.

## Key Exports and Public Interface
- **JSONReporter**: The primary struct responsible for creating and writing JSON reports.
  - `Report(findings finding.Collection) error`: Encodes and writes the report to an output writer.
  - `buildReport(findings finding.Collection) jsonReport`: Constructs the JSON report from a collection of findings.
  - `convertFinding(f *finding.Finding) jsonFinding`: Converts a single finding into its JSON representation.

## How It Fits in the Project
This file is part of the `report` package, which handles various reporting mechanisms for security findings. The JSON reporter integrates with other components like `finding.Collection`, which aggregates and categorizes findings. It outputs reports that can be used for documentation or further analysis.

## Notable Design Decisions
- **Error Handling**: Errors are handled gracefully by deferring the closure of any writer resources.
- **Indentation and Formatting**: The JSON encoder uses indentation and sets escape HTML to false, ensuring readability and proper formatting.
- **Struct Mapping**: Structs like `jsonReport`, `jsonSummary`, etc., map directly to JSON fields, facilitating easy serialization.
- **Time Handling**: Timestamps are formatted using RFC3339 for consistency and ease of parsing.
```

This documentation provides a high-level overview of the file's purpose, key components, integration within the project, and significant design choices.

---

*Generated by CodeWorm on 2026-02-20 20:47*
