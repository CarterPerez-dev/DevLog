# junit

**Type:** File Overview
**Repository:** docksec
**File:** internal/report/junit.go
**Language:** go
**Lines:** 1-211
**Complexity:** 0.0

---

## Source Code

```go
/*
AngelaMos | 2025
junit.go
*/

package report

import (
	"encoding/xml"
	"fmt"
	"io"
	"time"

	"github.com/CarterPerez-dev/docksec/internal/finding"
)

type JUnitReporter struct {
	w      io.Writer
	closer func() error
}

type junitTestSuites struct {
	XMLName   xml.Name         `xml:"testsuites"`
	Name      string           `xml:"name,attr"`
	Tests     int              `xml:"tests,attr"`
	Failures  int              `xml:"failures,attr"`
	Errors    int              `xml:"errors,attr"`
	Time      float64          `xml:"time,attr"`
	Timestamp string           `xml:"timestamp,attr"`
	Suites    []junitTestSuite `xml:"testsuite"`
}

type junitTestSuite struct {
	Name      string          `xml:"name,attr"`
	Tests     int             `xml:"tests,attr"`
	Failures  int             `xml:"failures,attr"`
	Errors    int             `xml:"errors,attr"`
	Skipped   int             `xml:"skipped,attr"`
	Time      float64         `xml:"time,attr"`
	Timestamp string          `xml:"timestamp,attr"`
	TestCases []junitTestCase `xml:"testcase"`
}

type junitTestCase struct {
	Name      string        `xml:"name,attr"`
	ClassName string        `xml:"classname,attr"`
	Time      float64       `xml:"time,attr"`
	Failure   *junitFailure `xml:"failure,omitempty"`
}

type junitFailure struct {
	Message string `xml:"message,attr"`
	Type    string `xml:"type,attr"`
	Content string `xml:",chardata"`
}

func (r *JUnitReporter) Report(findings finding.Collection) error {
	defer func() {
		if r.closer != nil {
			_ = r.closer()
		}
	}()

	report := r.buildReport(findings)

	_, _ = fmt.Fprintln(r.w, xml.Header)
	enc := xml.NewEncoder(r.w)
	enc.Indent("", "  ")

	return enc.Encode(report)
}

func (r *JUnitReporter) buildReport(
	findings finding.Collection,
) junitTestSuites {
	grouped := r.groupByCategory(findings)
	timestamp := time.Now().UTC().Format(time.RFC3339)

	var suites []junitTestSuite
	totalTests := 0
	totalFailures := 0

	for category, catFindings := range grouped {
		suite := r.buildSuite(category, catFindings, timestamp)
		suites = append(suites, suite)
		totalTests += suite.Tests
		totalFailures += suite.Failures
	}

	if len(suites) == 0 {
		suites = append(suites, junitTestSuite{
			Name:      "Security Checks",
			Tests:     1,
			Failures:  0,
			Errors:    0,
			Skipped:   0,
			Time:      0.001,
			Timestamp: timestamp,
			TestCases: []junitTestCase{
				{
					Name:      "All security checks passed",
					ClassName: "docksec.security",
					Time:      0.001,
				},
			},
		})
		totalTests = 1
	}

	return junitTestSuites{
		Name:      "docksec Security Scan",
		Tests:     totalTests,
		Failures:  totalFailures,
		Errors:    0,
		Time:      0.001,
		Timestamp: timestamp,
		Suites:    suites,
	}
}

func (r *JUnitReporter) buildSuite(
	category string,
	findings finding.Collection,
	timestamp string,
) junitTestSuite {
	var testCases []junitTestCase
	failures := 0

	for _, f := range findings {
		tc := r.buildTestCase(f)
		testCases = append(testCases, tc)
		if tc
```

---

## File Overview

# File Documentation: `junit.go`

## Purpose and Responsibility

This file implements a JUnit reporter for generating XML test reports from security findings. It is responsible for converting a collection of `finding` objects into a structured JUnit report, which can be used by CI/CD pipelines to track and manage security checks.

## Key Exports and Public Interface

- **JUnitReporter**: The main struct that handles the reporting process.
  - `Report(findings finding.Collection) error`: Encodes findings into a JUnit XML format.
  - `buildReport(findings finding.Collection) junitTestSuites`: Constructs the overall report structure.
  - `buildSuite(category string, findings finding.Collection, timestamp string) junitTestSuite`: Builds individual test suites for each category of findings.
  - `buildTestCase(f *finding.Finding) junitTestCase`: Converts a single finding into a JUnit test case.

## Fit in the Project

This file is part of the `report` package within the `docksec` project, which focuses on generating various types of reports from security findings. The JUnit reporter integrates seamlessly with other reporting mechanisms to provide comprehensive security assessment outputs.

## Notable Design Decisions

- **Error Handling**: Errors are handled gracefully by deferring the closure function and logging any issues.
- **XML Encoding**: Utilizes Go's `encoding/xml` package for structured XML encoding, ensuring compliance with JUnit standards.
- **Structured Grouping**: Findings are grouped by category to provide a clear breakdown of security checks in the report.
- **Custom Failure Content**: Generates detailed failure messages that include severity, target details, location, description, remediation steps, and CIS controls.
```

This documentation provides an overview of the file's role within the project, its key components, and important design choices.

---

*Generated by CodeWorm on 2026-02-20 20:10*
