# admin

**Type:** File Overview
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/auth/routes/admin.py
**Language:** python
**Lines:** 1-151
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2025
admin.py
"""

from uuid import UUID
from typing import Annotated

from fastapi import (
    APIRouter,
    Depends,
    Query,
    status,
)

from config import (
    settings,
    UserRole,
)
from core.security.auth.dependencies import (
    DBSession,
    RequireRole,
)
from core.foundation.responses import (
    AUTH_401,
    CONFLICT_409,
    FORBIDDEN_403,
    NOT_FOUND_404,
)
from aspects.auth.schemas.user import (
    AdminUserCreate,
    UserListResponse,
    UserResponse,
    UserUpdateAdmin,
)
from aspects.auth.models.User import User
from aspects.auth.services.user import UserService


router = APIRouter(prefix = "/admin", tags = ["admin"])

AdminOnly = Annotated[User, Depends(RequireRole(UserRole.ADMIN))]


@router.get(
    "/users",
    response_model = UserListResponse,
    responses = {
        **AUTH_401,
        **FORBIDDEN_403
    },
)
async def list_users(
    db: DBSession,
    _: AdminOnly,
    page: int = Query(default = 1,
                      ge = 1),
    size: int = Query(
        default = settings.PAGINATION_DEFAULT_SIZE,
        ge = 1,
        le = settings.PAGINATION_MAX_SIZE
    ),
) -> UserListResponse:
    """
    List all users (admin only)
    """
    return await UserService.list_users(db, page, size)


@router.post(
    "/users",
    response_model = UserResponse,
    status_code = status.HTTP_201_CREATED,
    responses = {
        **AUTH_401,
        **FORBIDDEN_403,
        **CONFLICT_409
    },
)
async def create_user(
    db: DBSession,
    _: AdminOnly,
    user_data: AdminUserCreate,
) -> UserResponse:
    """
    Create a new user (admin only, bypasses registration)
    """
    return await UserService.admin_create_user(db, user_data)


@router.get(
    "/users/{user_id}",
    response_model = UserResponse,
    responses = {
        **AUTH_401,
        **FORBIDDEN_403,
        **NOT_FOUND_404
    },
)
async def get_user(
    db: DBSession,
    _: AdminOnly,
    user_id: UUID,
) -> UserResponse:
    """
    Get user by ID (admin only)
    """
    return await UserService.get_user_by_id(db, user_id)


@router.patch(
    "/users/{user_id}",
    response_model = UserResponse,
    responses = {
        **AUTH_401,
        **FORBIDDEN_403,
        **NOT_FOUND_404,
        **CONFLICT_409
    },
)
async def update_user(
    db: DBSession,
    _: AdminOnly,
    user_id: UUID,
    user_data: UserUpdateAdmin,
) -> UserResponse:
    """
    Update user (admin only)
    """
    return await UserService.admin_update_user(db, user_id, user_data)


@router.delete(
    "/users/{user_id}",
    status_code = status.HTTP_204_NO_CONTENT,
    responses = {
        **AUTH_401,
        **FORBIDDEN_403,
        **NOT_FOUND_404
    },
)
async def delete_user(
    db: DBSession,
    _: AdminOnly,
    user_id: UUID,
) -> None:
    """
    Delete user (admin only, hard delete)
    """
    await UserService.admin_delete_user(db, user_id)

```

---

## File Overview

**File Purpose and Responsibility:**
This Python source file, `admin.py`, is part of the authentication module within a larger FastAPI application for CarterOS-Server. It provides an administrative API endpoint to manage users, including listing, creating, updating, and deleting user records.

**Key Exports or Public Interface:**
The file exports several endpoints that are accessible via the `/admin` prefix:
1. `list_users`: Lists all users.
2. `create_user`: Creates a new user with admin privileges.
3. `get_user`: Retrieves a user by ID.
4. `update_user`: Updates an existing user's information.
5. `delete_user`: Deletes a user.

**How It Fits in the Project:**
This file is crucial for administrative tasks, ensuring that only users with the `ADMIN` role can perform these actions. It integrates with the `UserService` to handle database operations and leverages dependency injection for session management and role checks. The endpoints are designed to be secure and robust, handling various HTTP status codes and error responses.

**Notable Design Decisions:**
- **Role-Based Access Control (RBAC):** Utilizes `RequireRole` to ensure only admins can access these routes.
- **Pagination:** Implements pagination for listing users to manage large datasets efficiently.
- **Dependency Injection:** Uses `DBSession` and `AdminOnly` annotations to inject dependencies, promoting testability and separation of concerns.
```

This documentation provides a high-level overview of the file's purpose, key components, integration within the project, and significant design choices.

---

*Generated by CodeWorm on 2026-02-19 19:28*
