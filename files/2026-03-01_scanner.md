# scanner

**Type:** File Overview
**Repository:** Yoshi-Audit
**File:** internal/audit/scanner.go
**Language:** go
**Lines:** 1-208
**Complexity:** 0.0

---

## Source Code

```go
// Â©AngelaMos | 2026
// scanner.go

package audit

import (
	"fmt"

	"github.com/CarterPerez-dev/yoshi-audit/internal/system"
)

type FindingType string

const (
	FindingZombie       FindingType = "zombie"
	FindingOrphan       FindingType = "orphan"
	FindingDaemon       FindingType = "daemon"
	FindingKernelThread FindingType = "kthread"
	FindingGPUShadow    FindingType = "gpushadow"
	FindingMemoryLeak   FindingType = "memleak"
	FindingUnknownSvc   FindingType = "unknown"
)

type Severity string

const (
	SeverityOK   Severity = "OK"
	SeverityWarn Severity = "WARN"
	SeverityCrit Severity = "CRIT"
)

type Finding struct {
	Type     FindingType
	Severity Severity
	PID      int
	Name     string
	Message  string
	Detail   string
}

type Scanner struct {
	knownGoods map[string]string
	baseline   *Baseline
}

func NewScanner(baseline *Baseline) *Scanner {
	return &Scanner{
		knownGoods: KnownGoodProcesses,
		baseline:   baseline,
	}
}

func (s *Scanner) ScanAll(procs []system.ProcessInfo, gpuProcs []system.GPUProcess) []Finding {
	var findings []Finding
	findings = append(findings, s.ScanZombies(procs)...)
	findings = append(findings, s.ScanOrphans(procs)...)
	findings = append(findings, s.ScanDaemons(procs)...)
	findings = append(findings, s.ScanKernelThreads(procs)...)
	findings = append(findings, s.ScanGPUShadows(procs, gpuProcs)...)
	return findings
}

func (s *Scanner) ScanZombies(procs []system.ProcessInfo) []Finding {
	var findings []Finding
	for _, p := range procs {
		if p.State == "Z" {
			findings = append(findings, Finding{
				Type:     FindingZombie,
				Severity: SeverityWarn,
				PID:      p.PID,
				Name:     p.Name,
				Message:  fmt.Sprintf("Zombie process (parent: PID %d)", p.PPID),
				Detail:   p.Cmdline,
			})
		}
	}
	return findings
}

func (s *Scanner) ScanOrphans(procs []system.ProcessInfo) []Finding {
	var findings []Finding
	for _, p := range procs {
		if p.PPID != 1 {
			continue
		}
		if s.isKnown(p.Name) {
			continue
		}
		findings = append(findings, Finding{
			Type:     FindingOrphan,
			Severity: SeverityWarn,
			PID:      p.PID,
			Name:     p.Name,
			Message:  "Orphaned process (re-parented to systemd)",
			Detail:   p.Cmdline,
		})
	}
	return findings
}

func (s *Scanner) ScanDaemons(procs []system.ProcessInfo) []Finding {
	var findings []Finding
	for _, p := range procs {
		if p.State != "S" {
			continue
		}
		if s.isKnown(p.Name) {
			continue
		}
		findings = append(findings, Finding{
			Type:     FindingDaemon,
			Severity: SeverityWarn,
			PID:      p.PID,
			Name:     p.Name,
			Message:  fmt.Sprintf("Unknown daemon: %s (RSS: %d MiB)", p.Cmdline, p.RSS/(1024*1024)),
			Detail:   p.Cmdline,
		})
	}
	return findings
}

func (s *Scanner) ScanKernelThreads(procs []system.ProcessInfo) []Finding {
	count := 0
	for _, p := range procs {
		if p.PPID == 2 {
			count++
		}
	}
	if count == 0 {
		return nil
	}
	return []Finding{
		{
			Type:     FindingKernelThread,
			Severity: SeverityOK,
			PID:      0,
			Name:     
```

---

## File Overview

# scanner.go

## Purpose and Responsibility
This Go source file defines a `Scanner` struct responsible for identifying potential issues within system processes, such as zombie processes, orphaned daemons, kernel threads, GPU shadows, and memory leaks. The scanner leverages known good process lists and baseline configurations to flag suspicious or abnormal behavior.

## Key Exports and Public Interface
- **FindingType**: An enumeration of different types of findings.
- **Severity**: An enumeration representing the severity level of a finding.
- **Finding**: A struct representing a detected issue, including its type, severity, PID, name, message, and detail.
- **Scanner**: A struct that encapsulates the logic for scanning processes. Key methods include `NewScanner`, which initializes a scanner with baseline data, and various `Scan` methods (e.g., `ScanZombies`, `ScanOrphans`) to identify specific issues.

## How It Fits into the Project
The `scanner.go` file is part of the `audit` package within the `yoshi-audit` project. It integrates with other components like `system` and `Baseline` to provide comprehensive process monitoring and anomaly detection. The findings generated by this scanner are used for further analysis or reporting.

## Notable Design Decisions
- **Error Handling**: While not explicitly shown, error handling is implicitly managed through the use of Go's idiomatic return values from methods.
- **Concurrency**: Although no goroutines are directly used in `scanner.go`, it could be extended to handle large datasets concurrently for improved performance.
- **Interfaces and Dependencies**: The scanner relies on interfaces like `system.ProcessInfo` and `Baseline.IsKnown`, promoting loose coupling and flexibility. It also uses a map of known good processes, enhancing its ability to identify anomalies.

---

*Generated by CodeWorm on 2026-03-01 10:52*
