# program_repo

**Type:** File Overview
**Repository:** stripe-referral
**File:** src/stripe_referral/repositories/program_repo.py
**Language:** python
**Lines:** 1-75
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2025 | CertGames.com
Referral program repository
"""

from sqlalchemy import select
from sqlalchemy.orm import Session

from ..models.ReferralProgram import ReferralProgram

from .base import BaseRepository


class ReferralProgramRepository(BaseRepository[ReferralProgram]):
    """
    Repository for ReferralProgram database operations
    """
    def __init__(self, db: Session) -> None:
        """
        Initialize with ReferralProgram model
        """
        super().__init__(db, ReferralProgram)

    def get_by_key(self, program_key: str) -> ReferralProgram | None:
        """
        Get program by unique program key
        """
        stmt = select(ReferralProgram).where(
            ReferralProgram.program_key == program_key
        )
        return self.db.execute(stmt).scalar_one_or_none()

    def get_by_name(self, name: str) -> ReferralProgram | None:
        """
        Get program by unique name
        """
        stmt = select(ReferralProgram).where(ReferralProgram.name == name)
        return self.db.execute(stmt).scalar_one_or_none()

    def get_active_programs(self) -> list[ReferralProgram]:
        """
        Get all active programs
        """
        stmt = select(ReferralProgram).where(ReferralProgram.is_active)
        return list(self.db.execute(stmt).scalars().all())

    def deactivate_program(
        self,
        program_id: int
    ) -> ReferralProgram | None:
        """
        Deactivate a program
        """
        program = self.get_by_id(program_id)
        if not program:
            return None

        program.is_active = False
        self.db.commit()
        self.db.refresh(program)
        return program

    def activate_program(self, program_id: int) -> ReferralProgram | None:
        """
        Activate a program
        """
        program = self.get_by_id(program_id)
        if not program:
            return None

        program.is_active = True
        self.db.commit()
        self.db.refresh(program)
        return program

```

---

## File Overview

### Purpose and Responsibility

This file defines a repository for managing `ReferralProgram` entities within a SQLAlchemy database context. It provides methods to interact with referral programs, including retrieval by key or name, listing active programs, and deactivating/activating specific programs.

### Key Exports and Public Interface

- **Class**: `ReferralProgramRepository`
  - **Methods**:
    - `__init__(self, db: Session)`: Initializes the repository with a database session.
    - `get_by_key(self, program_key: str) -> ReferralProgram | None`: Retrieves a referral program by its unique key.
    - `get_by_name(self, name: str) -> ReferralProgram | None`: Retrieves a referral program by its name.
    - `get_active_programs(self) -> list[ReferralProgram]`: Lists all active referral programs.
    - `deactivate_program(self, program_id: int) -> ReferralProgram | None`: Deactivates a specific referral program.
    - `activate_program(self, program_id: int) -> ReferralProgram | None`: Activates a specific referral program.

### How it Fits into the Project

This repository is part of the broader `stripe-referral` project, handling database operations for managing referral programs. It integrates with other modules that might need to query or modify referral programs, ensuring data consistency and integrity through SQLAlchemy ORM.

### Notable Design Decisions

- **Type Hints**: Utilizes Python type hints for method parameters and return types, enhancing code readability and maintainability.
- **Database Operations**: Uses SQLAlchemy's `Session` object for database interactions, providing a robust and flexible ORM layer.
- **Repository Pattern**: Adheres to the repository pattern, separating data access logic from business logic, making the system more modular and testable.

---

*Generated by CodeWorm on 2026-02-20 10:13*
