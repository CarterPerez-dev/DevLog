# system

**Type:** File Overview
**Repository:** angelamos-operations
**File:** Docker-Kentros/internal/docker/system.go
**Language:** go
**Lines:** 1-259
**Complexity:** 0.0

---

## Source Code

```go
/*
AngelaMos | 2026
system.go
*/

package docker

import (
	"bufio"
	"context"
	"fmt"
	"net"
	"os/exec"
	"strconv"
	"strings"

	"github.com/docker/docker/api/types"
	"github.com/docker/docker/api/types/build"
	"github.com/docker/docker/api/types/filters"

	"github.com/carterperez-dev/holophyly/internal/model"
)

// GetSystemInfo returns Docker daemon system information.
func (c *Client) GetSystemInfo(ctx context.Context) (*model.SystemInfo, error) {
	c.mu.RLock()
	defer c.mu.RUnlock()

	info, err := c.cli.Info(ctx)
	if err != nil {
		return nil, fmt.Errorf("getting system info: %w", err)
	}

	version, err := c.cli.ServerVersion(ctx)
	if err != nil {
		return nil, fmt.Errorf("getting server version: %w", err)
	}

	return &model.SystemInfo{
		DockerVersion:     version.Version,
		APIVersion:        version.APIVersion,
		OS:                info.OperatingSystem,
		Arch:              info.Architecture,
		Containers:        info.Containers,
		ContainersRunning: info.ContainersRunning,
		ContainersPaused:  info.ContainersPaused,
		ContainersStopped: info.ContainersStopped,
		Images:            info.Images,
	}, nil
}

// GetStorageInfo returns disk usage information for Docker resources.
func (c *Client) GetStorageInfo(
	ctx context.Context,
) (*model.StorageInfo, error) {
	c.mu.RLock()
	defer c.mu.RUnlock()

	usage, err := c.cli.DiskUsage(ctx, types.DiskUsageOptions{})
	if err != nil {
		return nil, fmt.Errorf("getting disk usage: %w", err)
	}

	info := &model.StorageInfo{
		Details: model.StorageDetails{
			Images:     make([]model.ImageInfo, 0),
			Volumes:    make([]model.VolumeInfo, 0),
			BuildCache: make([]model.CacheInfo, 0),
		},
	}

	for _, img := range usage.Images {
		info.ImagesSize += uint64(img.Size)
		repoTag := "<none>:<none>"
		repo := "<none>"
		tag := "<none>"
		if len(img.RepoTags) > 0 {
			repoTag = img.RepoTags[0]
			parts := strings.Split(repoTag, ":")
			if len(parts) >= 1 {
				repo = parts[0]
			}
			if len(parts) >= 2 {
				tag = parts[1]
			}
		}

		info.Details.Images = append(info.Details.Images, model.ImageInfo{
			ID:         img.ID,
			Repository: repo,
			Tag:        tag,
			Size:       uint64(img.Size),
			InUse:      img.Containers > 0,
		})
	}

	for _, ctr := range usage.Containers {
		info.ContainersSize += uint64(ctr.SizeRw)
	}

	for _, vol := range usage.Volumes {
		size := int64(0)
		if vol.UsageData != nil {
			size = vol.UsageData.Size
		}
		info.VolumesSize += uint64(size)

		inUse := false
		if vol.UsageData != nil {
			inUse = vol.UsageData.RefCount > 0
		}

		info.Details.Volumes = append(info.Details.Volumes, model.VolumeInfo{
			Name:   vol.Name,
			Driver: vol.Driver,
			Size:   uint64(size),
			InUse:  inUse,
		})
	}

	for _, cache := range usage.BuildCache {
		info.BuildCacheSize += uint64(cache.Size)

		info.Details.BuildCache = append(
			info.Details.BuildCache,
			model.CacheInfo{
				ID:    cache.ID,
				Type:  cache.Type,
				Size:  uint64(cache.Size),
				InUse: cache.InUse,
			},
		)
	}

	info.
```

---

## File Overview

# system.go

## Purpose and Responsibility
This Go source file, `system.go`, is part of the Docker management module within the Holophyly project. It provides core functionalities for interacting with a Docker daemon to retrieve system information, storage details, and prune unused resources.

## Key Exports and Public Interface
The key functions exported by this file are:
- `GetSystemInfo`: Retrieves detailed system information from the Docker daemon.
- `GetStorageInfo`: Fetches disk usage statistics for Docker images, containers, volumes, and build cache.
- `Prune`: Removes unused Docker resources to reclaim storage space.
- `CheckPort`: Checks if a specified port is available or in use.

## How It Fits into the Project
This file serves as a critical component within the Docker management module. It interacts directly with the Docker daemon through the Docker API, providing essential utilities for system administrators and developers. The information and actions provided by these functions are crucial for monitoring and maintaining the health of Docker environments.

## Notable Design Decisions
- **Error Handling**: Functions use `fmt.Errorf` to provide clear error messages.
- **Concurrency Safety**: Utilizes context and mutex locks (`mu`) to ensure thread safety when accessing shared resources.
- **Docker API Interactions**: Leverages the Docker SDK for Go, ensuring compatibility with the latest Docker APIs.
- **Resource Pruning**: Implements a comprehensive pruning mechanism that can clean up unused images, containers, volumes, and build cache, optimizing storage usage.

---

*Generated by CodeWorm on 2026-02-19 19:32*
