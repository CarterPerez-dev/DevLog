# scanner

**Type:** File Overview
**Repository:** CodeWorm
**File:** codeworm/analysis/scanner.py
**Language:** python
**Lines:** 1-303
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2026
analysis/scanner.py
"""
from __future__ import annotations

import os
import random
from dataclasses import dataclass, field
from pathlib import Path
from typing import TYPE_CHECKING, ClassVar

import pathspec
from git import InvalidGitRepositoryError, Repo

from codeworm.models import LANGUAGE_EXTENSIONS, Language

if TYPE_CHECKING:
    from collections.abc import Iterator

    from codeworm.core.config import RepoEntry


@dataclass
class ScannedFile:
    """
    A file discovered during repository scanning
    """
    path: Path
    language: Language
    repo_name: str
    relative_path: Path
    size_bytes: int
    is_binary: bool = False

    @property
    def extension(self) -> str:
        return self.path.suffix.lower()


@dataclass
class RepoStats:
    """
    Statistics about a scanned repository
    """
    name: str
    path: Path
    total_files: int = 0
    files_by_language: dict[Language, int] = field(default_factory = dict)
    total_size_bytes: int = 0
    is_git_repo: bool = False
    branch: str | None = None


class GitignoreFilter:
    """
    Filters files based on gitignore patterns
    """
    def __init__(
        self,
        repo_root: Path,
        extra_patterns: list[str] | None = None
    ) -> None:
        """
        Initialize filter with gitignore from repo root
        """
        self.repo_root = repo_root
        patterns: list[str] = []

        gitignore_path = repo_root / ".gitignore"
        if gitignore_path.exists():
            patterns.extend(gitignore_path.read_text().splitlines())

        if extra_patterns:
            patterns.extend(extra_patterns)

        patterns.extend(
            [
                ".git/",
                "__pycache__/",
                "*.pyc",
                "node_modules/",
                ".venv/",
                "venv/",
                ".env",
                "*.egg-info/",
            ]
        )

        self.spec = pathspec.PathSpec.from_lines("gitwildmatch", patterns)

    def is_ignored(self, path: Path) -> bool:
        """
        Check if a path should be ignored
        """
        try:
            rel_path = path.relative_to(self.repo_root)
            return self.spec.match_file(str(rel_path))
        except ValueError:
            return False


class RepoScanner:
    """
    Scans repositories to find code files for analysis
    """
    DEFAULT_EXCLUDE: ClassVar[list[str]] = [
        "**/test_*.py",
        "**/*_test.py",
        "**/*_test.go",
        "**/*.spec.ts",
        "**/*.test.ts",
        "**/*.test.js",
        "**/tests/**",
        "**/test/**",
        "**/__tests__/**",
        "**/node_modules/**",
        "**/vendor/**",
        "**/dist/**",
        "**/build/**",
        "**/.git/**",
    ]

    MAX_FILE_SIZE = 1024 * 1024
    BINARY_CHECK_BYTES = 8192

    def __init__(
        self,
        include_patterns: list[str] | None = None,
        exclude_patterns: list[str] | None = None,
    ) -> None:
       
```

---

## File Overview

### Purpose and Responsibility

This Python source file, `scanner.py`, is responsible for scanning repositories to identify code files suitable for analysis. It includes logic to filter out irrelevant files using `.gitignore` patterns and other exclusion rules.

### Key Exports and Public Interface

- **Classes:**
  - `ScannedFile`: Represents a discovered file during repository scanning.
  - `RepoStats`: Contains statistics about scanned repositories, such as total files, languages, and sizes.
  - `GitignoreFilter`: Filters out ignored files based on `.gitignore` patterns.
  - `RepoScanner`: Scans repositories to find code files for analysis.

- **Methods:**
  - `RepoScanner.scan_repo()`: Yields discovered `ScannedFile` instances from a repository.
  - `GitignoreFilter.is_ignored()`: Checks if a file should be ignored based on patterns.

### How It Fits into the Project

This file is part of the `codeworm` project, specifically within the `analysis` module. Its primary role is to prepare repositories for code analysis by filtering and categorizing files. The `RepoScanner` class interacts with other components in the project, such as `Language` from `models`, to process and analyze repository contents.

### Notable Design Decisions

- **Use of Dataclasses**: Classes like `ScannedFile` and `RepoStats` are defined using dataclasses for simplicity and type safety.
- **Pathspec Library**: Utilizes `pathspec` for pattern matching, ensuring efficient file filtering based on `.gitignore` rules.
- **Exclusion Patterns**: Defines default exclusion patterns to avoid unnecessary processing of non-code files like tests or build artifacts.
- **Type Hints and Annotations**: Extensive use of type hints and annotations (`from __future__ import annotations`) to ensure code clarity and maintainability.

---

*Generated by CodeWorm on 2026-02-21 02:16*
