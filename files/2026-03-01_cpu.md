# cpu

**Type:** File Overview
**Repository:** Yoshi-Audit
**File:** internal/system/cpu.go
**Language:** go
**Lines:** 1-80
**Complexity:** 0.0

---

## Source Code

```go
// ©AngelaMos | 2026
// cpu.go

package system

import (
	"bufio"
	"fmt"
	"os"
	"strconv"
	"strings"
	"time"
)

func parseCPULine(line string) (idle, total uint64, err error) {
	fields := strings.Fields(line)
	if len(fields) < 5 {
		return 0, 0, fmt.Errorf("not enough fields in cpu line: %q", line)
	}

	var sum uint64
	for i := 1; i < len(fields); i++ {
		val, parseErr := strconv.ParseUint(fields[i], 10, 64)
		if parseErr != nil {
			return 0, 0, fmt.Errorf("failed to parse field %d: %w", i, parseErr)
		}
		sum += val
		if i == 4 {
			idle = val
		}
	}

	return idle, sum, nil
}

func readCPUStat() (idle, total uint64, err error) {
	f, err := os.Open("/proc/stat")
	if err != nil {
		return 0, 0, err
	}
	defer f.Close()

	scanner := bufio.NewScanner(f)
	for scanner.Scan() {
		line := scanner.Text()
		if strings.HasPrefix(line, "cpu ") {
			return parseCPULine(line)
		}
	}

	if err := scanner.Err(); err != nil {
		return 0, 0, err
	}

	return 0, 0, fmt.Errorf("cpu line not found in /proc/stat")
}

func GetCPUUsage() (float64, error) {
	idle1, total1, err := readCPUStat()
	if err != nil {
		return 0, err
	}

	time.Sleep(200 * time.Millisecond)

	idle2, total2, err := readCPUStat()
	if err != nil {
		return 0, err
	}

	idleDelta := float64(idle2 - idle1)
	totalDelta := float64(total2 - total1)

	if totalDelta == 0 {
		return 0, nil
	}

	return (1 - idleDelta/totalDelta) * 100, nil
}

```

---

## File Overview

// ©AngelaMos | 2026
// cpu.go

### Purpose and Responsibility
This file provides functionality to monitor CPU usage on a Linux system by reading from `/proc/stat`. It exports functions for parsing CPU statistics, calculating CPU idle time, and determining the overall CPU usage percentage.

### Key Exports and Public Interface
- `GetCPUUsage() (float64, error)`: Calculates the current CPU usage percentage over a 200-millisecond interval.
- `parseCPULine(line string) (idle, total uint64, err error)`: Parses a single line from `/proc/stat` to extract idle and total CPU time.
- `readCPUStat() (idle, total uint64, err error)`: Reads the CPU statistics from `/proc/stat` and extracts relevant data.

### How It Fits in the Project
This file is part of the `system` package, which handles system-level monitoring. The `GetCPUUsage` function is used by higher-level modules to provide insights into system performance, aiding in audit and monitoring tasks within the Yoshi-Audit project.

### Notable Design Decisions
- **Error Handling**: Functions return detailed error messages for easier debugging.
- **Goroutines**: While not directly used here, goroutines could be employed for concurrent monitoring if needed.
- **Time Interval**: A fixed 200-millisecond interval is chosen for simplicity and consistency. This can be adjusted based on performance requirements.
- **Dependencies**: Minimal dependencies are used, focusing on standard library functions to ensure portability.

---

*Generated by CodeWorm on 2026-03-01 13:30*
