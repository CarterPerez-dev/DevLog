# factory

**Type:** File Overview
**Repository:** Cybersecurity-Projects
**File:** TEMPLATES/fullstack-template/backend/app/factory.py
**Language:** python
**Lines:** 1-134
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2025
factory.py
"""

from collections.abc import AsyncIterator
from contextlib import asynccontextmanager

from fastapi import FastAPI, Request
from fastapi.middleware.cors import CORSMiddleware
from fastapi.responses import JSONResponse
from slowapi import _rate_limit_exceeded_handler
from slowapi.errors import RateLimitExceeded

from config import settings, Environment, API_PREFIX
from core.database import sessionmanager
from core.exceptions import BaseAppException
from core.logging import configure_logging
from core.rate_limit import limiter
from middleware.correlation import CorrelationIdMiddleware
from core.common_schemas import AppInfoResponse
from core.health_routes import router as health_router
from user.routes import router as user_router
from auth.routes import router as auth_router
from admin.routes import router as admin_router


@asynccontextmanager
async def lifespan(app: FastAPI) -> AsyncIterator[None]:
    """
    Application lifespan handler for startup and shutdown
    """
    configure_logging()
    sessionmanager.init(str(settings.DATABASE_URL))
    yield
    await sessionmanager.close()


OPENAPI_TAGS = [
    {
        "name": "root",
        "description": "API information"
    },
    {
        "name": "health",
        "description": "Health check endpoints"
    },
    {
        "name": "auth",
        "description": "Authentication and authorization"
    },
    {
        "name": "users",
        "description": "User registration and profile management"
    },
    {
        "name": "admin",
        "description": "Admin only operations"
    },
]


def create_app() -> FastAPI:
    """
    Application factory
    """
    is_production = settings.ENVIRONMENT == Environment.PRODUCTION

    app = FastAPI(
        title = settings.APP_NAME,
        summary = settings.APP_SUMMARY,
        description = settings.APP_DESCRIPTION,
        version = settings.APP_VERSION,
        contact = {
            "name": settings.APP_CONTACT_NAME,
            "email": settings.APP_CONTACT_EMAIL,
        },
        license_info = {
            "name": settings.APP_LICENSE_NAME,
            "url": settings.APP_LICENSE_URL,
        },
        openapi_tags = OPENAPI_TAGS,
        openapi_version = "3.1.0",
        lifespan = lifespan,
        root_path = "/api" if not is_production else "",
        openapi_url = None if is_production else "/openapi.json",
        docs_url = None if is_production else "/docs",
        redoc_url = None if is_production else "/redoc",
    )

    app.add_middleware(CorrelationIdMiddleware)
    app.add_middleware(
        CORSMiddleware,
        allow_origins = settings.CORS_ORIGINS,
        allow_credentials = settings.CORS_ALLOW_CREDENTIALS,
        allow_methods = settings.CORS_ALLOW_METHODS,
        allow_headers = settings.CORS_ALLOW_HEADERS,
    )

    app.state.limiter = limiter
    app.add_exception_handler(
        RateLimitExceeded,
        _rate_limit_exceeded_handler
    )

    @app.exceptio
```

---

## File Overview

### Purpose and Responsibility

This `factory.py` file is responsible for creating and configuring a FastAPI application instance. It initializes various components such as database sessions, rate limiting, logging, and middleware. The file also sets up different API routers and exception handlers.

### Key Exports and Public Interface

- **create_app()**: An application factory function that returns a configured `FastAPI` instance.
- **lifespan()**: A context manager for managing the startup and shutdown of the application.
- **OPENAPI_TAGS**: A list defining tags for different API sections, enhancing documentation.

### How It Fits into the Project

This file acts as the central point for initializing the FastAPI application. It integrates essential components like database sessions, middleware, rate limiting, and exception handling. The `create_app()` function is called by the main entry point of the project to start the application with all necessary configurations.

### Notable Design Decisions

- **AsyncContextManager**: The `lifespan` context manager ensures proper initialization and cleanup of resources.
- **Rate Limiting**: Utilizes `slowapi` for rate limiting, which is crucial for production environments.
- **Middleware Integration**: Includes middleware like `CorrelationIdMiddleware` and CORS settings to manage cross-origin requests effectively.
- **Exception Handling**: Custom exception handlers are defined to provide structured error responses.
- **OpenAPI Documentation**: Configures OpenAPI documentation with tags for better API organization, especially useful in a production environment.

This file ensures that the application is robust, well-documented, and adheres to best practices in FastAPI development.

---

*Generated by CodeWorm on 2026-02-18 18:43*
