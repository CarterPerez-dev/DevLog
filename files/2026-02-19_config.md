# config

**Type:** File Overview
**Repository:** angelamos-operations
**File:** Docker-Kentros/internal/config/config.go
**Language:** go
**Lines:** 1-190
**Complexity:** 0.0

---

## Source Code

```go
/*
AngelaMos | 2026
config.go
*/

package config

import (
	"fmt"
	"os"
	"path/filepath"
	"strings"
	"time"

	"github.com/knadh/koanf/parsers/yaml"
	"github.com/knadh/koanf/providers/env"
	"github.com/knadh/koanf/providers/file"
	"github.com/knadh/koanf/v2"
)

type Config struct {
	Server     ServerConfig     `koanf:"server"`
	Scanner    ScannerConfig    `koanf:"scanner"`
	Protection ProtectionConfig `koanf:"protection"`
	Docker     DockerConfig     `koanf:"docker"`
	Logging    LoggingConfig    `koanf:"logging"`
	DataDir    string           `koanf:"data_dir"`
}

type ServerConfig struct {
	Host           string   `koanf:"host"`
	Port           int      `koanf:"port"`
	AllowedOrigins []string `koanf:"allowed_origins"`
}

type ScannerConfig struct {
	Paths        []string      `koanf:"paths"`
	Exclude      []string      `koanf:"exclude"`
	ScanInterval time.Duration `koanf:"scan_interval"`
}

type ProtectionConfig struct {
	Patterns []string `koanf:"patterns"`
	Projects []string `koanf:"projects"`
}

type DockerConfig struct {
	Socket string `koanf:"socket"`
}

type LoggingConfig struct {
	Level  string `koanf:"level"`
	Format string `koanf:"format"`
}

// Load reads configuration from file and environment variables.
// Priority: env vars > config file > defaults
func Load(configPath string) (*Config, error) {
	k := koanf.New(".")

	cfg := defaultConfig()

	if configPath == "" {
		configPath = findConfigFile()
	}

	if configPath != "" {
		if err := k.Load(file.Provider(configPath), yaml.Parser()); err != nil {
			return nil, fmt.Errorf("loading config file: %w", err)
		}
	}

	envProvider := env.Provider("HOLOPHYLY_", ".", func(s string) string {
		return strings.ReplaceAll(
			strings.ToLower(strings.TrimPrefix(s, "HOLOPHYLY_")),
			"_", ".",
		)
	})

	if err := k.Load(envProvider, nil); err != nil {
		return nil, fmt.Errorf("loading env vars: %w", err)
	}

	if err := k.Unmarshal("", cfg); err != nil {
		return nil, fmt.Errorf("unmarshaling config: %w", err)
	}

	if paths := os.Getenv("HOLOPHYLY_SCANNER_PATHS"); paths != "" {
		cfg.Scanner.Paths = strings.Split(paths, ",")
	}

	cfg.expandPaths()

	return cfg, nil
}

func defaultConfig() *Config {
	home, _ := os.UserHomeDir()

	return &Config{
		Server: ServerConfig{
			Host: "127.0.0.1",
			Port: 9001,
			AllowedOrigins: []string{
				"http://localhost:*",
				"http://127.0.0.1:*",
			},
		},
		Scanner: ScannerConfig{
			Paths: []string{
				filepath.Join(home, "projects"),
				filepath.Join(home, "dev"),
			},
			Exclude: []string{
				"node_modules",
				".git",
				"vendor",
				"__pycache__",
				".venv",
				"venv",
			},
			ScanInterval: 30 * time.Second,
		},
		Protection: ProtectionConfig{
			Patterns: []string{
				"*cloudflare*",
				"*tunnel*",
			},
			Projects: []string{},
		},
		Docker: DockerConfig{
			Socket: "unix:///var/run/docker.sock",
		},
		Logging: LoggingConfig{
			Level:  "info",
			Format: "json",
		},
	}
}

func findConfigFile() string {
	locations := []string{
		"holophyl
```

---

## File Overview

# config.go

## Purpose and Responsibility
This file is responsible for loading and managing configuration settings for the application. It uses a combination of environment variables, YAML files, and default values to provide flexible and robust configuration management.

## Key Exports or Public Interface
- `Load(configPath string) (*Config, error)`: Loads configuration from specified paths and environment variables.
- `defaultConfig() *Config`: Provides default configuration settings.
- `findConfigFile() string`: Searches for a configuration file in predefined locations.
- `expandPaths()`: Expands user home directory references in scanner and protection paths.

## How It Fits into the Project
This file serves as the central point for configuration management, ensuring that all parts of the application can access consistent and up-to-date settings. It integrates with other components through its public API, providing a clean interface for accessing configuration data.

## Notable Design Decisions
- **Priority Handling**: Environment variables take precedence over config files, which in turn default to provided values.
- **Path Expansion**: Automatically resolves user home directory references in paths, enhancing flexibility.
- **Error Handling**: Robust error handling ensures that any issues during configuration loading are properly reported and handled.
```

This documentation provides an overview of the file's role within the project, its key functions, and important design choices.

---

*Generated by CodeWorm on 2026-02-19 19:56*
