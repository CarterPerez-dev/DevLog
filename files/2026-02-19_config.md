# config

**Type:** File Overview
**Repository:** oneIsNun_
**File:** go-backend/internal/config/config.go
**Language:** go
**Lines:** 1-247
**Complexity:** 0.0

---

## Source Code

```go
/*
AngelaMos | 2025
config.go
*/

package config

import (
	"fmt"
	"sync"
	"time"

	"github.com/knadh/koanf/parsers/yaml"
	"github.com/knadh/koanf/providers/env"
	"github.com/knadh/koanf/providers/file"
	"github.com/knadh/koanf/v2"
)

type Config struct {
	App    AppConfig    `koanf:"app"`
	Server ServerConfig `koanf:"server"`
	Mongo  MongoConfig  `koanf:"mongodb"`
	SQLite SQLiteConfig `koanf:"sqlite"`
	Backup BackupConfig `koanf:"backup"`
	CORS   CORSConfig   `koanf:"cors"`
	Log    LogConfig    `koanf:"log"`
}

type AppConfig struct {
	Name        string `koanf:"name"`
	Version     string `koanf:"version"`
	Environment string `koanf:"environment"`
}

type ServerConfig struct {
	Host            string        `koanf:"host"`
	Port            int           `koanf:"port"`
	ReadTimeout     time.Duration `koanf:"read_timeout"`
	WriteTimeout    time.Duration `koanf:"write_timeout"`
	IdleTimeout     time.Duration `koanf:"idle_timeout"`
	ShutdownTimeout time.Duration `koanf:"shutdown_timeout"`
}

type MongoConfig struct {
	URI            string        `koanf:"uri"`
	Database       string        `koanf:"database"`
	MaxPoolSize    uint64        `koanf:"max_pool_size"`
	MinPoolSize    uint64        `koanf:"min_pool_size"`
	ConnectTimeout time.Duration `koanf:"connect_timeout"`
}

type SQLiteConfig struct {
	Path string `koanf:"path"`
}

type BackupConfig struct {
	OutputDir        string `koanf:"output_dir"`
	MongodumpPath    string `koanf:"mongodump_path"`
	MongorestorePath string `koanf:"mongorestore_path"`
	RetentionDays    int    `koanf:"retention_days"`
}

type CORSConfig struct {
	AllowedOrigins   []string `koanf:"allowed_origins"`
	AllowedMethods   []string `koanf:"allowed_methods"`
	AllowedHeaders   []string `koanf:"allowed_headers"`
	AllowCredentials bool     `koanf:"allow_credentials"`
	MaxAge           int      `koanf:"max_age"`
}

type LogConfig struct {
	Level  string `koanf:"level"`
	Format string `koanf:"format"`
}

var (
	cfg  *Config
	once sync.Once
)

func Load(configPath string) (*Config, error) {
	var loadErr error

	once.Do(func() {
		k := koanf.New(".")

		if err := loadDefaults(k); err != nil {
			loadErr = fmt.Errorf("load defaults: %w", err)
			return
		}

		if configPath != "" {
			if err := k.Load(file.Provider(configPath), yaml.Parser()); err != nil {
				loadErr = fmt.Errorf("load config file: %w", err)
				return
			}
		}

		if err := k.Load(env.Provider("", ".", envKeyReplacer), nil); err != nil {
			loadErr = fmt.Errorf("load env vars: %w", err)
			return
		}

		cfg = &Config{}
		if err := k.Unmarshal("", cfg); err != nil {
			loadErr = fmt.Errorf("unmarshal config: %w", err)
			return
		}

		if err := validate(cfg); err != nil {
			loadErr = fmt.Errorf("validate config: %w", err)
			return
		}
	})

	if loadErr != nil {
		return nil, loadErr
	}

	return cfg, nil
}

func Get() *Config {
	if cfg == nil {
		panic("config not loaded: call Load() first")
	}
	return cfg
}

func loadDefaults(k *koanf.Koanf) error {
	defaults := map[s
```

---

## File Overview

# config.go

## Purpose and Responsibility
This Go source file is responsible for managing configuration settings for the application. It uses `koanf` to load configurations from multiple sources, including a YAML file, environment variables, and default values. The configurations are structured into various types such as `AppConfig`, `ServerConfig`, `MongoConfig`, etc., providing a clear separation of concerns.

## Key Exports and Public Interface
- **Load(configPath string) (*Config, error)**: Loads configuration from specified files and environment variables.
- **Get() *Config**: Provides access to the loaded configuration after calling `Load`.

## How it Fits in the Project
This file acts as a central hub for all application settings. It ensures that the application can be easily configured via different methods (file, environment variables), making it flexible and adaptable. The structured approach allows other parts of the project to reference specific configurations without needing to know about the underlying implementation details.

## Notable Design Decisions
- **Error Handling**: Uses `fmt.Errorf` for error messages, ensuring clear and informative errors.
- **Lazy Initialization**: Utilizes a `sync.Once` guard to ensure that configuration is loaded only once, preventing multiple initializations.
- **Default Values**: Provides default values in the `loadDefaults` function, allowing users to override them via files or environment variables.
- **Environment Variables Handling**: Uses `koanf` with `env.Provider` to handle environment variables, ensuring they are properly parsed and integrated into the configuration.
```

This documentation covers the essential aspects of the file, providing a clear understanding of its role within the project and how it is structured.

---

*Generated by CodeWorm on 2026-02-19 23:32*
