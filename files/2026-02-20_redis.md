# redis

**Type:** File Overview
**Repository:** vuemantics
**File:** backend/core/redis.py
**Language:** python
**Lines:** 1-170
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2026
redis.py
"""

import asyncio
import logging
from contextlib import asynccontextmanager
from collections.abc import AsyncIterator

import redis.asyncio as redis

import config


logger = logging.getLogger(__name__)


class RedisPool:
    """
    Manages Redis connection pool for caching and pub/sub

    Provides methods for caching operations and pub/sub messaging
    Used for WebSocket cross-instance communication
    """
    def __init__(self) -> None:
        """
        Initialize Redis pool instance
        """
        self._pool: redis.ConnectionPool | None = None
        self._client: redis.Redis | None = None
        self._lock = asyncio.Lock()

    async def connect(self) -> None:
        """
        Initialize Redis connection pool
        """
        if self._pool is not None:
            return

        async with self._lock:
            if self._pool is not None:
                return  # type: ignore[unreachable]  # Double-check locking pattern

            try:
                self._pool = redis.ConnectionPool.from_url(
                    config.settings.redis_url,
                    decode_responses = config.settings.
                    redis_decode_responses,
                    max_connections = config.settings.redis_pool_max_size,
                )

                self._client = redis.Redis(connection_pool = self._pool)

                await self._client.ping()

                logger.info(
                    "Redis pool created successfully",
                    extra = {
                        "max_connections":
                        config.settings.redis_pool_max_size,
                    },
                )

            except Exception as e:
                logger.error(f"Failed to create Redis pool: {e}")
                raise

    async def disconnect(self) -> None:
        """
        Close all Redis connections
        """
        if self._client is not None:
            await self._client.close()
            self._client = None

        if self._pool is not None:
            await self._pool.disconnect()
            self._pool = None

        logger.info("Redis pool closed")

    @asynccontextmanager
    async def acquire(self) -> AsyncIterator[redis.Redis]:
        """
        Acquire a Redis connection from the pool
        """
        if self._client is None:
            raise RuntimeError(
                "Redis pool is not initialized. Call connect() first."
            )

        yield self._client

    async def publish(self, channel: str, message: str) -> int:
        """
        Publish message to Redis channel

        Args:
            channel: Channel name
            message: Message to publish

        Returns:
            Number of subscribers that received the message
        """
        async with self.acquire() as client:
            return await client.publish(channel, message)

    async def subscribe(self, *channels: str) -> redis.client.PubSub:
        """
        S
```

---

## File Overview

### redis.py

**Purpose:**
This Python module manages a Redis connection pool for caching and pub/sub operations, essential for WebSocket cross-instance communication within the application.

**Key Exports & Public Interface:**
- `RedisPool`: A class managing Redis connections with methods for connecting, disconnecting, acquiring clients, publishing messages, subscribing to channels/patterns.
- `init_redis()`: An asynchronous function to initialize the Redis connection pool during application startup.
- `close_redis()`: An asynchronous function to close the Redis connection pool during shutdown.

**Project Integration:**
This module is crucial for WebSocket communication and caching. It ensures that all parts of the application can efficiently use Redis without managing connections manually, promoting a clean separation of concerns.

**Design Decisions:**
1. **AsyncContextManager**: The `acquire` method uses an async context manager to ensure proper connection handling.
2. **Connection Pooling**: Utilizes `redis.ConnectionPool` for efficient management and reuse of connections.
3. **Error Handling & Logging**: Comprehensive error handling with detailed logging ensures robustness and traceability.
4. **Initialization & Shutdown**: `init_redis()` and `close_redis()` functions facilitate seamless integration into the application lifecycle.

This file is part of `/core/redis.py` in the `vuemantics` repository, contributing to the core infrastructure necessary for WebSocket communication and caching.

---

*Generated by CodeWorm on 2026-02-20 13:19*
