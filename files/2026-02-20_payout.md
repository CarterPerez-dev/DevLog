# Payout

**Type:** File Overview
**Repository:** stripe-referral
**File:** src/stripe_referral/models/Payout.py
**Language:** python
**Lines:** 1-110
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2025 | CertGames.com
Payout model
"""

from __future__ import annotations

from datetime import datetime
from typing import (
    TYPE_CHECKING,
    Any,
)

from sqlalchemy import (
    JSON,
    Float,
    String,
    ForeignKey,
    DateTime,
)
from sqlalchemy.orm import (
    Mapped,
    mapped_column,
    relationship,
)

from ..config.constants import (
    MAX_ERROR_MESSAGE_LENGTH,
    MAX_TRANSACTION_ID_LENGTH,
    MAX_USER_ID_LENGTH,
)
from ..config.enums import (
    CurrencyCode,
    PayoutStatus,
)
from ..database.Base import (
    Base,
    TimestampMixin,
)

if TYPE_CHECKING:
    from .ReferralTracking import ReferralTracking


class Payout(Base, TimestampMixin):
    """
    Payout record for referral rewards
    """
    __tablename__ = "payouts"

    id: Mapped[int] = mapped_column(
        primary_key = True,
        autoincrement = True
    )

    user_id: Mapped[str] = mapped_column(
        String(MAX_USER_ID_LENGTH),
        index = True
    )
    tracking_id: Mapped[int] = mapped_column(
        ForeignKey("referral_trackings.id"),
        nullable = False,
        unique = True
    )

    amount: Mapped[float] = mapped_column(Float, nullable = False)
    currency: Mapped[str] = mapped_column(
        String(3),
        default = CurrencyCode.USD.value
    )

    status: Mapped[str] = mapped_column(
        String(20),
        default = PayoutStatus.PENDING.value,
        index = True
    )

    adapter_type: Mapped[str] = mapped_column(
        String(50),
        nullable = False
    )
    recipient_data: Mapped[dict[str,
                                Any]] = mapped_column(
                                    JSON,
                                    default = dict
                                )

    processed_at: Mapped[datetime | None] = mapped_column(
        DateTime(timezone = True),
        nullable = True
    )
    failed_at: Mapped[datetime | None] = mapped_column(
        DateTime(timezone = True),
        nullable = True
    )

    external_transaction_id: Mapped[str | None] = mapped_column(
        String(MAX_TRANSACTION_ID_LENGTH),
        nullable = True
    )
    error_message: Mapped[str | None] = mapped_column(
        String(MAX_ERROR_MESSAGE_LENGTH),
        nullable = True
    )

    tracking: Mapped[ReferralTracking] = relationship(
        "ReferralTracking",
        back_populates = "payout"
    )

```

---

## File Overview

## Payout Model Documentation

**Purpose:**
This file defines the `Payout` model, which represents referral rewards payouts in the Stripe Referral application. It stores information about each payout transaction, including user details, amount, currency, status, and tracking data.

**Key Exports & Public Interface:**
- **Class:** `Payout`
  - Fields: `id`, `user_id`, `tracking_id`, `amount`, `currency`, `status`, `adapter_type`, `recipient_data`, `processed_at`, `failed_at`, `external_transaction_id`, `error_message`.
  - Relationships: `tracking` (back-populates to `ReferralTracking`).

**Project Fit:**
The `Payout` model is part of the database schema for managing referral rewards. It integrates with other models like `ReferralTracking` and uses SQLAlchemy for ORM operations. This class fits into the larger project by providing a structured way to handle payout records, ensuring consistency and ease of querying.

**Design Decisions:**
- **Foreign Key:** The `tracking_id` field is a foreign key linking to `ReferralTracking`, maintaining referential integrity.
- **Type Hints & JSON Field:** Using SQLAlchemy's `JSON` type for the `recipient_data` field allows flexible storage of recipient information as dictionaries.
- **Enum Usage:** Currency and status fields use enums from `CurrencyCode` and `PayoutStatus` respectively, ensuring consistency and preventing typos.
- **TimestampMixin:** Inheriting from `TimestampMixin` provides automatic timestamping for creation and update times.
```

This documentation covers the high-level purpose of the file, its key exports, how it fits into the project, and notable design decisions.

---

*Generated by CodeWorm on 2026-02-20 10:28*
