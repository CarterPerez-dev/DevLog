# routes

**Type:** File Overview
**Repository:** Cybersecurity-Projects
**File:** TEMPLATES/fullstack-template/backend/app/admin/routes.py
**Language:** python
**Lines:** 1-148
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2025
routes.py
"""

from uuid import UUID
from typing import Annotated

from fastapi import (
    APIRouter,
    Depends,
    Query,
    status,
)

from config import (
    settings,
    UserRole,
)
from core.dependencies import RequireRole
from core.responses import (
    AUTH_401,
    CONFLICT_409,
    FORBIDDEN_403,
    NOT_FOUND_404,
)
from user.schemas import (
    AdminUserCreate,
    UserListResponse,
    UserResponse,
    UserUpdateAdmin,
)
from user.User import User
from user.dependencies import UserServiceDep


router = APIRouter(prefix = "/admin", tags = ["admin"])

AdminOnly = Annotated[User, Depends(RequireRole(UserRole.ADMIN))]


@router.get(
    "/users",
    response_model = UserListResponse,
    responses = {
        **AUTH_401,
        **FORBIDDEN_403
    },
)
async def list_users(
    user_service: UserServiceDep,
    _: AdminOnly,
    page: int = Query(default = 1,
                      ge = 1),
    size: int = Query(
        default = settings.PAGINATION_DEFAULT_SIZE,
        ge = 1,
        le = settings.PAGINATION_MAX_SIZE
    ),
) -> UserListResponse:
    """
    List all users (admin only)
    """
    return await user_service.list_users(page, size)


@router.post(
    "/users",
    response_model = UserResponse,
    status_code = status.HTTP_201_CREATED,
    responses = {
        **AUTH_401,
        **FORBIDDEN_403,
        **CONFLICT_409
    },
)
async def create_user(
    user_service: UserServiceDep,
    _: AdminOnly,
    user_data: AdminUserCreate,
) -> UserResponse:
    """
    Create a new user (admin only, bypasses registration)
    """
    return await user_service.admin_create_user(user_data)


@router.get(
    "/users/{user_id}",
    response_model = UserResponse,
    responses = {
        **AUTH_401,
        **FORBIDDEN_403,
        **NOT_FOUND_404
    },
)
async def get_user(
    user_service: UserServiceDep,
    _: AdminOnly,
    user_id: UUID,
) -> UserResponse:
    """
    Get user by ID (admin only)
    """
    return await user_service.get_user_by_id(user_id)


@router.patch(
    "/users/{user_id}",
    response_model = UserResponse,
    responses = {
        **AUTH_401,
        **FORBIDDEN_403,
        **NOT_FOUND_404,
        **CONFLICT_409
    },
)
async def update_user(
    user_service: UserServiceDep,
    _: AdminOnly,
    user_id: UUID,
    user_data: UserUpdateAdmin,
) -> UserResponse:
    """
    Update user (admin only)
    """
    return await user_service.admin_update_user(user_id, user_data)


@router.delete(
    "/users/{user_id}",
    status_code = status.HTTP_204_NO_CONTENT,
    responses = {
        **AUTH_401,
        **FORBIDDEN_403,
        **NOT_FOUND_404
    },
)
async def delete_user(
    user_service: UserServiceDep,
    _: AdminOnly,
    user_id: UUID,
) -> None:
    """
    Delete user (admin only, hard delete)
    """
    await user_service.admin_delete_user(user_id)

```

---

## File Overview

### routes.py

**Purpose:**
This file defines the administrative routes for managing users within a FastAPI application. It restricts access to these endpoints to administrators only, ensuring that sensitive user management operations are performed securely.

**Key Exports and Public Interface:**
- **Endpoints:** 
  - `GET /admin/users`: Lists all users.
  - `POST /admin/users`: Creates a new user (bypassing registration).
  - `GET /admin/users/{user_id}`: Retrieves a user by ID.
  - `PATCH /admin/users/{user_id}`: Updates an existing user.
  - `DELETE /admin/users/{user_id}`: Deletes a user.

- **Dependencies and Services:** 
  - `UserServiceDep`: Dependency for the user service, ensuring that user-related operations are handled correctly.
  - `RequireRole(UserRole.ADMIN)`: Ensures only administrators can access these routes.

**How it Fits into the Project:**
This file is part of the backend module responsible for administrative tasks. It integrates with other modules like `user.User` and `core.responses`, providing a secure and controlled way to manage users from an admin perspective. The endpoints are prefixed with `/admin`, clearly indicating their restricted nature.

**Notable Design Decisions:**
- **Role-Based Access Control (RBAC):** Utilizes `RequireRole(UserRole.ADMIN)` to enforce role-based access, ensuring that only authorized administrators can perform these actions.
- **Pagination and Validation:** Implements pagination for listing users and validates input data using Pydantic schemas (`AdminUserCreate`, `UserUpdateAdmin`).
- **Error Handling:** Consistently handles errors by returning appropriate HTTP status codes and responses, such as 401 (Unauthorized), 403 (Forbidden), 409 (Conflict), and 404 (Not Found).
```

This documentation provides a high-level overview of the file's purpose, key components, integration within the project, and notable design choices.

---

*Generated by CodeWorm on 2026-02-18 15:35*
