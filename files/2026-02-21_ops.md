# ops

**Type:** File Overview
**Repository:** CodeWorm
**File:** codeworm/git/ops.py
**Language:** python
**Lines:** 1-377
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2026
git/ops.py
"""
from __future__ import annotations

import time
import random
from pathlib import Path
from datetime import datetime
from dataclasses import dataclass
from typing import TYPE_CHECKING, ClassVar

from git import (
    GitCommandError,
    InvalidGitRepositoryError,
    Repo,
)
from git.exc import GitError

from codeworm.core import get_logger
from codeworm.models import DocType

if TYPE_CHECKING:
    from codeworm.llm.generator import GeneratedDocumentation


logger = get_logger("git")


class GitOperationError(Exception):
    """
    Base exception for git operations
    """


class GitPushError(GitOperationError):
    """
    Failed to push to remote
    """


class GitConflictError(GitOperationError):
    """
    Merge conflict detected
    """


@dataclass
class CommitResult:
    """
    Result of a git commit operation
    """
    commit_hash: str
    message: str
    files_changed: int
    committed_at: datetime
    branch: str


COMMIT_PREFIXES = [
    "Document",
    "Add docs for",
    "Analyze",
    "Detail",
    "Explain",
    "Cover",
]

MINOR_FIX_MESSAGES = [
    "fix typo in {name} docs",
    "update formatting in {name}",
    "clarify {name} explanation",
    "improve {name} documentation",
    "refine {name} description",
]


class DevLogRepository:
    """
    Manages the DevLog output repository
    """
    def __init__(
        self,
        repo_path: Path,
        remote: str = "",
        branch: str = "main"
    ) -> None:
        """
        Initialize with repository path
        """
        self.repo_path = repo_path
        self.remote_url = remote
        self.branch = branch
        self._repo: Repo | None = None

    @property
    def repo(self) -> Repo:
        """
        Get or initialize the git repository
        """
        if self._repo is None:
            if not self.repo_path.exists():
                self.repo_path.mkdir(parents = True, exist_ok = True)

            try:
                self._repo = Repo(self.repo_path)
            except InvalidGitRepositoryError:
                self._repo = Repo.init(self.repo_path)
                logger.info("initialized_new_repo", path = str(self.repo_path))

        return self._repo

    DOC_TYPE_DIRS: ClassVar[dict[str,
                                 str]] = {
                                     "function_doc": "snippets",
                                     "class_doc": "classes",
                                     "file_doc": "files",
                                     "module_doc": "modules",
                                     "security_review": "reviews/security",
                                     "performance_analysis":
                                     "reviews/performance",
                                     "til": "til",
                                     "code_evolution": "evolution",
                                     "pattern_analysis": "patterns",
                                     "weekly_sum
```

---

## File Overview

### Purpose and Responsibility

This Python source file, `ops.py`, is part of the `codeworm` project's Git operations module. It manages git repository interactions, including committing changes, handling documentation snippets, and ensuring directory structures are in place for various types of documentation.

### Key Exports and Public Interface

- **CommitResult**: A dataclass representing the result of a git commit operation.
- **DevLogRepository**: A class responsible for managing the DevLog output repository. It handles operations like initializing repositories, writing snippets, and committing changes.
- **GitOperationError, GitPushError, GitConflictError**: Custom exceptions for handling various git-related errors.

### How it Fits into the Project

`ops.py` is a critical component of `codeworm`, providing essential functionality for managing version control. It integrates with other parts of the project to ensure that documentation changes are properly tracked and committed. This file interacts with the `core` module, which handles logging, and the `models` module, which defines data types like `DocType`.

### Notable Design Decisions

- **Dataclasses**: The use of `dataclass` for `CommitResult` simplifies object creation and ensures immutability.
- **Custom Exceptions**: Custom exceptions (`GitOperationError`, etc.) provide clear error handling for git operations, making the code more robust.
- **Directory Structure Management**: The `ensure_directory_structure` method ensures that the necessary directories are created, facilitating organized documentation management.
- **Type Hints and Annotations**: Extensive use of type hints and annotations enhances code readability and maintainability.

---

*Generated by CodeWorm on 2026-02-21 02:54*
