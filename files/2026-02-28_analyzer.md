# analyzer

**Type:** File Overview
**Repository:** CodeWorm
**File:** codeworm/analysis/analyzer.py
**Language:** python
**Lines:** 1-299
**Complexity:** 0.0

---

## Source Code

```python
"""
ⒸAngelaMos | 2026
analysis/analyzer.py
"""
from __future__ import annotations

import random
from dataclasses import dataclass
from pathlib import Path
from typing import TYPE_CHECKING

from git import InvalidGitRepositoryError, Repo

from codeworm.analysis.complexity import ComplexityAnalyzer, ComplexityMetrics
from codeworm.analysis.parser import CodeExtractor, ParsedFunction, ParserManager
from codeworm.analysis.scanner import RepoScanner, ScannedFile, WeightedRepoSelector
from codeworm.analysis.scoring import GitStats, InterestScore, InterestScorer
from codeworm.models import CodeSnippet

if TYPE_CHECKING:
    from collections.abc import Iterator

    from codeworm.core.config import AnalyzerSettings, RepoEntry


@dataclass
class AnalysisCandidate:
    """
    A code snippet candidate for documentation
    """
    snippet: CodeSnippet
    parsed_function: ParsedFunction
    complexity: ComplexityMetrics | None
    git_stats: GitStats
    interest_score: InterestScore
    scanned_file: ScannedFile

    @property
    def score(self) -> float:
        return self.interest_score.total

    @property
    def is_worth_documenting(self) -> bool:
        """
        Check if this candidate meets minimum thresholds
        """
        return self.score >= 25 and self.snippet.line_count >= 10


class CodeAnalyzer:
    """
    Main code analysis engine
    Combines parsing, complexity analysis, and interest scoring
    """
    def __init__(
        self,
        repos: list[RepoEntry],
        settings: AnalyzerSettings | None = None,
    ) -> None:
        """
        Initialize analyzer with repository configurations
        """
        self.repos = repos
        self.settings = settings
        self.repo_selector = WeightedRepoSelector(repos)
        self.scanner = RepoScanner(
            include_patterns = settings.include_patterns if settings else None,
            exclude_patterns = settings.exclude_patterns if settings else None,
        )
        self.complexity_analyzer = ComplexityAnalyzer()
        self.scorer = InterestScorer()

        self._git_repos: dict[Path, Repo | None] = {}

        ParserManager.initialize()

    def _get_git_repo(self, repo_path: Path) -> Repo | None:
        """
        Get or create git repo instance for a path
        """
        if repo_path in self._git_repos:
            return self._git_repos[repo_path]
        try:
            repo = Repo(repo_path, search_parent_directories = True)
            git_root = Path(repo.working_dir)
            if git_root in self._git_repos:
                repo.close()
                self._git_repos[repo_path] = self._git_repos[git_root]
            else:
                self._git_repos[git_root] = repo
                self._git_repos[repo_path] = repo
        except InvalidGitRepositoryError:
            self._git_repos[repo_path] = None
        return self._git_repos[repo_path]

    def close_repos(self) -> None:
        """
        Close all cached git repo handles an
```

---

## File Overview

### `analyzer.py` Documentation

**Purpose and Responsibility:**
This file serves as the core analysis engine for CodeWorm, responsible for integrating various components to analyze code snippets based on complexity, Git history, and interest scores. It processes repositories, extracts functions, calculates metrics, and generates documentation candidates.

**Key Exports and Public Interface:**
- **`AnalysisCandidate`:** Represents a code snippet candidate with associated metrics.
- **`CodeAnalyzer`:** The main analysis engine that initializes components like `RepoScanner`, `ComplexityAnalyzer`, and `InterestScorer`. It provides methods to analyze files, close repositories, and generate documentation candidates.

**How it Fits into the Project:**
This file acts as a central hub in CodeWorm’s architecture. It leverages other modules for parsing code, calculating complexity metrics, and scoring interest based on Git history. The `CodeAnalyzer` class orchestrates these processes to produce high-quality documentation candidates from source files across multiple repositories.

**Notable Design Decisions:**
- **Dataclasses:** Used extensively for structured data like `AnalysisCandidate`, enhancing readability and immutability.
- **Lazy Initialization:** Repositories are cached using a dictionary (`_git_repos`) to avoid redundant Git operations, optimizing performance.
- **Error Handling:** Robust error handling ensures that the analysis process can gracefully handle exceptions without crashing, maintaining robustness.
- **Type Hints:** Comprehensive type hints improve code clarity and facilitate static analysis tools like mypy.
```

This documentation provides a high-level overview of the file's role within the project, its key components, and notable design choices.

---

*Generated by CodeWorm on 2026-02-28 14:20*
