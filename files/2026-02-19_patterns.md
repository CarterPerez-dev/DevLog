# patterns

**Type:** File Overview
**Repository:** angelamos-operations
**File:** Docker-Kentros/internal/scanner/patterns.go
**Language:** go
**Lines:** 1-192
**Complexity:** 0.0

---

## Source Code

```go
/*
AngelaMos | 2026
patterns.go
*/

package scanner

import (
	"path/filepath"
	"strings"

	"github.com/carterperez-dev/holophyly/internal/model"
)

var developmentPatterns = []string{
	"dev",
	"development",
	"local",
	"test",
	"testing",
	"staging",
	"stage",
	"debug",
}

var productionPatterns = []string{
	"prod",
	"production",
	"live",
	"release",
	"main",
	"master",
}

// detectEnvironment determines if a compose file is for dev or prod
// based on filename patterns.
func detectEnvironment(composePath string) model.Environment {
	filename := strings.ToLower(filepath.Base(composePath))
	filenameWithoutExt := strings.TrimSuffix(filename, filepath.Ext(filename))

	dir := strings.ToLower(filepath.Base(filepath.Dir(composePath)))

	for _, pattern := range productionPatterns {
		if containsPattern(filenameWithoutExt, pattern) {
			return model.EnvProduction
		}
	}

	for _, pattern := range developmentPatterns {
		if containsPattern(filenameWithoutExt, pattern) {
			return model.EnvDevelopment
		}
	}

	for _, pattern := range productionPatterns {
		if containsPattern(dir, pattern) {
			return model.EnvProduction
		}
	}

	return model.EnvDevelopment
}

func containsPattern(s, pattern string) bool {
	if strings.Contains(s, pattern) {
		return true
	}

	parts := splitByDelimiters(s)
	for _, part := range parts {
		if part == pattern {
			return true
		}
	}

	return false
}

func splitByDelimiters(s string) []string {
	result := make([]string, 0)
	current := strings.Builder{}

	for _, r := range s {
		if r == '-' || r == '_' || r == '.' {
			if current.Len() > 0 {
				result = append(result, current.String())
				current.Reset()
			}
		} else {
			current.WriteRune(r)
		}
	}

	if current.Len() > 0 {
		result = append(result, current.String())
	}

	return result
}

// IsProtectedByPattern checks if a container/project name matches
// protection patterns (cloudflare tunnels, etc).
func IsProtectedByPattern(name string) (bool, model.ProtectionReason) {
	lower := strings.ToLower(name)

	cloudflarePatterns := []string{
		"cloudflare",
		"cloudflared",
		"cf-tunnel",
		"cftunnel",
		"tunnel",
		"argo",
	}

	for _, pattern := range cloudflarePatterns {
		if strings.Contains(lower, pattern) {
			return true, model.ProtectionCloudflareTunnel
		}
	}

	criticalPatterns := []string{
		"traefik",
		"nginx-proxy",
		"reverse-proxy",
		"gateway",
		"ingress",
	}

	for _, pattern := range criticalPatterns {
		if strings.Contains(lower, pattern) {
			return true, model.ProtectionAutoDetected
		}
	}

	return false, ""
}

// ClassifyComposeFile provides metadata about a compose file based on its name.
func ClassifyComposeFile(filename string) ComposeFileInfo {
	lower := strings.ToLower(filename)
	withoutExt := strings.TrimSuffix(lower, filepath.Ext(lower))

	info := ComposeFileInfo{
		Filename:    filename,
		Environment: detectEnvironmentFromName(withoutExt),
		IsOverride:  strings.Contains(lower, "override"),
		IsBase:      isBaseComposeFile(lower),
	}

	return info
}
```

---

## File Overview

### patterns.go

**Purpose and Responsibility:**
This Go source file is part of the `scanner` package within the `angelamos-operations` repository. It provides utilities for determining the environment (development or production) based on filename patterns, as well as classifying compose files by their metadata.

**Key Exports and Public Interface:**
- **detectEnvironment(composePath string) model.Environment**: Determines if a Docker Compose file is intended for development or production environments.
- **IsProtectedByPattern(name string) (bool, model.ProtectionReason)**: Checks if a container/project name matches protection patterns like cloudflare tunnels.
- **ClassifyComposeFile(filename string) ComposeFileInfo**: Provides metadata about a compose file based on its name.

**How it Fits in the Project:**
This file is crucial for environment detection and classification within the `angelamos-operations` project. It integrates with other components that rely on accurate environment identification to manage Docker Compose files effectively, ensuring proper deployment strategies are applied.

**Notable Design Decisions:**
1. **Pattern Matching**: Utilizes pattern matching based on filename and directory names to infer environments.
2. **Error Handling**: Primarily uses simple conditional logic for error handling, leveraging Go's strong type system.
3. **Modular Functions**: Functions like `containsPattern` and `splitByDelimiters` are designed to be reusable across different parts of the project.
4. **Environment Classification**: Implements a robust classification mechanism that considers both file name and directory patterns to accurately determine environments.
```

This documentation provides an overview of the file's purpose, key functionalities, integration within the project, and notable design choices.

---

*Generated by CodeWorm on 2026-02-19 19:22*
