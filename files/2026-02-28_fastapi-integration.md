# fastapi-integration

**Type:** File Overview
**Repository:** Telehook
**File:** docs/examples/fastapi-integration.py
**Language:** python
**Lines:** 1-52
**Complexity:** 0.0

---

## Source Code

```python
"""
Â©AngelaMos | 2026
fastapi-integration.py

Example: FastAPI app with automatic error notifications
and manual notifications for business events.
"""

from contextlib import asynccontextmanager

from fastapi import FastAPI

from telehook import Notifier
from telehook.adapters.fastapi import telehook_exception_handler
from telehook.formatters import alert_formatter

notifier = Notifier()


@asynccontextmanager
async def lifespan(app: FastAPI):
    yield
    await notifier.close()


app = FastAPI(lifespan=lifespan)
telehook_exception_handler(app, notifier)


@app.post("/tickets")
async def create_ticket(subject: str, email: str):
    ticket_id = save_ticket(subject, email)

    await notifier.send(
        alert_formatter(
            title="New Support Ticket",
            app="HelpDesk",
            details=f"From: {email}\nSubject: {subject}\nID: {ticket_id}",
        )
    )

    return {"ticket_id": ticket_id}


@app.get("/crash")
async def crash():
    raise RuntimeError("This will send a Telegram notification")


def save_ticket(subject: str, email: str) -> int:
    return 42

```

---

## File Overview

# fastapi-integration.py

**Purpose**: This Python script integrates a FastAPI application with Telegram notifications using the `telehook` library. It demonstrates handling both automatic error notifications and manual business event notifications.

**Key Exports/Interface**:
- **FastAPI Application (`app`)**: The main entry point for the API, including endpoints for creating support tickets and intentionally crashing to test error handling.
- **lifespan Manager**: Manages the lifecycle of the FastAPI application by ensuring the `Notifier` is properly closed when the app shuts down.

**Project Fit**: This file serves as an example within the Telehook repository, showcasing how to integrate automatic error logging with business event notifications in a FastAPI application. It highlights best practices for handling exceptions and managing application state.

**Design Decisions**:
- **Async Context Manager (`lifespan`)**: Ensures that resources are properly cleaned up when the application is shut down.
- **Telehook Exception Handler**: Automatically sends error notifications to Telegram whenever an unhandled exception occurs in the FastAPI app.
- **Manual Notification**: The `/crash` endpoint demonstrates how to manually trigger a notification by raising an exception, which is useful for testing and debugging.

This example emphasizes Pythonic patterns such as async context managers and type hints, making it easy to integrate into larger projects while maintaining clarity and maintainability.

---

*Generated by CodeWorm on 2026-02-28 23:54*
