# daemon-monitoring

**Type:** File Overview
**Repository:** Telehook
**File:** docs/examples/daemon-monitoring.py
**Language:** python
**Lines:** 1-77
**Complexity:** 0.0

---

## Source Code

```python
"""
Â©AngelaMos | 2026
daemon-monitoring.py

Example: monitoring a long-running daemon process.
Sends alerts on consecutive failures and periodic health pings.
"""

import asyncio

from telehook import Notifier
from telehook.formatters import alert_formatter, error_formatter, health_formatter
from telehook.middleware import Dedup, RateLimiter, Retry


async def main():
    async with Notifier(
        middleware=[
            Dedup(window_seconds=300),
            RateLimiter(max_per_second=1),
            Retry(),
        ],
    ) as notifier:
        consecutive_failures = 0
        total_cycles = 0
        successful_cycles = 0

        while True:
            try:
                await run_cycle()
                consecutive_failures = 0
                successful_cycles += 1
                total_cycles += 1
            except Exception as e:
                consecutive_failures += 1
                total_cycles += 1

                await notifier.send(
                    error_formatter(
                        exception=e,
                        component="main_cycle",
                        app="MyDaemon",
                    )
                )

                if consecutive_failures >= 5:
                    await notifier.send(
                        alert_formatter(
                            title=f"{consecutive_failures} consecutive failures",
                            app="MyDaemon",
                            last_error=str(e),
                        )
                    )

            if total_cycles % 100 == 0:
                await notifier.send(
                    health_formatter(
                        app="MyDaemon",
                        status="alive",
                        extra={
                            "Total cycles": str(total_cycles),
                            "Successful": str(successful_cycles),
                            "Failed": str(total_cycles - successful_cycles),
                        },
                    )
                )

            await asyncio.sleep(60)


async def run_cycle():
    pass


if __name__ == "__main__":
    asyncio.run(main())

```

---

## File Overview

### daemon-monitoring.py

**Purpose:** This Python script monitors a long-running daemon process, sending alerts on consecutive failures and periodic health pings using Telegram notifications.

**Key Exports/Interface:**
- `main()`: The entry point of the monitoring system. It handles the main logic for running cycles, managing consecutive failures, and sending notifications.
- `run_cycle()`: A placeholder function that needs to be implemented to define the daemon's cycle logic.

**Project Fit:** This script is part of a larger project (Telehook) designed for sending notifications via Telegram. It demonstrates how to integrate monitoring and alerting mechanisms into a daemon process.

**Design Decisions:**
- **Asyncio Integration:** The use of `asyncio` ensures non-blocking, efficient handling of the long-running task.
- **Notifier Middleware:** Utilizes middleware (`Dedup`, `RateLimiter`, `Retry`) from Telehook to manage message deduplication, rate limiting, and retries, ensuring robust notification behavior.
- **Health Checks & Alerts:** Periodic health checks and alerts on consecutive failures provide a comprehensive monitoring strategy.

---

*Generated by CodeWorm on 2026-03-01 02:51*
