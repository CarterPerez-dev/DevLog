# cli

**Type:** File Overview
**Repository:** CodeWorm
**File:** codeworm/cli.py
**Language:** python
**Lines:** 1-401
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2026
cli.py
"""
from __future__ import annotations

import asyncio
import os
import sys
from pathlib import Path

import click
from rich.console import Console
from rich.table import Table

from codeworm.core import configure_logging, load_settings


console = Console()


@click.group()
@click.option("--debug", is_flag = True, help = "Enable debug logging")
@click.option(
    "--config",
    type = click.Path(exists = True,
                      path_type = Path),
    help = "Path to config directory",
)
@click.pass_context
def cli(ctx: click.Context, debug: bool, config: Path | None) -> None:
    """
    CodeWorm - Autonomous Code Documentation Agent
    """
    ctx.ensure_object(dict)
    ctx.obj["debug"] = debug
    ctx.obj["config_dir"] = config


@cli.command()
@click.option(
    "--devlog",
    type = click.Path(path_type = Path),
    help = "Path to DevLog repository (overrides config)",
)
@click.option(
    "--repo",
    type = (str,
            str),
    multiple = True,
    help = "Add repo as NAME PATH pairs (overrides config)",
)
@click.option(
    "--dry-run",
    is_flag = True,
    help = "Generate docs but don't commit (for testing)",
)
@click.pass_context
def run(
    ctx: click.Context,
    devlog: Path | None,
    repo: tuple,
    dry_run: bool
) -> None:
    """
    Run the CodeWorm daemon with scheduler
    """
    from codeworm.daemon import CodeWormDaemon

    overrides = {"debug": ctx.obj["debug"]}

    if devlog:
        overrides["devlog"] = {"repo_path": devlog}

    if repo:
        repos = [
            {
                "name": name,
                "path": Path(path),
                "weight": 5
            } for name, path in repo
        ]
        overrides["repos"] = repos

    settings = load_settings(config_dir = ctx.obj["config_dir"], **overrides)
    redis_url = settings.dashboard.redis.connection_url if settings.dashboard.redis.enabled else ""
    configure_logging(debug = settings.debug, redis_url = redis_url)

    if not settings.repos:
        console.print("[red]Error:[/red] No repositories configured")
        console.print("Add repos to config/repos.yaml or use --repo NAME PATH")
        raise SystemExit(1)

    mode = "[yellow][DRY RUN][/yellow] " if dry_run else ""
    console.print(f"{mode}[bold green]Starting CodeWorm[/bold green]")
    console.print(f"  DevLog: {settings.devlog.repo_path}")
    console.print(f"  Repos: {len(settings.repos)}")
    console.print(f"  Ollama: {settings.ollama.base_url}")
    if redis_url:
        console.print(f"  Redis: {redis_url}")

    daemon = CodeWormDaemon(settings, dry_run = dry_run)
    daemon.run()


@cli.command("run-once")
@click.option(
    "--devlog",
    type = click.Path(path_type = Path),
    help = "Path to DevLog repository (overrides config)",
)
@click.option(
    "--repo",
    type = (str,
            str),
    multiple = True,
    help = "Add repo as NAME PATH pairs (overrides config)",
)
@click.option(
    "--dry-run",
    is_fl
```

---

## File Overview

### cli.py

**Purpose and Responsibility:**
This Python file serves as the command-line interface (CLI) for the CodeWorm documentation agent. It provides a user-friendly way to interact with the core functionality of CodeWorm, including running the daemon in both dry-run and single-cycle modes.

**Key Exports or Public Interface:**
- `cli`: A Click group that defines the main entry point for the CLI.
  - Subcommands:
    - `run`: Starts a CodeWorm daemon with a scheduler.
    - `run-once`: Runs a single documentation cycle.
    - `analyze`: Analyzes a specified repository and lists potential candidates.

**How it Fits in the Project:**
`cli.py` acts as the primary interface for users to interact with the CodeWorm system. It leverages configuration settings from `load_settings` and integrates logging via `configure_logging`. The CLI commands are designed to be flexible, allowing users to override default configurations using command-line options.

**Notable Design Decisions:**
- **Click Framework**: Utilizes Click for handling command-line arguments and options, ensuring a clean and user-friendly interface.
- **Asyncio Integration**: Uses asyncio for running the daemon in both `run` and `run-once` commands to handle asynchronous operations efficiently.
- **Configuration Management**: Loads settings from a specified configuration directory using `load_settings`, providing flexibility in managing project-specific configurations.
- **Logging Configuration**: Configures logging based on debug mode and Redis connection details, ensuring that logs are appropriately handled during both development and production runs.
```

This documentation provides an overview of the file's purpose, key components, integration within the broader project, and notable design choices.

---

*Generated by CodeWorm on 2026-02-21 01:26*
