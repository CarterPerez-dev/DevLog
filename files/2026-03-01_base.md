# base

**Type:** File Overview
**Repository:** Telehook
**File:** src/telehook/middleware/base.py
**Language:** python
**Lines:** 1-33
**Complexity:** 0.0

---

## Source Code

```python
"""
Â©AngelaMos | 2026
base.py
"""

from collections.abc import Awaitable, Callable
from typing import Protocol

from telehook.message import Message


SendFunc = Callable[[Message], Awaitable[None]]


class Middleware(Protocol):
    async def __call__(self, message: Message, next_: SendFunc) -> None:
        ...


def build_chain(middleware: list[Middleware], terminal: SendFunc) -> SendFunc:
    chain = terminal
    for mw in reversed(middleware):

        async def _wrap(
            msg: Message,
            _mw: Middleware = mw,
            _next: SendFunc = chain
        ) -> None:
            await _mw(msg, _next)

        chain = _wrap
    return chain

```

---

## File Overview

# base.py

**Purpose**: This file defines a middleware system for processing `Message` objects in Telehook, enabling modular and extensible handling of incoming messages.

**Key Exports**:
- `SendFunc`: A type alias representing an asynchronous function that sends a message.
- `Middleware`: A protocol defining the structure of middleware functions, which process messages before passing them to the next handler in the chain.
- `build_chain`: A function that constructs a middleware chain from a list of middleware and a terminal send function.

**Project Integration**: This file is central to Telehook's architecture, providing a flexible mechanism for adding custom processing steps (like logging or validation) between message reception and delivery. The middleware system ensures that each step can be independently developed and tested without affecting others.

**Design Decisions**:
- **Protocol-Oriented Approach**: Using `Protocol` from the standard library to define `Middleware`, ensuring type safety and clarity.
- **Reversed Iteration**: Building the chain in reverse order of middleware application, allowing for proper handling of message flow.
- **Closure Implementation**: Utilizing a closure within `build_chain` to encapsulate each middleware function, maintaining state across invocations without global variables.

This design supports modular development and enhances maintainability by clearly separating concerns in message processing pipelines.

---

*Generated by CodeWorm on 2026-03-01 10:20*
