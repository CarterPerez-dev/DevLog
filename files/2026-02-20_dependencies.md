# dependencies

**Type:** File Overview
**Repository:** fastapi-rc
**File:** fastapi-rc/fastapi_rc/dependencies.py
**Language:** python
**Lines:** 1-52
**Complexity:** 0.0

---

## Source Code

```python
"""
ⒸAngelaMos | 2025
dependencies.py
"""

from typing import Annotated

from fastapi import (
    Depends, 
    Request,
)
from redis.asyncio import Redis

from fastapi_rc.client import cachemanager
from fastapi_rc.service import CacheService


async def get_redis_client(request: Request) -> Redis:
    """
    FastAPI dependency for direct Redis client access

    Usage:
        @app.get("/example")
        async def example(redis: RedisClient):
            await redis.get("key")
    """
    if not cachemanager.is_available:
        raise RuntimeError("Redis is not available")
    return cachemanager.client


async def get_cache_service(
    redis: Annotated[Redis, Depends(get_redis_client)]
) -> CacheService:
    """
    FastAPI dependency for generic CacheService

    Usage:
        @app.get("/users/{user_id}")
        async def get_user(user_id: str, cache: CacheServiceDep):
            return await cache.get_or_set(
                user_id,
                factory=lambda: fetch_user(user_id),
                ttl=300
            )
    """
    return CacheService(redis, namespace = "default")


RedisClient = Annotated[Redis, Depends(get_redis_client)]
CacheServiceDep = Annotated[CacheService, Depends(get_cache_service)]

```

---

## File Overview

### Purpose and Responsibility

This file, `dependencies.py`, provides FastAPI dependencies for accessing a Redis cache client and a generic CacheService. It ensures that the application can interact with Redis seamlessly while maintaining a clean separation of concerns.

### Key Exports and Public Interface

- **`get_redis_client(Request)`**: A dependency function to get an instance of the Redis client.
- **`get_cache_service(RedisClient)`**: A dependency function to get an instance of `CacheService`.
- **`RedisClient`**: An annotated type hint for the Redis client.
- **`CacheServiceDep`**: An annotated type hint for the CacheService.

### How It Fits in the Project

This file is crucial for managing dependencies related to caching. By defining these dependencies, it ensures that any part of the application needing cache access can do so through a standardized interface. This promotes reusability and maintainability across different modules within the project.

### Notable Design Decisions

- **Dependency Injection**: Uses FastAPI's `Depends` for managing dependencies, ensuring that components like Redis and CacheService are properly initialized.
- **Type Hints with Annotated**: Utilizes Python’s `Annotated` to provide clear type hints and dependency annotations, enhancing code readability and maintainability.
- **Error Handling**: Includes a runtime check in `get_redis_client` to ensure Redis is available before proceeding, preventing potential runtime errors.
```

This documentation provides an overview of the file's purpose, key exports, integration within the project, and notable design choices.

---

*Generated by CodeWorm on 2026-02-20 02:19*
