# update

**Type:** File Overview
**Repository:** angela
**File:** internal/cli/update.go
**Language:** go
**Lines:** 1-615
**Complexity:** 0.0

---

## Source Code

```go
// Â©AngelaMos | 2026
// update.go

package cli

import (
	"context"
	"fmt"
	"os"
	"path/filepath"
	"sort"
	"strings"
	"time"

	"github.com/CarterPerez-dev/angela/internal/config"
	"github.com/CarterPerez-dev/angela/internal/osv"
	"github.com/CarterPerez-dev/angela/internal/pypi"
	"github.com/CarterPerez-dev/angela/internal/pyproject"
	"github.com/CarterPerez-dev/angela/internal/requirements"
	"github.com/CarterPerez-dev/angela/internal/ui"
	"github.com/CarterPerez-dev/angela/pkg/types"
	"github.com/spf13/cobra"
)

var (
	verbose     bool
	minSeverity string
)

type updateFlags struct {
	file              string
	safe              bool
	vulns             bool
	includePrerelease bool
}

func defaultCacheDir() string {
	home, err := os.UserHomeDir()
	if err != nil {
		home = "."
	}
	return filepath.Join(home, ".angela", "cache")
}

// Execute sets up the CLI and runs the root command
func Execute() {
	root := &cobra.Command{
		Use:   "angela",
		Short: "Python dependency updater and vulnerability scanner",
		Long: `angela scans your pyproject.toml, updates dependencies to their
latest stable versions, and checks for known CVEs using OSV.dev.`,
		SilenceUsage:  true,
		SilenceErrors: true,
		PersistentPreRun: func(
			_ *cobra.Command, _ []string,
		) {
			ui.PrintBanner()
		},
	}

	defaultHelp := root.HelpFunc()
	root.SetHelpFunc(
		func(cmd *cobra.Command, args []string) {
			if cmd.Root() == cmd {
				ui.PrintBannerWithArt()
			} else {
				ui.PrintBanner()
			}
			defaultHelp(cmd, args)
		},
	)

	root.PersistentFlags().BoolVarP(
		&verbose, "verbose", "v", false,
		"show full vulnerability details",
	)
	root.PersistentFlags().StringVar(
		&minSeverity, "min-severity", "",
		"minimum severity to report (critical, high, moderate, low)",
	)

	root.AddCommand(
		newInitCmd(),
		newUpdateCmd(),
		newCheckCmd(),
		newScanCmd(),
		newCacheCmd(),
	)

	if err := root.Execute(); err != nil {
		PrintError(err.Error())
		os.Exit(1)
	}
}

const pyprojectTemplate = `[project]
name = "%s"
version = "0.1.0"
description = ""
requires-python = ">=3.13"
dependencies = []

[tool.angela]
# Minimum severity to report (critical, high, moderate, low)
# min-severity = "moderate"

# Dependencies to skip during updates
# ignore = []

# Vulnerability IDs to suppress (accepted risk)
# ignore-vulns = []
`

func newInitCmd() *cobra.Command {
	return &cobra.Command{
		Use:   "init",
		Short: "Create a new pyproject.toml with angela configuration",
		RunE: func(_ *cobra.Command, _ []string) error {
			return runInit()
		},
	}
}

func runInit() error {
	if _, err := os.Stat("pyproject.toml"); err == nil {
		return fmt.Errorf("pyproject.toml already exists")
	}

	dir, err := os.Getwd()
	if err != nil {
		return fmt.Errorf("get working directory: %w", err)
	}

	name := filepath.Base(dir)
	content := fmt.Sprintf(pyprojectTemplate, name)

	if err := os.WriteFile( //nolint:gosec
		"pyproject.toml",
		[]byte(content),
		0o644,
	); err != nil {
		return fmt.Errorf("write pyproject.toml:
```

---

## File Overview

# update.go

## Purpose and Responsibility
This Go source file is part of the `cli` package in the `angela` project, responsible for handling CLI commands related to dependency updates and vulnerability scanning. It defines commands for initializing a new `pyproject.toml`, updating dependencies, checking available updates, and scanning for known vulnerabilities.

## Key Exports and Public Interface
- **Persistent Flags**: Defines persistent flags for verbosity and minimum severity.
- **Commands**:
  - `init`: Creates a new `pyproject.toml` with default configurations.
  - `update`: Updates dependencies to the latest stable versions.
  - `check`: Shows available updates without modifying files.
  - `scan`: Scans dependencies for known vulnerabilities.

## How It Fits in the Project
This file is crucial as it provides the CLI interface, enabling users to interact with the core functionalities of `angela`. The commands defined here are essential for dependency management and security scanning. They leverage internal packages like `config`, `osv`, `pypi`, `pyproject`, and `requirements` to perform their tasks.

## Notable Design Decisions
- **Error Handling**: Uses Go's idiomatic error handling with `fmt.Errorf` and `os.Exit(1)` for critical errors.
- **Context Management**: Utilizes context for graceful cancellation in long-running operations, although not explicitly shown here.
- **Flags and Command Structure**: Organized using Cobra, providing a structured way to define flags and commands. This ensures consistent CLI behavior across the project.
- **File Resolution**: Implements `resolveFile` to handle file paths dynamically, ensuring flexibility in command execution.

---

*Generated by CodeWorm on 2026-02-20 17:23*
