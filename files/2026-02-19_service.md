# service

**Type:** File Overview
**Repository:** Cybersecurity-Projects
**File:** TEMPLATES/fullstack-template/examples/minimal-production/backend/app/user/service.py
**Language:** python
**Lines:** 1-95
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2025
service.py
"""

from uuid import UUID
from sqlalchemy.ext.asyncio import (
    AsyncSession,
)

from core.exceptions import (
    EmailAlreadyExists,
    InvalidCredentials,
    UserNotFound,
)
from core.security import (
    hash_password,
    verify_password,
)
from .schemas import (
    UserCreate,
    UserResponse,
)
from .User import User
from .repository import UserRepository


class UserService:
    """
    Business logic for user operations
    """
    def __init__(self, session: AsyncSession) -> None:
        self.session = session

    async def create_user(
        self,
        user_data: UserCreate,
    ) -> UserResponse:
        """
        Register a new user
        """
        if await UserRepository.email_exists(self.session,
                                             user_data.email):
            raise EmailAlreadyExists(user_data.email)

        hashed = await hash_password(user_data.password)
        user = await UserRepository.create_user(
            self.session,
            email = user_data.email,
            hashed_password = hashed,
        )
        return UserResponse.model_validate(user)

    async def get_user_by_id(
        self,
        user_id: UUID,
    ) -> UserResponse:
        """
        Get user by ID
        """
        user = await UserRepository.get_by_id(self.session, user_id)
        if not user:
            raise UserNotFound(str(user_id))
        return UserResponse.model_validate(user)

    async def change_password(
        self,
        user: User,
        current_password: str,
        new_password: str,
    ) -> None:
        """
        Change user password
        """
        is_valid, _ = await verify_password(current_password, user.hashed_password)
        if not is_valid:
            raise InvalidCredentials()

        hashed = await hash_password(new_password)
        await UserRepository.update_password(self.session, user, hashed)

    async def deactivate_user(
        self,
        user: User,
    ) -> UserResponse:
        """
        Deactivate user account
        """
        updated = await UserRepository.update(
            self.session,
            user,
            is_active = False
        )
        return UserResponse.model_validate(updated)

```

---

## File Overview

### service.py

**Purpose & Responsibility:**
This file contains business logic for user operations, including registration, authentication, password management, and account deactivation.

**Key Exports & Public Interface:**
- `UserService`: Manages user-related operations.
  - `create_user(user_data: UserCreate) -> UserResponse`: Registers a new user.
  - `get_user_by_id(user_id: UUID) -> UserResponse`: Retrieves a user by ID.
  - `change_password(user: User, current_password: str, new_password: str) -> None`: Updates a user's password.
  - `deactivate_user(user: User) -> UserResponse`: Deactivates a user account.

**How it Fits in the Project:**
`service.py` is part of the backend application and interacts with the database through the `UserRepository`. It provides high-level business logic that ensures data integrity and security, such as password hashing and validation. The service layer acts as an intermediary between the repository and the API or frontend.

**Notable Design Decisions:**
- **Dependency Injection**: Uses an `AsyncSession` for database operations to maintain a clean separation of concerns.
- **Error Handling**: Implements custom exceptions (`EmailAlreadyExists`, `InvalidCredentials`, `UserNotFound`) to handle specific error scenarios.
- **Security**: Utilizes secure password hashing and verification through the `hash_password` and `verify_password` functions from the core security module.
```

This documentation provides a high-level overview of the file's purpose, key functionalities, integration within the project, and design choices.

---

*Generated by CodeWorm on 2026-02-19 00:15*
