# service

**Type:** File Overview
**Repository:** oneIsNun_
**File:** go-backend/internal/metrics/service.go
**Language:** go
**Lines:** 1-418
**Complexity:** 0.0

---

## Source Code

```go
/*
AngelaMos | 2026
service.go
*/

package metrics

import (
	"context"
	"fmt"
	"time"

	"github.com/carterperez-dev/templates/go-backend/internal/mongodb"
)

type metricsRepository interface {
	GetServerStatus(ctx context.Context) (*mongodb.ServerStatus, error)
	GetDatabaseStats(ctx context.Context, dbName string) (*mongodb.DatabaseStats, error)
	GetCurrentOps(ctx context.Context) ([]mongodb.Operation, error)
	ListDatabases(ctx context.Context) ([]string, error)
	GetCollectionCount(ctx context.Context, dbName string) (int, error)
	GetTruePaidSubscribers(ctx context.Context, dbName string) (int64, error)
	GetSlowQueries(ctx context.Context, dbName string, minMillis int, limit int) ([]mongodb.SlowQuery, error)
	GetProfilingStatus(ctx context.Context, dbName string) (int, int, error)
	SetProfilingLevel(ctx context.Context, dbName string, level int, slowMs int) error
}

type Service struct {
	repo     metricsRepository
	database string
}

func NewService(repo metricsRepository, database string) *Service {
	return &Service{
		repo:     repo,
		database: database,
	}
}

type DashboardMetrics struct {
	Timestamp       time.Time          `json:"timestamp"`
	Server          ServerMetrics      `json:"server"`
	Database        DatabaseMetrics    `json:"database"`
	Connections     ConnectionStats    `json:"connections"`
	Operations      OpCounters         `json:"operations"`
	Memory          MemoryStats        `json:"memory"`
	Network         NetworkStats       `json:"network"`
	ActiveOps       int                `json:"active_ops"`
	CurrentOps      []CurrentOperation `json:"current_ops"`
	PaidSubscribers int64              `json:"paid_subscribers"`
}

type CurrentOperation struct {
	OpID             int     `json:"opid"`
	Type             string  `json:"type"`
	Namespace        string  `json:"namespace"`
	Collection       string  `json:"collection"`
	MicrosecsRunning int64   `json:"microsecs_running"`
	MillisRunning    float64 `json:"millis_running"`
	Client           string  `json:"client"`
}

type ServerMetrics struct {
	Host      string `json:"host"`
	Version   string `json:"version"`
	UptimeSec int64  `json:"uptime_seconds"`
}

type DatabaseMetrics struct {
	Name            string  `json:"name"`
	Collections     int     `json:"collections"`
	Documents       int64   `json:"documents"`
	DataSizeMB      float64 `json:"data_size_mb"`
	StorageSizeMB   float64 `json:"storage_size_mb"`
	Indexes         int     `json:"indexes"`
	IndexSizeMB     float64 `json:"index_size_mb"`
	TotalDatabases  int     `json:"total_databases"`
}

type ConnectionStats struct {
	Current      int `json:"current"`
	Available    int `json:"available"`
	TotalCreated int `json:"total_created"`
}

type OpCounters struct {
	Insert  int64 `json:"insert"`
	Query   int64 `json:"query"`
	Update  int64 `json:"update"`
	Delete  int64 `json:"delete"`
	Getmore int64 `json:"getmore"`
	Command int64 `json:"command"`
	Total   int64 `json:"total"`
}

type MemoryStats struct {
	ResidentMB int `json:"r
```

---

## File Overview

### service.go

**Purpose and Responsibility:**
This Go source file defines a `Service` struct responsible for aggregating various metrics from MongoDB, such as server status, database statistics, and current operations. It interfaces with a `metricsRepository` to fetch these metrics and constructs a comprehensive `DashboardMetrics` object.

**Key Exports or Public Interface:**
- `NewService`: A constructor function that initializes the `Service` struct.
- `GetDashboardMetrics`: The primary method for retrieving aggregated metrics in a structured format.

**How It Fits into the Project:**
This file is part of the internal `metrics` package, which provides tools to monitor and manage MongoDB instances. The `Service` struct acts as a central point for collecting and presenting various metrics, making it easier to integrate with other parts of the application that require real-time or historical data.

**Notable Design Decisions:**
- **Error Handling:** The use of error wrapping ensures that any failure during metric retrieval is properly communicated.
- **Goroutines:** While not explicitly shown in this snippet, goroutines could be used for asynchronous operations to improve performance and responsiveness.
- **Interfaces:** The `metricsRepository` interface promotes loose coupling between the service logic and the underlying data source, allowing for flexible implementation choices.
```

This documentation provides a high-level overview of the file's purpose, key components, integration within the project, and notable design decisions.

---

*Generated by CodeWorm on 2026-02-19 23:29*
