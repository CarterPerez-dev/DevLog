# parser

**Type:** File Overview
**Repository:** CodeWorm
**File:** codeworm/analysis/parser.py
**Language:** python
**Lines:** 1-402
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2026
analysis/parser.py
"""
from __future__ import annotations

import threading
from dataclasses import dataclass
from pathlib import Path
from typing import TYPE_CHECKING, ClassVar

import tree_sitter_go as tsgo
import tree_sitter_javascript as tsjs
import tree_sitter_python as tspython
import tree_sitter_rust as tsrust
import tree_sitter_typescript as tstypescript
from tree_sitter import Language, Node, Parser, Tree

from codeworm.models import Language as CodeLanguage

if TYPE_CHECKING:
    from collections.abc import Iterator


@dataclass
class ParsedFunction:
    """
    A function or method extracted from parsed source code
    """
    name: str
    start_line: int
    end_line: int
    source: str
    class_name: str | None = None
    decorators: list[str] | None = None
    parameters: list[str] | None = None
    is_async: bool = False
    docstring: str | None = None


@dataclass
class ParsedClass:
    """
    A class extracted from parsed source code
    """
    name: str
    start_line: int
    end_line: int
    source: str
    methods: list[ParsedFunction] | None = None
    decorators: list[str] | None = None
    docstring: str | None = None


class ParserManager:
    """
    Thread-safe tree-sitter parser management
    Parsers are not thread-safe so we use thread-local storage
    """
    _languages: ClassVar[dict[CodeLanguage, Language]] = {}
    _local = threading.local()
    _initialized = False

    @classmethod
    def initialize(cls) -> None:
        """
        Initialize language grammars - call once at startup
        """
        if cls._initialized:
            return

        cls._languages = {
            CodeLanguage.PYTHON: Language(tspython.language()),
            CodeLanguage.TYPESCRIPT: Language(tstypescript.language_typescript()),
            CodeLanguage.TSX: Language(tstypescript.language_tsx()),
            CodeLanguage.JAVASCRIPT: Language(tsjs.language()),
            CodeLanguage.GO: Language(tsgo.language()),
            CodeLanguage.RUST: Language(tsrust.language()),
        }
        cls._initialized = True

    @classmethod
    def get_parser(cls, language: CodeLanguage) -> Parser:
        """
        Get a thread local parser for the specified language
        """
        if not cls._initialized:
            cls.initialize()

        if not hasattr(cls._local, "parsers"):
            cls._local.parsers = {}

        if language not in cls._local.parsers:
            parser = Parser(cls._languages[language])
            cls._local.parsers[language] = parser

        return cls._local.parsers[language]

    @classmethod
    def parse(cls, source: str | bytes, language: CodeLanguage) -> Tree:
        """
        Parse source code and return the syntax tree
        """
        parser = cls.get_parser(language)
        if isinstance(source, str):
            source = source.encode("utf-8")
        return parser.parse(source)


PYTHON_QUERIES = {
    "function":
    """
        (function_defi
```

---

## File Overview

### `parser.py` Documentation

**Purpose and Responsibility:**
This file is responsible for managing tree-sitter parsers to parse source code into syntax trees, extracting functions and classes from these trees, and providing a thread-safe mechanism for handling language-specific grammars.

**Key Exports and Public Interface:**
- **ParserManager:** Manages thread-local tree-sitter parsers for different programming languages.
  - `initialize()`: Initializes the language grammars required by the parsers.
  - `get_parser(language: CodeLanguage) -> Parser`: Returns a parser instance for the specified language.
  - `parse(source: str | bytes, language: CodeLanguage) -> Tree`: Parses source code and returns the syntax tree.

- **CodeExtractor:** Extracts functions and classes from parsed syntax trees.
  - `__init__(source: str, language: CodeLanguage)`: Initializes with source code and language.
  - `_node_text(node: Node) -> str`: Retrieves text content of a node.
  - `_get_docstring(node: Node) -> str | None`: Extracts docstrings from function or class bodies.
  - `extract_functions() -> Iterator[ParsedFunction]`: Yields parsed functions.

**How it Fits into the Project:**
This file is part of the CodeWorm project, which aims to analyze and extract information from source code. It provides essential functionality for parsing and extracting structural elements like functions and classes, enabling further analysis and transformation.

**Notable Design Decisions:**
- **Thread-Safe Parsers:** Uses thread-local storage to manage parsers, ensuring they are not shared across threads.
- **Language Agnostic:** Supports multiple programming languages through a dictionary of language grammars.
- **Syntax Tree Parsing:** Utilizes tree-sitter libraries for efficient and accurate parsing of source code.

---

*Generated by CodeWorm on 2026-02-21 01:40*
