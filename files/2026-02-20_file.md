# file

**Type:** File Overview
**Repository:** vuemantics
**File:** backend/core/validators/file.py
**Language:** python
**Lines:** 1-171
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2026
file.py
"""

from dataclasses import dataclass

import config
from core import (
    FileTooLargeError,
    UnsupportedFileTypeError,
)

# SINGLE SOURCE OF TRUTH FOR ALL FILE TYPES
MIME_TO_EXTENSION: dict[str,
                        str] = {
                            "image/jpeg": "jpg",
                            "image/jpg": "jpg",
                            "image/png": "png",
                            "image/webp": "webp",
                            "image/heic": "heic",
                            "image/heif": "heif",
                            "video/mp4": "mp4",
                            "video/quicktime": "mov",
                            "video/x-msvideo": "avi",
                            "video/webm": "webm",
                            "video/mpeg": "mpeg",
                            "video/x-flv": "flv",
                        }

# Derive all other constants from MIME_TO_EXTENSION
ALLOWED_IMAGE_MIMES: set[str] = {
    k
    for k in MIME_TO_EXTENSION
    if k.startswith("image/")
}
ALLOWED_VIDEO_MIMES: set[str] = {
    k
    for k in MIME_TO_EXTENSION
    if k.startswith("video/")
}
ALLOWED_MIME_TYPES: set[str] = set(MIME_TO_EXTENSION.keys())
VALID_EXTENSIONS: set[str] = set(MIME_TO_EXTENSION.values())
IMAGE_EXTENSIONS: set[str] = {
    f".{v}"
    for k, v in MIME_TO_EXTENSION.items()
    if k.startswith("image/")
}
VIDEO_EXTENSIONS: set[str] = {
    f".{v}"
    for k, v in MIME_TO_EXTENSION.items()
    if k.startswith("video/")
}


@dataclass
class FileValidationResult:
    """
    Result of file validation
    """
    file_type: str
    extension: str


class FileValidator:
    """
    Validates uploaded files for size, MIME type, and determines file type
    """
    @classmethod
    def validate(
        cls,
        filename: str,
        mime_type: str,
        file_size: int
    ) -> FileValidationResult:
        """
        Validate uploaded file

        Args:
            filename: Original filename
            mime_type: MIME type
            file_size: Size in bytes

        Returns:
            FileValidationResult with file_type and extension

        Raises:
            FileTooLargeError: If file exceeds size limit
            UnsupportedFileTypeError: If MIME type not allowed
        """
        cls._validate_size(file_size)
        cls._validate_mime_type(mime_type)

        file_type = cls._determine_file_type(mime_type)
        extension = cls._get_extension(filename, mime_type)

        return FileValidationResult(
            file_type = file_type,
            extension = extension
        )

    @classmethod
    def _validate_size(cls, file_size: int) -> None:
        """
        Validate file size is within limits
        """
        if file_size > config.settings.max_upload_size:
            raise FileTooLargeError(
                f"File size {file_size} exceeds limit of "
                f"{config.settings.max_upload_size} bytes"
            )

    @classmethod
    def _v
```

---

## File Overview

### Purpose and Responsibility

This Python source file, `file.py`, is responsible for validating uploaded files based on size, MIME type, and file extension. It ensures that only supported file types are accepted by the application.

### Key Exports and Public Interface

- **`FileValidationResult`**: A dataclass representing the result of file validation.
- **`FileValidator` Class**:
  - `validate(filename: str, mime_type: str, file_size: int) -> FileValidationResult`: Validates an uploaded file against size limits and MIME type constraints.
  - `_validate_size(file_size: int) -> None`: Checks if the file size is within the allowed limit.
  - `_validate_mime_type(mime_type: str) -> None`: Ensures the MIME type is supported.
  - `_determine_file_type(mime_type: str) -> str`: Determines whether a file is an image or video based on its MIME type.
  - `_get_extension(filename: str, mime_type: str) -> str`: Retrieves the file extension from either the filename or MIME type.
  - `is_valid_extension(extension: str) -> bool`: Checks if a given extension is valid.
  - `is_image_mime(mime_type: str) -> bool`: Determines if a MIME type represents an image.
  - `is_video_mime(mime_type: str) -> bool`: Determines if a MIME type represents a video.

### How It Fits into the Project

This file is part of the core validation module in the backend of the `vuemantics` project. It interacts with other modules to ensure that only valid files are processed, thereby maintaining data integrity and security.

### Notable Design Decisions

- **Single Source of Truth**: The `MIME_TO_EXTENSION` dictionary serves as a single source of truth for file types, ensuring consistency across the application.
- **Class-Based Validation**: Using a class-based approach with static methods allows for encapsulation and reusability. This design makes it easier to extend or modify validation rules without altering existing code.
- **Type Hints and Dataclasses**: Type hints improve code readability and maintainability, while dataclasses simplify object creation and manipulation.

---

*Generated by CodeWorm on 2026-02-20 13:25*
