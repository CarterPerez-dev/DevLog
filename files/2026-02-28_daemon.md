# daemon

**Type:** File Overview
**Repository:** CodeWorm
**File:** codeworm/daemon.py
**Language:** python
**Lines:** 1-810
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2026
daemon.py
"""
from __future__ import annotations

import asyncio
import signal
import sys
from dataclasses import dataclass, field
from datetime import datetime
from pathlib import Path
from typing import TYPE_CHECKING

from codeworm.analysis import (
    CodeAnalyzer,
    ParserManager,
    TargetRouter,
)
from codeworm.analysis.targets import DocumentationTarget, select_doc_type
from codeworm.core import (
    CodeWormSettings,
    StateManager,
    configure_logging,
    get_logger,
    load_settings,
)
from codeworm.core.events import get_publisher
from codeworm.core.notifier import CodeWormNotifier
from codeworm.git import DevLogRepository
from codeworm.llm import (
    DocumentationGenerator,
    OllamaClient,
    OllamaError,
)
from codeworm.models import DocType
from codeworm.scheduler import CodeWormScheduler

if TYPE_CHECKING:
    from codeworm.analysis import AnalysisCandidate


@dataclass
class CycleStats:
    """
    Tracks cycle statistics for monitoring and backoff logic
    """
    total_cycles: int = 0
    successful_cycles: int = 0
    failed_cycles: int = 0
    skipped_cycles: int = 0
    consecutive_failures: int = 0
    consecutive_ollama_failures: int = 0
    consecutive_push_failures: int = 0
    last_success: datetime | None = None
    last_failure: datetime | None = None
    last_failure_reason: str = ""
    repos_exhausted: set = field(default_factory = set)

    @property
    def success_rate(self) -> float:
        if self.total_cycles == 0:
            return 0.0
        return self.successful_cycles / self.total_cycles * 100

    def record_success(self) -> None:
        self.total_cycles += 1
        self.successful_cycles += 1
        self.consecutive_failures = 0
        self.consecutive_ollama_failures = 0
        self.last_success = datetime.now()
        self.repos_exhausted.clear()

    def record_failure(self, reason: str) -> None:
        self.total_cycles += 1
        self.failed_cycles += 1
        self.consecutive_failures += 1
        self.last_failure = datetime.now()
        self.last_failure_reason = reason

    def record_ollama_failure(self) -> None:
        self.consecutive_ollama_failures += 1

    def record_ollama_recovery(self) -> None:
        self.consecutive_ollama_failures = 0

    def record_skip(self, reason: str) -> None:
        self.total_cycles += 1
        self.skipped_cycles += 1
        self.last_failure_reason = reason

    def record_repo_exhausted(self, repo_name: str) -> None:
        self.repos_exhausted.add(repo_name)

    def get_backoff_seconds(self) -> int:
        if self.consecutive_failures <= 1:
            return 0
        return min(300, 30 * (2**(self.consecutive_failures - 1)))

    def get_ollama_wait_seconds(self) -> int:
        if self.consecutive_ollama_failures <= 1:
            return 10
        return min(300, 10 * (2**(self.consecutive_ollama_failures - 1)))

    def to_dict(self) -> dict:
        return {
            "total_cycles":

```

---

## File Overview

### daemon.py

**Purpose and Responsibility:**
This file defines the `CodeWormDaemon` class, which serves as the main orchestrator for CodeWorm's 24/7 operation. It coordinates tasks such as code analysis, LLM generation, git commits, and scheduling, ensuring robust self-healing mechanisms.

**Key Exports and Public Interface:**
- **Class:** `CodeWormDaemon`
  - **Initialization:** Initializes the daemon with settings and a dry-run flag.
  - **Methods:**
    - `__init__`: Sets up components like logging, state management, analysis, scheduling, and LLM client.
    - `start`: Starts the daemon's main loop.
    - `stop`: Stops the daemon gracefully.

**How It Fits into the Project:**
`CodeWormDaemon` is a central component of CodeWorm, integrating various modules such as code analysis (`CodeAnalyzer`), documentation generation (`DocumentationGenerator`), and git operations (`DevLogRepository`). It acts as the glue that ties these components together, ensuring seamless operation and self-recovery.

**Notable Design Decisions:**
- **Self-healing Mechanisms:** The daemon includes backoff strategies for retries and fallbacks when Ollama (LLM client) is unavailable.
- **Cycle Statistics:** `CycleStats` tracks the success rate, failure reasons, and backoff intervals to manage retry logic effectively.
- **Asynchronous Operations:** Utilizes asyncio for asynchronous task management, ensuring non-blocking operations during analysis and LLM interactions.

---

*Generated by CodeWorm on 2026-02-28 12:33*
