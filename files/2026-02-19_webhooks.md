# webhooks

**Type:** File Overview
**Repository:** CertGames-Core
**File:** backend/app/clients/webhooks.py
**Language:** python
**Lines:** 1-320
**Complexity:** 0.0

---

## Source Code

```python
"""
Webhook Handler Configuration
/app/clients/webhooks.py
---
Future iOS Admin App Push Notification System
"""

import requests
from enum import Enum
from typing import Any, Optional
from datetime import datetime, UTC
from flask import Flask, current_app


class NotificationType(Enum):
    """
    Notification types for iOS admin app
    """
    SECURITY_ALERT = "security_alert"
    NEW_SUBSCRIPTION = "new_subscription"
    SUBSCRIPTION_CANCELLED = "subscription_cancelled"
    PAYMENT_FAILED = "payment_failed"
    HIGH_ERROR_RATE = "high_error_rate"
    PERFORMANCE_DEGRADATION = "performance_degradation"
    NEW_USER_SIGNUP = "new_user_signup"
    SUPPORT_TICKET = "support_ticket"
    DAILY_SUMMARY = "daily_summary"
    SUSPICIOUS_ACTIVITY = "suspicious_activity"


class AdminNotificationService:
    """
    Service to send push notifications to iOS Admin App
    Future implementation for my custom admin panel iOS app
    """
    def __init__(self, webhook_url: str, api_key: str = None):
        self.webhook_url = webhook_url
        self.api_key = api_key
        self.enabled = bool(webhook_url)

    def send_notification(
        self,
        notification_type: NotificationType,
        title: str,
        message: str,
        *,
        priority: str = "normal",
        data: dict[str,
                   Any] = None,
        badge_increment: int = 1
    ) -> bool:
        """
        Send notification to iOS admin app
        """
        if not self.enabled:
            return False

        payload = {
            "type": notification_type.value,
            "title": title,
            "body": message,
            "priority": priority,
            "timestamp": datetime.now(UTC).isoformat(),
            "badge_increment": badge_increment,
            "data": data or {},
            "sound":
            "critical.caf" if priority == "critical" else "default"
        }

        headers = {
            "Content-Type": "application/json",
        }

        if self.api_key:
            headers["Authorization"] = f"Bearer {self.api_key}"

        try:
            response = requests.post(
                self.webhook_url,
                json = payload,
                headers = headers,
                timeout = 5
            )
            return response.status_code in [200, 201, 204]
        except Exception as e:  # pylint: disable=broad-exception-caught
            current_app.logger.error(
                "Failed to send admin notification: %s",
                str(e)
            )
            return False


admin_notifier: Optional[AdminNotificationService] = None


def setup_webhooks(app: Flask) -> None:
    """
    Initialize webhook handlers for iOS admin app
    """
    global admin_notifier  # pylint: disable=global-statement

    ios_webhook_url = app.config.get("IOS_ADMIN_WEBHOOK_URL")
    ios_api_key = app.config.get("IOS_ADMIN_API_KEY")

    if ios_webhook_url:
        admin_notifier = AdminNotificationService(
            ios_w
```

---

## File Overview

## Webhook Handler Configuration (`webhooks.py`)

### Purpose and Responsibility
This file defines a service for sending push notifications to an iOS admin app via webhooks. It includes configuration, initialization, and notification methods tailored for various types of alerts and events.

### Key Exports and Public Interface
- **AdminNotificationService**: A class responsible for sending notifications.
  - `send_notification`: Sends a notification with specified parameters.
  
- **setup_webhooks**: Initializes the webhook service within a Flask application context.
  
- **notify_security_alert, notify_subscription_event, notify_error_threshold**: Functions to send specific types of notifications.

### How It Fits into the Project
This file is part of the `CertGames-Core` backend and integrates with the iOS admin app via webhooks. It ensures that critical events like security alerts, subscription changes, and error rates are promptly communicated to the admin panel.

### Notable Design Decisions
- **Enum for Notification Types**: Provides a clear and maintainable way to define different types of notifications.
- **Flask Integration**: Utilizes Flask's configuration system to initialize services dynamically based on app settings.
- **Error Handling**: Logs errors gracefully without halting the application, ensuring robustness.

---

*Generated by CodeWorm on 2026-02-19 07:38*
