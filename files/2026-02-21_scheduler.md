# scheduler

**Type:** File Overview
**Repository:** CodeWorm
**File:** codeworm/scheduler/scheduler.py
**Language:** python
**Lines:** 1-354
**Complexity:** 0.0

---

## Source Code

```python
"""
ⒸAngelaMos | 2026
scheduler/scheduler.py
"""
from __future__ import annotations

import random
from dataclasses import dataclass, field
from datetime import datetime, timedelta
from typing import TYPE_CHECKING
from collections.abc import Callable
from zoneinfo import ZoneInfo

from apscheduler.schedulers.background import BackgroundScheduler
from apscheduler.triggers.base import BaseTrigger

from codeworm.core import get_logger

if TYPE_CHECKING:
    from codeworm.core.config import ScheduleSettings


logger = get_logger("scheduler")

HOUR_WEIGHTS: dict[int,
                   float] = {
                       0: 0.02,
                       1: 0.01,
                       2: 0.005,
                       3: 0.0,
                       4: 0.0,
                       5: 0.0,
                       6: 0.01,
                       7: 0.03,
                       8: 0.08,
                       9: 0.12,
                       10: 0.15,
                       11: 0.14,
                       12: 0.08,
                       13: 0.10,
                       14: 0.14,
                       15: 0.15,
                       16: 0.14,
                       17: 0.10,
                       18: 0.06,
                       19: 0.05,
                       20: 0.10,
                       21: 0.12,
                       22: 0.10,
                       23: 0.05,
                   }


@dataclass
class ScheduledTask:
    """
    A task scheduled for execution
    """
    scheduled_time: datetime
    task_id: str
    task_type: str
    executed: bool = False
    executed_at: datetime | None = None
    result: str | None = None


@dataclass
class DailySchedule:
    """
    Schedule of tasks for a single day
    """
    date: datetime
    tasks: list[ScheduledTask] = field(default_factory = list)
    target_commits: int = 0

    @property
    def pending_count(self) -> int:
        return sum(1 for t in self.tasks if not t.executed)

    @property
    def completed_count(self) -> int:
        return sum(1 for t in self.tasks if t.executed)


class HumanLikeTrigger(BaseTrigger):
    """
    APScheduler trigger that generates human-like scheduling patterns
    """
    def __init__(
        self,
        min_commits: int = 12,
        max_commits: int = 18,
        min_gap_minutes: int = 30,
        prefer_hours: list[int] | None = None,
        avoid_hours: list[int] | None = None,
        weekend_reduction: float = 0.7,
        timezone: str = "UTC",
    ) -> None:
        """
        Initialize the human-like trigger
        """
        self.min_commits = min_commits
        self.max_commits = max_commits
        self.min_gap_minutes = min_gap_minutes
        self.prefer_hours = prefer_hours or list(range(9, 18))
        self.avoid_hours = avoid_hours or [3, 4, 5, 6]
        self.weekend_reduction = weekend_reduction
        self.timezone = ZoneInfo(timezone)
        self._last_run: datetime | None = None
        self._daily_times: list[datetime] = []
    
```

---

## File Overview

### scheduler/scheduler.py

**Purpose and Responsibility:**
This file implements a human-like scheduling mechanism for tasks using the APScheduler library. It defines classes and logic to manage daily schedules, task execution times, and trigger generation based on realistic patterns.

**Key Exports and Public Interface:**
- `ScheduledTask`: A data class representing scheduled tasks.
- `DailySchedule`: Manages a list of tasks for a single day, including pending and completed counts.
- `HumanLikeTrigger`: An APScheduler trigger that generates human-like scheduling times, considering commit counts, time gaps, preferred hours, and weekend adjustments.

**How It Fits in the Project:**
This file is part of the CodeWorm project's task management system. It integrates with the core configuration settings to dynamically schedule tasks based on realistic patterns, ensuring that tasks are executed at times that mimic human behavior.

**Notable Design Decisions:**
- **Weighted Hour Generation:** Uses a weighted distribution for hours to simulate natural human activity patterns.
- **Dynamic Scheduling:** Generates daily schedules considering commit counts and time gaps, with adjustments for weekends.
- **APScheduler Integration:** Utilizes APScheduler's `BackgroundScheduler` and custom `BaseTrigger` to manage task execution times effectively.
```

This documentation provides a high-level overview of the file’s purpose, key components, integration within the project, and significant design choices.

---

*Generated by CodeWorm on 2026-02-21 01:39*
