# main

**Type:** File Overview
**Repository:** docksec
**File:** cmd/docksec/main.go
**Language:** go
**Lines:** 1-266
**Complexity:** 0.0

---

## Source Code

```go
/*
AngelaMos | 2025
main.go
*/

package main

import (
	"context"
	"fmt"
	"os"
	"os/signal"
	"sort"
	"syscall"

	"github.com/CarterPerez-dev/docksec/internal/benchmark"
	"github.com/CarterPerez-dev/docksec/internal/config"
	"github.com/CarterPerez-dev/docksec/internal/scanner"
	"github.com/spf13/cobra"
)

var (
	version   = "dev"
	commit    = "none"
	buildDate = "unknown"
)

func main() {
	os.Exit(run())
}

func run() int {
	ctx, cancel := signal.NotifyContext(
		context.Background(),
		syscall.SIGINT,
		syscall.SIGTERM,
	)
	defer cancel()

	if err := newRootCmd().ExecuteContext(ctx); err != nil {
		fmt.Fprintf(os.Stderr, "Error: %v\n", err)
		return 1
	}
	return 0
}

func newRootCmd() *cobra.Command {
	cfg := config.New()

	root := &cobra.Command{
		Use:   "docksec",
		Short: "Docker security audit tool",
		Long: `docksec scans Docker environments for security misconfigurations,
validates against CIS Docker Benchmark controls, and generates
actionable remediation reports.`,
		SilenceUsage:  true,
		SilenceErrors: true,
	}

	root.AddCommand(
		newScanCmd(cfg),
		newVersionCmd(),
		newBenchmarkCmd(),
	)

	return root
}

func newScanCmd(cfg *config.Config) *cobra.Command {
	cmd := &cobra.Command{
		Use:   "scan",
		Short: "Scan Docker environment for security issues",
		Long: `Scan running containers, images, Dockerfiles, and docker-compose files
for security misconfigurations and CIS Docker Benchmark violations.`,
		RunE: func(cmd *cobra.Command, args []string) error {
			return runScan(cmd.Context(), cfg)
		},
	}

	flags := cmd.Flags()

	flags.StringSliceVarP(&cfg.Targets, "target", "t", []string{"all"},
		"Scan targets: all, containers, daemon, images")

	flags.StringSliceVarP(&cfg.Files, "file", "f", nil,
		"Dockerfile or docker-compose.yml files to scan")

	flags.StringVarP(&cfg.Output, "output", "o", "terminal",
		"Output format: terminal, json, sarif, junit")

	flags.StringVar(&cfg.OutputFile, "output-file", "",
		"Write output to file instead of stdout")

	flags.StringSliceVar(&cfg.Severity, "severity", nil,
		"Filter by severity: info, low, medium, high, critical")

	flags.StringSliceVar(&cfg.CISControls, "cis", nil,
		"Filter by specific CIS control IDs (e.g., 5.4,5.31)")

	flags.StringSliceVar(&cfg.ExcludeContainers, "exclude-container", nil,
		"Exclude containers by name pattern")

	flags.StringSliceVar(&cfg.IncludeContainers, "include-container", nil,
		"Include only containers matching name pattern")

	flags.StringVar(
		&cfg.FailOn,
		"fail-on",
		"",
		"Exit with code 1 if findings at or above severity: low, medium, high, critical",
	)

	flags.BoolVarP(&cfg.Quiet, "quiet", "q", false,
		"Minimal output (counts only)")

	flags.BoolVarP(&cfg.Verbose, "verbose", "v", false,
		"Verbose output for debugging")

	flags.IntVar(&cfg.Workers, "workers", config.DefaultWorkerCount,
		"Number of concurrent workers")

	return cmd
}

func newVersionCmd() *cobra.Command {
	return &cobra.Command{
		Use:   "version",
		Short: "Print version informati
```

---

## File Overview

### main.go

**Purpose and Responsibility:**
This file serves as the entry point for the `docksec` tool, a Docker security audit utility. It initializes the command-line interface (CLI) and handles the execution of various commands such as scanning Docker environments, listing CIS controls, and printing version information.

**Key Exports and Public Interface:**
- `main()`: The main function that starts the CLI application.
- `run()`: Executes the root command with error handling.
- `newRootCmd()`: Creates the top-level command (`docksec`) and adds subcommands for scanning, benchmarking, and version information.

**How it Fits into the Project:**
`main.go` acts as the central hub of the CLI application. It leverages other packages like `config`, `scanner`, and `benchmark` to provide comprehensive security auditing capabilities. The file ensures that the CLI is robust by handling signals for graceful shutdown and providing detailed error messages.

**Notable Design Decisions:**
- **Error Handling:** Errors are handled gracefully, ensuring that any issues during execution are reported via stderr.
- **Concurrency:** The use of goroutines (`context` and `signal.NotifyContext`) ensures that the application can handle multiple tasks concurrently while maintaining a clean shutdown mechanism.
- **Configuration Management:** Utilizes `config.New()` to manage application settings, promoting flexibility in configuration options.
- **Command Pattern:** Adheres to the command pattern with `cobra`, providing a structured way to define and execute CLI commands.
```

This documentation provides an overview of the file's role within the project, its key functions, and important design choices.

---

*Generated by CodeWorm on 2026-02-20 18:49*
