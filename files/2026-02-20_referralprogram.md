# ReferralProgram

**Type:** File Overview
**Repository:** stripe-referral
**File:** src/stripe_referral/models/ReferralProgram.py
**Language:** python
**Lines:** 1-105
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2025 | CertGames.com
ReferralProgram model
"""

from __future__ import annotations

from typing import (
    TYPE_CHECKING,
    Any,
)

from sqlalchemy import (
    JSON,
    Boolean,
    Float,
    Integer,
    String,
)
from sqlalchemy.orm import (
    Mapped,
    mapped_column,
    relationship,
)

from ..config.constants import (
    MAX_PROGRAM_KEY_LENGTH,
    MAX_PROGRAM_NAME_LENGTH,
)
from ..config.enums import (
    AdapterType,
    CurrencyCode,
    RewardType,
)
from ..database.Base import (
    Base,
    TimestampMixin,
)

if TYPE_CHECKING:
    from .ReferralCode import ReferralCode
    from .ReferralTracking import ReferralTracking


class ReferralProgram(Base, TimestampMixin):
    """
    Referral program configuration
    """
    __tablename__ = "referral_programs"

    id: Mapped[int] = mapped_column(
        primary_key = True,
        autoincrement = True
    )
    name: Mapped[str] = mapped_column(
        String(MAX_PROGRAM_NAME_LENGTH),
        unique = True,
        index = True
    )
    program_key: Mapped[str] = mapped_column(
        String(MAX_PROGRAM_KEY_LENGTH),
        unique = True,
        index = True
    )

    reward_amount: Mapped[float] = mapped_column(Float, nullable = False)
    reward_currency: Mapped[str] = mapped_column(
        String(3),
        default = CurrencyCode.USD.value
    )
    reward_type: Mapped[str] = mapped_column(
        String(50),
        default = RewardType.ONE_TIME.value
    )

    is_active: Mapped[bool] = mapped_column(Boolean, default = True)
    max_rewards_per_user: Mapped[int | None] = mapped_column(
        Integer,
        nullable = True
    )
    conversion_window_days: Mapped[int | None] = mapped_column(
        Integer,
        nullable = True
    )

    adapter_type: Mapped[str] = mapped_column(
        String(50),
        default = AdapterType.MANUAL.value
    )
    adapter_config: Mapped[dict[str,
                                Any]] = mapped_column(
                                    JSON,
                                    default = dict
                                )

    codes: Mapped[list[ReferralCode]] = relationship(
        "ReferralCode",
        back_populates = "program",
        cascade = "all, delete-orphan"
    )
    trackings: Mapped[list[ReferralTracking]] = relationship(
        "ReferralTracking",
        back_populates = "program"
    )

```

---

## File Overview

### ReferralProgram Model

**Purpose and Responsibility:**
This file defines the `ReferralProgram` model, which represents a configuration for referral programs within the application. It includes fields such as program name, reward details, and adapter settings.

**Key Exports and Public Interface:**
- **Class:** `ReferralProgram`
  - Fields: `id`, `name`, `program_key`, `reward_amount`, `reward_currency`, `reward_type`, `is_active`, `max_rewards_per_user`, `conversion_window_days`, `adapter_type`, `adapter_config`.
  - Relationships: `codes` (list of `ReferralCode`), `trackings` (list of `ReferralTracking`).

**How it Fits in the Project:**
The `ReferralProgram` model is a core component that defines the structure and behavior of referral programs. It integrates with other models like `ReferralCode` and `ReferralTracking`, forming part of the broader referral management system.

**Notable Design Decisions:**
- **Relationships:** Uses SQLAlchemy relationships to manage associations between `ReferralProgram` and its related codes and trackings.
- **Type Hints and Enums:** Utilizes type hints and enums for better type safety and clarity, ensuring consistent data handling across the application.
- **TimestampMixin:** Inherits from `TimestampMixin` to automatically handle creation and update timestamps, enhancing auditability.
```

This documentation provides a high-level overview of the file's purpose, key components, integration within the project, and notable design choices.

---

*Generated by CodeWorm on 2026-02-20 10:40*
