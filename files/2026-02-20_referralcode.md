# ReferralCode

**Type:** File Overview
**Repository:** stripe-referral
**File:** src/stripe_referral/models/ReferralCode.py
**Language:** python
**Lines:** 1-85
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2025 | CertGames.com
ReferralCode model
"""

from __future__ import annotations

from datetime import datetime
from typing import TYPE_CHECKING

from sqlalchemy import (
    DateTime,
    ForeignKey,
    Integer,
    String,
)
from sqlalchemy.orm import (
    Mapped,
    mapped_column,
    relationship,
)

from ..config.constants import (
    MAX_CODE_LENGTH,
    MAX_USER_ID_LENGTH,
)
from ..config.enums import ReferralCodeStatus
from ..database.Base import (
    Base,
    TimestampMixin,
)

if TYPE_CHECKING:
    from .ReferralProgram import ReferralProgram
    from .ReferralTracking import ReferralTracking


class ReferralCode(Base, TimestampMixin):
    """
    Individual referral code for a user
    """
    __tablename__ = "referral_codes"

    id: Mapped[int] = mapped_column(
        primary_key = True,
        autoincrement = True
    )
    code: Mapped[str] = mapped_column(
        String(MAX_CODE_LENGTH),
        unique = True,
        index = True
    )

    user_id: Mapped[str] = mapped_column(
        String(MAX_USER_ID_LENGTH),
        index = True
    )
    program_id: Mapped[int] = mapped_column(
        ForeignKey("referral_programs.id"),
        nullable = False
    )

    status: Mapped[str] = mapped_column(
        String(20),
        default = ReferralCodeStatus.ACTIVE.value,
        index = True
    )

    uses_count: Mapped[int] = mapped_column(Integer, default = 0)
    max_uses: Mapped[int | None] = mapped_column(Integer, nullable = True)

    expires_at: Mapped[datetime | None] = mapped_column(
        DateTime(timezone = True),
        nullable = True
    )

    program: Mapped[ReferralProgram] = relationship(
        "ReferralProgram",
        back_populates = "codes"
    )
    trackings: Mapped[list[ReferralTracking]] = relationship(
        "ReferralTracking",
        back_populates = "code"
    )

```

---

## File Overview

### ReferralCode Model Documentation

**Purpose:**
This file defines the `ReferralCode` model, which represents individual referral codes used within a referral program. It is part of the broader `stripe-referral` project and interacts with the SQLAlchemy ORM to manage database records.

**Key Exports & Public Interface:**
- **Class:** `ReferralCode`
  - Fields: `id`, `code`, `user_id`, `program_id`, `status`, `uses_count`, `max_uses`, `expires_at`
  - Relationships: `program` (back-populates to `codes`), `trackings` (back-populates to `code`)

**Project Fit:**
The `ReferralCode` model is integral to the referral program module, facilitating the creation and tracking of unique referral codes. It integrates with other models like `ReferralProgram` and `ReferralTracking`, forming a cohesive system for managing referrals.

**Notable Design Decisions:**
- **ORM Integration:** Uses SQLAlchemy for database interactions.
- **Type Hints & Enums:** Utilizes type hints and enums (e.g., `ReferralCodeStatus`) to ensure clarity and enforce valid status values.
- **TimestampMixin:** Inherits from `TimestampMixin` to automatically manage creation and update timestamps, enhancing auditability.
```

This documentation provides a concise overview of the file's purpose, key components, integration within the project, and important design choices.

---

*Generated by CodeWorm on 2026-02-20 10:50*
