# ReferralTracking

**Type:** File Overview
**Repository:** stripe-referral
**File:** src/stripe_referral/models/ReferralTracking.py
**Language:** python
**Lines:** 1-114
**Complexity:** 0.0

---

## Source Code

```python
"""
ⒸAngelaMos | 2025 | CertGames.com
ReferralTracking model
"""

from __future__ import annotations

from datetime import (
    UTC,
    datetime,
)
from typing import TYPE_CHECKING

from sqlalchemy import (
    DateTime,
    Float,
    ForeignKey,
    String,
)
from sqlalchemy.orm import (
    Mapped,
    mapped_column,
    relationship,
)

from ..config.constants import (
    MAX_TRANSACTION_ID_LENGTH,
    MAX_USER_ID_LENGTH,
)
from ..config.enums import (
    CurrencyCode,
    ReferralTrackingStatus,
)
from ..database.Base import (
    Base,
    TimestampMixin,
)

if TYPE_CHECKING:
    from .Payout import Payout
    from .ReferralCode import ReferralCode
    from .ReferralProgram import ReferralProgram


class ReferralTracking(Base, TimestampMixin):
    """
    Tracks successful referral conversions
    """
    __tablename__ = "referral_trackings"

    id: Mapped[int] = mapped_column(
        primary_key = True,
        autoincrement = True
    )

    referrer_user_id: Mapped[str] = mapped_column(
        String(MAX_USER_ID_LENGTH),
        index = True
    )
    referred_user_id: Mapped[str] = mapped_column(
        String(MAX_USER_ID_LENGTH),
        index = True
    )

    code_id: Mapped[int] = mapped_column(
        ForeignKey("referral_codes.id"),
        nullable = False
    )
    program_id: Mapped[int] = mapped_column(
        ForeignKey("referral_programs.id"),
        nullable = False
    )

    transaction_id: Mapped[str | None] = mapped_column(
        String(MAX_TRANSACTION_ID_LENGTH),
        nullable = True
    )
    transaction_amount: Mapped[float | None] = mapped_column(
        Float,
        nullable = True
    )

    amount_earned: Mapped[float] = mapped_column(Float, nullable = False)
    currency: Mapped[str] = mapped_column(
        String(3),
        default = CurrencyCode.USD.value
    )

    converted_at: Mapped[datetime] = mapped_column(
        DateTime(timezone = True),
        default = lambda: datetime.now(UTC),
        index = True
    )

    payout_status: Mapped[str] = mapped_column(
        String(20),
        default = ReferralTrackingStatus.PENDING.value,
        index = True
    )

    code: Mapped[ReferralCode] = relationship(
        "ReferralCode",
        back_populates = "trackings"
    )
    program: Mapped[ReferralProgram] = relationship(
        "ReferralProgram",
        back_populates = "trackings"
    )
    payout: Mapped[Payout | None] = relationship(
        "Payout",
        back_populates = "tracking",
        uselist = False
    )

```

---

## File Overview

### ReferralTracking Model

**Purpose:**
This model tracks successful referral conversions within the StripeReferral application, capturing details such as referrer and referred user IDs, transaction amounts, and payout statuses.

**Key Exports & Public Interface:**
- `id`: Primary key for tracking records.
- `referrer_user_id`, `referred_user_id`: User identifiers for the referrer and referred party.
- `code_id` and `program_id`: Foreign keys linking to `ReferralCode` and `ReferralProgram`.
- `transaction_id`, `transaction_amount`: Details of the transaction, if applicable.
- `amount_earned`, `currency`, `converted_at`, `payout_status`: Financial and status details.
- Relationships with `ReferralCode`, `ReferralProgram`, and `Payout`.

**Project Fit:**
This model is integral to the referral program functionality, facilitating tracking of referrals and managing payouts. It integrates with other models like `ReferralCode` and `Payout` through relationships.

**Design Decisions:**
- **TimestampMixin**: Utilizes a mixin for automatic timestamping.
- **Foreign Keys & Relationships**: Ensures data integrity by linking to related entities.
- **Type Hints & Enums**: Uses SQLAlchemy's ORM features with type hints and enums from the project’s constants module, enhancing code readability and maintainability.

This model is part of the broader referral tracking system, ensuring accurate and efficient management of referrals and associated payouts.

---

*Generated by CodeWorm on 2026-02-20 10:20*
