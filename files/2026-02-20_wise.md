# wise

**Type:** File Overview
**Repository:** stripe-referral
**File:** src/stripe_referral/adapters/wise.py
**Language:** python
**Lines:** 1-230
**Complexity:** 0.0

---

## Source Code

```python
"""
ⒸAngelaMos | 2025 | CertGames.com
Wise API payout adapter
"""

import uuid
from typing import (
    Any,
    cast,
)

import requests

from ..config.enums import CurrencyCode
from ..exceptions.errors import PayoutAdapterError
from ..schemas.types import (
    PayoutResult,
    RecipientValidation,
)
from .base import PayoutAdapter


class WiseAdapter(PayoutAdapter):
    """
    Payout adapter for Wise API automated transfers
    """
    def __init__(self, api_token: str, sandbox: bool = False) -> None:
        """
        Initialize with Wise API token

        Args:
            api_token: Wise API token
            sandbox: Use sandbox environment if True
        """
        self.api_token = api_token
        self.base_url = (
            "https://api.sandbox.transferwise.tech"
            if sandbox else "https://api.transferwise.com"
        )
        self.headers = {
            "Authorization": f"Bearer {api_token}",
            "Content-Type": "application/json",
        }

    def _make_request(self,
                      method: str,
                      endpoint: str,
                      **kwargs: Any) -> dict[str,
                                             Any]:
        """
        Make HTTP request to Wise API with error handling
        """
        url = f"{self.base_url}{endpoint}"

        try:
            response = requests.request(
                method,
                url,
                headers = self.headers,
                timeout = 30,
                **kwargs
            )
            response.raise_for_status()
            json_response: dict[str, Any] = response.json()
            return json_response
        except requests.exceptions.HTTPError as e:
            raise PayoutAdapterError(
                f"Wise API error: {e.response.text}",
                adapter = "wise",
                endpoint = endpoint,
                status_code = e.response.status_code,
            ) from e
        except Exception as e:
            raise PayoutAdapterError(
                f"Wise request error: {str(e)}",
                adapter = "wise",
                endpoint = endpoint,
            ) from e

    def _get_profile_id(self) -> int:
        """
        Get first Wise profile ID
        """
        profiles = self._make_request("GET", "/v1/profiles")
        profiles_list = cast(list[dict[str, Any]], profiles)
        return cast(int, profiles_list[0]["id"])

    def send_payout(
        self,
        user_id: str,
        amount: float,
        currency: str,
        recipient_data: dict[str,
                             Any],
    ) -> PayoutResult:
        """
        Send payout via Wise API
        """
        try:
            profile_id = self._get_profile_id()

            source_currency = recipient_data.get(
                "source_currency",
                CurrencyCode.USD.value
            )
            target_currency = currency

            quote = self._make_request(
                "POST",
         
```

---

## File Overview

### WiseAdapter Class Documentation

**Purpose:**
The `WiseAdapter` class is responsible for integrating with the Wise API to facilitate automated payouts. It handles profile management, quote generation, recipient validation, and transfer execution.

**Key Exports & Public Interface:**
- **Class:** `WiseAdapter`
  - **Methods:**
    - `_make_request`: Makes HTTP requests to the Wise API.
    - `_get_profile_id`: Retrieves the first profile ID from the Wise API.
    - `send_payout`: Sends a payout via the Wise API.

**How it Fits into the Project:**
This class is part of the `stripe_referral` project, specifically within the `adapters` module. It acts as an adapter for integrating with the Wise payment gateway to handle payouts seamlessly across the application. The `WiseAdapter` interacts with other components such as user data validation and error handling mechanisms.

**Notable Design Decisions:**
- **Error Handling:** Comprehensive error handling is implemented using custom exceptions (`PayoutAdapterError`) to ensure robustness.
- **Type Hints & Typing:** Utilizes Python's type hints for better code readability and maintainability. 
- **Configuration Management:** Uses environment-specific URLs (sandbox vs production) via the `__init__` method, allowing flexible deployment configurations.
```

This documentation provides a high-level overview of the file’s purpose, key components, integration within the project, and notable design choices.

---

*Generated by CodeWorm on 2026-02-20 09:27*
