# upload

**Type:** File Overview
**Repository:** vuemantics
**File:** backend/schemas/upload.py
**Language:** python
**Lines:** 1-210
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2026
upload.py
"""

from datetime import datetime
from typing import Any, Literal
from uuid import UUID

from pydantic import (
    BaseModel,
    ConfigDict,
    Field,
    field_serializer,
    field_validator,
)

from config import EMBEDDING_DIMENSIONS
from models.Upload import FileType, ProcessingStatus
from schemas import PaginationParams, TimestampMixin


class UploadResponse(TimestampMixin):
    """
    Upload response with all fields including embedding
    """
    model_config = ConfigDict(
        extra = "forbid",
        from_attributes = True,
    )

    id: UUID = Field(description = "Upload's unique identifier")
    user_id: UUID = Field(description = "Owner's user ID")
    filename: str = Field(description = "Original filename")
    file_path: str = Field(description = "Storage path")
    file_type: FileType = Field(description = "Type of media")
    file_size: int = Field(gt = 0, description = "File size in bytes")
    mime_type: str = Field(description = "MIME type")
    processing_status: ProcessingStatus = Field(
        description = "Current processing status"
    )
    description: str | None = Field(
        default = None,
        description = "AI generated description from vision model"
    )
    description_audit_score: int | None = Field(
        default = None,
        ge = 0,
        le = 100,
        description = "Description quality score (0-100, higher is better)"
    )
    embedding_local: list[float] | None = Field(
        default = None,
        description =
        f"{EMBEDDING_DIMENSIONS}-dimensional embedding vector from bge-m3",
        min_length = EMBEDDING_DIMENSIONS,
        max_length = EMBEDDING_DIMENSIONS,
    )
    has_embedding: bool = Field(
        default = False,
        description = "Whether this upload has an embedding generated"
    )
    thumbnail_path: str | None = Field(
        default = None,
        description = "Path to generated thumbnail"
    )
    video_codec: str | None = Field(
        default = None,
        description = "Video codec (h264, hevc, vp9, av1, etc) - videos only"
    )
    error_message: str | None = Field(
        default = None,
        description = "Error details if processing failed"
    )
    metadata: dict[str,
                   Any] | None = Field(
                       default = None,
                       description = "Additional file metadata"
                   )
    hidden: bool = Field(
        default = False,
        description = "Whether this upload is hidden from gallery"
    )
    regeneration_count: int = Field(
        default = 0,
        ge = 0,
        description = "Number of times description was regenerated"
    )
    last_regenerated_at: datetime | None = Field(
        default = None,
        description = "Timestamp of last regeneration"
    )

    @field_validator("embedding_local")
    @classmethod
    def validate_embedding_dimensions(cls,
                                      v: list[float] | None
      
```

---

## File Overview

### upload.py

**Purpose and Responsibility:**
This Python file defines models for handling uploads, including response schemas, parameters for listing uploads, and statistics. It ensures data integrity and provides a structured representation of uploaded files.

**Key Exports/Public Interface:**
- `UploadResponse`: A Pydantic model representing the detailed response for an upload.
- `UploadListParams`: Parameters for filtering and sorting lists of uploads.
- `UploadStats`: Statistics about uploads by type and status.

**How it Fits in the Project:**
This file is part of the backend schema layer, responsible for defining data structures used throughout the application. It interacts with models and services that handle file storage, processing, and retrieval. The `UploadResponse` model is particularly important as it provides a standardized format for responses to API requests related to uploads.

**Notable Design Decisions:**
- **Pydantic Models:** Utilizes Pydantic for data validation and serialization, ensuring robust and consistent data handling.
- **Embedding Validation:** Ensures the embedding vector has exactly the required dimensions using a custom validator.
- **File Path Serialization:** Prepend `/files/` to file paths for proper serving by nginx, enhancing usability and consistency.

---

*Generated by CodeWorm on 2026-02-20 13:32*
