# Upload

**Type:** File Overview
**Repository:** vuemantics
**File:** backend/models/Upload.py
**Language:** python
**Lines:** 1-878
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2026
Upload.py
"""

from __future__ import annotations

import json
import logging
from datetime import datetime
from enum import Enum
from typing import Any
from uuid import UUID

import config
import database
from models.Base import BaseModel


logger = logging.getLogger(__name__)


class ProcessingStatus(str, Enum):
    """
    Processing status states for uploads
    """
    PENDING = "pending"  # Just uploaded, not processed
    ANALYZING = "analyzing"  # Qwen2.5-VL analyzing media + description audit
    EMBEDDING = "embedding"  # Creating embeddings with bge-m3
    COMPLETED = "completed"  # Successfully processed
    FAILED = "failed"  # Processing failed


class FileType(str, Enum):
    """
    Supported file types
    """
    IMAGE = "image"
    VIDEO = "video"


class Upload(BaseModel):
    """
    Upload model for media files

    Attributes:
        id: Unique identifier (UUID)
        user_id: Owner's user ID
        filename: Original filename
        file_path: Local storage path
        file_type: 'image' or 'video'
        file_size: Size in bytes
        mime_type: MIME type of file
        processing_status: Current processing state
        description: AI-generated description
        embedding_local: 1024-dimensional vector from bge-m3
        thumbnail_path: Path to generated thumbnail
        error_message: Error details if processing failed
        metadata: Additional file metadata (JSON)
        created_at: Upload timestamp
        updated_at: Last update timestamp
    """
    __tablename__ = "uploads"

    def __init__(self, **kwargs: Any) -> None:
        """
        Initialize upload instance.
        """
        super().__init__(**kwargs)
        self.id: UUID = kwargs["id"]  # Uploads from DB always have IDs
        self.user_id: UUID = kwargs["user_id"]
        self.batch_id: UUID | None = kwargs.get("batch_id")
        self.filename: str = kwargs.get("filename", "")
        self.file_path: str = kwargs.get("file_path", "")
        self.file_type: str = kwargs.get("file_type", "")
        self.file_size: int = kwargs.get("file_size", 0)
        self.mime_type: str = kwargs.get("mime_type", "")
        self.processing_status: str = kwargs.get(
            "processing_status",
            ProcessingStatus.PENDING
        )
        self.description: str | None = kwargs.get("description")
        self.description_audit_score: int | None = kwargs.get(
            "description_audit_score"
        )

        # Handle embedding (1024-dim from bge-m3)
        embedding_local_raw = kwargs.get("embedding_local")
        if isinstance(embedding_local_raw, str):
            try:
                if embedding_local_raw.startswith(
                        "[") and embedding_local_raw.endswith("]"):
                    self.embedding_local: list[float] | None = list(
                        map(float,
                            embedding_local_raw[1 :-1].split(","))
                    )
                else:
  
```

---

## File Overview

### Upload.py

**Purpose and Responsibility:**
This Python file defines the `Upload` model for handling media files, including images and videos, within a larger application. It manages the lifecycle of uploads from initial upload to processing stages like embedding creation and description generation.

**Key Exports and Public Interface:**
- **Class:** `Upload`
  - Represents an uploaded media file with attributes such as `id`, `user_id`, `filename`, `file_path`, `processing_status`, etc.
- **Enum Classes:**
  - `ProcessingStatus`: Enumerates the processing states of uploads.
  - `FileType`: Enumerates supported file types.

**How it Fits in the Project:**
`Upload.py` is a core component that interacts with other models and services, particularly through the database. It ensures data integrity by defining schema constraints and handling metadata storage. The class methods like `create_table` facilitate table creation and management, supporting the overall functionality of media processing.

**Notable Design Decisions:**
- **Enum Usage:** Utilizes Python enums for `ProcessingStatus` and `FileType` to ensure type safety and clarity.
- **Type Hints:** Extensive use of type hints throughout the class definitions and methods to improve code readability and maintainability.
- **Database Integration:** Implements database operations using async methods, ensuring compatibility with asynchronous workflows in the project.

---

*Generated by CodeWorm on 2026-02-20 12:10*
