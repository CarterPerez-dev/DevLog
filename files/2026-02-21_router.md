# router

**Type:** File Overview
**Repository:** angelamos-3d
**File:** backend/app/wake/router.py
**Language:** python
**Lines:** 1-55
**Complexity:** 0.0

---

## Source Code

```python
"""
Â©AngelaMos | 2026
router.py
"""

from fastapi import APIRouter, WebSocket, WebSocketDisconnect

from app.wake import service
from app.wake.schemas import WakeWordModelsResponse


router = APIRouter()


@router.get("/wakeword/models", response_model = WakeWordModelsResponse)
async def list_models() -> WakeWordModelsResponse:
    """
    List available wake word models.
    """
    return WakeWordModelsResponse(models = service.list_models())


@router.websocket("/ws/wake")
async def websocket_detect(websocket: WebSocket) -> None:
    """
    WebSocket endpoint for real-time wake word detection.
    Send audio chunks as binary, receive JSON detection events.
    """
    await websocket.accept()

    model = service.create_session_model()

    try:
        while True:
            msg = await websocket.receive()

            if msg.get("type") == "websocket.disconnect":
                break

            if "text" in msg:
                if msg["text"] == "reset":
                    model.reset()
                continue

            if "bytes" not in msg:
                continue

            detections = service.process_audio(model, msg["bytes"])

            for detection in detections:
                await websocket.send_json(detection.model_dump())

    except WebSocketDisconnect:
        pass

```

---

## File Overview

## router.py

**Purpose:**  
This file defines an APIRouter for handling wake word detection requests using FastAPI. It includes endpoints for listing available models and a WebSocket endpoint for real-time audio processing.

**Key Exports:**
- `list_models`: A GET route that returns a list of available wake word models.
- `websocket_detect`: A WebSocket route for real-time wake word detection, handling audio chunks and sending detection events.

**Project Integration:**
This router is part of the `app.wake` module, which handles wake word functionality. It integrates with other services and schemas defined in the same package to provide a complete solution for managing and detecting wake words.

**Design Decisions:**
- **FastAPI:** Utilizes FastAPI for defining RESTful endpoints and WebSocket routes.
- **WebSocket Handling:** Implements robust WebSocket handling, including disconnection management and message processing.
- **Service Layer:** Relies on the `service` module to create and manage model sessions, process audio data, and list available models. This separation ensures clear responsibilities and maintainability.
```

This documentation provides a high-level overview of the file's purpose, key components, integration within the project, and notable design choices.

---

*Generated by CodeWorm on 2026-02-21 00:48*
