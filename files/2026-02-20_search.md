# search

**Type:** File Overview
**Repository:** vuemantics
**File:** backend/schemas/search.py
**Language:** python
**Lines:** 1-231
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2026
search.py
"""

from datetime import datetime
from typing import Any
from uuid import UUID

from pydantic import (
    BaseModel,
    ConfigDict,
    Field,
    ValidationInfo,
    field_validator,
)

from config import (
    DEFAULT_PAGE_SIZE,
    MAX_PAGE_SIZE,
    MAX_QUERY_LENGTH,
    SEARCH_DEFAULT_SIMILARITY_THRESHOLD,
    SIMILAR_UPLOADS_DEFAULT_LIMIT,
    SIMILAR_UPLOADS_SIMILARITY_THRESHOLD,
)
from models.Upload import FileType
from schemas.upload import UploadResponse


class SearchRequest(BaseModel):
    """
    Semantic search request with advanced filtering options
    """
    model_config = ConfigDict(
        extra = "forbid",
        str_strip_whitespace = True,
    )

    query: str = Field(
        description = "Natural language search query",
        min_length = 1,
        max_length = MAX_QUERY_LENGTH,
    )

    limit: int = Field(
        default = DEFAULT_PAGE_SIZE,
        ge = 1,
        le = MAX_PAGE_SIZE,
        description = "Maximum number of results"
    )

    similarity_threshold: float = Field(
        default = SEARCH_DEFAULT_SIMILARITY_THRESHOLD,
        ge = 0.0,
        le = 1.0,
        description = "Minimum similarity score (0-1)"
    )

    file_types: list[FileType] | None = Field(
        default = None,
        description = "Filter by file types (None = all types)"
    )

    date_from: datetime | None = Field(
        default = None,
        description = "Filter uploads created after this date"
    )

    date_to: datetime | None = Field(
        default = None,
        description = "Filter uploads created before this date"
    )

    user_id: UUID | None = Field(
        default = None,
        description =
        "Search only within specific user's uploads (admin feature)",
    )

    @field_validator("query")
    @classmethod
    def clean_query(cls, v: str) -> str:
        """
        Clean and validate search query.
        """
        cleaned = " ".join(v.split())

        if not cleaned:
            raise ValueError("Query cannot be empty after cleaning")

        return cleaned

    @field_validator("date_to")
    @classmethod
    def validate_date_range(
        cls,
        v: datetime | None,
        info: ValidationInfo
    ) -> datetime | None:
        """
        Ensure date_to is after date_from if both provided
        """
        if v is not None and "date_from" in info.data:
            date_from = info.data["date_from"]
            if date_from is not None and v <= date_from:
                raise ValueError("date_to must be after date_from")
        return v


class SearchResult(BaseModel):
    """
    Individual search result with similarity score
    """
    model_config = ConfigDict(
        extra = "forbid",
        from_attributes = True,
    )

    upload: UploadResponse = Field(description = "Matched upload")
    similarity_score: float = Field(
        ge = 0.0,
        le = 1.0,
        description = "Similarity score (0-1, higher is more simila
```

---

## File Overview

### search.py

**Purpose and Responsibility:**
This Python file defines models for semantic search requests, results, and responses. It includes validation logic to ensure robust query handling and filtering options.

**Key Exports and Public Interface:**
- `SearchRequest`: A model for constructing advanced semantic search queries.
- `SearchResult`: Represents individual search results with similarity scores.
- `SearchResponse`: Contains the final search results along with metadata.
- `SimilarUploadsRequest`: Model for finding uploads similar to a specific upload.

**How it Fits into the Project:**
This file is part of the backend schema layer, providing structured data models and validation rules. It integrates with other modules such as `config` for default values and `models.Upload` for handling file types. The search functionality is crucial for content-based retrieval in the application.

**Notable Design Decisions:**
- **Validation**: Uses Pydantic's field validators to enforce constraints on query parameters.
- **Type Hints and Configurations**: Utilizes type hints and Pydantic configurations (`ConfigDict`) to ensure data integrity and consistency.
- **Dependencies**: Relies on `config` for default values, enhancing modularity and ease of configuration changes.

---

*Generated by CodeWorm on 2026-02-20 13:47*
