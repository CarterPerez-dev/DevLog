# service

**Type:** File Overview
**Repository:** my-portfolio
**File:** v1/backend/app/user/service.py
**Language:** python
**Lines:** 1-220
**Complexity:** 0.0

---

## Source Code

```python
"""
ⒸAngelaMos | 2025
service.py
"""

from uuid import UUID
from sqlalchemy.ext.asyncio import (
    AsyncSession,
)

from config import settings, UserRole
from core.exceptions import (
    EmailAlreadyExists,
    InvalidCredentials,
    UserNotFound,
)
from core.security import (
    hash_password,
    verify_password,
)
from .schemas import (
    AdminUserCreate,
    UserCreate,
    UserListResponse,
    UserResponse,
    UserUpdate,
    UserUpdateAdmin,
)
from .User import User
from .repository import UserRepository


class UserService:
    """
    Business logic for user operations
    """
    def __init__(self, session: AsyncSession) -> None:
        self.session = session

    async def create_user(
        self,
        user_data: UserCreate,
    ) -> UserResponse:
        """
        Register a new user
        """
        if await UserRepository.email_exists(self.session, user_data.email):
            raise EmailAlreadyExists(user_data.email)

        role = UserRole.USER
        if settings.ADMIN_EMAIL and user_data.email.lower(
        ) == settings.ADMIN_EMAIL.lower():
            role = UserRole.ADMIN

        hashed = await hash_password(user_data.password)
        user = await UserRepository.create_user(
            self.session,
            email = user_data.email,
            hashed_password = hashed,
            full_name = user_data.full_name,
            role = role,
        )
        return UserResponse.model_validate(user)

    async def get_user_by_id(
        self,
        user_id: UUID,
    ) -> UserResponse:
        """
        Get user by ID
        """
        user = await UserRepository.get_by_id(self.session, user_id)
        if not user:
            raise UserNotFound(str(user_id))
        return UserResponse.model_validate(user)

    async def get_user_model_by_id(
        self,
        user_id: UUID,
    ) -> User:
        """
        Get user model by ID (for internal use)
        """
        user = await UserRepository.get_by_id(self.session, user_id)
        if not user:
            raise UserNotFound(str(user_id))
        return user

    async def update_user(
        self,
        user: User,
        user_data: UserUpdate,
    ) -> UserResponse:
        """
        Update user profile
        """
        update_dict = user_data.model_dump(exclude_unset = True)
        updated_user = await UserRepository.update(
            self.session,
            user,
            **update_dict
        )
        return UserResponse.model_validate(updated_user)

    async def change_password(
        self,
        user: User,
        current_password: str,
        new_password: str,
    ) -> None:
        """
        Change user password
        """
        is_valid, _ = await verify_password(current_password, user.hashed_password)
        if not is_valid:
            raise InvalidCredentials()

        hashed = await hash_password(new_password)
        await UserRepository.update_password(self.session, user, hashed)

    a
```

---

## File Overview

### service.py

**Purpose and Responsibility:**
This Python file contains business logic for user management within a web application, including registration, authentication, updating, and listing users. It interacts with a database through an `UserRepository` to perform CRUD operations.

**Key Exports or Public Interface:**
- `UserService`: A class responsible for handling user-related operations such as creating, updating, and listing users.
  - Methods include:
    - `create_user`
    - `get_user_by_id`
    - `update_user`
    - `change_password`
    - `deactivate_user`
    - `list_users`
    - `admin_create_user`
    - `admin_update_user`

**How it Fits in the Project:**
This file is a core component of the application, providing essential user management functionalities. It interacts with the database via an `UserRepository` and leverages security utilities for password hashing and verification.

**Notable Design Decisions:**
- **Dependency Injection:** The `UserService` constructor accepts an `AsyncSession` to manage database operations.
- **Type Hints and Validation:** Utilizes Pydantic models (`UserCreate`, `UserUpdate`) for input validation and data transformation.
- **Role-Based Access Control:** Implements different user roles (e.g., ADMIN, USER) to restrict access to certain methods based on the user's role.
- **Error Handling:** Throws custom exceptions like `EmailAlreadyExists` and `InvalidCredentials` to handle specific error conditions gracefully.
```

This documentation provides a high-level overview of the file’s purpose, key functionalities, integration within the project, and significant design choices.

---

*Generated by CodeWorm on 2026-02-20 02:39*
