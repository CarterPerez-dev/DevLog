# notification.service

**Type:** File Overview
**Repository:** ios-test
**File:** red-recon/src/core/notifications/notification.service.ts
**Language:** typescript
**Lines:** 1-204
**Complexity:** 0.0

---

## Source Code

```typescript
/**
 * @AngelaMos | 2026
 * notification.service.ts
 */

import { Platform } from 'react-native'
import type { CycleStatus, PartnerResponse } from '@/api/types'
import {
  NOTIFICATION_CONTENT,
  NOTIFICATION_IDENTIFIERS,
  NotificationType,
  type NotificationConfig,
} from '@/api/types'

let Notifications: typeof import('expo-notifications') | null = null
let isNativeModuleAvailable = false

try {
  const NotificationsModule = require('expo-notifications')
  Notifications = NotificationsModule
  isNativeModuleAvailable = true

  NotificationsModule.setNotificationHandler({
    handleNotification: async () => ({
      shouldShowAlert: true,
      shouldPlaySound: true,
      shouldSetBadge: false,
      shouldShowBanner: true,
      shouldShowList: true,
    }),
  })
} catch {
  console.warn('expo-notifications native module not available (Expo Go). Build a dev client for notifications.')
}

export async function requestNotificationPermissions(): Promise<boolean> {
  if (!isNativeModuleAvailable || !Notifications) {
    return false
  }

  if (Platform.OS === 'android') {
    await Notifications.setNotificationChannelAsync('default', {
      name: 'default',
      importance: Notifications.AndroidImportance.MAX,
      vibrationPattern: [0, 250, 250, 250],
    })
  }

  const { status: existingStatus } = await Notifications.getPermissionsAsync()

  if (existingStatus === 'granted') {
    return true
  }

  const { status } = await Notifications.requestPermissionsAsync()
  return status === 'granted'
}

export async function cancelAllScheduledNotifications(): Promise<void> {
  if (!isNativeModuleAvailable || !Notifications) {
    return
  }

  await Notifications.cancelAllScheduledNotificationsAsync()
}

export async function cancelNotificationByIdentifier(
  identifier: string
): Promise<void> {
  if (!isNativeModuleAvailable || !Notifications) {
    return
  }

  await Notifications.cancelScheduledNotificationAsync(identifier)
}

export async function scheduleNotification(
  config: NotificationConfig
): Promise<string | null> {
  if (!isNativeModuleAvailable || !Notifications) {
    return null
  }

  const now = new Date()

  if (config.triggerDate <= now) {
    return null
  }

  const identifier = await Notifications.scheduleNotificationAsync({
    identifier: config.identifier,
    content: {
      title: config.title,
      body: config.body,
      sound: true,
    },
    trigger: {
      type: Notifications.SchedulableTriggerInputTypes.DATE,
      date: config.triggerDate,
    },
  })

  return identifier
}

function addDays(date: Date, days: number): Date {
  const result = new Date(date)
  result.setDate(result.getDate() + days)
  return result
}

function setTimeToMorning(date: Date): Date {
  const result = new Date(date)
  result.setHours(9, 0, 0, 0)
  return result
}

export function calculateNotificationsFromCycleData(
  cycleStatus: CycleStatus,
  partner: PartnerResponse
): NotificationConfig[] {
  const notifications: Notificati
```

---

## File Overview

### notification.service.ts

**Purpose and Responsibility:**
This file manages notifications within the application, handling permissions, scheduling, and canceling notifications based on user cycle data.

**Key Exports and Public API:**
- `requestNotificationPermissions()`: Requests permission to send notifications.
- `cancelAllScheduledNotifications()`: Cancels all scheduled notifications.
- `cancelNotificationByIdentifier(identifier)`: Cancels a specific notification by identifier.
- `scheduleNotification(config)`: Schedules a new notification based on provided configuration.

**How it Fits in the Project:**
This service is crucial for delivering timely and relevant notifications to users, enhancing user engagement and experience. It interacts with both native modules (`expo-notifications`) and API types defined elsewhere in the project.

**Notable Design Decisions:**
- The file uses conditional imports to handle different environments (native vs. Expo Go).
- It leverages `async` functions for handling asynchronous operations related to notifications.
- Custom utility functions like `addDays()` and `setTimeToMorning()` ensure precise timing of notifications.
- Notifications are calculated based on user cycle data, providing personalized alerts.
```

This documentation provides a high-level overview of the file's purpose, key functionalities, integration within the project, and important design choices.

---

*Generated by CodeWorm on 2026-02-20 15:22*
