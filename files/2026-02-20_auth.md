# auth

**Type:** File Overview
**Repository:** vuemantics
**File:** backend/routers/v1/auth.py
**Language:** python
**Lines:** 1-183
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2026
Authentication routes for user registration, login, and token management.

Implements OAuth2-compatible endpoints with JWT access/refresh tokens.
Follows FastAPI patterns with dependency injection and Pydantic validation.
Includes rate limiting to prevent brute force attacks.
"""

import logging
from typing import Annotated

from fastapi import (
    APIRouter,
    Depends,
    Request,
    status,
)
from fastapi.security import OAuth2PasswordRequestForm

from auth import (
    create_token_pair,
    get_current_user,
    refresh_access_token,
)
from config import settings
from core import (
    AUTH_401,
    CONFLICT_409,
    FORBIDDEN_403,
    RATE_LIMIT_420,
    VALIDATION_422,
    AuthenticationError,
    ConflictError,
    ValidationError,
    hash_password,
    limiter,
    verify_password_safe,
)
from models.User import User
from schemas import (
    RefreshRequest,
    TokenResponse,
    UserCreate,
    UserResponse,
)


logger = logging.getLogger(__name__)

router = APIRouter(
    prefix = "/auth",
    tags = ["authentication"],
    responses = {
        **AUTH_401,
        **FORBIDDEN_403,
        **CONFLICT_409,
        **VALIDATION_422,
        **RATE_LIMIT_420,
    },
)


@router.post(
    "/register",
    response_model = UserResponse,
    status_code = status.HTTP_201_CREATED,
    summary = "Register new user",
    description = "Create a new user account with email and password",
)
@limiter.limit(settings.rate_limit_auth)
async def register(
    request: Request,
    user_data: UserCreate
) -> UserResponse:
    """
    Register a new user.

    Password requirements:
    - 8-69 characters
    - At least one uppercase letter
    - At least one lowercase letter
    - At least one number
    - At least one special character (!@#$%^&*()_+-=[]{}|;:,.<>?)
    """
    existing_user = await User.find_by_email(user_data.email)
    if existing_user:
        raise ConflictError("Email already registered")

    try:
        password_hash = await hash_password(user_data.password)
        user = await User.create(
            email = user_data.email,
            password_hash = password_hash,
            is_active = True
        )

        logger.info(f"New user registered: {user.email}")
        return UserResponse.model_validate(user)

    except ValueError as e:
        raise ValidationError(str(e)) from e
    except Exception as e:
        logger.error(f"Registration failed: {e}")
        raise


@router.post(
    "/token",
    response_model = TokenResponse,
    summary = "Login with email and password",
    description =
    "OAuth2 compatible token endpoint. Returns access and refresh tokens.",
)
@limiter.limit(settings.rate_limit_auth)
async def login(
    request: Request,
    form_data: Annotated[OAuth2PasswordRequestForm,
                         Depends()]
) -> TokenResponse:
    """
    OAuth2 compatible token endpoint.
    Returns both access token (30 min) and refresh token (30 days).
    """
    user = awai
```

---

## File Overview

### Purpose and Responsibility

This Python source file defines authentication routes for user registration, login, token management, and retrieval of current user information. It follows FastAPI patterns with dependency injection and Pydantic validation to ensure robust and secure authentication endpoints.

### Key Exports and Public Interface

- **`register`**: Registers a new user with email and password.
- **`login`**: Authenticates users using OAuth2-compatible token endpoint, returning access and refresh tokens.
- **`refresh_token`**: Refreshes the access token using a valid refresh token.
- **`get_me`**: Retrieves the current authenticated user's information.

### How It Fits into the Project

This file is part of the `/routers/v1/auth.py` module in the `vuemantics` backend project. It handles all authentication-related endpoints, ensuring secure and efficient user management. The routes interact with the database via models and services defined elsewhere in the project, such as `auth`, `models.User`, and `core`.

### Notable Design Decisions

- **OAuth2 Compatibility**: Implements OAuth2-compatible token endpoints for registration, login, and refresh.
- **Rate Limiting**: Uses FastAPI's rate limiter to prevent brute force attacks on authentication endpoints.
- **Dependency Injection**: Utilizes FastAPI's dependency injection to manage user sessions and tokens securely.
- **Pydantic Validation**: Ensures data integrity through Pydantic schemas for request and response models.

---

*Generated by CodeWorm on 2026-02-20 13:32*
