# description

**Type:** File Overview
**Repository:** vuemantics
**File:** backend/core/validators/description.py
**Language:** python
**Lines:** 1-340
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2026
Description validation and audit logic.
Sanity checks AI-generated descriptions for hallucinations and gibberish.
"""

import re
from dataclasses import dataclass
from typing import ClassVar

import config


@dataclass
class AuditResult:
    """
    Result of a description audit.
    """
    score: int
    issues: list[str]
    passed: bool


class DescriptionAuditor:
    """
    Audits AI-generated descriptions for quality and sanity.
    Returns confidence score 0-100 and list of issues found.
    """

    BAD_TOKEN_PATTERNS: ClassVar[list[str]] = [
        "<|",
        "|>",
    ]

    @classmethod
    def audit(cls, description: str) -> AuditResult:
        """
        Audit a description and return score + issues.
        Score is 0-100, higher is better.
        """
        score = 100
        issues: list[str] = []

        if not description or not description.strip():
            return AuditResult(
                score = 0,
                issues = ["Empty description"],
                passed = False
            )

        text = description.strip()

        score, issues = cls._check_complete_garbage(text, score, issues)
        score, issues = cls._check_bad_tokens(text, score, issues)
        score, issues = cls._check_length(text, score, issues)
        score, issues = cls._check_word_diversity(text, score, issues)
        score, issues = cls._check_consecutive_repeats(text, score, issues)
        score, issues = cls._check_gibberish_ratio(text, score, issues)
        score, issues = cls._check_sentence_structure(text, score, issues)
        score, issues = cls._check_common_words(text, score, issues)

        final_score = max(0, score)
        passed = final_score >= config.DESCRIPTION_AUDIT_PASS_THRESHOLD

        return AuditResult(
            score = final_score,
            issues = issues,
            passed = passed
        )

    @classmethod
    def _check_complete_garbage(cls,
                                text: str,
                                score: int,
                                issues: list[str]) -> tuple[int,
                                                            list[str]]:
        """
        Check if description is complete garbage (mostly random special chars).
        This catches catastrophic AI failures that produce gibberish.
        """
        if len(text) == 0:
            return score, issues

        # Check alpha ratio
        alphabetic = sum(1 for c in text if c.isalpha())
        alpha_ratio = alphabetic / len(text)

        if alpha_ratio < 0.3:
            score -= 70
            issues.append(
                f"Complete garbage: only {alpha_ratio:.1%} alphabetic characters"
            )
            return score, issues

        # Check for random character sequences (e.g., "4#2>*)=-C4>8B")
        # Real text doesn't mix letters, numbers, and special chars randomly
        tokens = re.findall(r'[^\s]+', text)
        garbage_tokens = 0

        for token
```

---

## File Overview

### Description

This Python source file, `description.py`, is responsible for validating and auditing AI-generated descriptions to ensure they are free from hallucinations and gibberish. It performs a series of sanity checks on the text, returning a confidence score and a list of issues found.

### Key Exports and Public API

- **Class: `DescriptionAuditor`**
  - **Method:** `audit(description: str) -> AuditResult`
    - Audits an AI-generated description for quality and returns a `AuditResult` object containing the score, issues, and whether it passed the audit.
  
### How It Fits into the Project

This file is part of the validation module in the `core` package. It integrates with other validation logic to ensure that descriptions meet certain criteria before being used or stored. The `DescriptionAuditor` class is called by higher-level modules to perform quality checks, ensuring consistency and reliability across the application.

### Notable Design Decisions

- **Dataclass for Audit Result:** Uses a dataclass to encapsulate audit results, making it easy to pass around and use.
- **Class Variables for Patterns:** Utilizes `ClassVar` for defining patterns like bad tokens, which are used in multiple checks.
- **Comprehensive Checks:** Implements various checks such as sentence structure, length, word diversity, and gibberish detection to ensure thorough validation.
- **Configurable Thresholds:** Uses a configuration threshold (`DESCRIPTION_AUDIT_PASS_THRESHOLD`) to determine if the audit passes, allowing for flexibility based on project requirements.

---

*Generated by CodeWorm on 2026-02-20 13:04*
