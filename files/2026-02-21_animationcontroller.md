# AnimationController

**Type:** File Overview
**Repository:** angelamos-3d
**File:** frontend/src/lib/animation/AnimationController.ts
**Language:** typescript
**Lines:** 1-59
**Complexity:** 0.0

---

## Source Code

```typescript
// ===================
// Â© AngelaMos | 2026
// AnimationController.ts
// ===================

import type { VRM } from "@pixiv/three-vrm";
import { getAngelaConfig } from "../../config";

export type AnimationState =
	| "idle"
	| "listening"
	| "thinking"
	| "speaking"
	| "error";

export class AnimationController {
	private vrm: VRM;
	private state: AnimationState = "idle";
	private blinkTimer = 0;

	constructor(vrm: VRM) {
		this.vrm = vrm;
	}

	setState(newState: AnimationState): void {
		if (this.state === newState) return;
		this.state = newState;
	}

	update(delta: number): void {
		this.updateBlink(delta);
	}

	private updateBlink(delta: number): void {
		const config = getAngelaConfig();
		const { blinkMinInterval, blinkMaxInterval } = config.animation;

		this.blinkTimer += delta;
		if (
			this.blinkTimer >
			blinkMinInterval + Math.random() * (blinkMaxInterval - blinkMinInterval)
		) {
			this.vrm.expressionManager?.setValue("blink", 1);
			setTimeout(() => {
				this.vrm.expressionManager?.setValue("blink", 0);
			}, 100);
			this.blinkTimer = 0;
		}
	}

	setMouthOpen(value: number): void {
		this.vrm.expressionManager?.setValue("aa", value);
	}

	getState(): AnimationState {
		return this.state;
	}
}

```

---

## File Overview

# AnimationController.ts Documentation

## Purpose and Responsibility
This file defines `AnimationController`, a class responsible for managing the animations of VRM (Virtual Reality Model) characters within the AngelaMos 3D application. It handles state transitions, blinking, and mouth movements based on predefined configurations.

## Key Exports and Public Interface
- **`AnimationState`**: An enumeration representing different animation states (`idle`, `listening`, `thinking`, `speaking`, `error`).
- **`AnimationController`**: A class that manages the VRM character's animations. It provides methods to set the state, update animations based on time deltas, and control mouth movements.

## Fit in the Project
The `AnimationController` is part of the frontend module for handling 3D character animations. It interacts with the VRM model through its `expressionManager`, allowing dynamic changes in expressions like blinking and speaking. This class is crucial for creating realistic and responsive animations that enhance user interaction within the application.

## Notable Design Decisions
- **State Management**: The controller uses an enumeration to manage different animation states, ensuring clarity and ease of maintenance.
- **Random Blinking Logic**: The `blinkTimer` uses a random interval between minimum and maximum values for natural blinking behavior, enhancing realism without fixed timing.
- **Dependency Injection**: The VRM model is passed as a constructor parameter, promoting flexibility and testability. The configuration is fetched from the global `getAngelaConfig()` function to centralize settings management.

This design ensures that the animation logic remains modular and easily extensible, contributing to a robust 3D character interaction system.

---

*Generated by CodeWorm on 2026-02-21 00:02*
