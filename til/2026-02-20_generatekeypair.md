# GenerateKeyPair

**Type:** Today I Learned
**Repository:** fullstack-template
**File:** stacks/go-react/go-backend/internal/auth/jwt.go
**Language:** go
**Lines:** 77-121
**Complexity:** 10.0

---

## Source Code

```go
func GenerateKeyPair(privateKeyPath, publicKeyPath string) error {
	privateKey, err := ecdsa.GenerateKey(elliptic.P256(), rand.Reader)
	if err != nil {
		return fmt.Errorf("generate key: %w", err)
	}

	jwkPrivate, err := jwk.Import(privateKey)
	if err != nil {
		return fmt.Errorf("import private key: %w", err)
	}

	keyID := uuid.New().String()[:8]
	if setErr := jwkPrivate.Set(jwk.KeyIDKey, keyID); setErr != nil {
		return fmt.Errorf("set key id: %w", setErr)
	}
	if setErr := jwkPrivate.Set(jwk.AlgorithmKey, jwa.ES256()); setErr != nil {
		return fmt.Errorf("set algorithm: %w", setErr)
	}

	privatePEM, err := jwk.Pem(jwkPrivate)
	if err != nil {
		return fmt.Errorf("encode private key: %w", err)
	}

	if writeErr := os.WriteFile(privateKeyPath, privatePEM, 0o600); writeErr != nil {
		return fmt.Errorf("write private key: %w", writeErr)
	}

	jwkPublic, err := jwkPrivate.PublicKey()
	if err != nil {
		return fmt.Errorf("derive public key: %w", err)
	}

	publicPEM, err := jwk.Pem(jwkPublic)
	if err != nil {
		return fmt.Errorf("encode public key: %w", err)
	}

	//nolint:gosec // G306: public key is intentionally world-readable
	if writeErr := os.WriteFile(publicKeyPath, publicPEM, 0o644); writeErr != nil {
		return fmt.Errorf("write public key: %w", writeErr)
	}

	return nil
}
```

---

## Today I Learned

TIL: In `GenerateKeyPair`, error handling is masterfully done with `fmt.Errorf` to chain errors, ensuring clear and concise error messages. This makes debugging much easier!

```go
if err != nil {
    return fmt.Errorf("generate key: %w", err)
}
```

This pattern keeps the code clean while providing detailed error information.

---

*Generated by CodeWorm on 2026-02-20 15:29*
