# detailed_health_check

**Type:** Today I Learned
**Repository:** vuemantics
**File:** backend/routers/v1/health.py
**Language:** python
**Lines:** 45-91
**Complexity:** 9.0

---

## Source Code

```python
async def detailed_health_check() -> HealthDetailedResponse:
    """
    Detailed health check including database connectivity

    healthy, degraded, or unhealthy
    """
    db_status = HealthStatus.UNHEALTHY
    redis_status = None

    try:
        await db.fetchval("SELECT 1")
        db_status = HealthStatus.HEALTHY
    except Exception as e:
        logger.error(f"Database health check failed: {e}")
        db_status = HealthStatus.UNHEALTHY

    if settings.redis_url:
        try:
            redis_client = redis.from_url(
                settings.redis_url,
                decode_responses = settings.redis_decode_responses
            )
            await redis_client.ping()
            await redis_client.close()
            redis_status = HealthStatus.HEALTHY
        except Exception as e:
            logger.error(f"Redis health check failed: {e}")
            redis_status = HealthStatus.UNHEALTHY

    services = [db_status,
                redis_status] if redis_status is not None else [db_status]
    healthy_count = sum(1 for s in services if s == HealthStatus.HEALTHY)

    if healthy_count == len(services):
        overall = HealthStatus.HEALTHY
    elif healthy_count > 0:
        overall = HealthStatus.DEGRADED
    else:
        overall = HealthStatus.UNHEALTHY

    return HealthDetailedResponse(
        status = overall,
        environment = settings.environment,
        version = config.APP_VERSION,
        database = db_status,
        redis = redis_status,
    )
```

---

## Today I Learned

TIL: I learned how to handle multiple health checks in an async function using Python's `try-except` blocks and conditional logic to determine overall system status. This approach ensures each service is checked independently, providing a detailed yet concise health report.

```python
async def detailed_health_check() -> HealthDetailedResponse:
    # ... (code snippet)
```

This pattern allows for clear error logging and flexible status determination based on the health of individual services like database and Redis.

---

*Generated by CodeWorm on 2026-02-22 10:00*
