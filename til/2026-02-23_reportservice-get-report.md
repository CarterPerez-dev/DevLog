# ReportService.get_report

**Type:** Today I Learned
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/advanced/bug-bounty-platform/backend/app/report/service.py
**Language:** python
**Lines:** 79-136
**Complexity:** 11.0

---

## Source Code

```python
async def get_report(
        self,
        user: User,
        report_id: UUID,
    ) -> ReportDetailResponse:
        """
        Get report by ID with details
        """
        report = await ReportRepository.get_by_id_with_details(
            self.session,
            report_id
        )
        if not report:
            raise ReportNotFound(str(report_id))

        program = await ProgramRepository.get_by_id(
            self.session,
            report.program_id
        )

        is_researcher = report.researcher_id == user.id
        is_program_owner = program and program.company_id == user.id

        if not is_researcher and not is_program_owner:
            raise ReportNotFound(str(report_id))

        comments = report.comments
        if is_researcher and not is_program_owner:
            comments = [c for c in comments if not c.is_internal]

        return ReportDetailResponse(
            id = report.id,
            created_at = report.created_at,
            updated_at = report.updated_at,
            program_id = report.program_id,
            researcher_id = report.researcher_id,
            title = report.title,
            description = report.description,
            steps_to_reproduce = report.steps_to_reproduce,
            impact = report.impact,
            severity_submitted = report.severity_submitted,
            severity_final = report.severity_final,
            status = report.status,
            cvss_score = report.cvss_score,
            cwe_id = report.cwe_id,
            bounty_amount = report.bounty_amount,
            duplicate_of_id = report.duplicate_of_id,
            triaged_at = report.triaged_at,
            resolved_at = report.resolved_at,
            disclosed_at = report.disclosed_at,
            comments = [
                CommentResponse.model_validate(c) for c in comments
            ],
            attachments = [
                AttachmentResponse.model_validate(a)
                for a in report.attachments
            ],
        )
```

---

## Today I Learned

TIL: In the `get_report` method, list comprehensions are used to filter comments based on user permissions. This concise approach ensures that researchers only see non-internal comments unless they also own the program, making permission checks both readable and efficient.

```python
if is_researcher and not is_program_owner:
    comments = [c for c in comments if not c.is_internal]
```

This pattern keeps the code clean while handling complex logic effectively.

---

*Generated by CodeWorm on 2026-02-23 07:08*
