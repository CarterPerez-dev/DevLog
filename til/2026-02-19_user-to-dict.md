# User.to_dict

**Type:** Today I Learned
**Repository:** CertGames-Core
**File:** backend/api/domains/account/models/User.py
**Language:** python
**Lines:** 452-616
**Complexity:** 20.0

---

## Source Code

```python
def to_dict(self) -> dict[str, Any]:
        """
        Convert user to dictionary for API responses
        """
        data: dict[str,
                   Any] = {
                       "_id":
                       str(self.id),
                       "username":
                       self.username,
                       "email":
                       self.email,
                       "coins":
                       self.coins,
                       "xp":
                       self.xp,
                       "level":
                       self.level,
                       "achievements": [
                           ach.get('achievementId')
                           if isinstance(ach,
                                         dict) else ach.achievementId
                           for ach in self.achievements_v2
                       ] if self.achievements_v2 else [],
                       "achievement_counters":
                       _serialize_dict_values(self.achievement_counters)
                       if self.achievement_counters else {},
                       "currentAvatar":
                       str(self.currentAvatar)
                       if self.currentAvatar else None,
                       "nameColor":
                       self.nameColor,
                       "xpBoost":
                       self.xpBoost,
                       "purchasedItems":
                       [str(item_id) for item_id in self.purchasedItems]
                       if self.purchasedItems else [],
                       "lastDailyClaim":
                       self.lastDailyClaim.isoformat()
                       if self.lastDailyClaim else None,
                       "tags":
                       self.tags,
                       "signUpSource":
                       self.signUpSource,
                       "subscriptionActive":
                       self.subscriptionActive,
                       "subscriptionType":
                       self.subscriptionType,
                       "subscriptionPlan":
                       self.subscriptionPlan,
                       "subscriptionStatus":
                       self.subscriptionStatus,
                       "subscriptionPlatform":
                       self.subscriptionPlatform,
                       "subscriptionStartDate":
                       self.subscriptionStartDate.isoformat()
                       if self.subscriptionStartDate else None,
                       "subscriptionEndDate":
                       self.subscriptionEndDate.isoformat()
                       if self.subscriptionEndDate else None,
                       "subscriptionCanceledAt":
                       self.subscriptionCanceledAt.isoformat()
                       if self.subscriptionCanceledAt else None,
                       "practiceQuestionsRemaining":
                       self.practiceQuestionsRemaining,
                       "freeUserCreatedAt":
                       self.freeUse
```

---

## Today I Learned

TIL: In `User.to_dict`, list comprehensions with conditional expressions are used to handle optional and nested objects elegantly. For example:

```python
"achievements": [
    ach.get('achievementId')
    if isinstance(ach, dict) else ach.achievementId
    for ach in self.achievements_v2
] if self.achievements_v2 else [],
```

This pattern checks the type of `ach` and extracts the appropriate ID, making the code both readable and robust.

---

*Generated by CodeWorm on 2026-02-19 14:48*
