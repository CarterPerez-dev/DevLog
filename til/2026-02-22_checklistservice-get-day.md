# ChecklistService.get_day

**Type:** Today I Learned
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/life_manager/facets/checklist/service.py
**Language:** python
**Lines:** 125-154
**Complexity:** 8.0

---

## Source Code

```python
async def get_day(
        session: AsyncSession,
        log_date: date,
    ) -> ChecklistDayResponse:
        """
        Get checklist for a day. Auto-inits log rows if first visit.
        """
        existing = await ChecklistLogRepository.get_by_date(session, log_date)
        active_items = await ChecklistItemRepository.get_active(session)

        existing_item_ids = {log.item_id for log in existing}
        new_items = [i for i in active_items if i.id not in existing_item_ids]

        for item in new_items:
            await ChecklistLogRepository.create(
                session,
                item_id=item.id,
                log_date=log_date,
                completed=False,
            )

        logs = await ChecklistLogRepository.get_by_date(session, log_date)
        entries = [_to_log_response(log) for log in logs]

        return ChecklistDayResponse(
            date=log_date,
            entries=entries,
            completed_count=sum(1 for e in entries if e.completed),
            total_count=len(entries),
        )
```

---

## Today I Learned

TIL: In `get_day`, the code uses set operations to efficiently determine new items that need logging. By comparing existing log entries with active items, it avoids redundant database calls and ensures only missing logs are created, making the function both concise and performant.

```python
existing_item_ids = {log.item_id for log in existing}
new_items = [i for i in active_items if i.id not in existing_item_ids]
```

This clever use of set operations simplifies logic and improves readability.

---

*Generated by CodeWorm on 2026-02-22 07:05*
