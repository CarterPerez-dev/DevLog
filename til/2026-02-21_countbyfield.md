# CountByField

**Type:** Today I Learned
**Repository:** angelamos-operations
**File:** CertGamesDB-Argos/go-backend/internal/handler/collections.go
**Language:** go
**Lines:** 195-242
**Complexity:** 10.0

---

## Source Code

```go
func (h *CollectionsHandler) CountByField(w http.ResponseWriter, r *http.Request) {
	name := chi.URLParam(r, "name")
	dbName := r.URL.Query().Get("database")
	if dbName == "" {
		dbName = h.database
	}

	field := r.URL.Query().Get("field")
	if field == "" {
		core.BadRequest(w, "field query parameter is required")
		return
	}

	value := r.URL.Query().Get("value")
	if value == "" {
		core.BadRequest(w, "value query parameter is required")
		return
	}

	var queryValue any = value

	if v, err := strconv.ParseInt(value, 10, 64); err == nil {
		queryValue = v
	} else if v, err := strconv.ParseFloat(value, 64); err == nil {
		queryValue = v
	} else if value == "true" {
		queryValue = true
	} else if value == "false" {
		queryValue = false
	} else if value == "null" {
		queryValue = nil
	}

	count, err := h.repo.CountByFieldValue(r.Context(), dbName, name, field, queryValue)
	if err != nil {
		core.InternalServerError(w, err)
		return
	}

	response := CountResponse{
		Collection: name,
		Field:      field,
		Value:      queryValue,
		Count:      count,
	}

	core.OK(w, response)
}
```

---

## Today I Learned

TIL: In `CountByField`, the function elegantly handles various data types for query parameters using conditional type conversion. It first tries to parse the input as an integer, then a float, and finally checks for boolean or nil values. This approach ensures flexible and robust parameter handling in Go.

```go
if v, err := strconv.ParseInt(value, 10, 64); err == nil {
	queryValue = v
} else if v, err := strconv.ParseFloat(value, 64); err == nil {
	queryValue = v
} else if value == "true" {
	queryValue = true
} else if value == "false" {
	queryValue = false
} else if value == "null" {
	queryValue = nil
}
```

This pattern makes the function versatile and user-friendly.

---

*Generated by CodeWorm on 2026-02-21 02:23*
