# Prune

**Type:** Today I Learned
**Repository:** angelamos-operations
**File:** Docker-Kentros/internal/docker/system.go
**Language:** go
**Lines:** 150-202
**Complexity:** 9.0

---

## Source Code

```go
func (c *Client) Prune(
	ctx context.Context,
	pruneImages, pruneVolumes, pruneBuildCache bool,
) (uint64, error) {
	c.mu.RLock()
	defer c.mu.RUnlock()

	var totalReclaimed uint64

	containerReport, err := c.cli.ContainersPrune(ctx, filters.Args{})
	if err != nil {
		return 0, fmt.Errorf("pruning containers: %w", err)
	}
	totalReclaimed += containerReport.SpaceReclaimed

	if pruneImages {
		imageReport, err := c.cli.ImagesPrune(
			ctx,
			filters.NewArgs(filters.Arg("dangling", "false")),
		)
		if err != nil {
			return totalReclaimed, fmt.Errorf("pruning images: %w", err)
		}
		totalReclaimed += imageReport.SpaceReclaimed
	}

	if pruneVolumes {
		volumeReport, err := c.cli.VolumesPrune(ctx, filters.Args{})
		if err != nil {
			return totalReclaimed, fmt.Errorf("pruning volumes: %w", err)
		}
		totalReclaimed += volumeReport.SpaceReclaimed
	}

	if pruneBuildCache {
		buildReport, err := c.cli.BuildCachePrune(
			ctx,
			build.CachePruneOptions{All: true},
		)
		if err != nil {
			return totalReclaimed, fmt.Errorf("pruning build cache: %w", err)
		}
		totalReclaimed += buildReport.SpaceReclaimed
	}

	networkReport, err := c.cli.NetworksPrune(ctx, filters.Args{})
	if err != nil {
		return totalReclaimed, fmt.Errorf("pruning networks: %w", err)
	}
	_ = networkReport

	return totalReclaimed, nil
}
```

---

## Today I Learned

TIL: This Go function uses error handling with `fmt.Errorf` to wrap errors, making it clear and concise. It also employs a series of conditional checks to prune different Docker resources based on input flags, ensuring flexibility while maintaining readability.

```go
totalReclaimed, err := c.Prune(ctx, true, false, true)
if err != nil {
    log.Error(err)
}
fmt.Printf("Total reclaimed space: %d\n", totalReclaimed)
```

This pattern of error wrapping and conditional pruning makes the function both robust and versatile.

---

*Generated by CodeWorm on 2026-02-21 00:25*
