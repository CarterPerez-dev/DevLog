# IdentityMutations.update_revenue_goals

**Type:** Today I Learned
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/core/foundation/repositories/identity_mutations.py
**Language:** python
**Lines:** 617-656
**Complexity:** 7.0

---

## Source Code

```python
async def update_revenue_goals(
        session: AsyncSession,
        data: dict
    ) -> RevenueGoal:
        """
        Update revenue goals - partial update supported

        Args:
            data: {paying_users_target, monthly_price, monthly_revenue_target, current_paying_users, note}
        """
        result = await session.execute(select(RevenueGoal).limit(1))
        revenue_goal = result.scalar_one_or_none()

        if not revenue_goal:
            identity = await session.execute(select(CoreIdentity).limit(1))
            revenue_goal = RevenueGoal(
                identity_id = identity.scalar_one().id,
                paying_users_target = 0,
                monthly_price = 0,
                monthly_revenue_target = 0,
                current_paying_users = 0,
            )
            session.add(revenue_goal)

        if "paying_users_target" in data:
            revenue_goal.paying_users_target = data["paying_users_target"]
        if "monthly_price" in data:
            revenue_goal.monthly_price = data["monthly_price"]
        if "monthly_revenue_target" in data:
            revenue_goal.monthly_revenue_target = data[
                "monthly_revenue_target"]
        if "current_paying_users" in data:
            revenue_goal.current_paying_users = data["current_paying_users"
                                                     ]
        if "note" in data:
            revenue_goal.note = data["note"]

        await session.flush()
        await session.refresh(revenue_goal)
        return revenue_goal
```

---

## Today I Learned

TIL: This function demonstrates partial updates using dynamic attribute assignment. By checking if keys exist in `data`, it allows flexible updates without modifying non-existent fields, making the function versatile and efficient.

```python
if "paying_users_target" in data:
    revenue_goal.paying_users_target = data["paying_users_target"]
```

This pattern saves database hits and keeps the code clean.

---

*Generated by CodeWorm on 2026-02-21 00:43*
