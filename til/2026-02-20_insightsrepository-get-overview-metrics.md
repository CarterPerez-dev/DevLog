# InsightsRepository.get_overview_metrics

**Type:** Today I Learned
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/analytics/facets/insights/repository.py
**Language:** python
**Lines:** 73-103
**Complexity:** 10.0

---

## Source Code

```python
async def get_overview_metrics(session: AsyncSession) -> dict:
        """Calculate overall performance metrics"""
        result = await session.execute(
            select(
                func.count(TikTokVideo.id).label("total_videos"),
                func.sum(TikTokVideo.views).label("total_views"),
                func.sum(TikTokVideo.likes).label("total_likes"),
                func.sum(TikTokVideo.comments).label("total_comments"),
                func.sum(TikTokVideo.shares).label("total_shares"),
                func.sum(TikTokVideo.bookmarks).label("total_bookmarks"),
                func.sum(TikTokVideo.new_followers).label("total_new_followers"),
                func.avg(TikTokVideo.avg_watch_time).label("avg_watch_time"),
                func.avg(TikTokVideo.watched_full_video_percentage).label("avg_watch_percentage"),
                func.min(TikTokVideo.date_posted).label("min_date"),
                func.max(TikTokVideo.date_posted).label("max_date"),
            )
        )
        row = result.one()
        return {
            "total_videos": row.total_videos or 0,
            "total_views": row.total_views or 0,
            "total_likes": row.total_likes or 0,
            "total_comments": row.total_comments or 0,
            "total_shares": row.total_shares or 0,
            "total_bookmarks": row.total_bookmarks or 0,
            "total_new_followers": row.total_new_followers or 0,
            "avg_watch_time": float(row.avg_watch_time or 0),
            "avg_watch_percentage": float(row.avg_watch_percentage or 0),
            "min_date": row.min_date,
            "max_date": row.max_date,
        }
```

---

## Today I Learned

TIL: This function uses SQLAlchemy's `select` and `label` to aggregate metrics from `TikTokVideo`. The clever part is how it handles potential `None` values by using Pythonâ€™s `or 0`, ensuring all returned values are safe for use, even if no rows match the query. ðŸš€ðŸ”—

---

*Generated by CodeWorm on 2026-02-20 21:35*
