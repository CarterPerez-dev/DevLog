# VerifyAccessToken

**Type:** Today I Learned
**Repository:** fullstack-template
**File:** stacks/go-react/go-backend/internal/auth/jwt.go
**Language:** go
**Lines:** 160-225
**Complexity:** 10.0

---

## Source Code

```go
func (m *JWTManager) VerifyAccessToken(
	ctx context.Context,
	tokenString string,
) (*middleware.AccessTokenClaims, error) {
	token, err := jwt.Parse(
		[]byte(tokenString),
		jwt.WithKey(jwa.ES256(), m.publicKey),
		jwt.WithValidate(true),
		jwt.WithIssuer(m.config.Issuer),
		jwt.WithAudience(m.config.Audience),
	)
	if err != nil {
		if isTokenExpiredError(err) {
			return nil, fmt.Errorf("verify token: %w", core.ErrTokenExpired)
		}
		return nil, fmt.Errorf("verify token: %w", core.ErrTokenInvalid)
	}

	var tokenType string
	if err := token.Get("type", &tokenType); err != nil ||
		tokenType != "access" {
		return nil, fmt.Errorf(
			"verify token: invalid token type: %w",
			core.ErrTokenInvalid,
		)
	}

	subject, ok := token.Subject()
	if !ok || subject == "" {
		return nil, fmt.Errorf(
			"verify token: missing subject: %w",
			core.ErrTokenInvalid,
		)
	}

	var roleStr string
	if err := token.Get("role", &roleStr); err != nil {
		return nil, fmt.Errorf(
			"verify token: missing role claim: %w",
			core.ErrTokenInvalid,
		)
	}

	var tierStr string
	if err := token.Get("tier", &tierStr); err != nil {
		return nil, fmt.Errorf(
			"verify token: missing tier claim: %w",
			core.ErrTokenInvalid,
		)
	}

	var versionFloat float64
	if err := token.Get("token_version", &versionFloat); err != nil {
		return nil, fmt.Errorf(
			"verify token: missing token_version claim: %w",
			core.ErrTokenInvalid,
		)
	}

	return &middleware.AccessTokenClaims{
		UserID:       subject,
		Role:         roleStr,
		Tier:         tierStr,
		TokenVersion: int(versionFloat),
	}, nil
}
```

---

## Today I Learned

TIL: This Go function `VerifyAccessToken` demonstrates robust error handling and claim validation for JWT tokens. It checks for common issues like token expiration, invalid type, missing claims, and uses specific error messages to provide clear feedback. Cleverly, it leverages the `jwt.Parse` method with multiple options to ensure a secure and comprehensive verification process.

---

*Generated by CodeWorm on 2026-02-20 13:48*
