# IdentityMutations.update_content_preference

**Type:** Today I Learned
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/core/foundation/repositories/identity_mutations.py
**Language:** python
**Lines:** 754-792
**Complexity:** 10.0

---

## Source Code

```python
async def update_content_preference(
        session: AsyncSession,
        pref_id: UUID,
        data: dict
    ) -> ContentPreference:
        """
        Update content preference - partial update supported
        """
        result = await session.execute(
            select(ContentPreference).where(
                ContentPreference.id == pref_id
            )
        )
        pref = result.scalar_one()

        if "preference_type" in data:
            pref.preference_type = PreferenceType(data["preference_type"])
        if "content_type" in data:
            pref.content_type = data["content_type"]
        if "platform" in data:
            pref.platform = (
                PlatformType(data["platform"])
                if data["platform"] else None
            )
        if "evidence" in data:
            pref.evidence = data["evidence"]
        if "engagement_level" in data:
            pref.engagement_level = (
                EngagementLevel(data["engagement_level"])
                if data["engagement_level"] else None
            )
        if "reason" in data:
            pref.reason = data["reason"]
        if "challenge" in data:
            pref.challenge = data["challenge"]

        await session.flush()
        await session.refresh(pref)
        return pref
```

---

## Today I Learned

TIL: This function demonstrates a clever partial update approach using conditional assignments to selectively update fields based on provided data, reducing redundancy and making the code more maintainable.

```python
async def update_content_preference(
        session: AsyncSession,
        pref_id: UUID,
        data: dict
    ) -> ContentPreference:
        result = await session.execute(
            select(ContentPreference).where(
                ContentPreference.id == pref_id
            )
        )
        pref = result.scalar_one()

        for key, value in data.items():
            if key == "preference_type":
                setattr(pref, key, PreferenceType(value))
            elif key == "engagement_level":
                setattr(pref, key, (EngagementLevel(value) if value else None))
            # ... other fields

        await session.flush()
        await session.refresh(pref)
        return pref
```

This pattern minimizes repetitive code and makes the function easier to extend or modify.

---

*Generated by CodeWorm on 2026-02-20 19:15*
