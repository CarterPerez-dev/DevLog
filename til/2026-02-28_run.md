# run

**Type:** Today I Learned
**Repository:** CertGames-Core
**File:** frontend/user-app/scripts/verify-guards.ts
**Language:** typescript
**Lines:** 150-201
**Complexity:** 12.0

---

## Source Code

```typescript
async function run(): Promise<void> {
  const active = tests.filter(t => !t.skip).length;
  const skipped = tests.filter(t => t.skip).length;
  console.log(`\nðŸ”  Guard Verification  ${BASE}`);
  console.log(`    ${active} active  |  ${skipped} skipped\n`);

  const results: Result[] = [];

  for (const t of tests) {
    if (t.skip) {
      results.push({ name: t.name, status: 'skip', detail: t.skip });
      process.stdout.write(`  â­  ${t.name}  (${t.skip})\n`);
      continue;
    }

    try {
      const { status: http, data } = await client.request({
        method: t.method ?? 'GET',
        url: t.url,
        data: t.body,
      });

      if (http >= 400) {
        const detail = `HTTP ${http} â€” ${JSON.stringify(data).slice(0, 140)}`;
        results.push({ name: t.name, status: 'http_err', detail });
        process.stdout.write(`  ðŸ”´  ${t.name}  â†’  ${detail}\n`);
        continue;
      }

      const ok = t.guard(data);
      results.push({ name: t.name, status: ok ? 'pass' : 'fail', detail: ok ? undefined : JSON.stringify(data).slice(0, 240) });
      process.stdout.write(ok ? `  âœ…  ${t.name}\n` : `  âŒ  ${t.name}\n`);
      if (!ok) process.stdout.write(`       ${JSON.stringify(data).slice(0, 240)}\n`);

    } catch (err) {
      const msg = err instanceof Error ? err.message : String(err);
      results.push({ name: t.name, status: 'throw', detail: msg });
      process.stdout.write(`  ðŸ’¥  ${t.name}  â†’  ${msg}\n`);
    }
  }

  const pass  = results.filter(r => r.status === 'pass').length;
  const fail  = results.filter(r => r.status === 'fail').length;
  const err   = results.filter(r => r.status === 'http_err' || r.status === 'throw').length;
  const skip  = results.filter(r => r.status === 'skip').length;

  console.log('\n' + 'â”€'.repeat(56));
  console.log(`  âœ… ${pass} passed  âŒ ${fail} guard-fail  ðŸ”´ ${err} http/throw  â­ ${skip} skipped`);
  console.log('â”€'.repeat(56) + '\n');

  if (fail > 0 || err > 0) process.exit(1);
}
```

---

## Today I Learned

TIL: In this TypeScript code, the `run` function uses async/await to handle HTTP requests elegantly. By wrapping the request call inside a try-catch block, it ensures that any errors are caught and logged appropriately, making the code robust and easy to read.

```typescript
try {
  const { status: http, data } = await client.request({ ... });
} catch (err) {
  const msg = err instanceof Error ? err.message : String(err);
  results.push({ name: t.name, status: 'throw', detail: msg });
}
```

This pattern simplifies error handling and keeps the flow clean.

---

*Generated by CodeWorm on 2026-02-28 00:00*
