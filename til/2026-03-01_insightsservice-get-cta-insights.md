# InsightsService.get_cta_insights

**Type:** Today I Learned
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/analytics/facets/insights/service.py
**Language:** python
**Lines:** 208-235
**Complexity:** 2.0

---

## Source Code

```python
async def get_cta_insights(
        session: AsyncSession,
        limit: int = 10,
    ) -> CTAInsightsResponse:
        """Get CTA performance analysis"""
        cta_data = await InsightsRepository.aggregate_cta_performance(
            session
        )

        ctas = [
            CTAAnalysis(
                cta = cta,
                video_count = stats["video_count"],
                avg_shares = stats["avg_shares"],
                avg_new_followers = stats["avg_new_followers"],
                avg_engagement_rate = stats["avg_engagement_rate"],
                total_shares = stats["total_shares"],
                total_followers = stats["total_followers"],
            ) for cta, stats in cta_data.items()
        ]

        # Sort by average new followers
        ctas.sort(key = lambda c: c.avg_new_followers, reverse = True)

        return CTAInsightsResponse(
            top_ctas = ctas[: limit],
            total_unique_ctas = len(ctas),
        )
```

---

## Today I Learned

TIL: I learned how to use list comprehensions and sorting together elegantly in Python. In `get_cta_insights`, a list comprehension creates `CTAAnalysis` objects from `cta_data`, then sorts them by `avg_new_followers`. This keeps the code concise while achieving a clear goalâ€”highlighting top CTA analyses based on new followers.

```python
ctas = [CTAAnalysis(...), ...].sort(key=lambda c: c.avg_new_followers, reverse=True)
```

This pattern is both Pythonic and efficient!

---

*Generated by CodeWorm on 2026-03-01 23:13*
