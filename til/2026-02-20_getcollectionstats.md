# GetCollectionStats

**Type:** Today I Learned
**Repository:** angelamos-operations
**File:** CertGamesDB-Argos/go-backend/internal/mongodb/collections.go
**Language:** go
**Lines:** 153-206
**Complexity:** 15.0

---

## Source Code

```go
func (r *CollectionsRepository) GetCollectionStats(ctx context.Context, dbName, collName string) (*CollectionStats, error) {
	db := r.client.client.Database(dbName)

	var stats bson.M
	if err := db.RunCommand(ctx, bson.D{{"collStats", collName}}).Decode(&stats); err != nil {
		return nil, fmt.Errorf("get collection stats: %w", err)
	}

	result := &CollectionStats{
		Name: collName,
	}

	if count, ok := stats["count"].(int32); ok {
		result.DocumentCount = int64(count)
	} else if count, ok := stats["count"].(int64); ok {
		result.DocumentCount = count
	}

	if size, ok := stats["size"].(int32); ok {
		result.SizeBytes = int64(size)
	} else if size, ok := stats["size"].(int64); ok {
		result.SizeBytes = size
	}

	if avgSize, ok := stats["avgObjSize"].(int32); ok {
		result.AvgDocSize = int64(avgSize)
	} else if avgSize, ok := stats["avgObjSize"].(int64); ok {
		result.AvgDocSize = avgSize
	} else if avgSize, ok := stats["avgObjSize"].(float64); ok {
		result.AvgDocSize = int64(avgSize)
	}

	if storageSize, ok := stats["storageSize"].(int32); ok {
		result.StorageSize = int64(storageSize)
	} else if storageSize, ok := stats["storageSize"].(int64); ok {
		result.StorageSize = storageSize
	}

	if nindexes, ok := stats["nindexes"].(int32); ok {
		result.IndexCount = int(nindexes)
	}

	if totalIndexSize, ok := stats["totalIndexSize"].(int32); ok {
		result.TotalIndexSize = int64(totalIndexSize)
	} else if totalIndexSize, ok := stats["totalIndexSize"].(int64); ok {
		result.TotalIndexSize = totalIndexSize
	}

	if capped, ok := stats["capped"].(bool); ok {
		result.Capped = capped
	}

	return result, nil
}
```

---

## Today I Learned

TIL: In `GetCollectionStats`, the function handles multiple types for each field using type assertions and checks, making it flexible to work with different MongoDB versions that might return stats as `int32` or `int64`. This ensures robust error handling and accurate data extraction.

```go
result.DocumentCount = int64(count)
```

This pattern prevents runtime errors by safely casting types based on the actual value returned.

---

*Generated by CodeWorm on 2026-02-20 17:20*
