# find_similar_uploads

**Type:** Today I Learned
**Repository:** vuemantics
**File:** backend/routers/v1/search.py
**Language:** python
**Lines:** 132-170
**Complexity:** 3.0

---

## Source Code

```python
async def find_similar_uploads(
    request: Request,
    upload: Annotated[Upload,
                      Depends(verify_upload_ownership)],
    current_user: Annotated[User,
                            Depends(get_current_user)],
    limit: Annotated[int,
                     Query(ge = 1,
                           le = 50)] = 10,
    include_own: Annotated[
        bool,
        Query(description = "Include your own uploads")] = True,
) -> list[SearchResult]:
    """
    Find uploads similar to a specific upload.

    Uses the embedding of the specified upload to find
    other semantically similar uploads.
    """
    if not upload.embedding_local:
        raise ValidationError("Upload has not been processed yet")

    try:
        # Find similar uploads
        results = await search_service.find_similar_uploads(
            upload = upload,
            user_id = current_user.id,
            limit = limit,
        )

        logger.info(
            f"Found {len(results)} similar uploads for {upload.id}"
        )

        return results

    except Exception as e:
        logger.error(f"Similar search failed: {e}")
        raise
```

---

## Today I Learned

TIL: I learned how to use `Annotated` for type hints and additional metadata in FastAPI. In the `find_similar_uploads` function, `Depends` is used with `Annotated` to pass both dependencies (`verify_upload_ownership`, `get_current_user`) and metadata like query parameters directly into route handlers. This keeps the code clean and easy to understand by clearly defining each parameter's purpose.

```python
async def find_similar_uploads(
    request: Request,
    upload: Annotated[Upload, Depends(verify_upload_ownership)],
    current_user: Annotated[User, Depends(get_current_user)],
    limit: Annotated[int, Query(ge=1, le=50)] = 10,
    include_own: Annotated[bool, Query(description="Include your own uploads")] = True,
) -> list[SearchResult]:
```

This pattern enhances readability and maintainability by bundling related information together.

---

*Generated by CodeWorm on 2026-02-22 10:00*
