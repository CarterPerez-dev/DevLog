# GetTimeToConversion

**Type:** Today I Learned
**Repository:** angelamos-operations
**File:** CertGamesDB-Argos/go-backend/internal/metrics/conversion.go
**Language:** go
**Lines:** 187-251
**Complexity:** 10.0

---

## Source Code

```go
func (s *Service) GetTimeToConversion(ctx context.Context) (*TimeToConversion, error) {
	startDate := time.Date(2026, 1, 8, 0, 0, 0, 0, time.UTC)

	users, err := s.repo.GetUsersWithSubscriptionDate(ctx, s.database, startDate)
	if err != nil {
		return nil, fmt.Errorf("get users with subscription date: %w", err)
	}

	if len(users) == 0 {
		return &TimeToConversion{
			AvgHours:   0,
			MedianHours: 0,
			MinHours:   0,
			MaxHours:   0,
			TotalUsers: 0,
		}, nil
	}

	var hours []float64
	var totalHours float64

	for _, user := range users {
		if user.SubscriptionStartDate != nil {
			diff := user.SubscriptionStartDate.Sub(user.CreatedAt)
			h := diff.Hours()
			if h >= 0 {
				hours = append(hours, h)
				totalHours += h
			}
		}
	}

	if len(hours) == 0 {
		return &TimeToConversion{
			AvgHours:   0,
			MedianHours: 0,
			MinHours:   0,
			MaxHours:   0,
			TotalUsers: 0,
		}, nil
	}

	avgHours := totalHours / float64(len(hours))

	minHours := hours[0]
	maxHours := hours[0]
	for _, h := range hours {
		if h < minHours {
			minHours = h
		}
		if h > maxHours {
			maxHours = h
		}
	}

	medianHours := calculateMedian(hours)

	return &TimeToConversion{
		AvgHours:    avgHours,
		MedianHours: medianHours,
		MinHours:    minHours,
		MaxHours:    maxHours,
		TotalUsers:  len(hours),
	}, nil
}
```

---

## Today I Learned

TIL: In `GetTimeToConversion`, the function handles edge cases elegantly by returning default values when no users are found, ensuring the function always returns a valid result. This makes the code more robust and easier to reason about.

```go
if len(users) == 0 {
	return &TimeToConversion{
		AvgHours:   0,
		MedianHours: 0,
		MinHours:   0,
		MaxHours:   0,
		TotalUsers: 0,
	}, nil
}
```

This pattern prevents potential errors and maintains a clean interface.

---

*Generated by CodeWorm on 2026-02-21 01:50*
