# checkSecurityOptions

**Type:** Today I Learned
**Repository:** docksec
**File:** internal/analyzer/container.go
**Language:** go
**Lines:** 233-304
**Complexity:** 13.0

---

## Source Code

```go
func (a *ContainerAnalyzer) checkSecurityOptions(
	target finding.Target,
	info types.ContainerJSON,
) finding.Collection {
	var findings finding.Collection

	hasAppArmor := false
	hasSeccomp := false
	hasNoNewPrivileges := false
	seccompDisabled := false

	for _, opt := range info.HostConfig.SecurityOpt {
		if strings.HasPrefix(opt, "apparmor=") {
			hasAppArmor = true
		}
		if strings.HasPrefix(opt, "seccomp=") {
			hasSeccomp = true
			if opt == "seccomp=unconfined" {
				seccompDisabled = true
			}
		}
		if opt == "no-new-privileges" || opt == "no-new-privileges:true" {
			hasNoNewPrivileges = true
		}
	}

	if !hasAppArmor && !info.HostConfig.Privileged {
		control, _ := benchmark.Get("5.1")
		f := finding.New("CIS-5.1", control.Title, finding.SeverityHigh, target).
			WithDescription(control.Description).
			WithCategory(string(CategoryContainerRuntime)).
			WithRemediation(control.Remediation).
			WithReferences(control.References...).
			WithCISControl(control.ToCISControl())
		findings = append(findings, f)
	}

	if seccompDisabled {
		control, _ := benchmark.Get("5.21")
		f := finding.New("CIS-5.21", control.Title, finding.SeverityHigh, target).
			WithDescription(control.Description).
			WithCategory(string(CategoryContainerRuntime)).
			WithRemediation(control.Remediation).
			WithReferences(control.References...).
			WithCISControl(control.ToCISControl())
		findings = append(findings, f)
	}

	if !hasSeccomp && !info.HostConfig.Privileged {
		control, _ := benchmark.Get("5.21")
		f := finding.New("CIS-5.21", "No seccomp profile set", finding.SeverityMedium, target).
			WithDescription("Container is running without an explicit seccomp profile. While Docker applies a default profile, it's recommended to explicitly set one.").
			WithCategory(string(CategoryContainerRuntime)).
			WithRemediation(control.Remediation).
			WithReferences(control.References...).
			WithCISControl(control.ToCISControl())
		findings = append(findings, f)
	}

	if !hasNoNewPrivileges {
		control, _ := benchmark.Get("5.25")
		f := finding.New("CIS-5.25", control.Title, finding.SeverityHigh, target).
			WithDescription(control.Description).
			WithCategory(string(CategoryContainerRuntime)).
			WithRemediation(control.Remediation).
			WithReferences(control.References...).
			WithCISControl(control.ToCISControl())
		findings = append(findings, f)
	}

	return findings
}
```

---

## Today I Learned

TIL: This Go function cleverly uses flags and conditional checks to identify security best practices in container configurations. By iterating over `info.HostConfig.SecurityOpt`, it efficiently determines if AppArmor, Seccomp, and NoNewPrivileges are enabled, then generates findings based on these conditions. Clever use of string prefixes and boolean flags makes the code concise and easy to understand! üêüüîç

---

*Generated by CodeWorm on 2026-02-22 10:54*
