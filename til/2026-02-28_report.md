# Report

**Type:** Today I Learned
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/secrets-scanner/internal/reporter/sarif.go
**Language:** go
**Lines:** 89-169
**Complexity:** 8.0

---

## Source Code

```go
func (s *SARIF) Report(
	w io.Writer, result *types.ScanResult,
) error {
	ruleMap := make(map[string]bool)
	var sarifRules []sarifRule

	for _, f := range result.Findings {
		if ruleMap[f.RuleID] {
			continue
		}
		ruleMap[f.RuleID] = true
		sarifRules = append(sarifRules, sarifRule{
			ID:               f.RuleID,
			ShortDescription: sarifMessage{Text: f.Description},
			DefaultConfig: sarifRuleConfig{
				Level: severityToSARIF(f.Severity),
			},
		})
	}

	var results []sarifResult
	for _, f := range result.Findings {
		r := sarifResult{
			RuleID:  f.RuleID,
			Level:   severityToSARIF(f.Severity),
			Message: sarifMessage{Text: f.Description},
			Locations: []sarifLocation{
				{
					PhysicalLocation: sarifPhysicalLocation{
						ArtifactLocation: sarifArtifactLocation{
							URI: f.FilePath,
						},
						Region: sarifRegion{
							StartLine: f.LineNumber,
						},
					},
				},
			},
		}

		props := make(map[string]any)
		if f.CommitSHA != "" {
			props["commit"] = f.CommitSHA
		}
		if f.Entropy > 0 {
			props["entropy"] = f.Entropy
		}
		if f.HIBPStatus == types.HIBPBreached {
			props["hibp_breached"] = true
			props["breach_count"] = f.BreachCount
		}
		if len(props) > 0 {
			r.Properties = props
		}

		results = append(results, r)
	}

	log := sarifLog{
		Version: "2.1.0",
		Schema: "https://raw.githubusercontent.com/" +
			"oasis-tcs/sarif-spec/main/sarif-2.1/" +
			"schema/sarif-schema-2.1.0.json",
		Runs: []sarifRun{
			{
				Tool: sarifTool{
					Driver: sarifDriver{
						Name:    "portia",
						Version: "1.0.0",
						Rules:   sarifRules,
					},
				},
				Results: results,
			},
		},
	}

	enc := json.NewEncoder(w)
	enc.SetIndent("", "  ")
	return enc.Encode(log)
}
```

---

## Today I Learned

TIL: In Go, this function cleverly uses a map to deduplicate rule IDs while populating SARIF rules and results. This ensures each rule is only added once, making the output concise and efficient.

```go
ruleMap := make(map[string]bool)
for _, f := range result.Findings {
	if ruleMap[f.RuleID] {
		continue
	}
	ruleMap[f.RuleID] = true
	sarifRules = append(sarifRules, sarifRule{...})
}
```

This pattern keeps the code clean and avoids redundant entries in the SARIF log.

---

*Generated by CodeWorm on 2026-02-28 16:28*
