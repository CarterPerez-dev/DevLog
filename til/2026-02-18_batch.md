# batch

**Type:** Today I Learned
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/beginner/dns-lookup/dnslookup/cli.py
**Language:** python
**Lines:** 279-381
**Complexity:** 8.0

---

## Source Code

```python
def batch(
    file: Annotated[
        Path,
        typer.
        Argument(help = "File containing domains (one per line)"),
    ],
    record_type: Annotated[
        str,
        typer.Option(
            "--type",
            "-t",
            help = "Record types to query",
        ),
    ] = "A,MX,NS",
    server: Annotated[
        str | None,
        typer.Option(
            "--server",
            "-s",
            help = "DNS server to use",
        ),
    ] = None,
    timeout: Annotated[
        float,
        typer.Option(
            "--timeout",
            help = "Query timeout in seconds",
        ),
    ] = 5.0,
    output: Annotated[
        Path | None,
        typer.Option(
            "--output",
            "-o",
            help = "Output file for JSON results",
        ),
    ] = None,
    json_output: Annotated[
        bool,
        typer.Option(
            "--json",
            "-j",
            help = "Output results as JSON to stdout",
        ),
    ] = False,
) -> None:
    """
    [bold cyan]Batch DNS lookup[/bold cyan] for multiple domains from a file.

    The file should contain one domain per line. Empty lines and lines
    starting with # are ignored.

    Examples:
        dnslookup batch domains.txt
        dnslookup batch domains.txt --type A,MX --output results.json
    """
    if not file.exists():
        console.print(f"[red]Error:[/red] File not found: {file}")
        raise typer.Exit(1)

    domains = []
    with open(file) as f:
        for line in f:
            line = line.strip()
            if line and not line.startswith("#"):
                domains.append(line)

    if not domains:
        console.print(
            "[yellow]Warning:[/yellow] No domains found in file"
        )
        raise typer.Exit(0)

    record_types = parse_record_types(record_type)

    with Progress(
            SpinnerColumn(),
            TextColumn("[progress.description]{task.description}"),
            console = console,
            transient = True,
    ) as progress:
        progress.add_task(
            f"Querying {len(domains)} domains...",
            total = None
        )
        results = asyncio.run(
            batch_lookup(domains,
                         record_types,
                         server,
                         timeout)
        )

    if json_output:
        console.print(results_to_json(results))
    elif output:
        with open(output, "w") as f:
            f.write(results_to_json(results))
        console.print(
            f"[green]:heavy_check_mark:[/green] Results saved to {output}"
        )
    else:
        print_batch_progress_header(len(domains))
        print_batch_results(results)
```

---

## Today I Learned

TIL: I learned how to use `typer` for command-line interfaces in Python, making it easy to define arguments and options with annotations. The `batch` function demonstrates clean parameter handling and asynchronous execution with `Progress` from `rich`, providing a user-friendly experience.

```python
def batch(...):
    ...
```

This pattern simplifies CLI development and enhances usability with clear help messages and progress tracking.

---

*Generated by CodeWorm on 2026-02-18 15:31*
