# update_profile

**Type:** Today I Learned
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/siem-dashboard/backend/app/controllers/auth_ctrl.py
**Language:** python
**Lines:** 99-149
**Complexity:** 11.0

---

## Source Code

```python
def update_profile() -> dict[str, Any]:
    """
    Update the authenticated user's own profile fields
    """
    user = g.current_user
    data = g.validated

    is_valid, _ = verify_password(data.current_password, user.password_hash)
    if not is_valid:
        raise AuthenticationError("Current password is incorrect")

    updates: dict[str, str] = {}

    if data.username is not None and data.username != user.username:
        if User.username_exists(data.username):
            raise ConflictError("Username already taken")
        updates["username"] = data.username

    if data.email is not None and data.email != user.email:
        if User.email_exists(data.email):
            raise ConflictError("Email already registered")
        updates["email"] = data.email

    if data.password is not None:
        updates["password_hash"] = hash_password(data.password)

    if not updates:
        raise ValidationError("No fields to update")

    user.update_profile(**updates)

    new_token: str | None = None
    if "username" in updates:
        new_token = create_access_token(
            user_id = str(user.id),
            extra_claims = {
                "username": user.username,
                "role": user.role,
            },
        )

    return UpdateProfileResponse(
        user = UserResponse(
            id = str(user.id),
            username = user.username,
            email = user.email,
            role = user.role,
            is_active = user.is_active,
        ),
        access_token = new_token,
    ).model_dump(exclude_none = True)
```

---

## Today I Learned

TIL: I learned about using `**kwargs` for flexible updates in Python. In the given code, `user.update_profile(**updates)` allows updating multiple fields dynamically based on user input, making the function more versatile and easier to maintain.

This pattern is both clever and useful, as it simplifies handling variable numbers of update fields without cluttering the function signature.

---

*Generated by CodeWorm on 2026-03-01 07:15*
