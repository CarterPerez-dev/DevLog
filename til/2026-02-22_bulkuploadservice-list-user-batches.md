# BulkUploadService.list_user_batches

**Type:** Today I Learned
**Repository:** vuemantics
**File:** backend/services/bulk_upload_service.py
**Language:** python
**Lines:** 280-327
**Complexity:** 7.0

---

## Source Code

```python
async def list_user_batches(
        user_id: UUID,
        limit: int = config.BATCH_LIST_DEFAULT_LIMIT,
        offset: int = config.BATCH_LIST_DEFAULT_OFFSET,
    ) -> list[BatchStatusResult]:
        """
        List batches for a user

        Args:
            user_id: User UUID
            limit: Max results
            offset: Skip N results

        Returns:
            List of BatchStatusResult
        """
        # Validate pagination parameters
        if limit < 1 or limit > config.BATCH_LIST_MAX_LIMIT:
            raise ValidationError(
                f"Limit must be between 1 and {config.BATCH_LIST_MAX_LIMIT}"
            )

        if offset < 0:
            raise ValidationError("Offset must be non-negative")

        batches = await UploadBatch.find_by_user(
            user_id = user_id,
            limit = min(limit,
                        config.BATCH_LIST_MAX_LIMIT),
            offset = offset,
        )

        return [
            BatchStatusResult(
                batch_id = batch.id,
                status = batch.status,
                total_uploads = batch.total_uploads,
                processed_uploads = batch.processed_uploads,
                successful_uploads = batch.successful_uploads,
                failed_uploads = batch.failed_uploads,
                progress_percentage = batch.get_progress_percentage(),
                created_at = batch.created_at.isoformat() if batch.created_at else None,
                started_at = None,  # Not needed for list view
                completed_at = batch.completed_at.isoformat() if batch.completed_at else None,
                error_message = None,  # Not needed for list view
            )
            for batch in batches
        ]
```

---

## Today I Learned

TIL: In the `list_user_batches` function, the use of type hints and list comprehension makes the code both clear and concise. The function validates pagination parameters and transforms batches into a formatted list of `BatchStatusResult`, ensuring type safety and readability.

```python
# TIL: Type hints & list comp for clarity & safety
batches = [
    BatchStatusResult(
        batch_id=batch.id,
        # ... other fields ...
    )
    for batch in await UploadBatch.find_by_user(...)
]
```

This pattern ensures the returned data is structured as expected, making it easy to understand and use elsewhere.

---

*Generated by CodeWorm on 2026-02-22 09:56*
