# run_once

**Type:** Today I Learned
**Repository:** CodeWorm
**File:** codeworm/cli.py
**Language:** python
**Lines:** 125-173
**Complexity:** 8.0

---

## Source Code

```python
def run_once(
    ctx: click.Context,
    devlog: Path | None,
    repo: tuple,
    dry_run: bool
) -> None:
    """
    Run a single documentation cycle then exit
    """
    from codeworm.daemon import CodeWormDaemon

    overrides = {"debug": ctx.obj["debug"]}

    if devlog:
        overrides["devlog"] = {"repo_path": devlog}

    if repo:
        repos = [
            {
                "name": name,
                "path": Path(path),
                "weight": 5
            } for name, path in repo
        ]
        overrides["repos"] = repos

    settings = load_settings(config_dir = ctx.obj["config_dir"], **overrides)
    redis_url = settings.dashboard.redis.connection_url if settings.dashboard.redis.enabled else ""
    configure_logging(debug = settings.debug, redis_url = redis_url)

    if not settings.repos:
        console.print("[red]Error:[/red] No repositories configured")
        console.print("Add repos to config/repos.yaml or use --repo NAME PATH")
        raise SystemExit(1)

    mode = "[yellow][DRY RUN][/yellow] " if dry_run else ""
    console.print(f"{mode}[bold]Running single documentation cycle...[/bold]")
    console.print(f"  DevLog: {settings.devlog.repo_path}")
    console.print(f"  Repos: {[r.name for r in settings.repos]}")

    daemon = CodeWormDaemon(settings)
    result = asyncio.run(daemon.run_once(dry_run = dry_run))

    if result:
        console.print("[green]Documentation generated successfully[/green]")
    else:
        console.print(
            "[yellow]No candidates found or all already documented[/yellow]"
        )
```

---

## Today I Learned

TIL: In `run_once`, the function uses tuple unpacking and list comprehension to initialize repository settings elegantly. This concise approach makes the code more readable by clearly separating the configuration logic from the main flow, ensuring that repositories are properly formatted before being passed to `load_settings`.

```python
repos = [
    {"name": name, "path": Path(path), "weight": 5}
    for name, path in repo
]
```

This pattern simplifies handling multiple repository configurations.

---

*Generated by CodeWorm on 2026-02-22 11:30*
