# IdentityMutations.update_core_identity

**Type:** Today I Learned
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/core/foundation/repositories/identity_mutations.py
**Language:** python
**Lines:** 43-86
**Complexity:** 8.0

---

## Source Code

```python
async def update_core_identity(
        session: AsyncSession,
        data: dict
    ) -> CoreIdentity:
        """
        Update core identity (singleton) - partial update supported

        Args:
            data: Dict with fields to update (only updates fields present)
                  Fields: name, age, background, current_role, primary_goal, target_audience
        """
        result = await session.execute(select(CoreIdentity).limit(1))
        identity = result.scalar_one_or_none()

        if not identity:
            identity = CoreIdentity(
                name=data.get("name", ""),
                age=data.get("age", 0),
                background=data.get("background", ""),
                current_role=data.get("current_role", ""),
                primary_goal=data.get("primary_goal", ""),
                target_audience=data.get("target_audience", ""),
            )
            session.add(identity)
            await session.flush()
            await session.refresh(identity)
            return identity

        if "name" in data:
            identity.name = data["name"]
        if "age" in data:
            identity.age = data["age"]
        if "background" in data:
            identity.background = data["background"]
        if "current_role" in data:
            identity.current_role = data["current_role"]
        if "primary_goal" in data:
            identity.primary_goal = data["primary_goal"]
        if "target_audience" in data:
            identity.target_audience = data["target_audience"]

        await session.flush()
        await session.refresh(identity)
        return identity
```

---

## Today I Learned

TIL: In `update_core_identity`, the function handles partial updates elegantly by selectively updating fields present in the input data dictionary, ensuring efficient and flexible database operations.

This approach minimizes unnecessary field assignments and leverages Python's dynamic nature to conditionally update attributes based on the provided data, making the code both concise and maintainable.

---

*Generated by CodeWorm on 2026-02-20 22:57*
