# sse_generator

**Type:** Today I Learned
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/siem-dashboard/backend/app/core/streaming.py
**Language:** python
**Lines:** 120-149
**Complexity:** 7.0

---

## Source Code

```python
def sse_generator(
    stream_key: str,
    event_type: str = "message",
) -> Generator[str]:
    """
    Yield SSE-formatted events by tailing a Redis Stream with XREAD
    """
    r = get_redis()
    last_id = "$"
    while True:
        try:
            results = r.xread(
                {stream_key: last_id},
                count = settings.SSE_READ_COUNT,
                block = settings.SSE_BLOCK_MS,
            )
            if results:
                for _stream, entries in results:
                    for msg_id, fields in entries:
                        last_id = msg_id
                        payload = fields.get("payload", "{}")
                        yield (f"event: {event_type}\n"
                               f"data: {payload}\n\n")
            else:
                yield ": keepalive\n\n"
        except GeneratorExit:
            return
        except Exception:
            time.sleep(1)
            yield ": reconnecting\n\n"
```

---

## Today I Learned

TIL: The `sse_generator` function uses a generator to efficiently stream Server-Sent Events (SSE). By yielding formatted strings, it can send real-time updates from a Redis Stream without blocking. The `try-except` block handles graceful shutdowns and reconnections, ensuring robustness in event streaming.

```python
def sse_generator(stream_key: str, event_type: str = "message") -> Generator[str]:
    ...
```

This pattern minimizes memory usage and maintains a smooth user experience.

---

*Generated by CodeWorm on 2026-02-28 19:30*
