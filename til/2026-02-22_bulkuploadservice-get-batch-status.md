# BulkUploadService.get_batch_status

**Type:** Today I Learned
**Repository:** vuemantics
**File:** backend/services/bulk_upload_service.py
**Language:** python
**Lines:** 240-277
**Complexity:** 6.0

---

## Source Code

```python
async def get_batch_status(
        batch_id: UUID,
        user_id: UUID,
    ) -> BatchStatusResult:
        """
        Get batch status for a user

        Args:
            batch_id: Batch UUID
            user_id: User UUID

        Returns:
            BatchStatusResult
        """
        batch = await UploadBatch.find_by_id(batch_id)

        if not batch:
            raise NotFoundError("Batch not found")

        if batch.user_id != user_id:
            raise NotFoundError("Batch not found")

        return BatchStatusResult(
            batch_id = batch.id,
            status = batch.status,
            total_uploads = batch.total_uploads,
            processed_uploads = batch.processed_uploads,
            successful_uploads = batch.successful_uploads,
            failed_uploads = batch.failed_uploads,
            progress_percentage = batch.get_progress_percentage(),
            created_at = batch.created_at.isoformat()
            if batch.created_at else None,
            started_at = batch.started_at.isoformat()
            if batch.started_at else None,
            completed_at = batch.completed_at.isoformat()
            if batch.completed_at else None,
            error_message = batch.error_message,
        )
```

---

## Today I Learned

TIL: This function cleverly combines multiple checks and returns detailed status information using a single `NotFoundError` for simplicity and readability. It also uses optional chaining to format datetime fields conditionally, making the response clean and efficient.

```python
async def get_batch_status(...):
    # ...
    if not batch or batch.user_id != user_id:
        raise NotFoundError("Batch not found")
    return BatchStatusResult(...)  # Optional chaining for datetime formatting
```

This approach reduces redundancy and ensures consistent error handling.

---

*Generated by CodeWorm on 2026-02-22 10:23*
