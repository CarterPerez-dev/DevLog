# InsightsService.export_all_data

**Type:** Today I Learned
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/analytics/facets/insights/service.py
**Language:** python
**Lines:** 418-462
**Complexity:** 4.0

---

## Source Code

```python
async def export_all_data(
        session: AsyncSession,
    ) -> ExportDataResponse:
        """Export all video data as JSON"""
        videos = await InsightsRepository.get_all_videos(session)

        video_dicts = [
            {
                "id": str(v.id),
                "rank": v.rank,
                "date_posted": v.date_posted.isoformat(),
                "video_url": v.video_url,
                "views": v.views,
                "comments": v.comments,
                "likes": v.likes,
                "bookmarks": v.bookmarks,
                "shares": v.shares,
                "avg_watch_time": v.avg_watch_time,
                "new_followers": v.new_followers,
                "watched_full_video_percentage": v.watched_full_video_percentage,
                "top_comment_words": v.top_comment_words,
                "search_queries": v.search_queries,
                "traffic_sources": v.traffic_sources,
                "hook": v.hook,
                "text_on_screen_hook": v.text_on_screen_hook,
                "length": v.length,
                "description": v.description,
                "hashtags": v.hashtags,
                "cta": v.cta,
                "full_transcription": v.full_transcription,
                "notes": v.notes,
                "created_at": v.created_at.isoformat() if v.created_at else None,
                "updated_at": v.updated_at.isoformat() if v.updated_at else None,
                # Calculated fields
                "engagement_rate": InsightsRepository.calculate_engagement_rate(v),
                "follower_conversion_rate": InsightsRepository.calculate_follower_conversion_rate(v),
            }
            for v in videos
        ]

        return ExportDataResponse(
            videos = video_dicts,
            total_count = len(video_dicts),
            export_date = datetime.utcnow().isoformat(),
        )
```

---

## Today I Learned

TIL: In the `export_all_data` function, list comprehension is used to efficiently transform each video object into a dictionary with calculated fields. This approach keeps the code clean and concise while ensuring that all necessary data, including computed values like engagement rate and follower conversion rate, are included in the final JSON export.

```python
video_dicts = [
    {
        # ... (fields)
        "engagement_rate": InsightsRepository.calculate_engagement_rate(v),
        "follower_conversion_rate": InsightsRepository.calculate_follower_conversion_rate(v),
    }
    for v in videos
]
```

This pattern makes the code both readable and maintainable.

---

*Generated by CodeWorm on 2026-03-01 10:26*
