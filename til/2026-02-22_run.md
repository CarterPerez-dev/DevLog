# run

**Type:** Today I Learned
**Repository:** CodeWorm
**File:** codeworm/cli.py
**Language:** python
**Lines:** 59-103
**Complexity:** 8.0

---

## Source Code

```python
def run(
    ctx: click.Context,
    devlog: Path | None,
    repo: tuple,
    dry_run: bool
) -> None:
    """
    Run the CodeWorm daemon with scheduler
    """
    from codeworm.daemon import CodeWormDaemon

    overrides = {"debug": ctx.obj["debug"]}

    if devlog:
        overrides["devlog"] = {"repo_path": devlog}

    if repo:
        repos = [
            {
                "name": name,
                "path": Path(path),
                "weight": 5
            } for name, path in repo
        ]
        overrides["repos"] = repos

    settings = load_settings(config_dir = ctx.obj["config_dir"], **overrides)
    redis_url = settings.dashboard.redis.connection_url if settings.dashboard.redis.enabled else ""
    configure_logging(debug = settings.debug, redis_url = redis_url)

    if not settings.repos:
        console.print("[red]Error:[/red] No repositories configured")
        console.print("Add repos to config/repos.yaml or use --repo NAME PATH")
        raise SystemExit(1)

    mode = "[yellow][DRY RUN][/yellow] " if dry_run else ""
    console.print(f"{mode}[bold green]Starting CodeWorm[/bold green]")
    console.print(f"  DevLog: {settings.devlog.repo_path}")
    console.print(f"  Repos: {len(settings.repos)}")
    console.print(f"  Ollama: {settings.ollama.base_url}")
    if redis_url:
        console.print(f"  Redis: {redis_url}")

    daemon = CodeWormDaemon(settings, dry_run = dry_run)
    daemon.run()
```

---

## Today I Learned

TIL: In the `run` function, the code uses list comprehension to dynamically configure repository settings based on input. This concise approach simplifies handling multiple repositories and ensures clean, readable code.

```python
repos = [
    {"name": name, "path": Path(path), "weight": 5}
    for name, path in repo
]
```

This pattern reduces redundancy and makes the function more flexible by easily accommodating additional repository parameters.

---

*Generated by CodeWorm on 2026-02-22 11:43*
