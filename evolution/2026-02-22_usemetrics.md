# useMetrics

**Type:** Code Evolution
**Repository:** oneIsNun_
**File:** react-scss/src/api/hooks/useMetrics.ts
**Language:** typescript
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```typescript
Commit: fc968a71
Message: feat: transform to MongoDB management dashboard

Major refactor from auth template to MongoDB dashboard:

Backend:
- Fix WebSocket context issue (use context.Background instead of r.Context)
- Add Dockerfile.dev with Air hot reload and mongodb-database-tools
- Update go.mod to Go 1.25
- Add Makefile for mongo and app management
- Add dev.compose.yml for Docker development environment
- Configure mongo-rs.yml for 3-node replica set

Frontend:
- Add HydrateFallback to silence React Router warning
- Update CSP to allow localhost:8080 and ws connections
- Replace auth pages with dashboard, collections, backups, slow-queries
- Add WebSocket hook for real-time metrics
- Add metrics, backups, collections API hooks and types
- Update shell with connection status indicator
- Remove auth-related code (login, register, protected routes)

Removed legacy GO/*.md architecture docs (moved to CLAUDE.md)
Author: CarterPerez-dev
File: react-scss/src/api/hooks/useMetrics.ts
Change type: new file

Diff:
@@ -0,0 +1,86 @@
+// ===================
+// AngelaMos | 2026
+// useMetrics.ts
+// ===================
+
+import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query'
+import { apiClient } from '@/core/api'
+import { API_ENDPOINTS, QUERY_CONFIG, QUERY_KEYS } from '@/config'
+import {
+  parseApiResponse,
+  DashboardMetricsSchema,
+  SlowQueryReportSchema,
+  SlowQueryAnalysisSchema,
+  ProfilingStatusSchema,
+  type DashboardMetrics,
+  type SlowQueryReport,
+  type SlowQueryAnalysis,
+  type ProfilingStatus,
+  type SetProfilingRequest,
+} from '../types'
+
+export function useMetrics() {
+  return useQuery({
+    queryKey: QUERY_KEYS.METRICS.DASHBOARD(),
+    queryFn: async (): Promise<DashboardMetrics> => {
+      const { data } = await apiClient.get(API_ENDPOINTS.METRICS.DASHBOARD)
+      return parseApiResponse(DashboardMetricsSchema, data)
+    },
+    staleTime: QUERY_CONFIG.STALE_TIME.METRICS,
+    refetchInterval: QUERY_CONFIG.REFETCH_INTERVAL.METRICS,
+  })
+}
+
+export function useSlowQueries(minMillis?: number, limit?: number) {
+  return useQuery({
+    queryKey: QUERY_KEYS.METRICS.SLOW_QUERIES(minMillis),
+    queryFn: async (): Promise<SlowQueryReport> => {
+      const params = new URLSearchParams()
+      if (minMillis) params.append('min_millis', String(minMillis))
+      if (limit) params.append('limit', String(limit))
+      const url = `${API_ENDPOINTS.METRICS.SLOW_QUERIES}?${params}`
+      const { data } = await apiClient.get(url)
+      return parseApiResponse(SlowQueryReportSchema, data)
+    },
+    staleTime: QUERY_CONFIG.STALE_TIME.METRICS,
+  })
+}
+
+export function useSlowQueryAnalysis(minMillis?: number, limit?: number) {
+  return useQuery({
+    queryKey: QUERY_KEYS.METRICS.ANALYSIS(),
+    queryFn: async (): Promise<SlowQueryAnalysis> => {
+      const params = new URLSearchParams()
+      if (minMillis) params.append('min_millis', String(minMillis))
+      if (limit) params.append('limit
```

---

## Code Evolution

### Change Analysis

**What was Changed:**
A new file `useMetrics.ts` was added to the project, introducing React Query hooks for managing MongoDB metrics and slow query reports. The code defines four main functions:
- `useMetrics`: Fetches dashboard metrics.
- `useSlowQueries`: Retrieves slow query reports with optional filtering by minimum millis and limit.
- `useSlowQueryAnalysis`: Analyzes slow queries similarly to the previous function.
- `useProfilingStatus` and `useSetProfiling`: Handle profiling status and setting profiling, respectively.

**Why it was Likely Changed:**
This change likely aims to provide a more robust and flexible way to manage MongoDB metrics and performance data within the new dashboard. The use of React Query ensures efficient data fetching and caching, reducing unnecessary API calls.

**Impact on Behavior:**
These hooks will enable real-time monitoring and analysis of MongoDB performance directly from the frontend. Developers can now easily integrate these functionalities into their applications without handling low-level API interactions manually.

**Risks or Concerns:**
- **Dependence on External Services:** The new functionality relies heavily on backend APIs, which could introduce latency if not properly optimized.
- **Error Handling:** Proper error handling and fallback mechanisms should be implemented to ensure a smooth user experience even when network issues occur.
- **Resource Management:** Frequent API calls might impact performance; thus, careful consideration of `staleTime` and `refetchInterval` is necessary.

---

*Generated by CodeWorm on 2026-02-22 23:39*
