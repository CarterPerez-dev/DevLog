# ReferralTracking

**Type:** Code Evolution
**Repository:** stripe-referral
**File:** src/stripe_referral/models/ReferralTracking.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: bfb52633
Message: feat: Done
Author: CarterPerez-dev
File: src/stripe_referral/models/ReferralTracking.py
Change type: new file

Diff:
@@ -0,0 +1,113 @@
+"""
+â’¸AngelaMos | 2025 | CertGames.com
+ReferralTracking model
+"""
+
+from __future__ import annotations
+
+from datetime import (
+    UTC,
+    datetime,
+)
+from typing import TYPE_CHECKING
+
+from sqlalchemy import (
+    DateTime,
+    Float,
+    ForeignKey,
+    String,
+)
+from sqlalchemy.orm import (
+    Mapped,
+    mapped_column,
+    relationship,
+)
+
+from ..config.constants import (
+    MAX_TRANSACTION_ID_LENGTH,
+    MAX_USER_ID_LENGTH,
+)
+from ..config.enums import (
+    CurrencyCode,
+    ReferralTrackingStatus,
+)
+from ..database.Base import (
+    Base,
+    TimestampMixin,
+)
+
+if TYPE_CHECKING:
+    from .Payout import Payout
+    from .ReferralCode import ReferralCode
+    from .ReferralProgram import ReferralProgram
+
+
+class ReferralTracking(Base, TimestampMixin):
+    """
+    Tracks successful referral conversions
+    """
+    __tablename__ = "referral_trackings"
+
+    id: Mapped[int] = mapped_column(
+        primary_key = True,
+        autoincrement = True
+    )
+
+    referrer_user_id: Mapped[str] = mapped_column(
+        String(MAX_USER_ID_LENGTH),
+        index = True
+    )
+    referred_user_id: Mapped[str] = mapped_column(
+        String(MAX_USER_ID_LENGTH),
+        index = True
+    )
+
+    code_id: Mapped[int] = mapped_column(
+        ForeignKey("referral_codes.id"),
+        nullable = False
+    )
+    program_id: Mapped[int] = mapped_column(
+        ForeignKey("referral_programs.id"),
+        nullable = False
+    )
+
+    transaction_id: Mapped[str | None] = mapped_column(
+        String(MAX_TRANSACTION_ID_LENGTH),
+        nullable = True
+    )
+    transaction_amount: Mapped[float | None] = mapped_column(
+        Float,
+        nullable = True
+    )
+
+    amount_earned: Mapped[float] = mapped_column(Float, nullable = False)
+    currency: Mapped[str] = mapped_column(
+        String(3),
+        default = CurrencyCode.USD.value
+    )
+
+    converted_at: Mapped[datetime] = mapped_column(
+        DateTime(timezone = True),
+        default = lambda: datetime.now(UTC),
+        index = True
+    )
+
+    payout_status: Mapped[str] = mapped_column(
+        String(20),
+        default = ReferralTrackingStatus.PENDING.value,
+        index = True
+    )
+
+    code: Mapped[ReferralCode] = relationship(
+        "ReferralCode",
+        back_populates = "trackings"
+    )
+    program: Mapped[ReferralProgram] = relationship(
+        "ReferralProgram",
+        back_populates = "trackings"
+    )
+    payout: Mapped[Payout | None] = relationship(
+        "Payout",
+        back_populates = "tracking",
+        uselist = False
+    )

```

---

## Code Evolution

### Change Analysis for `ReferralTracking` Model

**What was Changed:**
The code introduces a new file, `ReferralTracking.py`, defining a SQLAlchemy model named `ReferralTracking`. This model tracks successful referral conversions within the `stripe-referral` application.

**Why it was Likely Changed:**
This change likely aims to implement a tracking mechanism for referrals in the system. The model includes fields such as referrer and referred user IDs, transaction details (ID and amount), currency, status of the payout, and relationships with other models like `ReferralCode`, `ReferralProgram`, and `Payout`.

**Impact on Behavior:**
The introduction of this model will allow the application to log and manage referral events. This can help in monitoring referral performance, calculating payouts, and maintaining a history of successful referrals.

**Risks or Concerns:**
- **Data Integrity:** Ensuring that all fields are correctly populated and validated.
- **Performance:** Indexing certain columns (e.g., `referrer_user_id`, `referred_user_id`, `converted_at`) could impact query performance if not managed properly.
- **Relationship Management:** Proper handling of relationships with other models to avoid orphaned records or circular references.

Overall, this change enhances the application's capability to track and manage referral programs effectively.

---

*Generated by CodeWorm on 2026-02-23 03:01*
