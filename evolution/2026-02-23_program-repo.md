# program_repo

**Type:** Code Evolution
**Repository:** stripe-referral
**File:** src/stripe_referral/repositories/program_repo.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: bfb52633
Message: feat: Done
Author: CarterPerez-dev
File: src/stripe_referral/repositories/program_repo.py
Change type: new file

Diff:
@@ -0,0 +1,74 @@
+"""
+â’¸AngelaMos | 2025 | CertGames.com
+Referral program repository
+"""
+
+from sqlalchemy import select
+from sqlalchemy.orm import Session
+
+from ..models.ReferralProgram import ReferralProgram
+
+from .base import BaseRepository
+
+
+class ReferralProgramRepository(BaseRepository[ReferralProgram]):
+    """
+    Repository for ReferralProgram database operations
+    """
+    def __init__(self, db: Session) -> None:
+        """
+        Initialize with ReferralProgram model
+        """
+        super().__init__(db, ReferralProgram)
+
+    def get_by_key(self, program_key: str) -> ReferralProgram | None:
+        """
+        Get program by unique program key
+        """
+        stmt = select(ReferralProgram).where(
+            ReferralProgram.program_key == program_key
+        )
+        return self.db.execute(stmt).scalar_one_or_none()
+
+    def get_by_name(self, name: str) -> ReferralProgram | None:
+        """
+        Get program by unique name
+        """
+        stmt = select(ReferralProgram).where(ReferralProgram.name == name)
+        return self.db.execute(stmt).scalar_one_or_none()
+
+    def get_active_programs(self) -> list[ReferralProgram]:
+        """
+        Get all active programs
+        """
+        stmt = select(ReferralProgram).where(ReferralProgram.is_active)
+        return list(self.db.execute(stmt).scalars().all())
+
+    def deactivate_program(
+        self,
+        program_id: int
+    ) -> ReferralProgram | None:
+        """
+        Deactivate a program
+        """
+        program = self.get_by_id(program_id)
+        if not program:
+            return None
+
+        program.is_active = False
+        self.db.commit()
+        self.db.refresh(program)
+        return program
+
+    def activate_program(self, program_id: int) -> ReferralProgram | None:
+        """
+        Activate a program
+        """
+        program = self.get_by_id(program_id)
+        if not program:
+            return None
+
+        program.is_active = True
+        self.db.commit()
+        self.db.refresh(program)
+        return program

```

---

## Code Evolution

### Change Analysis for Commit `bfb52633`

**What was Changed:**
A new file, `program_repo.py`, was added to the `stripe-referral` repository. This file introduces a `ReferralProgramRepository` class that extends `BaseRepository`. The class includes methods like `get_by_key`, `get_by_name`, `get_active_programs`, and methods to deactivate or activate programs.

**Why it was Likely Changed:**
This change likely aims to provide structured database operations for managing referral programs. By encapsulating these operations within a repository, the code becomes more modular and easier to maintain. The addition of methods like `deactivate_program` and `activate_program` suggests an intent to manage program states dynamically.

**Impact on Behavior:**
The introduction of this repository class allows for centralized handling of referral program data retrieval and state management. Developers can now easily interact with the database using these defined methods, reducing the likelihood of errors in direct SQL queries.

**Risks or Concerns:**
- **Potential Bugs:** The `get_by_id` method is not explicitly defined within this class, which could lead to issues if it's expected to exist elsewhere.
- **Database Consistency:** Ensure that committing changes (`self.db.commit()`) and refreshing objects (`self.db.refresh(program)`) are handled correctly in a multi-threaded or concurrent environment.

Overall, this change enhances the codebase by adding structured database operations for managing referral programs.

---

*Generated by CodeWorm on 2026-02-23 08:28*
