# filter

**Type:** Code Evolution
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/secrets-scanner/internal/engine/filter.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: 294169a2
Message: feat: Complete Go secrets scanner - Portia
Author: CarterPerez-dev
File: PROJECTS/intermediate/secrets-scanner/internal/engine/filter.go
Change type: new file

Diff:
@@ -0,0 +1,847 @@
+// Â©AngelaMos | 2026
+// filter.go
+
+package engine
+
+import (
+	"regexp"
+	"strings"
+
+	"github.com/CarterPerez-dev/portia/internal/rules"
+	"github.com/CarterPerez-dev/portia/pkg/types"
+)
+
+var templatePatterns = []*regexp.Regexp{
+	regexp.MustCompile(`^\$\{.+\}$`),
+	regexp.MustCompile(`^\{\{.+\}\}$`),
+	regexp.MustCompile(`(?i)os\.(?:getenv|environ)\s*\(`),
+	regexp.MustCompile(`(?i)process\.env\.`),
+	regexp.MustCompile(`(?i)System\.getenv\s*\(`),
+	regexp.MustCompile(`(?i)ENV\[`),
+	regexp.MustCompile(`(?i)env\(\s*['"]`),
+	regexp.MustCompile(`(?i)viper\.Get`),
+	regexp.MustCompile(`(?i)config\.get\s*\(`),
+	regexp.MustCompile(`(?i)config\[`),
+	regexp.MustCompile(`@Value\s*\(\s*"\$\{`),
+	regexp.MustCompile(`<%=\s*ENV\[`),
+	regexp.MustCompile(`\{\{\s*\.Values\.`),
+}
+
+var assignmentPattern = regexp.MustCompile(
+	`(?:=|:|=>|:=|\|\||,)\s*['"\x60]?\s*\S`,
+)
+
+func IsStopword(
+	secret string, extra []string,
+) bool {
+	lower := strings.ToLower(secret)
+	if _, ok := stopwords[lower]; ok {
+		return true
+	}
+
+	for _, sw := range extra {
+		if len(sw) >= 4 &&
+			strings.Contains(lower, strings.ToLower(sw)) {
+			return true
+		}
+	}
+
+	parts := strings.FieldsFunc(lower, func(r rune) bool {
+		return r == '_' || r == '-' || r == '.' || r == '/'
+	})
+	for _, part := range parts {
+		if _, ok := stopwords[part]; ok {
+			return true
+		}
+	}
+
+	return false
+}
+
+func IsPlaceholder(secret string) bool {
+	for _, re := range rules.GlobalValueAllowlist {
+		if re.MatchString(secret) {
+			return true
+		}
+	}
+	return false
+}
+
+func IsTemplated(secret string) bool {
+	for _, re := range templatePatterns {
+		if re.MatchString(secret) {
+			return true
+		}
+	}
+	return false
+}
+
+func HasAssignmentOperator(line string) bool {
+	return assignmentPattern.MatchString(line)
+}
+
+func IsAllowedPath(
+	path string, allowlist []*regexp.Regexp,
+) bool {
+	for _, re := range allowlist {
+		if re.MatchString(path) {
+			return true
+		}
+	}
+	return false
+}
+
+func FilterFinding(
+	finding *types.Finding,
+	rule *types.Rule,
+) bool {
+	if IsPlaceholder(finding.Secret) {
+		return false
+	}
+
+	if IsTemplated(finding.Secret) {
+		return false
+	}
+
+	if IsStopword(finding.Secret, rule.Allowlist.Stopwords) {
+		return false
+	}
+
+	for _, re := range rule.Allowlist.Values {
+		if re.MatchString(finding.Secret) {
+			return false
+		}
+	}
+
+	if IsAllowedPath(
+		finding.FilePath,
+		rules.GlobalPathAllowlist,
+	) {
+		return false
+	}
+
+	for _, re := range rule.Allowlist.Paths {
+		if re.MatchString(finding.FilePath) {
+			return false
+		}
+	}
+
+	return true
+}
+
+var stopwords = map[string]bool{
+	"abstract":       true,
+	"account":        true,
+	"action":         true,
+	"active":         true,
+	"activity":       true,
+	"
```

---

## Code Evolution

### Change Analysis

**What was Changed:** 
A new file `filter.go` was added to the `internal/engine` package, containing several functions for filtering potential secrets based on various criteria such as templating patterns, stopword lists, and path allowlists.

**Why it was Likely Changed:**
This change likely aims to enhance the Go secrets scanner by implementing more sophisticated filtering logic. The introduction of regex-based templates, stopword detection, and path allowlisting ensures that false positives are minimized while accurately identifying sensitive information.

**Impact on Behavior:**
The `FilterFinding` function now considers multiple factors before determining if a finding should be reported. This includes checking for templated secrets, stopword presence, and allowed paths, making the scanner more robust and precise.

**Risks or Concerns:**
- **Complexity:** The introduction of numerous regex patterns and complex logic could increase code maintenance costs.
- **Performance:** Regular expression matching can be resource-intensive, potentially impacting performance if used extensively.
- **False Negatives/Positives:** While the new filters aim to reduce false positives, there is a risk that legitimate findings might be missed or incorrectly flagged as false positives.

Overall, this change significantly improves the scanner's ability to accurately identify and filter out non-sensitive information.

---

*Generated by CodeWorm on 2026-02-22 20:51*
