# visitor

**Type:** Code Evolution
**Repository:** docksec
**File:** internal/parser/visitor.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: 5a7c48c4
Message: Initial release
Author: CarterPerez-dev
File: internal/parser/visitor.go
Change type: new file

Diff:
@@ -0,0 +1,138 @@
+/*
+CarterPerez-dev | 2025
+visitor.go
+*/
+
+package parser
+
+import (
+	"github.com/CarterPerez-dev/docksec/internal/finding"
+)
+
+type RuleVisitor struct {
+	Target   finding.Target
+	Findings finding.Collection
+	rules    []Rule
+}
+
+type Rule interface {
+	ID() string
+	Check(ctx *RuleContext) []*finding.Finding
+}
+
+type RuleContext struct {
+	Target      finding.Target
+	Dockerfile  *DockerfileAST
+	ComposeFile *ComposeFile
+}
+
+func NewRuleVisitor(target finding.Target, rules ...Rule) *RuleVisitor {
+	return &RuleVisitor{
+		Target: target,
+		rules:  rules,
+	}
+}
+
+func (v *RuleVisitor) VisitDockerfile(ast *DockerfileAST) {
+	ctx := &RuleContext{
+		Target:     v.Target,
+		Dockerfile: ast,
+	}
+
+	for _, rule := range v.rules {
+		findings := rule.Check(ctx)
+		v.Findings = append(v.Findings, findings...)
+	}
+}
+
+func (v *RuleVisitor) VisitCompose(cf *ComposeFile) {
+	ctx := &RuleContext{
+		Target:      v.Target,
+		ComposeFile: cf,
+	}
+
+	for _, rule := range v.rules {
+		findings := rule.Check(ctx)
+		v.Findings = append(v.Findings, findings...)
+	}
+}
+
+func (v *RuleVisitor) VisitCommand(cmd Command) {
+}
+
+func (v *RuleVisitor) VisitService(name string, svc *Service) {
+}
+
+func (v *RuleVisitor) Results() finding.Collection {
+	return v.Findings
+}
+
+type BaseRule struct {
+	RuleID      string
+	Title       string
+	Severity    finding.Severity
+	Category    string
+	Description string
+	Remediation string
+	References  []string
+}
+
+func (r *BaseRule) ID() string {
+	return r.RuleID
+}
+
+func (r *BaseRule) NewFinding(target finding.Target) *finding.Finding {
+	return finding.New(r.RuleID, r.Title, r.Severity, target).
+		WithDescription(r.Description).
+		WithCategory(r.Category).
+		WithRemediation(r.Remediation).
+		WithReferences(r.References...)
+}
+
+type DockerfileRule struct {
+	BaseRule
+	CheckFunc func(ast *DockerfileAST, target finding.Target) []*finding.Finding
+}
+
+func (r *DockerfileRule) Check(ctx *RuleContext) []*finding.Finding {
+	if ctx.Dockerfile == nil {
+		return nil
+	}
+	return r.CheckFunc(ctx.Dockerfile, ctx.Target)
+}
+
+type ComposeRule struct {
+	BaseRule
+	CheckFunc func(cf *ComposeFile, target finding.Target) []*finding.Finding
+}
+
+func (r *ComposeRule) Check(ctx *RuleContext) []*finding.Finding {
+	if ctx.ComposeFile == nil {
+		return nil
+	}
+	return r.CheckFunc(ctx.ComposeFile, ctx.Target)
+}
+
+type MultiRule struct {
+	BaseRule
+	DockerfileCheck func(ast *DockerfileAST, target finding.Target) []*finding.Finding
+	ComposeCheck    func(cf *ComposeFile, target finding.Target) []*finding.Finding
+}
+
+func (r *MultiRule) Check(ctx *RuleContext) []*finding.Finding {
+	var findings []*finding.Finding
+
+	if ctx.Dockerfile != nil && r.DockerfileCheck != nil {
+		findings = append(
+			findings,
+			r.DockerfileCheck(ctx.Dockerfile, ctx.Targ
```

---

## Code Evolution

### Change Analysis for `internal/parser/visitor.go`

**What was Changed:**
The file `internal/parser/visitor.go` introduces a new package `parser`, which contains the implementation of a visitor pattern to traverse and analyze Dockerfile and Compose files. This includes defining interfaces, structs, and methods for visiting rules.

**Why it was Likely Changed:**
This change likely aims to provide a modular and extensible way to check Dockerfiles and Compose files for security vulnerabilities or best practices by allowing the addition of new rules without modifying existing code. The use of interfaces (`Rule`, `RuleContext`) enables dynamic rule checking, making the system more flexible.

**Impact on Behavior:**
The introduction of this visitor pattern allows for a structured approach to parsing and validating Dockerfiles and Compose files. It ensures that any new rule can be easily integrated by implementing the `Rule` interface. The `VisitDockerfile`, `VisitCompose`, and `VisitCommand` methods enable traversal through the ASTs, while `Results()` returns all findings.

**Risks or Concerns:**
- **Error Handling:** While the code does not explicitly handle errors, it's crucial to ensure robust error handling in production. For instance, checking for `nil` pointers (e.g., `ctx.Dockerfile`) is good practice but should be extended to cover other potential issues.
- **Performance:** The current implementation iterates over rules and appends findings, which could become inefficient if many rules are defined or the ASTs are large.

Overall, this change significantly enhances the modularity and extensibility of the codebase.

---

*Generated by CodeWorm on 2026-02-23 15:50*
