# parser

**Type:** Code Evolution
**Repository:** angela
**File:** internal/pyproject/parser.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: ea4cc501
Message: Create canonical module source location - release v1.0.0
Author: CarterPerez-dev
File: internal/pyproject/parser.go
Change type: new file

Diff:
@@ -0,0 +1,117 @@
+// Â©AngelaMos | 2026
+// parser.go
+
+package pyproject
+
+import (
+	"fmt"
+	"os"
+	"strings"
+
+	"github.com/CarterPerez-dev/angela/pkg/types"
+	toml "github.com/pelletier/go-toml/v2"
+)
+
+type pyProjectFile struct {
+	Project struct {
+		Name                 string              `toml:"name"`
+		Version              string              `toml:"version"`
+		Dependencies         []string            `toml:"dependencies"`
+		OptionalDependencies map[string][]string `toml:"optional-dependencies"`
+	} `toml:"project"`
+}
+
+// ParseFile reads a pyproject.toml and extracts all dependency declarations
+func ParseFile(path string) ([]types.Dependency, error) {
+	data, err := os.ReadFile(path) //nolint:gosec
+	if err != nil {
+		if os.IsNotExist(err) {
+			return nil, fmt.Errorf(
+				"open %s: file not found (run from your project root)",
+				path,
+			)
+		}
+		return nil, fmt.Errorf("read %s: %w", path, err)
+	}
+
+	var proj pyProjectFile
+	if err := toml.Unmarshal(data, &proj); err != nil {
+		return nil, fmt.Errorf(
+			"parse %s: invalid TOML syntax: %w", path, err,
+		)
+	}
+
+	var deps []types.Dependency
+
+	for _, raw := range proj.Project.Dependencies {
+		deps = append(deps, ParseDependency(raw, ""))
+	}
+
+	for group, entries := range proj.Project.OptionalDependencies {
+		for _, raw := range entries {
+			deps = append(deps, ParseDependency(raw, group))
+		}
+	}
+
+	if len(deps) == 0 {
+		return nil, fmt.Errorf(
+			"%s: no dependencies found in [project.dependencies] or [project.optional-dependencies]",
+			path,
+		)
+	}
+	return deps, nil
+}
+
+// ParseDependency splits a PEP 508 dependency string into its components
+func ParseDependency(raw, group string) types.Dependency {
+	dep := types.Dependency{Group: group}
+	s := strings.TrimSpace(raw)
+
+	if idx := strings.Index(s, ";"); idx >= 0 {
+		dep.Markers = strings.TrimSpace(s[idx+1:])
+		s = s[:idx]
+	}
+	s = strings.TrimSpace(s)
+
+	if start := strings.Index(s, "["); start >= 0 {
+		end := strings.Index(s, "]")
+		if end > start {
+			for _, e := range strings.Split(s[start+1:end], ",") {
+				dep.Extras = append(
+					dep.Extras,
+					strings.TrimSpace(e),
+				)
+			}
+			s = s[:start] + s[end+1:]
+		}
+	}
+
+	if idx := strings.IndexAny(s, "><=!~"); idx >= 0 {
+		dep.Name = strings.TrimSpace(s[:idx])
+		dep.Spec = strings.TrimSpace(s[idx:])
+	} else {
+		dep.Name = strings.TrimSpace(s)
+	}
+
+	return dep
+}
+
+// ExtractMinVersion returns the first pinned or lower-bound version from a
+// PEP 440 version specifier string. Returns empty if no version is specified.
+func ExtractMinVersion(spec string) string {
+	for _, part := range strings.Split(spec, ",") {
+		part = strings.TrimSpace(part)
+		switch {
+		case strings.HasPrefix(part, ">="):
+			return strings.TrimSpace(part[2:])
+		case strings
```

---

## Code Evolution

### Change Analysis for Commit ea4cc501

**What was Changed:**
The commit introduces a new file `parser.go` in the `internal/pyproject` package, which contains functions to parse and extract dependencies from a `pyproject.toml` file. The key changes include:
- Defining a `pyProjectFile` struct for parsing.
- Implementing `ParseFile`, which reads and parses the TOML file content into dependency objects.
- Adding `ParseDependency` to split PEP 508 dependency strings into components like name, specifiers, markers, and extras.
- Introducing `ExtractMinVersion` to extract the minimum version from a version specifier.

**Why it was Likely Changed:**
This change likely aims to provide a robust way to handle Python project dependencies within the Go package. It aligns with the goal of creating a canonical module source location by ensuring accurate dependency extraction and management.

**Impact on Behavior:**
The `ParseFile` function will now correctly parse both direct and optional dependencies, returning them as structured objects. This enhances the tool's ability to manage Python project configurations accurately.

**Risks or Concerns:**
- **Security:** The use of `os.ReadFile` without proper validation could expose security risks if not run from the correct directory.
- **Error Handling:** While basic error handling is present, more granular checks and logging should be considered for better debugging and resilience.
- **PEP 508 Compliance:** Ensuring full compliance with PEP 508 syntax variations might require additional tests or updates.

---

*Generated by CodeWorm on 2026-02-23 14:18*
