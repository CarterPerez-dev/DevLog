# extractor

**Type:** Code Evolution
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/advanced/ai-threat-detection/backend/app/core/features/extractor.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: 7f35fbd8
Message: feat: complete Phase 1 — rule-based detection pipeline, API, Docker E2E

Phase 1 delivers end-to-end threat detection from nginx log ingestion
through rule-based scoring to REST API and WebSocket alerts.

- API layer: /threats, /stats, /models/status, /ws/alerts, /health, /ready
- Alert dispatcher with Redis pub/sub + PostgreSQL persistence
- Typer CLI: vigil serve, config, health
- Integration tests (tailer -> pipeline -> DB round-trip)
- Docker E2E verified: dev.compose.yml stack with all services healthy
- Linting clean: ruff, mypy strict (0 issues), pylint 10/10
- 75 tests passing across 8 test modules
Author: CarterPerez-dev
File: PROJECTS/advanced/ai-threat-detection/backend/app/core/features/extractor.py
Change type: modified

Diff:
@@ -25,9 +25,7 @@ def _shannon_entropy(s: str) -> float:
         return 0.0
     length = len(s)
     counts = Counter(s)
-    return -sum(
-        (c / length) * math.log2(c / length) for c in counts.values()
-    )
+    return -sum((c / length) * math.log2(c / length) for c in counts.values())
 
 
 def _is_private_ip(ip_str: str) -> bool:
@@ -63,9 +61,7 @@ def extract_request_features(
         "path_entropy": _shannon_entropy(entry.path),
         "path_length": path_len,
         "query_string_length": len(entry.query_string),
-        "query_param_count": (
-            len(entry.query_string.split("&")) if entry.query_string else 0
-        ),
+        "query_param_count": (len(entry.query_string.split("&")) if entry.query_string else 0),
         "has_encoded_chars": bool(ENCODED_CHARS.search(full_uri)),
         "has_double_encoding": bool(DOUBLE_ENCODED.search(full_uri)),
         "status_code": entry.status_code,
@@ -77,9 +73,7 @@ def extract_request_features(
         "ua_length": len(entry.user_agent),
         "ua_entropy": _shannon_entropy(entry.user_agent),
         "is_known_bot": any(sig in ua_lower for sig in BOT_USER_AGENTS),
-        "is_known_scanner": any(
-            sig in ua_lower for sig in SCANNER_USER_AGENTS
-        ),
+        "is_known_scanner": any(sig in ua_lower for sig in SCANNER_USER_AGENTS),
         "has_attack_pattern": bool(ATTACK_COMBINED.search(full_uri)),
         "special_char_ratio": non_alnum / path_len if path_len else 0.0,
         "file_extension": ext,

```

---

## Code Evolution

### Change Analysis

**What was Changed:**
The code modifications in `extract_request_features` function primarily involved simplifying the syntax of lambda expressions and removing redundant parentheses. Specifically, the `_shannon_entropy` function's return statement had its formatting adjusted for readability, while the calculation of `query_param_count` and `is_known_scanner` were streamlined.

**Why it was Likely Changed:**
The changes likely aim to improve code readability and maintain Pythonic style by simplifying expressions. This is common in refactoring efforts where developers streamline code without altering functionality.

**Impact on Behavior:**
These changes do not impact the behavior of the functions; they merely enhance the code's clarity. The entropy calculation remains unchanged, as does the logic for determining `query_param_count` and `is_known_scanner`.

**Risks or Concerns:**
There are no risks introduced by these changes since the functionality is preserved. However, it’s important to ensure that other parts of the application that rely on these functions remain consistent with any potential refactoring.

Overall, this change aligns with best practices in Python coding and should not introduce any bugs or issues.

---

*Generated by CodeWorm on 2026-02-23 08:35*
