# useWebSocket

**Type:** Code Evolution
**Repository:** oneIsNun_
**File:** react-scss/src/api/hooks/useWebSocket.ts
**Language:** typescript
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```typescript
Commit: fc968a71
Message: feat: transform to MongoDB management dashboard

Major refactor from auth template to MongoDB dashboard:

Backend:
- Fix WebSocket context issue (use context.Background instead of r.Context)
- Add Dockerfile.dev with Air hot reload and mongodb-database-tools
- Update go.mod to Go 1.25
- Add Makefile for mongo and app management
- Add dev.compose.yml for Docker development environment
- Configure mongo-rs.yml for 3-node replica set

Frontend:
- Add HydrateFallback to silence React Router warning
- Update CSP to allow localhost:8080 and ws connections
- Replace auth pages with dashboard, collections, backups, slow-queries
- Add WebSocket hook for real-time metrics
- Add metrics, backups, collections API hooks and types
- Update shell with connection status indicator
- Remove auth-related code (login, register, protected routes)

Removed legacy GO/*.md architecture docs (moved to CLAUDE.md)
Author: CarterPerez-dev
File: react-scss/src/api/hooks/useWebSocket.ts
Change type: new file

Diff:
@@ -0,0 +1,125 @@
+// ===================
+// AngelaMos | 2026
+// useWebSocket.ts
+// ===================
+
+import { useCallback, useEffect, useRef, useState } from 'react'
+import { z } from 'zod'
+import { DashboardMetricsSchema, type DashboardMetrics } from '../types'
+
+type ReadyState = 'CONNECTING' | 'OPEN' | 'CLOSING' | 'CLOSED'
+
+const WebSocketMessageSchema = z.object({
+  type: z.string(),
+  payload: z.unknown(),
+  timestamp: z.string(),
+})
+
+interface UseWebSocketOptions {
+  enabled?: boolean
+  reconnectAttempts?: number
+  reconnectInterval?: number
+}
+
+interface UseWebSocketReturn {
+  metrics: DashboardMetrics | null
+  readyState: ReadyState
+  isConnected: boolean
+  reconnect: () => void
+}
+
+export function useWebSocket(options: UseWebSocketOptions = {}): UseWebSocketReturn {
+  const {
+    enabled = true,
+    reconnectAttempts = 5,
+    reconnectInterval = 3000,
+  } = options
+
+  const [metrics, setMetrics] = useState<DashboardMetrics | null>(null)
+  const [readyState, setReadyState] = useState<ReadyState>('CLOSED')
+  const wsRef = useRef<WebSocket | null>(null)
+  const reconnectCountRef = useRef(0)
+  const reconnectTimeoutRef = useRef<NodeJS.Timeout>()
+
+  const getWsUrl = useCallback(() => {
+    const apiUrl = import.meta.env.VITE_API_URL ?? 'http://localhost:8080'
+    const wsProtocol = apiUrl.startsWith('https') ? 'wss' : 'ws'
+    const host = apiUrl.replace(/^https?:\/\//, '')
+    return `${wsProtocol}://${host}/ws`
+  }, [])
+
+  const connect = useCallback(() => {
+    if (wsRef.current?.readyState === WebSocket.OPEN) return
+
+    const ws = new WebSocket(getWsUrl())
+    wsRef.current = ws
+
+    ws.onopen = () => {
+      setReadyState('OPEN')
+      reconnectCountRef.current = 0
+    }
+
+    ws.onclose = () => {
+      setReadyState('CLOSED')
+
+      if (enabled && reconnectCountRef.current < reconnectAttempts) {
+        reconnectTimeoutRef.current = setTimeout(() => {
+          re
```

---

## Code Evolution

### Change Analysis

**What was Changed:**
- A new file `useWebSocket.ts` was added to the project.
- The file introduces a custom hook for managing WebSocket connections, specifically designed for real-time metrics in the MongoDB dashboard.

**Why it Was Likely Changed:**
The addition of this hook is likely aimed at enabling real-time updates and monitoring features in the MongoDB management dashboard. This change supports dynamic data fetching and handling reconnections, ensuring robust WebSocket communication even when network issues occur.

**Impact on Behavior:**
This new hook will allow the frontend to receive live metrics from the backend, enhancing the user experience by providing up-to-date information without requiring page reloads. It also handles connection management gracefully, reducing potential disruptions due to disconnections.

**Risks or Concerns:**
- **Complexity:** The introduction of a custom WebSocket management hook adds complexity to the codebase.
- **Error Handling:** While the hook attempts to handle errors and reconnections, it may still fail in unexpected scenarios. Careful testing is required to ensure reliability.
- **Resource Management:** Proper cleanup must be ensured when components using this hook unmount, to avoid memory leaks.

Overall, this change significantly enhances real-time functionality but requires thorough testing and monitoring to ensure stability.

---

*Generated by CodeWorm on 2026-02-22 23:40*
