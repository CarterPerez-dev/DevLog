# _publish_batch_progress

**Type:** Code Evolution
**Repository:** vuemantics
**File:** backend/workers/batch_helpers/_publish_batch_progress.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: 4d33b24a
Message: feat: dramatiq - bulkupload
Author: CarterPerez-dev
File: backend/workers/batch_helpers/_publish_batch_progress.py
Change type: new file

Diff:
@@ -0,0 +1,48 @@
+"""
+â’¸AngelaMos | 2026
+_publish_batch_progress.py
+
+Publish batch-level progress updates via WebSocket
+"""
+
+import logging
+
+from core.websocket import (
+    get_publisher,
+    BatchProgressUpdate,
+    BatchProgressPayload,
+)
+from models.UploadBatch import UploadBatch
+
+
+logger = logging.getLogger(__name__)
+
+
+async def publish_batch_progress(batch: UploadBatch) -> None:
+    """
+    Publish batch progress update via WebSocket
+
+    Args:
+        batch: UploadBatch instance
+    """
+    try:
+        publisher = get_publisher()
+        await publisher.publish_to_user(
+            str(batch.user_id),
+            BatchProgressUpdate(
+                payload = BatchProgressPayload(
+                    batch_id = str(batch.id),
+                    status = batch.status,
+                    total = batch.total_uploads,
+                    processed = batch.processed_uploads,
+                    successful = batch.successful_uploads,
+                    failed = batch.failed_uploads,
+                    progress_percentage = int(batch.get_progress_percentage()),
+                )
+            ),
+        )
+    except Exception as e:
+        # Don't fail batch processing if WebSocket broadcast fails
+        logger.warning(
+            f"Failed to publish batch progress for {batch.id}: {e}"
+        )

```

---

## Code Evolution

### Change Analysis

**What was Changed:**
A new file `_publish_batch_progress.py` was added to the `backend/workers/batch_helpers` directory. This file introduces an asynchronous function `publish_batch_progress` that updates batch-level progress via WebSocket.

**Why it was Likely Changed:**
The addition of this file likely aims to enhance real-time communication between the backend and frontend by providing immediate feedback on the status of batch uploads. This is common in applications where users need to monitor long-running processes without refreshing the page.

**Impact on Behavior:**
This change enables the application to send progress updates for each `UploadBatch` instance directly to the user's WebSocket connection. The function constructs a detailed payload with various metrics (status, total uploads, processed, successful, failed) and publishes it to the appropriate user based on their `user_id`.

**Risks or Concerns:**
- **Error Handling:** While the code catches exceptions and logs them, there is no retry mechanism for WebSocket publishing. If network issues persist, this could lead to incomplete progress updates.
- **Resource Usage:** Frequent WebSocket broadcasts might increase server load, especially if many users are uploading batches simultaneously.
- **Security:** Ensure that only authorized users receive batch progress updates by properly validating `user_id` and securing the WebSocket connection.

Overall, this change improves user experience but requires careful monitoring to ensure it does not introduce performance or security issues.

---

*Generated by CodeWorm on 2026-02-23 09:56*
