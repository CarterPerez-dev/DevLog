# scheduler

**Type:** Code Evolution
**Repository:** oneIsNun_
**File:** go-backend/internal/backup/scheduler.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: 4a6975ab
Message: feat: add automated 30-day cleanup for collections

Implemented daily cleanup task to manage old documents:

New cleanup service (`internal/cleanup/service.go`):
- Deletes documents older than 30 days from:
  - perfSamples
  - auditLogs
  - admin_request_logs
  - uniqueUserRequests
  - watchList
  - globalRateLimits
  - scanAttempts
- Drops all documents from legacy collections:
  - honeypot_interactions

Scheduled execution:
- Runs daily at 3:00 AM via cron
- 10-minute timeout for cleanup operations
- Detailed logging of results per collection

Integration:
- Added cleanup service to main.go
- Uses existing backup scheduler's cron instance
- Added Cron() getter to backup scheduler
- Configurable retention period (default: 30 days)

This will prevent database bloat from logging collections
Author: CarterPerez-dev
File: go-backend/internal/backup/scheduler.go
Change type: modified

Diff:
@@ -90,3 +90,7 @@ func (s *Scheduler) ListJobs() []string {
 	}
 	return ids
 }
+
+func (s *Scheduler) Cron() *cron.Cron {
+	return s.cron
+}

```

---

## Code Evolution

### Change Analysis

**What was Changed:**
In `internal/backup/scheduler.go`, a new method `Cron()` was added to the `Scheduler` struct, returning an instance of the cron scheduler used by the backup service. This change is part of implementing a daily cleanup task that removes old documents from various collections and drops legacy documents.

**Why it was Likely Changed:**
The addition of this method likely supports the integration of the new cleanup service into the existing backup scheduler's infrastructure. It provides access to the cron instance, allowing for the scheduling of the daily cleanup tasks at 3:00 AM with a 10-minute timeout.

**Impact on Behavior:**
This change introduces automated document cleanup that will run daily, preventing database bloat from logging collections like `perfSamples`, `auditLogs`, etc. The configurable retention period (defaulting to 30 days) ensures flexibility in managing the amount of data retained.

**Risks or Concerns:**
- **Potential Data Loss:** Documents older than 30 days will be deleted, which could lead to loss of critical information if not properly configured.
- **Cron Job Stability:** The daily cleanup task relies on a cron job running at 3:00 AM. Any issues with the cron scheduler could disrupt this process.
- **Resource Management:** Dropping all documents from legacy collections (`honeypot_interactions`) might have unintended consequences, especially if these documents are still needed for historical analysis or debugging.

Overall, while this change addresses database bloat, it's crucial to ensure proper configuration and testing of the cleanup logic.

---

*Generated by CodeWorm on 2026-02-23 01:18*
