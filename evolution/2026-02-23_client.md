# client

**Type:** Code Evolution
**Repository:** angela
**File:** internal/osv/client.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: ea4cc501
Message: Create canonical module source location - release v1.0.0
Author: CarterPerez-dev
File: internal/osv/client.go
Change type: new file

Diff:
@@ -0,0 +1,401 @@
+// Â©AngelaMos | 2026
+// client.go
+
+package osv
+
+import (
+	"bytes"
+	"context"
+	"encoding/json"
+	"fmt"
+	"io"
+	"net/http"
+	"strconv"
+	"strings"
+	"sync"
+	"time"
+
+	"github.com/CarterPerez-dev/angela/pkg/types"
+	"golang.org/x/sync/errgroup"
+)
+
+const (
+	batchEndpoint = "https://api.osv.dev/v1/querybatch"
+	vulnEndpoint  = "https://api.osv.dev/v1/vulns/"
+	userAgent     = "angela/0.1.0 (https://github.com/CarterPerez-dev/angela)"
+	maxHydrate    = 15
+)
+
+// Client queries the OSV.dev API for known vulnerabilities
+type Client struct {
+	http *http.Client
+}
+
+// NewClient creates an OSV client with sensible defaults
+func NewClient() *Client {
+	return &Client{
+		http: &http.Client{Timeout: 30 * time.Second},
+	}
+}
+
+// PackageQuery identifies a single package+version to check
+type PackageQuery struct {
+	Name    string
+	Version string
+}
+
+type batchRequest struct {
+	Queries []query `json:"queries"`
+}
+
+type query struct {
+	Package pkg    `json:"package"`
+	Version string `json:"version"`
+}
+
+type pkg struct {
+	Name      string `json:"name"`
+	Ecosystem string `json:"ecosystem"`
+}
+
+type batchResponse struct {
+	Results []batchResult `json:"results"`
+}
+
+type batchResult struct {
+	Vulns []vulnRef `json:"vulns"`
+}
+
+type vulnRef struct {
+	ID       string `json:"id"`
+	Modified string `json:"modified"`
+}
+
+type osvVuln struct {
+	ID               string         `json:"id"`
+	Summary          string         `json:"summary"`
+	Aliases          []string       `json:"aliases"`
+	Severity         []severity     `json:"severity"`
+	Affected         []affected     `json:"affected"`
+	References       []reference    `json:"references"`
+	DatabaseSpecific map[string]any `json:"database_specific"`
+}
+
+type severity struct {
+	Type  string `json:"type"`
+	Score string `json:"score"`
+}
+
+type affected struct {
+	Package pkg   `json:"package"`
+	Ranges  []rng `json:"ranges"`
+}
+
+type rng struct {
+	Type   string  `json:"type"`
+	Events []event `json:"events"`
+}
+
+type event struct {
+	Introduced string `json:"introduced,omitempty"`
+	Fixed      string `json:"fixed,omitempty"`
+}
+
+type reference struct {
+	Type string `json:"type"`
+	URL  string `json:"url"`
+}
+
+// ScanPackages checks a list of packages for known vulnerabilities and returns
+// per-package results with full vulnerability details. Duplicates caused by
+// overlapping CVE/GHSA identifiers are removed.
+func (c *Client) ScanPackages(
+	ctx context.Context,
+	packages []PackageQuery,
+) (map[string][]types.Vulnerability, error) {
+	if len(packages) == 0 {
+		return nil, nil
+	}
+
+	batch, err := c.queryBatch(ctx, packages)
+	if err != nil {
+		return nil, fmt.Errorf("osv batch query: %w", err)
+	}
+
+	allIDs := collectUniqueIDs(batch)
+	if len(allIDs) == 0 {
+		retur
```

---

## Code Evolution

### Change Analysis for `internal/osv/client.go`

**What was Changed:**
The commit introduces a new file, `client.go`, which implements an OSV (Open Source Vulnerability) client in Go. This client supports querying the OSV.dev API to identify known vulnerabilities for given package+version combinations.

**Why it was Likely Changed:**
This change likely aims to enhance the security features of the angela project by providing a robust and efficient way to check for vulnerabilities in open-source packages used within projects. The new implementation includes error handling, proper HTTP request construction, and JSON decoding, ensuring reliable interaction with the OSV API.

**Impact on Behavior:**
The `ScanPackages` function now allows querying multiple package+version pairs simultaneously using batch requests, which can significantly reduce the number of API calls needed. Additionally, it provides detailed vulnerability information for each package, making it easier to manage and mitigate identified risks.

**Risks or Concerns:**
- **Rate Limiting:** The client does not handle rate limiting from the OSV API, which could lead to API abuse if not managed properly.
- **Error Handling:** While error handling is present, more specific error types and logging might be beneficial for debugging and monitoring.
- **Concurrency:** Although goroutines are not explicitly used in this code, future enhancements might involve concurrent requests to improve performance.

Overall, this change significantly improves the security features of the project by providing a comprehensive vulnerability scanning mechanism.

---

*Generated by CodeWorm on 2026-02-23 13:42*
