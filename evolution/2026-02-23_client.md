# client

**Type:** Code Evolution
**Repository:** docksec
**File:** internal/docker/client.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: 5a7c48c4
Message: Initial release
Author: CarterPerez-dev
File: internal/docker/client.go
Change type: new file

Diff:
@@ -0,0 +1,169 @@
+/*
+CarterPerez-dev | 2025
+client.go
+*/
+
+package docker
+
+import (
+	"context"
+	"fmt"
+	"sync"
+
+	"github.com/CarterPerez-dev/docksec/internal/config"
+	"github.com/docker/docker/api/types"
+	"github.com/docker/docker/api/types/container"
+	"github.com/docker/docker/api/types/image"
+	"github.com/docker/docker/api/types/system"
+	"github.com/docker/docker/client"
+)
+
+// Client wraps the Docker SDK client providing timeout aware operations
+type Client struct {
+	api *client.Client
+}
+
+var (
+	instance *Client
+	once     sync.Once
+	initErr  error
+)
+
+func NewClient() (*Client, error) {
+	once.Do(func() {
+		cli, err := client.NewClientWithOpts(
+			client.FromEnv,
+			client.WithAPIVersionNegotiation(),
+		)
+		if err != nil {
+			initErr = fmt.Errorf("creating docker client: %w", err)
+			return
+		}
+		instance = &Client{api: cli}
+	})
+
+	if initErr != nil {
+		return nil, initErr
+	}
+	return instance, nil
+}
+
+func (c *Client) Close() error {
+	if c.api != nil {
+		return c.api.Close()
+	}
+	return nil
+}
+
+func (c *Client) Ping(ctx context.Context) error {
+	pingCtx, cancel := context.WithTimeout(ctx, config.ConnectionTimeout)
+	defer cancel()
+
+	_, err := c.api.Ping(pingCtx)
+	if err != nil {
+		return fmt.Errorf("pinging docker daemon: %w", err)
+	}
+	return nil
+}
+
+func (c *Client) Info(ctx context.Context) (system.Info, error) {
+	infoCtx, cancel := context.WithTimeout(ctx, config.DefaultTimeout)
+	defer cancel()
+
+	info, err := c.api.Info(infoCtx)
+	if err != nil {
+		return system.Info{}, fmt.Errorf("getting docker info: %w", err)
+	}
+	return info, nil
+}
+
+// ServerVersion retrieves Docker daemon version details.
+func (c *Client) ServerVersion(ctx context.Context) (types.Version, error) {
+	versionCtx, cancel := context.WithTimeout(ctx, config.ConnectionTimeout)
+	defer cancel()
+
+	version, err := c.api.ServerVersion(versionCtx)
+	if err != nil {
+		return types.Version{}, fmt.Errorf("getting docker version: %w", err)
+	}
+	return version, nil
+}
+
+func (c *Client) ListContainers(
+	ctx context.Context,
+	all bool,
+) ([]types.Container, error) {
+	listCtx, cancel := context.WithTimeout(ctx, config.DefaultTimeout)
+	defer cancel()
+
+	containers, err := c.api.ContainerList(
+		listCtx,
+		container.ListOptions{All: all},
+	)
+	if err != nil {
+		return nil, fmt.Errorf("listing containers: %w", err)
+	}
+	return containers, nil
+}
+
+func (c *Client) InspectContainer(
+	ctx context.Context,
+	containerID string,
+) (types.ContainerJSON, error) {
+	inspectCtx, cancel := context.WithTimeout(ctx, config.InspectTimeout)
+	defer cancel()
+
+	info, err := c.api.ContainerInspect(inspectCtx, containerID)
+	if err != nil {
+		return types.ContainerJSON{}, fmt.Errorf(
+			"inspecting container %s: %w",
+			containerID,
+			err,
+		)
+	}
+	return info, nil
+}
+
+// ListImages re
```

---

## Code Evolution

### Change Analysis for `internal/docker/client.go`

**What was Changed:**
The file `client.go` introduces a new Go package named `docker`, which encapsulates the Docker SDK client in a `Client` struct. The code includes methods to interact with Docker, such as creating and closing the client, pinging the daemon, inspecting containers and images, listing containers and images, and retrieving server version details.

**Why it was Likely Changed:**
This change likely aims to provide a more structured and context-aware interface for interacting with the Docker API. By wrapping the Docker SDK client in a `Client` struct, the code ensures that operations are performed within appropriate timeouts and contexts, improving reliability and error handling.

**Impact on Behavior:**
The new methods like `Ping`, `Info`, `ServerVersion`, etc., now handle context timeouts explicitly, making them more robust. This change also introduces proper resource management by closing the client correctly in the `Close` method.

**Risks or Concerns:**
- The use of a single global instance (`instance`) might introduce concurrency issues if not managed properly.
- The error handling could be improved; for example, returning specific errors instead of generic ones would provide more context during debugging.
- The default timeouts and inspect timeout should be configurable via the `config` package to allow customization.

Overall, this change enhances the reliability and maintainability of Docker interactions within the `docksec` repository.

---

*Generated by CodeWorm on 2026-02-23 15:40*
