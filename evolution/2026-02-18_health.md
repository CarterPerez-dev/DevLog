# health

**Type:** Code Evolution
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/advanced/ai-threat-detection/backend/app/api/health.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: 3fd9f773
Message: checkpoint - phase 13 complete
Author: CarterPerez-dev
File: PROJECTS/advanced/ai-threat-detection/backend/app/api/health.py
Change type: new file

Diff:
@@ -0,0 +1,72 @@
+"""
+©AngelaMos | 2026
+health.py
+"""
+
+import time
+
+from fastapi import APIRouter, Request, Response
+
+from app.core.redis_manager import redis_manager
+
+router = APIRouter()
+
+
+@router.get("/health")
+async def health(request: Request) -> dict:
+    """
+    Liveness probe — returns 200 if the process is alive.
+    """
+    uptime = time.monotonic() - request.app.state.startup_time
+    return {
+        "status": "healthy",
+        "uptime_seconds": round(uptime, 2),
+        "pipeline_running": request.app.state.pipeline_running,
+    }
+
+
+@router.get("/ready")
+async def ready(request: Request, response: Response) -> dict:
+    """
+    Readiness probe — checks all service dependencies.
+    """
+    redis_ok = await _check_redis()
+    database_ok = await _check_database(request)
+
+    checks = {
+        "database": "ok" if database_ok else "error",
+        "redis": "ok" if redis_ok else "error",
+        "models_loaded": getattr(request.app.state, "models_loaded", False),
+    }
+
+    all_ok = database_ok and redis_ok
+
+    if not all_ok:
+        response.status_code = 503
+
+    return {
+        "status": "ready" if all_ok else "not_ready",
+        "checks": checks,
+    }
+
+
+async def _check_redis() -> bool:
+    """
+    Ping Redis and return connectivity status.
+    """
+    return await redis_manager.ping()
+
+
+async def _check_database(request: Request) -> bool:
+    """
+    Verify database engine is connected and responsive.
+    """
+    engine = getattr(request.app.state, "db_engine", None)
+    if engine is None:
+        return False
+    try:
+        async with engine.connect() as conn:
+            await conn.execute("SELECT 1")
+        return True
+    except Exception:
+        return False

```

---

## Code Evolution

### Change Analysis for `health.py`

**What was Changed:**
A new file, `health.py`, was added to the project. It introduces two API endpoints (`/health` and `/ready`) using FastAPI. The `/health` endpoint returns a simple status indicating if the process is alive, while the `/ready` endpoint checks service dependencies like Redis and database connectivity.

**Why it Was Likely Changed:**
This change likely aims to implement liveness and readiness probes essential for Kubernetes deployments or other container orchestration systems. These probes help in monitoring application health and ensuring that services are properly initialized before handling requests.

**Impact on Behavior:**
- **Liveness Probe:** `/health` returns a 200 status indicating the process is alive, which is useful for liveness checks.
- **Readiness Probe:** `/ready` provides detailed information about service dependencies. It sets an HTTP 503 status if any dependency fails, ensuring that only fully functional services handle requests.

**Risks or Concerns:**
- The `_check_database` function assumes the database engine is available in `request.app.state`, which might not always be the case.
- Error handling could be improved to provide more detailed feedback on failures.
- Ensuring these endpoints do not introduce significant latency during high traffic periods should be considered.

This change enhances the project's monitoring capabilities and aligns with best practices for robust service management.

---

*Generated by CodeWorm on 2026-02-18 10:41*
