# json

**Type:** Code Evolution
**Repository:** docksec
**File:** internal/report/json.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: 5a7c48c4
Message: Initial release
Author: CarterPerez-dev
File: internal/report/json.go
Change type: new file

Diff:
@@ -0,0 +1,146 @@
+/*
+AngelaMos | 2025
+json.go
+*/
+
+package report
+
+import (
+	"encoding/json"
+	"io"
+	"time"
+
+	"github.com/CarterPerez-dev/docksec/internal/finding"
+)
+
+type JSONReporter struct {
+	w      io.Writer
+	closer func() error
+}
+
+type jsonReport struct {
+	Version   string        `json:"version"`
+	Timestamp string        `json:"timestamp"`
+	Summary   jsonSummary   `json:"summary"`
+	Findings  []jsonFinding `json:"findings"`
+}
+
+type jsonSummary struct {
+	Total      int            `json:"total"`
+	BySeverity map[string]int `json:"by_severity"`
+}
+
+type jsonFinding struct {
+	ID          string        `json:"id"`
+	RuleID      string        `json:"rule_id"`
+	Title       string        `json:"title"`
+	Description string        `json:"description,omitempty"`
+	Severity    string        `json:"severity"`
+	Category    string        `json:"category,omitempty"`
+	Target      jsonTarget    `json:"target"`
+	Location    *jsonLocation `json:"location,omitempty"`
+	Remediation string        `json:"remediation,omitempty"`
+	References  []string      `json:"references,omitempty"`
+	CISControl  *jsonCIS      `json:"cis_control,omitempty"`
+	Timestamp   string        `json:"timestamp"`
+}
+
+type jsonTarget struct {
+	Type string `json:"type"`
+	Name string `json:"name"`
+	ID   string `json:"id,omitempty"`
+}
+
+type jsonLocation struct {
+	Path   string `json:"path"`
+	Line   int    `json:"line,omitempty"`
+	Column int    `json:"column,omitempty"`
+}
+
+type jsonCIS struct {
+	ID          string `json:"id"`
+	Section     string `json:"section,omitempty"`
+	Title       string `json:"title"`
+	Description string `json:"description,omitempty"`
+	Scored      bool   `json:"scored"`
+	Level       int    `json:"level"`
+}
+
+func (r *JSONReporter) Report(findings finding.Collection) error {
+	defer func() {
+		if r.closer != nil {
+			_ = r.closer()
+		}
+	}()
+
+	report := r.buildReport(findings)
+
+	enc := json.NewEncoder(r.w)
+	enc.SetIndent("", "  ")
+	enc.SetEscapeHTML(false)
+
+	return enc.Encode(report)
+}
+
+func (r *JSONReporter) buildReport(findings finding.Collection) jsonReport {
+	counts := findings.CountBySeverity()
+	bySeverity := make(map[string]int)
+	for sev, count := range counts {
+		bySeverity[sev.String()] = count
+	}
+
+	jsonFindings := make([]jsonFinding, 0, len(findings))
+	for _, f := range findings {
+		jsonFindings = append(jsonFindings, r.convertFinding(f))
+	}
+
+	return jsonReport{
+		Version:   "1.0.0",
+		Timestamp: time.Now().UTC().Format(time.RFC3339),
+		Summary: jsonSummary{
+			Total:      len(findings),
+			BySeverity: bySeverity,
+		},
+		Findings: jsonFindings,
+	}
+}
+
+func (r *JSONReporter) convertFinding(f *finding.Finding) jsonFinding {
+	jf := jsonFinding{
+		ID:          f.ID,
+		RuleID:      f.RuleID,
+		Title:       f.Title,
+		Description: f.Description,
+		Seve
```

---

## Code Evolution

### Change Analysis for `internal/report/json.go`

**What was Changed:**
The commit introduces a new file, `json.go`, which defines a JSON reporter for generating security findings reports. This includes struct definitions for report components like `jsonReport`, `jsonSummary`, and `jsonFinding`. The `JSONReporter` type handles encoding these structures into JSON format using the `encoding/json` package.

**Why it was Likely Changed:**
This change likely aims to standardize the output of security findings in a machine-readable JSON format, facilitating easier integration with other tools or systems. It also provides a structured way to represent complex data like findings and their metadata.

**Impact on Behavior:**
The new `JSONReporter` can now be used to generate detailed reports from `finding.Collection`. This impacts how results are exported, making it more suitable for automated processes or further analysis downstream.

**Risks or Concerns:**
- **Error Handling:** The `Report` method does not explicitly handle errors that might occur during encoding. Adding robust error handling could improve reliability.
- **Resource Management:** The use of a deferred function to close the writer (`r.closer`) is good practice, but it assumes the caller provides a valid closer function. Ensuring this is always provided and properly implemented is crucial.

Overall, this change enhances the reporting capabilities by providing a structured JSON output format, which can be beneficial for integration with other systems or tools.

---

*Generated by CodeWorm on 2026-02-23 16:03*
