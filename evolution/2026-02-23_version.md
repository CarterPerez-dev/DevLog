# version

**Type:** Code Evolution
**Repository:** angela
**File:** internal/pypi/version.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: ea4cc501
Message: Create canonical module source location - release v1.0.0
Author: CarterPerez-dev
File: internal/pypi/version.go
Change type: new file

Diff:
@@ -0,0 +1,314 @@
+// Â©AngelaMos | 2026
+// version.go
+
+package pypi
+
+import (
+	"cmp"
+	"errors"
+	"fmt"
+	"math"
+	"regexp"
+	"strconv"
+	"strings"
+)
+
+// ErrInvalidVersion indicates a string that does not conform to PEP 440
+var ErrInvalidVersion = errors.New("invalid PEP 440 version")
+
+// ChangeKind classifies a version bump by semver magnitude
+type ChangeKind int
+
+// Version change magnitudes.
+const (
+	Patch ChangeKind = iota + 1
+	Minor
+	Major
+)
+
+// String returns the lowercase name of the change kind
+func (c ChangeKind) String() string {
+	switch c {
+	case Patch:
+		return "patch"
+	case Minor:
+		return "minor"
+	case Major:
+		return "major"
+	default:
+		return "unknown"
+	}
+}
+
+// Version represents a parsed PEP 440 version with all optional components
+type Version struct {
+	Raw     string
+	Epoch   int
+	Release []int
+	PreKind string
+	PreNum  int
+	Post    int
+	Dev     int
+	Local   string
+}
+
+var versionRe = regexp.MustCompile(
+	`(?i)^v?` +
+		`(?:(\d+)!)?` +
+		`(\d+(?:\.\d+)*)` +
+		`(?:[-_.]?(alpha|a|beta|b|preview|pre|c|rc)[-_.]?(\d*))?` +
+		`(?:[-_.]?(post|rev|r)[-_.]?(\d*)|-(\d+))?` +
+		`(?:[-_.]?(dev)[-_.]?(\d*))?` +
+		`(?:\+([a-z0-9](?:[a-z0-9._-]*[a-z0-9])?))?$`,
+)
+
+// ParseVersion parses a PEP 440 version string into its structured components
+func ParseVersion(s string) (Version, error) {
+	normalized := strings.ToLower(strings.TrimSpace(s))
+	m := versionRe.FindStringSubmatch(normalized)
+	if m == nil {
+		return Version{}, fmt.Errorf("%w: %q", ErrInvalidVersion, s)
+	}
+
+	v := Version{
+		Raw:  s,
+		Post: -1,
+		Dev:  -1,
+	}
+
+	if m[1] != "" {
+		v.Epoch = mustAtoi(m[1])
+	}
+
+	for _, seg := range strings.Split(m[2], ".") {
+		v.Release = append(v.Release, mustAtoi(seg))
+	}
+
+	if m[3] != "" {
+		v.PreKind = normalizePreKind(m[3])
+		v.PreNum = optionalAtoi(m[4])
+	}
+
+	switch {
+	case m[5] != "":
+		v.Post = optionalAtoi(m[6])
+	case m[7] != "":
+		v.Post = mustAtoi(m[7])
+	}
+
+	if m[8] != "" {
+		v.Dev = optionalAtoi(m[9])
+	}
+
+	v.Local = m[10]
+
+	return v, nil
+}
+
+// String returns the canonical PEP 440 representation
+func (v Version) String() string {
+	var b strings.Builder
+
+	if v.Epoch != 0 {
+		fmt.Fprintf(&b, "%d!", v.Epoch)
+	}
+
+	for i, n := range v.Release {
+		if i > 0 {
+			b.WriteByte('.')
+		}
+		fmt.Fprintf(&b, "%d", n)
+	}
+
+	if v.PreKind != "" {
+		fmt.Fprintf(&b, "%s%d", v.PreKind, v.PreNum)
+	}
+
+	if v.Post >= 0 {
+		fmt.Fprintf(&b, ".post%d", v.Post)
+	}
+
+	if v.Dev >= 0 {
+		fmt.Fprintf(&b, ".dev%d", v.Dev)
+	}
+
+	if v.Local != "" {
+		fmt.Fprintf(&b, "+%s", v.Local)
+	}
+
+	return b.String()
+}
+
+// IsStable reports whether the version is a stable (non-pre, non-dev) release
+func (v Version) IsStable() bool {
+	return v.PreKind == "" && v.Dev < 0
+}
+
+// Compare returns -1, 0, 
```

---

## Code Evolution

### Change Analysis for Commit ea4cc501

**What was Changed:**
The commit introduces a new file `version.go` in the `internal/pypi` package, defining a `Version` struct and associated methods to parse, compare, and classify PEP 440 version strings. The code also includes utility functions for comparing release segments and finding the latest stable version.

**Why it was Likely Changed:**
This change likely aims to standardize how PEP 440 versions are handled within the repository. By implementing comprehensive parsing and comparison logic, the developers can ensure consistent version handling across the project, which is crucial for package management and dependency resolution.

**Impact on Behavior:**
The new `Version` struct and related functions provide a robust way to manage version strings according to PEP 440 rules. This impacts how versions are parsed, compared, and classified, ensuring that semantic versioning is correctly applied. The introduction of methods like `ParseVersion`, `Compare`, and `ClassifyChange` enhances the reliability of version management.

**Risks or Concerns:**
While the new code is comprehensive, there could be risks if existing version strings do not conform to PEP 440 standards. Additionally, the complexity might introduce subtle bugs if not thoroughly tested against edge cases. Ensuring that all version strings are properly formatted and that tests cover a wide range of scenarios will mitigate these risks.

---

*Generated by CodeWorm on 2026-02-23 14:08*
