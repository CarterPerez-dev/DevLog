# _publish_file_progress

**Type:** Code Evolution
**Repository:** vuemantics
**File:** backend/workers/batch_helpers/_publish_file_progress.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: 4d33b24a
Message: feat: dramatiq - bulkupload
Author: CarterPerez-dev
File: backend/workers/batch_helpers/_publish_file_progress.py
Change type: new file

Diff:
@@ -0,0 +1,57 @@
+"""
+â’¸AngelaMos | 2026
+_publish_file_progress.py
+
+Publish per-file progress updates via WebSocket
+"""
+
+import logging
+
+from core.websocket import (
+    get_publisher,
+    FileProgressUpdate,
+    FileProgressPayload,
+)
+from models.Upload import Upload
+from models.UploadBatch import UploadBatch
+
+
+logger = logging.getLogger(__name__)
+
+
+async def publish_file_progress(
+    batch: UploadBatch,
+    upload: Upload,
+    status: str,
+    progress: int = 0,
+) -> None:
+    """
+    Publish per-file progress update via WebSocket
+
+    Args:
+        batch: UploadBatch instance
+        upload: Upload instance
+        status: File processing status (processing/completed/failed)
+        progress: Progress percentage (0-100)
+    """
+    try:
+        publisher = get_publisher()
+
+        await publisher.publish_to_user(
+            str(batch.user_id),
+            FileProgressUpdate(
+                payload = FileProgressPayload(
+                    batch_id = str(batch.id),
+                    upload_id = str(upload.id),
+                    file_name = upload.filename,
+                    file_size = upload.file_size or 0,
+                    progress_percentage = progress,
+                    status = status,
+                )
+            ),
+        )
+    except Exception as e:
+        # Don't fail batch processing if WebSocket broadcast fails
+        logger.warning(
+            f"Failed to publish file progress for {upload.id}: {e}"
+        )

```

---

## Code Evolution

### Change Analysis

**What was Changed:**
A new file `_publish_file_progress.py` was added to the `backend/workers/batch_helpers` directory. This file introduces an asynchronous function `publish_file_progress` that publishes per-file progress updates via WebSocket.

**Why it was Likely Changed:**
This change likely aims to provide real-time feedback on the processing status of individual files within a batch upload, enhancing user experience by keeping them informed about the progress of their uploads.

**Impact on Behavior:**
The function `publish_file_progress` will now be called whenever there is an update in file processing status. This ensures that users receive timely notifications via WebSocket, reflecting the current state of each file being processed.

**Risks or Concerns:**
- **Error Handling:** The exception handling is minimal, logging only the failure without re-raising or retrying the operation. This could lead to silent failures if not properly managed.
- **Performance Impact:** Frequent WebSocket messages might impact server performance, especially for large batches with many files.
- **WebSocket Availability:** Reliance on WebSocket for critical operations may introduce availability risks; ensuring robust fallback mechanisms is important.

Overall, this change enhances real-time communication but requires careful monitoring and additional error handling to ensure reliability.

---

*Generated by CodeWorm on 2026-02-23 10:02*
