# main

**Type:** Code Evolution
**Repository:** docksec
**File:** cmd/docksec/main.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: 5a7c48c4
Message: Initial release
Author: CarterPerez-dev
File: cmd/docksec/main.go
Change type: new file

Diff:
@@ -0,0 +1,265 @@
+/*
+AngelaMos | 2025
+main.go
+*/
+
+package main
+
+import (
+	"context"
+	"fmt"
+	"os"
+	"os/signal"
+	"sort"
+	"syscall"
+
+	"github.com/CarterPerez-dev/docksec/internal/benchmark"
+	"github.com/CarterPerez-dev/docksec/internal/config"
+	"github.com/CarterPerez-dev/docksec/internal/scanner"
+	"github.com/spf13/cobra"
+)
+
+var (
+	version   = "dev"
+	commit    = "none"
+	buildDate = "unknown"
+)
+
+func main() {
+	os.Exit(run())
+}
+
+func run() int {
+	ctx, cancel := signal.NotifyContext(
+		context.Background(),
+		syscall.SIGINT,
+		syscall.SIGTERM,
+	)
+	defer cancel()
+
+	if err := newRootCmd().ExecuteContext(ctx); err != nil {
+		fmt.Fprintf(os.Stderr, "Error: %v\n", err)
+		return 1
+	}
+	return 0
+}
+
+func newRootCmd() *cobra.Command {
+	cfg := config.New()
+
+	root := &cobra.Command{
+		Use:   "docksec",
+		Short: "Docker security audit tool",
+		Long: `docksec scans Docker environments for security misconfigurations,
+validates against CIS Docker Benchmark controls, and generates
+actionable remediation reports.`,
+		SilenceUsage:  true,
+		SilenceErrors: true,
+	}
+
+	root.AddCommand(
+		newScanCmd(cfg),
+		newVersionCmd(),
+		newBenchmarkCmd(),
+	)
+
+	return root
+}
+
+func newScanCmd(cfg *config.Config) *cobra.Command {
+	cmd := &cobra.Command{
+		Use:   "scan",
+		Short: "Scan Docker environment for security issues",
+		Long: `Scan running containers, images, Dockerfiles, and docker-compose files
+for security misconfigurations and CIS Docker Benchmark violations.`,
+		RunE: func(cmd *cobra.Command, args []string) error {
+			return runScan(cmd.Context(), cfg)
+		},
+	}
+
+	flags := cmd.Flags()
+
+	flags.StringSliceVarP(&cfg.Targets, "target", "t", []string{"all"},
+		"Scan targets: all, containers, daemon, images")
+
+	flags.StringSliceVarP(&cfg.Files, "file", "f", nil,
+		"Dockerfile or docker-compose.yml files to scan")
+
+	flags.StringVarP(&cfg.Output, "output", "o", "terminal",
+		"Output format: terminal, json, sarif, junit")
+
+	flags.StringVar(&cfg.OutputFile, "output-file", "",
+		"Write output to file instead of stdout")
+
+	flags.StringSliceVar(&cfg.Severity, "severity", nil,
+		"Filter by severity: info, low, medium, high, critical")
+
+	flags.StringSliceVar(&cfg.CISControls, "cis", nil,
+		"Filter by specific CIS control IDs (e.g., 5.4,5.31)")
+
+	flags.StringSliceVar(&cfg.ExcludeContainers, "exclude-container", nil,
+		"Exclude containers by name pattern")
+
+	flags.StringSliceVar(&cfg.IncludeContainers, "include-container", nil,
+		"Include only containers matching name pattern")
+
+	flags.StringVar(
+		&cfg.FailOn,
+		"fail-on",
+		"",
+		"Exit with code 1 if findings at or above severity: low, medium, high, critical",
+	)
+
+	flags.BoolVarP(&cfg.Quiet, "quiet", "q", false,
+		"Minimal output (counts only)")
+
+	flags.BoolVarP(&cfg.Verbose, "verbose", "v", false,
+		"Verbose
```

---

## Code Evolution

### Change Analysis for Commit 5a7c48c4

**What was Changed:**
The commit introduces the initial implementation of `docksec`, a Docker security audit tool. The main file, `main.go`, sets up the command-line interface (CLI) using Cobra and defines commands for scanning Docker environments (`scan`), printing version information (`version`), and listing or showing details from the CIS Docker Benchmark (`benchmark`).

**Why it was Likely Changed:**
This change likely represents the initial setup of the CLI tool, focusing on providing a user-friendly interface to interact with `docksec`. The use of Cobra for command-line parsing is common in Go applications due to its robust and flexible nature.

**Impact on Behavior:**
The introduction of these commands enables users to perform security scans, view version information, and access CIS Docker Benchmark details. This provides essential functionality for auditing Docker environments for security misconfigurations.

**Risks or Concerns:**
- **Error Handling:** While the code includes error handling in some places (e.g., `runScan`), it may be insufficient in others.
- **Configuration Management:** The configuration management using `config.New()` is basic and might need more robust validation and defaults.
- **Resource Management:** Proper resource cleanup should be ensured, especially when dealing with concurrent workers.

Overall, this initial release sets a solid foundation for further development.

---

*Generated by CodeWorm on 2026-02-23 15:13*
