# daemon

**Type:** Code Evolution
**Repository:** CodeWorm
**File:** codeworm/daemon.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: ca3ce30d
Message: v1.0.2: add doc type system, Docker infrastructure, and web dashboard

- Add 11 documentation types (function, class, file, security review, TIL, etc.)
  with weighted random selection so the same codebase generates 10x more unique content
- Add Docker Compose for Ollama (GPU passthrough) + Redis + Dashboard + Nginx
- Add FastAPI backend with REST API, WebSocket live events, and Redis pub/sub
- Add React dashboard with stats, live log, commit feed, repo list, and worm viz
- Add next_scheduled_run logging after each cycle completes
- Update repos config and README for v1.0.2
Author: CarterPerez-dev
File: codeworm/daemon.py
Change type: modified

Diff:
@@ -15,7 +15,9 @@ from typing import TYPE_CHECKING
 from codeworm.analysis import (
     CodeAnalyzer,
     ParserManager,
+    TargetRouter,
 )
+from codeworm.analysis.targets import DocumentationTarget, select_doc_type
 from codeworm.core import (
     CodeWormSettings,
     StateManager,
@@ -23,12 +25,14 @@ from codeworm.core import (
     get_logger,
     load_settings,
 )
+from codeworm.core.events import get_publisher
 from codeworm.git import DevLogRepository
 from codeworm.llm import (
     DocumentationGenerator,
     OllamaClient,
     OllamaError,
 )
+from codeworm.models import DocType
 from codeworm.scheduler import CodeWormScheduler
 
 if TYPE_CHECKING:
@@ -49,7 +53,7 @@ class CycleStats:
     last_success: datetime | None = None
     last_failure: datetime | None = None
     last_failure_reason: str = ""
-    repos_exhausted: set = field(default_factory=set)
+    repos_exhausted: set = field(default_factory = set)
 
     @property
     def success_rate(self) -> float:
@@ -89,22 +93,30 @@ class CycleStats:
     def get_backoff_seconds(self) -> int:
         if self.consecutive_failures <= 1:
             return 0
-        return min(300, 30 * (2 ** (self.consecutive_failures - 1)))
+        return min(300, 30 * (2**(self.consecutive_failures - 1)))
 
     def get_ollama_wait_seconds(self) -> int:
         if self.consecutive_ollama_failures <= 1:
             return 10
-        return min(300, 10 * (2 ** (self.consecutive_ollama_failures - 1)))
+        return min(300, 10 * (2**(self.consecutive_ollama_failures - 1)))
 
     def to_dict(self) -> dict:
         return {
-            "total_cycles": self.total_cycles,
-            "successful_cycles": self.successful_cycles,
-            "failed_cycles": self.failed_cycles,
-            "skipped_cycles": self.skipped_cycles,
-            "success_rate": round(self.success_rate, 1),
-            "consecutive_failures": self.consecutive_failures,
-            "last_success": self.last_success.isoformat() if self.last_success else None,
+            "total_cycles":
+            self.total_cycles,
+            "successful_cycles":
+            self.successful_cycles,
+            "failed_cycles":
+            self.failed_cycles,
+            "skipped_cycles":
+            self.skipped_cycles,
+            "success_ra
```

---

## Code Evolution

### Change Analysis

**What was Changed:**
The code changes in `daemon.py` primarily involve the addition of new imports and minor refactoring. Specifically, the file now includes imports for `TargetRouter`, `DocumentationTarget`, `select_doc_type`, `DocType`, and updates to class methods.

**Why it was Likely Changed:**
This change likely supports the implementation of a more sophisticated documentation system as part of v1.0.2. The addition of `TargetRouter` suggests a new mechanism for routing or selecting targets, possibly related to the weighted random selection of documentation types mentioned in the commit message. The update to class methods ensures that these changes integrate seamlessly with existing functionality.

**Impact on Behavior:**
The impact is primarily internal and focuses on enhancing the documentation generation process. The `select_doc_type` function will now be used to generate more diverse and unique content, which could improve the quality of generated documentation. This change does not directly affect external behavior but significantly enhances the internal logic for handling documentation.

**Risks or Concerns:**
There is a minor risk that the new imports might introduce compatibility issues if they are not fully backward-compatible with existing code. Additionally, the refactoring of `CycleStats` and `CodeWormDaemon` methods could potentially break existing tests or usage patterns if not thoroughly tested.

---

*Generated by CodeWorm on 2026-02-23 21:36*
