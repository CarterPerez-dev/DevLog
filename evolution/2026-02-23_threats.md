# threats

**Type:** Code Evolution
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/advanced/ai-threat-detection/backend/app/api/threats.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: 7f35fbd8
Message: feat: complete Phase 1 — rule-based detection pipeline, API, Docker E2E

Phase 1 delivers end-to-end threat detection from nginx log ingestion
through rule-based scoring to REST API and WebSocket alerts.

- API layer: /threats, /stats, /models/status, /ws/alerts, /health, /ready
- Alert dispatcher with Redis pub/sub + PostgreSQL persistence
- Typer CLI: vigil serve, config, health
- Integration tests (tailer -> pipeline -> DB round-trip)
- Docker E2E verified: dev.compose.yml stack with all services healthy
- Linting clean: ruff, mypy strict (0 issues), pylint 10/10
- 75 tests passing across 8 test modules
Author: CarterPerez-dev
File: PROJECTS/advanced/ai-threat-detection/backend/app/api/threats.py
Change type: new file

Diff:
@@ -0,0 +1,54 @@
+"""
+©AngelaMos | 2026
+threats.py
+"""
+
+import uuid
+from datetime import datetime
+
+from fastapi import APIRouter, Depends, HTTPException, Query
+from sqlalchemy.ext.asyncio import AsyncSession
+
+from app.api.deps import get_session
+from app.schemas.threats import ThreatEventResponse, ThreatListResponse
+from app.services import threat_service
+
+router = APIRouter(prefix="/threats", tags=["threats"])
+
+
+@router.get("", response_model=ThreatListResponse)
+async def list_threats(
+    session: AsyncSession = Depends(get_session),
+    limit: int = Query(50, ge=1, le=100),
+    offset: int = Query(0, ge=0),
+    severity: str | None = Query(None),
+    source_ip: str | None = Query(None),
+    since: datetime | None = Query(None),
+    until: datetime | None = Query(None),
+) -> ThreatListResponse:
+    """
+    List threat events with optional filters and pagination.
+    """
+    return await threat_service.get_threats(
+        session,
+        limit,
+        offset,
+        severity,
+        source_ip,
+        since,
+        until,
+    )
+
+
+@router.get("/{threat_id}", response_model=ThreatEventResponse)
+async def get_threat(
+    threat_id: uuid.UUID,
+    session: AsyncSession = Depends(get_session),
+) -> ThreatEventResponse:
+    """
+    Fetch a single threat event by ID.
+    """
+    result = await threat_service.get_threat_by_id(session, threat_id)
+    if result is None:
+        raise HTTPException(status_code=404, detail="Threat event not found")
+    return result

```

---

## Code Evolution

### Change Analysis for `threats.py`

**What was Changed:**
A new file, `threats.py`, was added to the project. This file introduces two FastAPI endpoints:
1. A GET endpoint at `/threats` that lists threat events with optional filters and pagination.
2. A GET endpoint at `/threats/{threat_id}` that fetches a single threat event by ID.

**Why it Was Likely Changed:**
This change was likely made to provide an API for querying threat events, which is essential for monitoring and analyzing detected threats. The inclusion of query parameters allows for flexible filtering based on severity, source IP, time range, etc., making the API more versatile and user-friendly.

**Impact on Behavior:**
The addition of these endpoints enables users to programmatically retrieve threat data from the backend system. This is crucial for integrating with other security tools or for manual inspection of detected threats. The use of FastAPI ensures a modern, asynchronous approach that scales well with increasing traffic.

**Risks or Concerns:**
- **Security**: Ensure proper validation and sanitization of query parameters to prevent injection attacks.
- **Performance**: With the ability to filter and paginate results, performance could be impacted if not optimized. Consider indexing relevant fields in the database.
- **Maintenance**: Adding more endpoints may increase maintenance overhead. Regularly review and optimize these endpoints as the project evolves.

Overall, this change significantly enhances the backend's functionality by providing a robust API for threat event management.

---

*Generated by CodeWorm on 2026-02-23 07:02*
