# env

**Type:** Code Evolution
**Repository:** stripe-referral
**File:** alembic/env.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: bfb52633
Message: feat: Done
Author: CarterPerez-dev
File: alembic/env.py
Change type: new file

Diff:
@@ -0,0 +1,71 @@
+"""
+â’¸AngelaMos | 2025 | CertGames.com
+"""
+
+from sqlalchemy import (
+    pool,
+    engine_from_config,
+)
+from alembic import context
+from logging.config import fileConfig
+
+from src.stripe_referral.database.Base import Base
+from src.stripe_referral.models.Payout import Payout
+from src.stripe_referral.config.settings import settings
+from src.stripe_referral.models.ReferralCode import ReferralCode
+from src.stripe_referral.models.ReferralProgram import ReferralProgram
+from src.stripe_referral.models.ReferralTracking import ReferralTracking
+
+config = context.config
+
+if config.config_file_name is not None:
+    fileConfig(config.config_file_name)
+
+config.set_main_option("sqlalchemy.url", settings.database_url)
+
+target_metadata = Base.metadata
+
+# other values from the config, defined by the needs of env.py,
+# can be acquired:
+# my_important_option = config.get_main_option("my_important_option")
+# ... etc.
+
+def run_migrations_offline() -> None:
+    """
+    Run migrations in 'offline' mode
+    """
+    url = config.get_main_option("sqlalchemy.url")
+    context.configure(
+        url=url,
+        target_metadata=target_metadata,
+        literal_binds=True,
+        dialect_opts={"paramstyle": "named"},
+    )
+
+    with context.begin_transaction():
+        context.run_migrations()
+
+
+def run_migrations_online() -> None:
+    """
+    Run migrations in 'online' mode
+    """
+    connectable = engine_from_config(
+        config.get_section(config.config_ini_section, {}),
+        prefix="sqlalchemy.",
+        poolclass=pool.NullPool,
+    )
+
+    with connectable.connect() as connection:
+        context.configure(
+            connection=connection, target_metadata=target_metadata
+        )
+
+        with context.begin_transaction():
+            context.run_migrations()
+
+
+if context.is_offline_mode():
+    run_migrations_offline()
+else:
+    run_migrations_online()

```

---

## Code Evolution

### Change Analysis

**What was Changed:**
A new file `alembic/env.py` has been added to the repository, containing configuration and migration scripts for database schema changes using Alembic.

- **Lines 1-71**: Added a Python script defining offline and online migration functions.
- **Key Functions**: 
  - `run_migrations_offline()`: Configures and runs migrations in an offline mode.
  - `run_migrations_online()`: Configures and runs migrations in an online mode.

**Why it was Likely Changed:**
This change likely introduces a new Alembic environment for managing database schema migrations. The addition of these functions allows for both offline testing and online deployment of database changes, ensuring that the application can be updated without downtime during critical operations.

**Impact on Behavior:**
- **Behavioral Impact**: This script will now handle all database migration needs, making it easier to manage schema updates.
- **API Impact**: No new public API is exposed; this change is internal to the project's migration management.

**Risks or Concerns:**
- **Risk of Configuration Errors**: If `settings.database_url` is incorrectly configured, migrations may fail.
- **Potential Overhead**: Running migrations in online mode might introduce some overhead during application runtime. Ensure that this does not impact performance-critical operations.

This change appears to be a feature addition aimed at improving the project's database management capabilities.

---

*Generated by CodeWorm on 2026-02-23 01:31*
