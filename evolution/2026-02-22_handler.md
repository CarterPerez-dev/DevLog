# handler

**Type:** Code Evolution
**Repository:** fullstack-template
**File:** stacks/go-react/go-backend/internal/auth/handler.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: bf95949c
Message: go backend to react-go stack
Author: CarterPerez-dev
File: stacks/go-react/go-backend/internal/auth/handler.go
Change type: new file

Diff:
@@ -0,0 +1,316 @@
+// AngelaMos | 2026
+// handler.go
+
+package auth
+
+import (
+	"encoding/json"
+	"errors"
+	"net"
+	"net/http"
+	"strings"
+
+	"github.com/go-chi/chi/v5"
+	"github.com/go-playground/validator/v10"
+
+	"github.com/carterperez-dev/templates/go-backend/internal/core"
+	"github.com/carterperez-dev/templates/go-backend/internal/middleware"
+)
+
+type Handler struct {
+	service   *Service
+	validator *validator.Validate
+}
+
+func NewHandler(service *Service) *Handler {
+	return &Handler{
+		service:   service,
+		validator: validator.New(validator.WithRequiredStructEnabled()),
+	}
+}
+
+func (h *Handler) RegisterRoutes(
+	r chi.Router,
+	authenticator func(http.Handler) http.Handler,
+) {
+	r.Route("/auth", func(r chi.Router) {
+		r.Post("/login", h.Login)
+		r.Post("/register", h.Register)
+		r.Post("/refresh", h.Refresh)
+
+		r.Group(func(r chi.Router) {
+			r.Use(authenticator)
+			r.Get("/me", h.GetMe)
+			r.Post("/logout", h.Logout)
+			r.Post("/logout-all", h.LogoutAll)
+			r.Get("/sessions", h.GetSessions)
+			r.Delete("/sessions/{sessionID}", h.RevokeSession)
+			r.Post("/change-password", h.ChangePassword)
+		})
+	})
+}
+
+func (h *Handler) Login(w http.ResponseWriter, r *http.Request) {
+	var req LoginRequest
+	if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
+		core.BadRequest(w, "invalid request body")
+		return
+	}
+
+	if err := h.validator.Struct(req); err != nil {
+		core.BadRequest(w, core.FormatValidationError(err))
+		return
+	}
+
+	userAgent := r.UserAgent()
+	ipAddress := extractIPAddress(r)
+
+	resp, err := h.service.Login(r.Context(), req, userAgent, ipAddress)
+	if err != nil {
+		if errors.Is(err, ErrInvalidCredentials) {
+			core.JSONError(
+				w,
+				core.UnauthorizedError("invalid email or password"),
+			)
+			return
+		}
+		core.InternalServerError(w, err)
+		return
+	}
+
+	core.OK(w, resp)
+}
+
+func (h *Handler) Register(w http.ResponseWriter, r *http.Request) {
+	var req RegisterRequest
+	if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
+		core.BadRequest(w, "invalid request body")
+		return
+	}
+
+	if err := h.validator.Struct(req); err != nil {
+		core.BadRequest(w, core.FormatValidationError(err))
+		return
+	}
+
+	userAgent := r.UserAgent()
+	ipAddress := extractIPAddress(r)
+
+	resp, err := h.service.Register(r.Context(), req, userAgent, ipAddress)
+	if err != nil {
+		if errors.Is(err, ErrEmailExists) {
+			core.JSONError(w, core.DuplicateError("email"))
+			return
+		}
+		core.InternalServerError(w, err)
+		return
+	}
+
+	core.Created(w, resp)
+}
+
+func (h *Handler) Refresh(w http.ResponseWriter, r *http.Request) {
+	var req RefreshRequest
+	if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
+		core.BadRequest(w, "invalid request body")
+		return
+	}
+
+	if err := h.validator.Struct(req); err 
```

---

## Code Evolution

### Change Analysis

**What was Changed:**
A new file `handler.go` was added to the Go backend stack, implementing authentication handlers for a React-Go application. The file contains methods like `Login`, `Register`, `Refresh`, and others that handle various user authentication tasks.

**Why it was Likely Changed:**
This change likely aims to provide a robust set of API endpoints for user authentication in a new fullstack project. By separating these handlers into their own package, the code becomes more modular and easier to maintain.

**Impact on Behavior:**
The introduction of these handlers will enable users to perform actions such as logging in, registering, refreshing tokens, and managing sessions. This enhances the application's security and functionality by providing a clear interface for authentication tasks.

**Risks or Concerns:**
- **Error Handling:** The use of custom error types like `core.ErrTokenRevoked` might lead to inconsistent error handling if not properly propagated.
- **Security:** Ensure that sensitive operations, such as token revocation, are handled securely and cannot be abused by unauthorized users.
- **Validation:** The validation logic is centralized in the handler methods but could benefit from additional checks or logging for debugging purposes.

Overall, this change significantly improves the application's authentication capabilities while maintaining a clean code structure.

---

*Generated by CodeWorm on 2026-02-22 13:42*
