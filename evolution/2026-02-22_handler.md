# handler

**Type:** Code Evolution
**Repository:** fullstack-template
**File:** stacks/go-react/go-backend/internal/admin/handler.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: bf95949c
Message: go backend to react-go stack
Author: CarterPerez-dev
File: stacks/go-react/go-backend/internal/admin/handler.go
Change type: new file

Diff:
@@ -0,0 +1,208 @@
+// AngelaMos | 2026
+// handler.go
+
+package admin
+
+import (
+	"context"
+	"database/sql"
+	"net/http"
+	"runtime"
+
+	"github.com/go-chi/chi/v5"
+	"github.com/redis/go-redis/v9"
+
+	"github.com/carterperez-dev/templates/go-backend/internal/core"
+)
+
+type AuthService interface {
+	InvalidateAllSessions(ctx context.Context) error
+}
+
+type Handler struct {
+	dbStats    func() sql.DBStats
+	redisStats func() *redis.PoolStats
+	redisPing  func(ctx context.Context) error
+	dbPing     func(ctx context.Context) error
+	authSvc    AuthService
+}
+
+type HandlerConfig struct {
+	DBStats    func() sql.DBStats
+	RedisStats func() *redis.PoolStats
+	RedisPing  func(ctx context.Context) error
+	DBPing     func(ctx context.Context) error
+	AuthSvc    AuthService
+}
+
+func NewHandler(cfg HandlerConfig) *Handler {
+	return &Handler{
+		dbStats:    cfg.DBStats,
+		redisStats: cfg.RedisStats,
+		redisPing:  cfg.RedisPing,
+		dbPing:     cfg.DBPing,
+		authSvc:    cfg.AuthSvc,
+	}
+}
+
+func (h *Handler) RegisterRoutes(
+	r chi.Router,
+	authenticator, adminOnly func(http.Handler) http.Handler,
+) {
+	r.Route("/admin", func(r chi.Router) {
+		r.Use(authenticator)
+		r.Use(adminOnly)
+
+		r.Get("/stats", h.GetSystemStats)
+		r.Get("/stats/db", h.GetDatabaseStats)
+		r.Get("/stats/redis", h.GetRedisStats)
+		r.Get("/stats/runtime", h.GetRuntimeStats)
+	})
+}
+
+func (h *Handler) GetSystemStats(w http.ResponseWriter, r *http.Request) {
+	ctx := r.Context()
+
+	dbHealthy := true
+	if h.dbPing != nil {
+		if err := h.dbPing(ctx); err != nil {
+			dbHealthy = false
+		}
+	}
+
+	redisHealthy := true
+	if h.redisPing != nil {
+		if err := h.redisPing(ctx); err != nil {
+			redisHealthy = false
+		}
+	}
+
+	var memStats runtime.MemStats
+	runtime.ReadMemStats(&memStats)
+
+	response := SystemStatsResponse{
+		Database: DatabaseStatus{
+			Healthy: dbHealthy,
+			Stats:   h.getDBStats(),
+		},
+		Redis: RedisStatus{
+			Healthy: redisHealthy,
+			Stats:   h.getRedisStats(),
+		},
+		Runtime: RuntimeStats{
+			GoVersion:    runtime.Version(),
+			NumGoroutine: runtime.NumGoroutine(),
+			NumCPU:       runtime.NumCPU(),
+			MemAlloc:     memStats.Alloc,
+			MemSys:       memStats.Sys,
+			NumGC:        memStats.NumGC,
+		},
+	}
+
+	core.OK(w, response)
+}
+
+func (h *Handler) GetDatabaseStats(w http.ResponseWriter, r *http.Request) {
+	core.OK(w, h.getDBStats())
+}
+
+func (h *Handler) GetRedisStats(w http.ResponseWriter, r *http.Request) {
+	core.OK(w, h.getRedisStats())
+}
+
+func (h *Handler) GetRuntimeStats(w http.ResponseWriter, r *http.Request) {
+	var memStats runtime.MemStats
+	runtime.ReadMemStats(&memStats)
+
+	response := RuntimeStats{
+		GoVersion:    runtime.Version(),
+		NumGoroutine: runtime.NumGoroutine(),
+		NumCPU:       runtime.NumCPU(),
+		MemAlloc:     memStats.Allo
```

---

## Code Evolution

### Change Analysis

**What was Changed:**
A new file `handler.go` was added to the Go backend of a fullstack project, implementing an admin handler for system and database statistics. The code defines interfaces, handlers, and configuration structs. It includes methods to handle HTTP requests related to system stats, database stats, Redis stats, and runtime stats.

**Why it was Likely Changed:**
This change likely aims to provide administrative endpoints for monitoring the health and performance of the backend services. By integrating with the database (`sql.DBStats`) and Redis (`redis.PoolStats`), it allows for real-time insights into system resources and connections. The use of `go-chi/chi/v5` for routing ensures a clean, modular structure.

**Impact on Behavior:**
The addition introduces new endpoints under `/admin`, such as `/stats`, `/stats/db`, `/stats/redis`, and `/stats/runtime`. These endpoints will return JSON responses with detailed statistics about the system's health and resource usage. This is beneficial for monitoring and debugging purposes.

**Risks or Concerns:**
- **Security Risks:** Exposing internal stats could potentially leak sensitive information.
- **Performance Impact:** Frequent database and Redis queries might impact performance if not optimized.
- **Error Handling:** Proper error handling should be ensured, especially when calling external services like `redis` and `db`.

Overall, this change enhances the backend's observability while introducing potential risks that need to be managed.

---

*Generated by CodeWorm on 2026-02-22 13:35*
