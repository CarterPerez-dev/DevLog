# wise

**Type:** Code Evolution
**Repository:** stripe-referral
**File:** src/stripe_referral/adapters/wise.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: bfb52633
Message: feat: Done
Author: CarterPerez-dev
File: src/stripe_referral/adapters/wise.py
Change type: new file

Diff:
@@ -0,0 +1,229 @@
+"""
+ⒸAngelaMos | 2025 | CertGames.com
+Wise API payout adapter
+"""
+
+import uuid
+from typing import (
+    Any,
+    cast,
+)
+
+import requests
+
+from ..config.enums import CurrencyCode
+from ..exceptions.errors import PayoutAdapterError
+from ..schemas.types import (
+    PayoutResult,
+    RecipientValidation,
+)
+from .base import PayoutAdapter
+
+
+class WiseAdapter(PayoutAdapter):
+    """
+    Payout adapter for Wise API automated transfers
+    """
+    def __init__(self, api_token: str, sandbox: bool = False) -> None:
+        """
+        Initialize with Wise API token
+
+        Args:
+            api_token: Wise API token
+            sandbox: Use sandbox environment if True
+        """
+        self.api_token = api_token
+        self.base_url = (
+            "https://api.sandbox.transferwise.tech"
+            if sandbox else "https://api.transferwise.com"
+        )
+        self.headers = {
+            "Authorization": f"Bearer {api_token}",
+            "Content-Type": "application/json",
+        }
+
+    def _make_request(self,
+                      method: str,
+                      endpoint: str,
+                      **kwargs: Any) -> dict[str,
+                                             Any]:
+        """
+        Make HTTP request to Wise API with error handling
+        """
+        url = f"{self.base_url}{endpoint}"
+
+        try:
+            response = requests.request(
+                method,
+                url,
+                headers = self.headers,
+                timeout = 30,
+                **kwargs
+            )
+            response.raise_for_status()
+            json_response: dict[str, Any] = response.json()
+            return json_response
+        except requests.exceptions.HTTPError as e:
+            raise PayoutAdapterError(
+                f"Wise API error: {e.response.text}",
+                adapter = "wise",
+                endpoint = endpoint,
+                status_code = e.response.status_code,
+            ) from e
+        except Exception as e:
+            raise PayoutAdapterError(
+                f"Wise request error: {str(e)}",
+                adapter = "wise",
+                endpoint = endpoint,
+            ) from e
+
+    def _get_profile_id(self) -> int:
+        """
+        Get first Wise profile ID
+        """
+        profiles = self._make_request("GET", "/v1/profiles")
+        profiles_list = cast(list[dict[str, Any]], profiles)
+        return cast(int, profiles_list[0]["id"])
+
+    def send_payout(
+        self,
+        user_id: str,
+        amount: float,
+        currency: str,
+        recipient_data: dict[str,
+                             Any],
+    ) -> PayoutResult:
+        """
+        Send payout via Wise API
+        """
+        try:
+            profile_id = self._get_profile_id()
+
```

---

## Code Evolution

### Change Analysis for Commit `bfb52633`

**What was Changed:**
A new file, `wise.py`, was added to the repository. This file introduces a `WiseAdapter` class that serves as an adapter for the Wise API to facilitate automated payouts.

**Why it was Likely Changed:**
This change likely aims to integrate support for the Wise payment gateway into the existing Stripe referral system. The addition of this adapter allows the system to handle payments via Wise, providing flexibility in payment processing options.

**Impact on Behavior:**
The `WiseAdapter` class provides methods to send payouts and validate recipients using the Wise API. This will enable the system to process payments through Wise, which can be particularly useful for international transactions or specific regions where Wise operates efficiently.

**Risks or Concerns:**
- **Error Handling:** The `_make_request` method includes robust error handling but could benefit from more detailed logging and clearer exception messages.
- **Security:** Storing the `api_token` in the code as a string constant might pose security risks. Consider using environment variables for sensitive information.
- **Dependence on External Services:** Reliance on Wise's API means that any downtime or changes to their service could impact the system’s functionality.

Overall, this change enhances the system's payment processing capabilities by adding support for Wise, but it also introduces dependencies and security considerations.

---

*Generated by CodeWorm on 2026-02-23 01:46*
