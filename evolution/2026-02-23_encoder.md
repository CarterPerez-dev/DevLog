# encoder

**Type:** Code Evolution
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/advanced/ai-threat-detection/backend/app/core/features/encoder.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: 7f35fbd8
Message: feat: complete Phase 1 â€” rule-based detection pipeline, API, Docker E2E

Phase 1 delivers end-to-end threat detection from nginx log ingestion
through rule-based scoring to REST API and WebSocket alerts.

- API layer: /threats, /stats, /models/status, /ws/alerts, /health, /ready
- Alert dispatcher with Redis pub/sub + PostgreSQL persistence
- Typer CLI: vigil serve, config, health
- Integration tests (tailer -> pipeline -> DB round-trip)
- Docker E2E verified: dev.compose.yml stack with all services healthy
- Linting clean: ruff, mypy strict (0 issues), pylint 10/10
- 75 tests passing across 8 test modules
Author: CarterPerez-dev
File: PROJECTS/advanced/ai-threat-detection/backend/app/core/features/encoder.py
Change type: modified

Diff:
@@ -34,9 +34,9 @@ def encode_for_inference(
         if name in BOOLEAN_FEATURES:
             vector.append(1.0 if raw else 0.0)
         elif name in CATEGORICAL_ENCODERS:
-            vector.append(float(CATEGORICAL_ENCODERS[name].get(raw, 0)))
+            vector.append(float(CATEGORICAL_ENCODERS[name].get(str(raw), 0)))
         elif name == "country_code":
-            vector.append(_encode_country(raw))
+            vector.append(_encode_country(str(raw)))
         else:
             vector.append(float(raw))
 

```

---

## Code Evolution

### Change Analysis

**What was Changed:**
In the `encoder.py` file, two lines were modified to wrap the input `raw` value with `str()` before passing it to the `CATEGORICAL_ENCODERS.get()` and `_encode_country()` functions.

- Line 34 changed from:
  ```python
  vector.append(float(CATEGORICAL_ENCODERS[name].get(raw, 0)))
  ```
  to:
  ```python
  vector.append(float(CATEGICAL_ENCODERS[name].get(str(raw), 0)))
  ```

- Line 35 changed from:
  ```python
  vector.append(_encode_country(raw))
  ```
  to:
  ```python
  vector.append(_encode_country(str(raw)))
  ```

**Why it was Likely Changed:**
This change likely ensures that the input `raw` value is consistently converted to a string before being passed to the dictionary lookup or function. This could be necessary if the internal representations of `CATEGORICAL_ENCODERS` and `_encode_country()` expect strings, avoiding potential type errors.

**Impact on Behavior:**
The behavior remains largely unchanged for valid inputs. However, this change ensures that any input types are uniformly handled as strings, which is crucial for consistency across different parts of the codebase.

**Risks or Concerns:**
- **Type Safety:** While converting `raw` to a string is generally safe, it could introduce issues if `raw` contains non-string data that should not be converted (e.g., integers representing flags).
- **Performance:** The additional overhead of type conversion might have minor performance implications for very large datasets.

Overall, this change enhances the robustness and consistency of the encoding process.

---

*Generated by CodeWorm on 2026-02-23 08:40*
