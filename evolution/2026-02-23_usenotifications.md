# useNotifications

**Type:** Code Evolution
**Repository:** ios-test
**File:** red-recon/src/shared/hooks/useNotifications.ts
**Language:** typescript
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```typescript
Commit: 9d363188
Message: feat(notifications): add useNotifications hook

- Request permissions on mount
- Schedule notifications when cycle/partner data changes
- Re-schedule on app foreground
- Export rescheduleNotifications for manual trigger
Author: CarterPerez-dev
File: red-recon/src/shared/hooks/useNotifications.ts
Change type: new file

Diff:
@@ -0,0 +1,91 @@
+/**
+ * @AngelaMos | 2026
+ * useNotifications.ts
+ */
+
+import { useCallback, useEffect, useRef, useState } from 'react'
+import { AppState, type AppStateStatus } from 'react-native'
+import { useCycleStatus, usePartner } from '@/api/hooks'
+import {
+  requestNotificationPermissions,
+  scheduleAllNotifications,
+  cancelAllScheduledNotifications,
+} from '@/core/notifications'
+
+export interface UseNotificationsResult {
+  permissionGranted: boolean
+  isScheduling: boolean
+  rescheduleNotifications: () => Promise<void>
+}
+
+export function useNotifications(): UseNotificationsResult {
+  const [permissionGranted, setPermissionGranted] = useState(false)
+  const [isScheduling, setIsScheduling] = useState(false)
+  const hasRequestedPermission = useRef(false)
+
+  const { data: cycleStatus } = useCycleStatus()
+  const { data: partner } = usePartner()
+
+  useEffect(() => {
+    if (hasRequestedPermission.current) return
+    hasRequestedPermission.current = true
+
+    const requestPermissions = async (): Promise<void> => {
+      const granted = await requestNotificationPermissions()
+      setPermissionGranted(granted)
+    }
+
+    requestPermissions()
+  }, [])
+
+  const rescheduleNotifications = useCallback(async (): Promise<void> => {
+    if (!permissionGranted || !cycleStatus || !partner) {
+      return
+    }
+
+    setIsScheduling(true)
+
+    try {
+      const hasAnyEnabled =
+        partner.notification_period_reminder ||
+        partner.notification_pms_alert ||
+        partner.notification_ovulation_alert
+
+      if (hasAnyEnabled) {
+        await scheduleAllNotifications(cycleStatus, partner)
+      } else {
+        await cancelAllScheduledNotifications()
+      }
+    } finally {
+      setIsScheduling(false)
+    }
+  }, [cycleStatus, partner, permissionGranted])
+
+  useEffect(() => {
+    if (!permissionGranted || !cycleStatus || !partner) {
+      return
+    }
+
+    rescheduleNotifications()
+  }, [cycleStatus, partner, permissionGranted, rescheduleNotifications])
+
+  useEffect(() => {
+    const handleAppStateChange = (nextState: AppStateStatus): void => {
+      if (nextState === 'active' && permissionGranted && cycleStatus && partner) {
+        rescheduleNotifications()
+      }
+    }
+
+    const subscription = AppState.addEventListener('change', handleAppStateChange)
+
+    return () => {
+      subscription.remove()
+    }
+  }, [cycleStatus, partner, permissionGranted, rescheduleNotifications])
+
+  return {
+    permissionGranted,
+    isScheduling,
+    rescheduleNotifications,
+  }
+}

```

---

## Code Evolution

### Change Analysis

**What was Changed:**
A new file `useNotifications.ts` was added, introducing a custom React hook named `useNotifications`. This hook handles requesting notification permissions and scheduling notifications based on cycle status and partner data changes.

**Why it was Likely Changed:**
The addition of this hook likely aims to streamline the management of notifications within the application. By centralizing permission requests and scheduling logic in one place, the code becomes more modular and easier to maintain. The use of hooks also aligns with React's best practices for handling state and side effects.

**Impact on Behavior:**
- **Permissions Handling:** On component mount, the hook requests notification permissions if not already requested.
- **Notification Scheduling:** It schedules notifications when cycle status or partner data changes, ensuring relevant alerts are sent to users based on their preferences.
- **App Foreground Detection:** The hook reschedules notifications when the app is brought to the foreground.

**Risks or Concerns:**
- **Permission Denial Handling:** If permission is denied, the hook does not handle this scenario explicitly. This could lead to a poor user experience if users are unaware of why they're missing notifications.
- **Resource Management:** The use of `useEffect` for handling app state changes and rescheduling might cause unnecessary re-renders or resource leaks if not managed properly.

Overall, the change introduces a useful utility but should be reviewed for edge cases and performance implications.

---

*Generated by CodeWorm on 2026-02-23 11:37*
