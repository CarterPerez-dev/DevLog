# writer_test

**Type:** Code Evolution
**Repository:** angela
**File:** internal/pyproject/writer_test.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: ea4cc501
Message: Create canonical module source location - release v1.0.0
Author: CarterPerez-dev
File: internal/pyproject/writer_test.go
Change type: new file

Diff:
@@ -0,0 +1,177 @@
+// Â©AngelaMos | 2026
+// writer_test.go
+
+package pyproject
+
+import (
+	"strings"
+	"testing"
+)
+
+const sampleTOML = `# Project configuration
+[project]
+name = "myapp"
+version = "1.0.0"
+
+# Core dependencies
+dependencies = [
+    "requests>=2.28.0",  # HTTP library
+    "django>=3.2,<4.0",
+    "flask[async]>=2.0",
+    "numpy",
+]
+
+[project.optional-dependencies]
+# Development tools
+dev = [
+    "pytest>=7.0.0",
+    "black==23.7.0",  # Code formatter
+]
+`
+
+func TestUpdaterPreservesComments(t *testing.T) {
+	t.Parallel()
+
+	u, err := NewUpdater([]byte(sampleTOML))
+	if err != nil {
+		t.Fatalf("NewUpdater error: %v", err)
+	}
+
+	if err := u.UpdateDependency("requests", ">=2.31.0"); err != nil {
+		t.Fatalf("UpdateDependency error: %v", err)
+	}
+
+	result := string(u.Bytes())
+
+	if !strings.Contains(result, `"requests>=2.31.0"`) {
+		t.Error("version was not updated")
+	}
+	if !strings.Contains(result, "# HTTP library") {
+		t.Error("inline comment was lost")
+	}
+	if !strings.Contains(result, "# Project configuration") {
+		t.Error("header comment was lost")
+	}
+	if !strings.Contains(result, "# Core dependencies") {
+		t.Error("section comment was lost")
+	}
+	if !strings.Contains(result, "# Development tools") {
+		t.Error("optional-deps comment was lost")
+	}
+}
+
+func TestUpdaterPreservesExtras(t *testing.T) {
+	t.Parallel()
+
+	u, err := NewUpdater([]byte(sampleTOML))
+	if err != nil {
+		t.Fatal(err)
+	}
+
+	if err := u.UpdateDependency("flask", ">=3.0"); err != nil {
+		t.Fatal(err)
+	}
+
+	result := string(u.Bytes())
+	if !strings.Contains(result, `"flask[async]>=3.0"`) {
+		t.Errorf("extras lost or version not updated: %s", result)
+	}
+}
+
+func TestUpdaterHandlesExactPin(t *testing.T) {
+	t.Parallel()
+
+	u, err := NewUpdater([]byte(sampleTOML))
+	if err != nil {
+		t.Fatal(err)
+	}
+
+	if err := u.UpdateDependency("black", ">=24.0.0"); err != nil {
+		t.Fatal(err)
+	}
+
+	result := string(u.Bytes())
+	if !strings.Contains(result, `"black>=24.0.0"`) {
+		t.Errorf("exact pin not updated: %s", result)
+	}
+	if !strings.Contains(result, "# Code formatter") {
+		t.Error("inline comment was lost")
+	}
+}
+
+func TestUpdaterNotFound(t *testing.T) {
+	t.Parallel()
+
+	u, err := NewUpdater([]byte(sampleTOML))
+	if err != nil {
+		t.Fatal(err)
+	}
+
+	err = u.UpdateDependency("nonexistent", ">=1.0")
+	if err == nil {
+		t.Fatal("expected error for missing dependency")
+	}
+}
+
+func TestUpdaterSkipsBareNames(t *testing.T) {
+	t.Parallel()
+
+	u, err := NewUpdater([]byte(sampleTOML))
+	if err != nil {
+		t.Fatal(err)
+	}
+
+	err = u.UpdateDependency("numpy", ">=1.26.0")
+	if err == nil {
+		t.Fatal("expected error: bare name has no version spec to match")
+	}
+}
+
+func TestUpdaterMultipleUpdates(t *testing.T) {
+	t.Parallel()
+
+	u
```

---

## Code Evolution

### Change Analysis

**What was Changed:** 
A new test file `writer_test.go` was added to the `internal/pyproject` package, containing multiple test functions that validate the behavior of a TOML updater. The tests cover various scenarios such as preserving comments and extras, handling exact pins, updating dependencies with or without version specifications, and managing invalid TOML inputs.

**Why it Was Likely Changed:**
This change was likely made to ensure robust testing of the TOML updater functionality. By adding comprehensive test cases, the developer aims to verify that the updater correctly updates dependency versions while preserving comments and extras, handles missing dependencies gracefully, and rejects invalid input formats.

**Impact on Behavior:**
The addition of these tests will help maintain the integrity of the TOML updater by ensuring it behaves as expected in different scenarios. This is crucial for any package management tool or build system that relies on updating dependency versions accurately.

**Risks or Concerns:**
While the tests are thorough, they assume that the `NewUpdater` function and its dependencies work correctly. Any issues with these underlying components could lead to false positives or negatives in the test results. Additionally, the tests may need periodic updates if the implementation of the updater changes significantly.

---

*Generated by CodeWorm on 2026-02-23 14:24*
