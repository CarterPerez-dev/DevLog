# app

**Type:** Code Evolution
**Repository:** CodeWorm
**File:** dashboard/backend/app.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: ca3ce30d
Message: v1.0.2: add doc type system, Docker infrastructure, and web dashboard

- Add 11 documentation types (function, class, file, security review, TIL, etc.)
  with weighted random selection so the same codebase generates 10x more unique content
- Add Docker Compose for Ollama (GPU passthrough) + Redis + Dashboard + Nginx
- Add FastAPI backend with REST API, WebSocket live events, and Redis pub/sub
- Add React dashboard with stats, live log, commit feed, repo list, and worm viz
- Add next_scheduled_run logging after each cycle completes
- Update repos config and README for v1.0.2
Author: CarterPerez-dev
File: dashboard/backend/app.py
Change type: new file

Diff:
@@ -0,0 +1,56 @@
+"""
+â’¸AngelaMos | 2026
+dashboard/backend/app.py
+"""
+from __future__ import annotations
+
+from collections.abc import AsyncIterator
+from contextlib import asynccontextmanager
+from pathlib import Path
+
+from fastapi import FastAPI
+from fastapi.middleware.cors import CORSMiddleware
+from fastapi.responses import JSONResponse
+from fastapi.staticfiles import StaticFiles
+
+from dashboard.backend.api import router as api_router
+from dashboard.backend.ws import (
+    router as ws_router,
+    start_redis_subscriber,
+    stop_redis_subscriber,
+)
+
+
+@asynccontextmanager
+async def lifespan(app: FastAPI) -> AsyncIterator[None]:
+    await start_redis_subscriber()
+    yield
+    await stop_redis_subscriber()
+
+
+app = FastAPI(
+    title="CodeWorm Dashboard",
+    version="1.0.2",
+    lifespan=lifespan,
+)
+
+app.add_middleware(
+    CORSMiddleware,
+    allow_origins=["*"],
+    allow_credentials=True,
+    allow_methods=["*"],
+    allow_headers=["*"],
+)
+
+app.include_router(api_router, prefix="")
+app.include_router(ws_router, prefix="")
+
+
+@app.get("/health")
+async def health() -> JSONResponse:
+    return JSONResponse({"status": "healthy"})
+
+
+static_dir = Path(__file__).parent.parent / "frontend" / "dist"
+if static_dir.exists():
+    app.mount("/", StaticFiles(directory=str(static_dir), html=True), name="static")

```

---

## Code Evolution

### Change Analysis for `dashboard/backend/app.py`

**What was Changed:**
A new file, `app.py`, was added to the `dashboard/backend` directory. This file sets up a FastAPI application with middleware and routers for API and WebSocket endpoints. It also includes a custom lifespan manager for starting and stopping a Redis subscriber.

**Why it was Likely Changed:**
This change likely aims to centralize backend logic, improve modularity by separating API and WebSocket handling, and ensure proper resource management (starting/stopping the Redis subscriber) during application lifecycle events.

**Impact on Behavior:**
- **API Endpoints:** The addition of `api_router` and `ws_router` allows for RESTful API interactions and real-time WebSocket communication.
- **Health Check:** A `/health` endpoint is introduced to monitor the application's health status.
- **Static File Serving:** Static files from the frontend are served, enabling a seamless integration between backend and frontend.

**Risks or Concerns:**
- **Dependency Management:** The application relies on external services (Redis) which could introduce single points of failure. Proper error handling should be implemented to manage these dependencies.
- **Security:** Ensure that CORS settings are appropriately configured to prevent unauthorized access from origins other than the allowed ones.
- **Resource Leaks:** The custom lifespan manager ensures resources like Redis are properly cleaned up, but this must be validated in a production environment.

This change significantly enhances the application's functionality and structure, making it more robust and maintainable.

---

*Generated by CodeWorm on 2026-02-23 20:49*
