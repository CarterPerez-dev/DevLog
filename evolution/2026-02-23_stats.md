# stats

**Type:** Code Evolution
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/advanced/ai-threat-detection/backend/app/api/stats.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: 7f35fbd8
Message: feat: complete Phase 1 — rule-based detection pipeline, API, Docker E2E

Phase 1 delivers end-to-end threat detection from nginx log ingestion
through rule-based scoring to REST API and WebSocket alerts.

- API layer: /threats, /stats, /models/status, /ws/alerts, /health, /ready
- Alert dispatcher with Redis pub/sub + PostgreSQL persistence
- Typer CLI: vigil serve, config, health
- Integration tests (tailer -> pipeline -> DB round-trip)
- Docker E2E verified: dev.compose.yml stack with all services healthy
- Linting clean: ruff, mypy strict (0 issues), pylint 10/10
- 75 tests passing across 8 test modules
Author: CarterPerez-dev
File: PROJECTS/advanced/ai-threat-detection/backend/app/api/stats.py
Change type: new file

Diff:
@@ -0,0 +1,24 @@
+"""
+©AngelaMos | 2026
+stats.py
+"""
+
+from fastapi import APIRouter, Depends, Query
+from sqlalchemy.ext.asyncio import AsyncSession
+
+from app.api.deps import get_session
+from app.schemas.stats import StatsResponse
+from app.services import stats_service
+
+router = APIRouter(prefix="/stats", tags=["stats"])
+
+
+@router.get("", response_model=StatsResponse)
+async def get_stats(
+    session: AsyncSession = Depends(get_session),
+    time_range: str = Query("24h", alias="range"),
+) -> StatsResponse:
+    """
+    Aggregate threat statistics for a given time window.
+    """
+    return await stats_service.get_stats(session, time_range)

```

---

## Code Evolution

### Change Analysis

**What was Changed:**
A new file `stats.py` was added to the project, introducing an API endpoint for retrieving threat statistics. The file defines a FastAPI router and a single GET endpoint `/stats/` which aggregates threat statistics based on a specified time range.

**Why it was Likely Changed:**
This change likely aims to provide a RESTful interface for fetching aggregated threat data, enabling users or other systems to monitor the system's performance over different time windows. This is part of Phase 1 in completing the rule-based detection pipeline and API layer.

**Impact on Behavior:**
The addition of this endpoint allows external clients to request statistical summaries of detected threats, which can be crucial for monitoring and reporting purposes. The `time_range` parameter supports flexibility in querying data over different periods (e.g., "24h", "1w").

**Risks or Concerns:**
- **Security:** Ensure that the API is properly secured to prevent unauthorized access.
- **Performance:** Aggregating statistics might impact performance, especially if the underlying database queries are complex. Monitoring and optimizing these queries will be important.
- **Maintenance:** Regular updates to the `stats_service` and related services may be required as the threat detection pipeline evolves.

Overall, this change enhances the API's functionality by providing valuable insights into detected threats over time.

---

*Generated by CodeWorm on 2026-02-23 07:43*
