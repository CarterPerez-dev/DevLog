# registry_test

**Type:** Code Evolution
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/secrets-scanner/internal/rules/registry_test.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: 294169a2
Message: feat: Complete Go secrets scanner - Portia
Author: CarterPerez-dev
File: PROJECTS/intermediate/secrets-scanner/internal/rules/registry_test.go
Change type: new file

Diff:
@@ -0,0 +1,310 @@
+// Â©AngelaMos | 2026
+// registry_test.go
+
+package rules
+
+import (
+	"regexp"
+	"testing"
+
+	"github.com/stretchr/testify/assert"
+	"github.com/stretchr/testify/require"
+
+	"github.com/CarterPerez-dev/portia/pkg/types"
+)
+
+func testRule(id string, keywords []string) *types.Rule {
+	return &types.Rule{
+		ID:       id,
+		Keywords: keywords,
+		Pattern:  regexp.MustCompile(`test`),
+		Severity: types.SeverityHigh,
+	}
+}
+
+func TestRegistryRegisterAndGet(t *testing.T) {
+	t.Parallel()
+	reg := NewRegistry()
+	rule := testRule("test-rule", []string{"test"})
+	reg.Register(rule)
+
+	got, ok := reg.Get("test-rule")
+	require.True(t, ok)
+	assert.Equal(t, "test-rule", got.ID)
+}
+
+func TestRegistryGetMissing(t *testing.T) {
+	t.Parallel()
+	reg := NewRegistry()
+	_, ok := reg.Get("nonexistent")
+	assert.False(t, ok)
+}
+
+func TestRegistryDuplicatePanics(t *testing.T) {
+	t.Parallel()
+	reg := NewRegistry()
+	rule := testRule("dup", []string{"test"})
+	reg.Register(rule)
+
+	assert.Panics(t, func() {
+		reg.Register(testRule("dup", []string{"test"}))
+	})
+}
+
+func TestRegistryAll(t *testing.T) {
+	t.Parallel()
+	reg := NewRegistry()
+	reg.Register(testRule("b-rule", []string{"b"}))
+	reg.Register(testRule("a-rule", []string{"a"}))
+	reg.Register(testRule("c-rule", []string{"c"}))
+
+	all := reg.All()
+	require.Len(t, all, 3)
+	assert.Equal(t, "a-rule", all[0].ID)
+	assert.Equal(t, "b-rule", all[1].ID)
+	assert.Equal(t, "c-rule", all[2].ID)
+}
+
+func TestRegistryDisable(t *testing.T) {
+	t.Parallel()
+	reg := NewRegistry()
+	reg.Register(testRule("keep", []string{"a"}))
+	reg.Register(testRule("drop", []string{"b"}))
+
+	reg.Disable("drop")
+
+	_, ok := reg.Get("drop")
+	assert.False(t, ok)
+
+	all := reg.All()
+	require.Len(t, all, 1)
+	assert.Equal(t, "keep", all[0].ID)
+}
+
+func TestRegistryMatchKeywords(t *testing.T) {
+	t.Parallel()
+	reg := NewRegistry()
+	reg.Register(
+		testRule("aws", []string{"AKIA", "aws"}),
+	)
+	reg.Register(
+		testRule("github", []string{"ghp_"}),
+	)
+	reg.Register(
+		testRule("stripe", []string{"sk_live_"}),
+	)
+
+	tests := map[string]struct {
+		content  string
+		wantIDs  []string
+		wantNone bool
+	}{
+		"matches aws by AKIA prefix": { //nolint:gosec
+			content: "found AKIAIOSFODNN7EXAMPLE in config",
+			wantIDs: []string{"aws"},
+		},
+		"matches github token": {
+			content: "token = ghp_abc123def456",
+			wantIDs: []string{"github"},
+		},
+		"matches multiple rules": {
+			content: "aws key AKIA and ghp_ token here",
+			wantIDs: []string{"aws", "github"},
+		},
+		"case insensitive matching": {
+			content: "AWS_ACCESS_KEY with akia prefix",
+			wantIDs: []string{"aws"},
+		},
+		"no matches on unrelated content": {
+			content:  "just some normal code here",
+			wantNone: true,

```

---

## Code Evolution

### Change Analysis for `registry_test.go`

**What was Changed:**
A new file, `registry_test.go`, was added to the `internal/rules` package. This file contains multiple test functions that validate various functionalities of a rules registry. The tests cover registration, retrieval, duplication handling, keyword matching, disabling rules, and more.

**Why it Was Likely Changed:**
This change likely aims to ensure comprehensive testing coverage for the secrets scanner's rule management system. By adding these tests, developers can verify that the registry functions as intended, including registering, retrieving, and managing rules effectively.

**Impact on Behavior:**
The addition of these tests will help maintain the integrity of the rules registry by ensuring it behaves correctly under various scenarios such as duplicate registrations, keyword matching, and rule disabling. This enhances the reliability of the secrets scanner.

**Risks or Concerns:**
While the tests are beneficial for validation, they also introduce a risk if not maintained properly. Ensuring that test cases remain relevant and up-to-date with changes in the registry's implementation is crucial to avoid false positives or negatives. Additionally, the extensive use of `assert` and `require` from testify may lead to verbose test outputs, which could be simplified for clarity.

Overall, this change significantly improves code quality and maintainability by providing robust testing coverage.

---

*Generated by CodeWorm on 2026-02-22 21:47*
