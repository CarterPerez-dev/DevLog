# entropy

**Type:** Code Evolution
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/secrets-scanner/internal/rules/entropy.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: 294169a2
Message: feat: Complete Go secrets scanner - Portia
Author: CarterPerez-dev
File: PROJECTS/intermediate/secrets-scanner/internal/rules/entropy.go
Change type: new file

Diff:
@@ -0,0 +1,168 @@
+// Â©AngelaMos | 2026
+// entropy.go
+
+package rules
+
+import (
+	"math"
+	"strings"
+)
+
+const (
+	Base64Charset       = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=-_"
+	HexCharset          = "0123456789abcdefABCDEF"
+	AlphanumericCharset = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"
+)
+
+var (
+	base64Set       = buildCharsetSet(Base64Charset)
+	hexSet          = buildCharsetSet(HexCharset)
+	alphanumericSet = buildCharsetSet(AlphanumericCharset)
+)
+
+type EntropyToken struct {
+	Value   string
+	Entropy float64
+}
+
+func ShannonEntropy(data, charset string) float64 {
+	if len(data) == 0 {
+		return 0.0
+	}
+
+	filtered := data
+	if charset != "" {
+		cs := charsetSet(charset)
+		var b strings.Builder
+		b.Grow(len(data))
+		for _, c := range data {
+			if cs[c] {
+				b.WriteRune(c)
+			}
+		}
+		filtered = b.String()
+		if len(filtered) == 0 {
+			return 0.0
+		}
+	}
+
+	freq := make(map[rune]int)
+	for _, c := range filtered {
+		freq[c]++
+	}
+
+	length := float64(len([]rune(filtered)))
+	entropy := 0.0
+	for _, count := range freq {
+		p := float64(count) / length
+		if p > 0 {
+			entropy -= p * math.Log2(p)
+		}
+	}
+	return entropy
+}
+
+func DetectCharset(s string) string {
+	hexCount := 0
+	b64Count := 0
+	total := 0
+
+	for _, c := range s {
+		total++
+		if hexSet[c] {
+			hexCount++
+		}
+		if base64Set[c] {
+			b64Count++
+		}
+	}
+
+	if total == 0 {
+		return "alphanumeric"
+	}
+
+	hexRatio := float64(hexCount) / float64(total)
+	b64Ratio := float64(b64Count) / float64(total)
+
+	if hexRatio == 1.0 && isAllHexChars(s) {
+		return "hex"
+	}
+	if b64Ratio >= 0.95 {
+		return "base64"
+	}
+	return "alphanumeric"
+}
+
+func ExtractHighEntropyTokens(
+	line string,
+	charset string,
+	threshold float64,
+	minLen int,
+) []EntropyToken {
+	cs := charsetSet(charset)
+	var tokens []EntropyToken
+	var current []rune
+
+	for _, c := range line {
+		if cs[c] {
+			current = append(current, c)
+		} else {
+			if len(current) >= minLen {
+				token := string(current)
+				ent := ShannonEntropy(token, charset)
+				if ent >= threshold {
+					tokens = append(tokens, EntropyToken{
+						Value:   token,
+						Entropy: math.Round(ent*1000) / 1000,
+					})
+				}
+			}
+			current = current[:0]
+		}
+	}
+
+	if len(current) >= minLen {
+		token := string(current)
+		ent := ShannonEntropy(token, charset)
+		if ent >= threshold {
+			tokens = append(tokens, EntropyToken{
+				Value:   token,
+				Entropy: math.Round(ent*1000) / 1000,
+			})
+		}
+	}
+
+	return tokens
+}
+
+func charsetSet(charset string) map[rune]bool {
+	switch charset {
+	case Base64Charset:
+		return base64Set
+	case HexCharset:
+		return hexSet
+	case AlphanumericCharset:
+		return alphanumericSet
+	default:
+		return bui
```

---

## Code Evolution

### Change Analysis for `entropy.go`

**What was Changed:**
A new file, `entropy.go`, was added to the `internal/rules` package. This file introduces functions for calculating Shannon entropy and detecting character sets in strings. The key functions include:
- `ShannonEntropy`: Computes the Shannon entropy of a string based on given or inferred character set.
- `DetectCharset`: Identifies the most likely character set used in a string (hex, base64, alphanumeric).
- `ExtractHighEntropyTokens`: Extracts tokens from a line that exceed a specified entropy threshold.

**Why it was Likely Changed:**
This change is part of completing a Go secrets scanner. The new functions are essential for identifying potentially sensitive data by analyzing the entropy and character set of strings within lines of text or code.

**Impact on Behavior:**
- **Entropy Calculation:** The `ShannonEntropy` function provides a measure of randomness in the input string, which can indicate the likelihood that it contains secret information.
- **Character Set Detection:** `DetectCharset` helps distinguish between different types of encoded data (hex, base64) by analyzing their character composition.
- **Token Extraction:** `ExtractHighEntropyTokens` filters out tokens with high entropy, making it easier to focus on suspicious patterns.

**Risks or Concerns:**
- The functions assume a certain level of accuracy in character set detection and token extraction. Misidentification could lead to false positives or negatives.
- Performance considerations should be evaluated for large datasets, as the current implementation iterates over each character multiple times.
- Error handling is minimal; potential edge cases (e.g., empty strings) are handled but more robust error management might be needed.

This change significantly enhances the scanner's ability to detect secrets by leveraging entropy and character set analysis.

---

*Generated by CodeWorm on 2026-02-22 21:37*
