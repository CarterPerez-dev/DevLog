# main

**Type:** Code Evolution
**Repository:** fullstack-template
**File:** stacks/go-react/go-backend/cmd/api/main.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: bf95949c
Message: go backend to react-go stack
Author: CarterPerez-dev
File: stacks/go-react/go-backend/cmd/api/main.go
Change type: new file

Diff:
@@ -0,0 +1,221 @@
+// AngelaMos | 2026
+// main.go
+
+package main
+
+import (
+	"context"
+	"flag"
+	"log/slog"
+	"os"
+	"os/signal"
+	"syscall"
+	"time"
+
+	"github.com/go-chi/chi/v5"
+
+	"github.com/carterperez-dev/templates/go-backend/internal/admin"
+	"github.com/carterperez-dev/templates/go-backend/internal/auth"
+	"github.com/carterperez-dev/templates/go-backend/internal/config"
+	"github.com/carterperez-dev/templates/go-backend/internal/core"
+	"github.com/carterperez-dev/templates/go-backend/internal/health"
+	"github.com/carterperez-dev/templates/go-backend/internal/middleware"
+	"github.com/carterperez-dev/templates/go-backend/internal/server"
+	"github.com/carterperez-dev/templates/go-backend/internal/user"
+)
+
+const (
+	drainDelay = 5 * time.Second
+)
+
+func main() {
+	configPath := flag.String("config", "config.yaml", "path to config file")
+	flag.Parse()
+
+	if err := run(*configPath); err != nil {
+		slog.Error("application error", "error", err)
+		os.Exit(1)
+	}
+}
+
+//nolint:funlen // bootstrap code is inherently verbose
+func run(configPath string) error {
+	ctx, stop := signal.NotifyContext(
+		context.Background(),
+		syscall.SIGINT,
+		syscall.SIGTERM,
+	)
+	defer stop()
+
+	cfg, err := config.Load(configPath)
+	if err != nil {
+		return err
+	}
+
+	logger := setupLogger(cfg.Log)
+	slog.SetDefault(logger)
+
+	logger.Info("starting application",
+		"name", cfg.App.Name,
+		"version", cfg.App.Version,
+		"environment", cfg.App.Environment,
+	)
+
+	var telemetry *core.Telemetry
+	if cfg.Otel.Enabled {
+		tel, telErr := core.NewTelemetry(ctx, cfg.Otel, cfg.App)
+		if telErr != nil {
+			logger.Warn("failed to initialize telemetry", "error", telErr)
+		} else {
+			telemetry = tel
+			logger.Info("OpenTelemetry tracer initialized",
+				"endpoint", cfg.Otel.Endpoint,
+			)
+		}
+	}
+
+	db, err := core.NewDatabase(ctx, cfg.Database)
+	if err != nil {
+		return err
+	}
+	logger.Info("database connected",
+		"max_open_conns", cfg.Database.MaxOpenConns,
+		"max_idle_conns", cfg.Database.MaxIdleConns,
+	)
+
+	redis, err := core.NewRedis(ctx, cfg.Redis)
+	if err != nil {
+		return err
+	}
+	logger.Info("redis connected",
+		"pool_size", cfg.Redis.PoolSize,
+	)
+
+	jwtManager, err := auth.NewJWTManager(cfg.JWT)
+	if err != nil {
+		return err
+	}
+	logger.Info("JWT manager initialized",
+		"algorithm", "ES256",
+		"key_id", jwtManager.GetKeyID(),
+	)
+
+	userRepo := user.NewRepository(db.DB)
+	userSvc := user.NewService(userRepo)
+	userHandler := user.NewHandler(userSvc)
+
+	authRepo := auth.NewRepository(db.DB)
+	authSvc := auth.NewService(authRepo, jwtManager, userSvc, redis.Client)
+	authHandler := auth.NewHandler(authSvc)
+
+	healthHandler := health.NewHandler(db, redis)
+
+	adminHandler := admin.NewHandler(admin.HandlerConfig{
+		DBStats:    db.Stats,
+		RedisStats: redis.P
```

---

## Code Evolution

### Change Analysis

**What was Changed:**
The commit introduces a new `main.go` file for the Go backend in a React-Go stack project. This file sets up and runs the application, integrating various components like configuration loading, logging setup, database connection, Redis connection, JWT management, service initialization, and HTTP server setup.

**Why it was Likely Changed:**
This change likely aims to provide a clean, modular structure for the backend API, separating concerns such as configuration handling, dependency injection, and routing. It also integrates modern Go practices like context propagation for graceful shutdowns and middleware usage for security and rate limiting.

**Impact on Behavior:**
The new `main.go` file ensures that all necessary services and repositories are properly initialized before starting the HTTP server. This setup enhances the application's robustness by handling signals gracefully, logging important events, and ensuring resources are cleaned up correctly during shutdown.

**Risks or Concerns:**
- **Error Handling:** The code uses `slog` for logging errors but does not provide detailed error messages in production environments. Improving error logging could help with debugging.
- **Resource Management:** While the application handles graceful shutdown, it might be beneficial to ensure that all resources are closed properly even if an unexpected error occurs.
- **Security:** The use of `FailOpen` for rate limiting should be carefully managed to avoid potential security risks.

Overall, this change significantly improves the structure and maintainability of the backend codebase.

---

*Generated by CodeWorm on 2026-02-22 13:32*
