# notification.service

**Type:** Code Evolution
**Repository:** ios-test
**File:** red-recon/src/core/notifications/notification.service.ts
**Language:** typescript
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```typescript
Commit: 120aefce
Message: checkpoint
Author: CarterPerez-dev
File: red-recon/src/core/notifications/notification.service.ts
Change type: modified

Diff:
@@ -3,7 +3,6 @@
  * notification.service.ts
  */
 
-import * as Notifications from 'expo-notifications'
 import { Platform } from 'react-native'
 import type { CycleStatus, PartnerResponse } from '@/api/types'
 import {
@@ -13,15 +12,32 @@ import {
   type NotificationConfig,
 } from '@/api/types'
 
-Notifications.setNotificationHandler({
-  handleNotification: async () => ({
-    shouldShowAlert: true,
-    shouldPlaySound: true,
-    shouldSetBadge: false,
-  }),
-})
+let Notifications: typeof import('expo-notifications') | null = null
+let isNativeModuleAvailable = false
+
+try {
+  const NotificationsModule = require('expo-notifications')
+  Notifications = NotificationsModule
+  isNativeModuleAvailable = true
+
+  NotificationsModule.setNotificationHandler({
+    handleNotification: async () => ({
+      shouldShowAlert: true,
+      shouldPlaySound: true,
+      shouldSetBadge: false,
+      shouldShowBanner: true,
+      shouldShowList: true,
+    }),
+  })
+} catch {
+  console.warn('expo-notifications native module not available (Expo Go). Build a dev client for notifications.')
+}
 
 export async function requestNotificationPermissions(): Promise<boolean> {
+  if (!isNativeModuleAvailable || !Notifications) {
+    return false
+  }
+
   if (Platform.OS === 'android') {
     await Notifications.setNotificationChannelAsync('default', {
       name: 'default',
@@ -41,18 +57,30 @@ export async function requestNotificationPermissions(): Promise<boolean> {
 }
 
 export async function cancelAllScheduledNotifications(): Promise<void> {
+  if (!isNativeModuleAvailable || !Notifications) {
+    return
+  }
+
   await Notifications.cancelAllScheduledNotificationsAsync()
 }
 
 export async function cancelNotificationByIdentifier(
   identifier: string
 ): Promise<void> {
+  if (!isNativeModuleAvailable || !Notifications) {
+    return
+  }
+
   await Notifications.cancelScheduledNotificationAsync(identifier)
 }
 
 export async function scheduleNotification(
   config: NotificationConfig
 ): Promise<string | null> {
+  if (!isNativeModuleAvailable || !Notifications) {
+    return null
+  }
+
   const now = new Date()
 
   if (config.triggerDate <= now) {

```

---

## Code Evolution

### Change Analysis

**What was Changed:**
The code introduced a conditional check for the availability of the `expo-notifications` native module before using its functions. It also added support for additional notification properties like `shouldShowBanner` and `shouldShowList`. The `Notifications.setNotificationHandler` function now only runs if the native module is available.

**Why it was Likely Changed:**
This change likely addresses issues with notifications in non-native environments, such as Expo Go. By checking if the native module is available before using its functions, the code prevents potential runtime errors and ensures that notification functionality works correctly across different build environments.

**Impact on Behavior:**
- The behavior of requesting permissions, scheduling, canceling, and handling notifications now depends on whether the `expo-notifications` native module is available.
- Notifications will only be shown if the native module supports additional properties like banners and lists.

**Risks or Concerns:**
- There's a risk that developers might forget to handle cases where `isNativeModuleAvailable` is false, leading to potential bugs.
- The code introduces complexity by adding conditional logic for each function call. This could make maintenance more challenging if not properly documented.

Overall, this change improves the robustness of notification handling but requires careful testing across different environments.

---

*Generated by CodeWorm on 2026-02-23 12:32*
