# config

**Type:** Code Evolution
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/secrets-scanner/internal/config/config.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: 294169a2
Message: feat: Complete Go secrets scanner - Portia
Author: CarterPerez-dev
File: PROJECTS/intermediate/secrets-scanner/internal/config/config.go
Change type: new file

Diff:
@@ -0,0 +1,202 @@
+// Â©AngelaMos | 2026
+// config.go
+
+package config
+
+import (
+	"fmt"
+	"os"
+	"path/filepath"
+
+	"github.com/pelletier/go-toml/v2"
+)
+
+const DefaultConfigFile = ".portia.toml"
+
+type Config struct {
+	Rules     RulesConfig     `toml:"rules"`
+	Scan      ScanConfig      `toml:"scan"`
+	Output    OutputConfig    `toml:"output"`
+	HIBP      HIBPConfig      `toml:"hibp"`
+	Allowlist AllowlistConfig `toml:"allowlist"`
+}
+
+type RulesConfig struct {
+	Disable []string `toml:"disable"`
+	Enable  []string `toml:"enable"`
+}
+
+type ScanConfig struct {
+	MaxFileSize int64    `toml:"max_file_size"`
+	Excludes    []string `toml:"excludes"`
+	Depth       int      `toml:"depth"`
+	Since       string   `toml:"since"`
+}
+
+type OutputConfig struct {
+	Format  string `toml:"format"`
+	Verbose bool   `toml:"verbose"`
+	NoColor bool   `toml:"no_color"`
+}
+
+type HIBPConfig struct {
+	Enabled bool `toml:"enabled"`
+}
+
+type AllowlistConfig struct {
+	Paths     []string `toml:"paths"`
+	Values    []string `toml:"values"`
+	Stopwords []string `toml:"stopwords"`
+}
+
+func Load(path string) (*Config, error) {
+	cfg := &Config{
+		Scan: ScanConfig{
+			MaxFileSize: 1 << 20,
+		},
+		Output: OutputConfig{
+			Format: "terminal",
+		},
+	}
+
+	if path == "" {
+		path = findConfig()
+	}
+
+	if path == "" {
+		if pyCfg, ok := loadFromPyproject(); ok {
+			return pyCfg, nil
+		}
+		return cfg, nil
+	}
+
+	data, err := os.ReadFile(path) //nolint:gosec
+	if err != nil {
+		if os.IsNotExist(err) {
+			return cfg, nil
+		}
+		return nil, err
+	}
+
+	if err := toml.Unmarshal(data, cfg); err != nil {
+		return nil, err
+	}
+
+	return cfg, nil
+}
+
+type pyprojectWrapper struct {
+	Tool struct {
+		Portia Config `toml:"portia"`
+	} `toml:"tool"`
+}
+
+func loadFromPyproject() (*Config, bool) {
+	data, err := os.ReadFile("pyproject.toml")
+	if err != nil {
+		return nil, false
+	}
+
+	var wrapper pyprojectWrapper
+	if err := toml.Unmarshal(data, &wrapper); err != nil {
+		return nil, false
+	}
+
+	cfg := wrapper.Tool.Portia
+	if cfg.Output.Format == "" && !cfg.Output.Verbose &&
+		!cfg.Output.NoColor && !cfg.HIBP.Enabled &&
+		len(cfg.Rules.Disable) == 0 && len(cfg.Scan.Excludes) == 0 {
+		return nil, false
+	}
+
+	if cfg.Scan.MaxFileSize == 0 {
+		cfg.Scan.MaxFileSize = 1 << 20
+	}
+	if cfg.Output.Format == "" {
+		cfg.Output.Format = "terminal"
+	}
+
+	return &cfg, true
+}
+
+func findConfig() string {
+	candidates := []string{
+		DefaultConfigFile,
+		filepath.Join(".portia", "config.toml"),
+	}
+
+	for _, c := range candidates {
+		if _, err := os.Stat(c); err == nil {
+			return c
+		}
+	}
+
+	home, err := os.UserHomeDir()
+	if err == nil {
+		global := filepath.Join(home, ".config", "portia", "config.toml")
+		if _, err := os.Stat(global); err == nil {
+			
```

---

## Code Evolution

### Change Analysis for `config.go`

**What was Changed:**
The commit introduces a new file, `config.go`, which defines the configuration structure and provides functionality to load configurations from various sources like `.portia.toml`, `pyproject.toml`, and default values. The file includes types such as `Config`, `RulesConfig`, `ScanConfig`, etc., along with methods for loading these configurations.

**Why it was Likely Changed:**
This change likely aims to centralize configuration handling in the secrets scanner project, making it easier to manage settings like rules, scanning parameters, output formats, and HIBP integration. The addition of support for `pyproject.toml` aligns with modern Go project practices, allowing users to define configurations within their existing setup.

**Impact on Behavior:**
The new configuration system will allow users to customize the scanner's behavior through a `.portia.toml` file or by setting up configurations in `pyproject.toml`. This enhances flexibility and ease of use. The default values ensure that the application can still run without explicit configuration, making it more accessible.

**Risks:**
- **Security Risks:** Reading files directly with `os.ReadFile()` could pose security risks if not handled properly.
- **Error Handling:** The current implementation uses simple error checks which might need to be enhanced for robustness. For instance, handling specific errors like permission denied or file corruption more gracefully.

Overall, this change significantly improves the project's configurability and aligns with modern Go best practices.

---

*Generated by CodeWorm on 2026-02-22 20:32*
