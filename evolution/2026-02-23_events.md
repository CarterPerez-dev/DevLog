# events

**Type:** Code Evolution
**Repository:** CodeWorm
**File:** codeworm/core/events.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: ca3ce30d
Message: v1.0.2: add doc type system, Docker infrastructure, and web dashboard

- Add 11 documentation types (function, class, file, security review, TIL, etc.)
  with weighted random selection so the same codebase generates 10x more unique content
- Add Docker Compose for Ollama (GPU passthrough) + Redis + Dashboard + Nginx
- Add FastAPI backend with REST API, WebSocket live events, and Redis pub/sub
- Add React dashboard with stats, live log, commit feed, repo list, and worm viz
- Add next_scheduled_run logging after each cycle completes
- Update repos config and README for v1.0.2
Author: CarterPerez-dev
File: codeworm/core/events.py
Change type: new file

Diff:
@@ -0,0 +1,98 @@
+"""
+â’¸AngelaMos | 2026
+core/events.py
+"""
+from __future__ import annotations
+
+import threading
+from datetime import datetime
+from typing import Any
+
+import orjson
+
+
+_publisher: EventPublisher | None = None
+
+
+class EventPublisher:
+    CHANNEL_LOGS = "codeworm:logs"
+    CHANNEL_EVENTS = "codeworm:events"
+    CHANNEL_STATS = "codeworm:stats"
+
+    def __init__(self, redis_url: str) -> None:
+        import redis as redis_lib
+
+        self._client = redis_lib.Redis.from_url(
+            redis_url,
+            decode_responses = False,
+            socket_connect_timeout = 2,
+            socket_timeout = 2,
+        )
+        self._lock = threading.Lock()
+        self._connected = False
+        self._check_connection()
+
+    def _check_connection(self) -> bool:
+        try:
+            self._client.ping()
+            self._connected = True
+            return True
+        except Exception:
+            self._connected = False
+            return False
+
+    def _publish(self, channel: str, data: dict) -> None:
+        if not self._connected:
+            if not self._check_connection():
+                return
+        try:
+            payload = orjson.dumps(data, default = str)
+            with self._lock:
+                self._client.publish(channel, payload)
+        except Exception:
+            self._connected = False
+
+    def publish_log(self, event_dict: dict) -> None:
+        self._publish(self.CHANNEL_LOGS, event_dict)
+
+    def publish_event(self, event_type: str, data: dict | None = None) -> None:
+        payload = {
+            "type": event_type,
+            "timestamp": datetime.now().isoformat(),
+            "data": data or {},
+        }
+        self._publish(self.CHANNEL_EVENTS, payload)
+
+    def publish_stats(self, stats: dict) -> None:
+        payload = {
+            "timestamp": datetime.now().isoformat(),
+            **stats,
+        }
+        self._publish(self.CHANNEL_STATS, payload)
+
+    def close(self) -> None:
+        try:
+            self._client.close()
+        except Exception:
+            pass
+
+
+def redis_log_processor(
+    logger: Any,
+    method_name: str,
+    event_dict: dict,
+) -> dict:
+    publisher = get_publisher()
+    if publisher is not None:
+       
```

---

## Code Evolution

### Change Analysis for `core/events.py`

**What was Changed:**
A new file, `core/events.py`, was added to the repository. This file introduces an event publisher system using Redis for logging and event publishing. The class `EventPublisher` manages connections and publishes events to different channels (`codeworm:logs`, `codeworm:events`, `codeworm:stats`). Additionally, two functions, `redis_log_processor` and `init_publisher`, are provided to facilitate event logging.

**Why it was Likely Changed:**
This change likely aims to enhance the observability and maintainability of the system by centralizing logging and event handling. The use of Redis for pub/sub allows real-time updates and decoupling of components, which is crucial for a web dashboard that needs live stats and logs.

**Impact on Behavior:**
The addition of this module enables the application to log events and statistics in real-time, providing more detailed insights into system operations. This can help in debugging issues, monitoring performance, and ensuring the system's reliability.

**Risks or Concerns:**
- **Dependency Management:** The `EventPublisher` class depends on Redis, which needs to be properly configured and available.
- **Error Handling:** The `_check_connection` method retries connection checks but does not handle all potential errors gracefully. Consider adding more robust error handling.
- **Thread Safety:** While the use of a lock ensures thread safety for publishing, it might introduce performance bottlenecks if the number of events is high.

Overall, this change significantly improves the system's logging and event management capabilities, making it easier to monitor and debug the application.

---

*Generated by CodeWorm on 2026-02-23 20:36*
