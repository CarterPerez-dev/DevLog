# database

**Type:** Code Evolution
**Repository:** social-media-notes
**File:** backend/app/core/database.py
**Language:** python
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```python
Commit: 8c757802
Message: easy peasy
Author: CarterPerez-dev
File: backend/app/core/database.py
Change type: new file

Diff:
@@ -0,0 +1,160 @@
+"""
+â’¸AngelaMos | 2025
+database.py
+"""
+
+import contextlib
+from collections.abc import (
+    AsyncIterator,
+    Iterator,
+)
+
+from sqlalchemy import create_engine
+from sqlalchemy.engine import Engine
+from sqlalchemy.engine.url import make_url
+from sqlalchemy.ext.asyncio import (
+    AsyncEngine,
+    AsyncSession,
+    AsyncConnection,
+    async_sessionmaker,
+    create_async_engine,
+)
+from sqlalchemy.orm import Session, sessionmaker
+
+from config import settings
+
+
+class DatabaseSessionManager:
+    """
+    Manages database connections and sessions for both sync and async contexts
+    """
+    def __init__(self) -> None:
+        self._async_engine: AsyncEngine | None = None
+        self._sync_engine: Engine | None = None
+        self._async_sessionmaker: async_sessionmaker[AsyncSession
+                                                     ] | None = None
+        self._sync_sessionmaker: sessionmaker[Session] | None = None
+
+    def init(self, database_url: str) -> None:
+        """
+        Initialize database engines and session factories
+        """
+        base_url = make_url(database_url)
+
+        async_url = base_url.set(drivername = "postgresql+asyncpg")
+        self._async_engine = create_async_engine(
+            async_url,
+            pool_size = settings.DB_POOL_SIZE,
+            max_overflow = settings.DB_MAX_OVERFLOW,
+            pool_timeout = settings.DB_POOL_TIMEOUT,
+            pool_recycle = settings.DB_POOL_RECYCLE,
+            pool_pre_ping = True,
+            echo = settings.DEBUG,
+        )
+        self._async_sessionmaker = async_sessionmaker(
+            bind = self._async_engine,
+            class_ = AsyncSession,
+            autocommit = False,
+            autoflush = False,
+            expire_on_commit = False,
+        )
+
+        sync_url = base_url.set(drivername = "postgresql+psycopg2")
+        self._sync_engine = create_engine(
+            sync_url,
+            pool_size = settings.DB_POOL_SIZE,
+            max_overflow = settings.DB_MAX_OVERFLOW,
+            pool_timeout = settings.DB_POOL_TIMEOUT,
+            pool_recycle = settings.DB_POOL_RECYCLE,
+            pool_pre_ping = True,
+            echo = settings.DEBUG,
+        )
+        self._sync_sessionmaker = sessionmaker(
+            bind = self._sync_engine,
+            autocommit = False,
+            autoflush = False,
+            expire_on_commit = False,
+        )
+
+    async def close(self) -> None:
+        """
+        Dispose of all database connections
+        """
+        if self._async_engine:
+            await self._async_engine.dispose()
+            self._async_engine = None
+            self._async_sessionmaker = None
+
+        if self._sync_engine:
+            self._sync_engine.dispose()
+            self._sync_engine = None
+            
```

---

## Code Evolution

### Change Analysis for `database.py`

**What was Changed:**
The commit added a new file, `database.py`, which introduces a comprehensive database session manager class named `DatabaseSessionManager`. This class manages both synchronous and asynchronous database connections and sessions.

**Why it was Likely Changed:**
This change likely aims to centralize database management in the application. By encapsulating connection setup and session handling within a single class, the code becomes more modular and easier to maintain. The use of context managers ensures that resources are properly managed, reducing the risk of memory leaks or other resource-related issues.

**Impact on Behavior:**
The introduction of `DatabaseSessionManager` allows for consistent database interaction across both synchronous and asynchronous contexts. This can be particularly useful in applications that need to support both types of operations. The class handles session management with proper commit/rollback logic, ensuring data integrity.

**Risks or Concerns:**
- **Initialization Dependency:** The manager relies on the `settings` module for configuration parameters. If these settings are not properly configured, the manager will raise a `RuntimeError`.
- **Resource Management:** While context managers handle resource cleanup, there is still potential for issues if exceptions occur during session management.
- **Complexity:** Adding a new class increases code complexity, which may require additional documentation and testing.

Overall, this change enhances the application's database handling capabilities while introducing some dependency on configuration settings.

---

*Generated by CodeWorm on 2026-02-23 17:41*
