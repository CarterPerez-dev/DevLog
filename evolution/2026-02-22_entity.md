# entity

**Type:** Code Evolution
**Repository:** fullstack-template
**File:** stacks/go-react/go-backend/internal/auth/entity.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: bf95949c
Message: go backend to react-go stack
Author: CarterPerez-dev
File: stacks/go-react/go-backend/internal/auth/entity.go
Change type: new file

Diff:
@@ -0,0 +1,47 @@
+// AngelaMos | 2026
+// entity.go
+
+package auth
+
+import (
+	"time"
+)
+
+type RefreshToken struct {
+	ID           string     `db:"id"`
+	UserID       string     `db:"user_id"`
+	TokenHash    string     `db:"token_hash"`
+	FamilyID     string     `db:"family_id"`
+	ExpiresAt    time.Time  `db:"expires_at"`
+	CreatedAt    time.Time  `db:"created_at"`
+	IsUsed       bool       `db:"is_used"`
+	UsedAt       *time.Time `db:"used_at"`
+	RevokedAt    *time.Time `db:"revoked_at"`
+	ReplacedByID *string    `db:"replaced_by_id"`
+	UserAgent    string     `db:"user_agent"`
+	IPAddress    string     `db:"ip_address"`
+}
+
+func (t *RefreshToken) IsExpired() bool {
+	return time.Now().After(t.ExpiresAt)
+}
+
+func (t *RefreshToken) IsRevoked() bool {
+	return t.RevokedAt != nil
+}
+
+func (t *RefreshToken) IsValid() bool {
+	return !t.IsExpired() && !t.IsRevoked() && !t.IsUsed
+}
+
+func (t *RefreshToken) MarkAsUsed(replacedByID string) {
+	now := time.Now()
+	t.IsUsed = true
+	t.UsedAt = &now
+	t.ReplacedByID = &replacedByID
+}
+
+func (t *RefreshToken) Revoke() {
+	now := time.Now()
+	t.RevokedAt = &now
+}

```

---

## Code Evolution

### Change Analysis

**What was Changed:**
A new file `entity.go` was added to the Go backend module of a React-Go stack. This file defines a struct `RefreshToken` with fields for database mapping and methods to check its validity, mark it as used, and revoke it.

**Why it Was Likely Changed:**
This change likely introduces a mechanism for managing refresh tokens in the authentication system. The `RefreshToken` struct includes fields like `ExpiresAt`, `IsUsed`, and `RevokedAt` which are essential for token management. Methods such as `IsExpired()`, `IsRevoked()`, and `IsValid()` provide clear conditions under which a token should be considered invalid, while `MarkAsUsed()` and `Revoke()` allow updating the state of tokens.

**Impact on Behavior:**
This change significantly impacts how refresh tokens are handled in the backend. It ensures that only valid tokens can be used for authentication, preventing misuse or abuse. The methods provide a structured way to manage token states, ensuring security and compliance with best practices.

**Risks or Concerns:**
- **Error Handling:** While not explicitly shown, error handling should be considered when using these methods in production.
- **Concurrency Issues:** If tokens are frequently updated (e.g., by multiple users), race conditions could arise if not properly managed.
- **Performance:** Frequent updates to token states might impact performance; however, this is mitigated by the efficient use of pointers and time comparisons.

Overall, this change enhances security and maintainability in the authentication system.

---

*Generated by CodeWorm on 2026-02-22 13:40*
