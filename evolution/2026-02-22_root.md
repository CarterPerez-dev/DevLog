# root

**Type:** Code Evolution
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/secrets-scanner/internal/cli/root.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: 294169a2
Message: feat: Complete Go secrets scanner - Portia
Author: CarterPerez-dev
File: PROJECTS/intermediate/secrets-scanner/internal/cli/root.go
Change type: new file

Diff:
@@ -0,0 +1,148 @@
+// Â©AngelaMos | 2026
+// root.go
+
+package cli
+
+import (
+	"fmt"
+	"os"
+	"os/signal"
+	"syscall"
+
+	"github.com/fatih/color"
+	"github.com/spf13/cobra"
+
+	"github.com/CarterPerez-dev/portia/internal/config"
+	"github.com/CarterPerez-dev/portia/internal/ui"
+)
+
+var (
+	cfgFile    string
+	format     string
+	verbose    bool
+	noColor    bool
+	excludes   []string
+	maxSize    int64
+	enableHIBP bool
+)
+
+var rootCmd = &cobra.Command{
+	Use:   "portia",
+	Short: "Secrets scanner for codebases and git repositories",
+	Long: `Portia scans codebases and git history for leaked secrets,
+API keys, passwords, tokens, and private keys.`,
+	SilenceUsage:  true,
+	SilenceErrors: true,
+}
+
+func Execute() {
+	if err := run(); err != nil {
+		fmt.Fprintf(os.Stderr, "%s %s\n",
+			ui.Cross, ui.Red(err.Error()))
+		os.Exit(1)
+	}
+}
+
+func run() error {
+	ctx, cancel := signal.NotifyContext(
+		rootCmd.Context(), os.Interrupt, syscall.SIGTERM,
+	)
+	defer cancel()
+
+	rootCmd.SetContext(ctx)
+	return rootCmd.ExecuteContext(ctx)
+}
+
+func init() {
+	cobra.OnInitialize(initConfig)
+
+	rootCmd.PersistentFlags().StringVar(
+		&cfgFile, "config", "",
+		"config file (default .portia.toml)",
+	)
+	rootCmd.PersistentFlags().StringVarP(
+		&format, "format", "f", "",
+		"output format: terminal, json, sarif",
+	)
+	rootCmd.PersistentFlags().BoolVarP(
+		&verbose, "verbose", "v", false,
+		"verbose output",
+	)
+	rootCmd.PersistentFlags().BoolVar(
+		&noColor, "no-color", false,
+		"disable colored output",
+	)
+	rootCmd.PersistentFlags().StringSliceVarP(
+		&excludes, "exclude", "e", nil,
+		"paths to exclude (repeatable)",
+	)
+	rootCmd.PersistentFlags().Int64Var(
+		&maxSize, "max-size", 0,
+		"max file size in bytes (default 1MB)",
+	)
+	rootCmd.PersistentFlags().BoolVar(
+		&enableHIBP, "hibp", false,
+		"enable HIBP breach verification",
+	)
+
+	rootCmd.AddCommand(scanCmd)
+	rootCmd.AddCommand(gitCmd)
+	rootCmd.AddCommand(initCmd)
+	rootCmd.AddCommand(configCmd)
+	rootCmd.AddCommand(pyprojectCmd)
+
+	defaultHelp := rootCmd.HelpFunc()
+	rootCmd.SetHelpFunc(
+		func(cmd *cobra.Command, args []string) {
+			if cmd.Root() == cmd {
+				ui.PrintBannerWithArt()
+			} else {
+				ui.PrintBanner()
+			}
+			defaultHelp(cmd, args)
+		},
+	)
+}
+
+var cfg *config.Config
+
+func initConfig() {
+	if noColor {
+		color.NoColor = true
+	}
+
+	loaded, err := config.Load(cfgFile)
+	if err != nil {
+		fmt.Fprintf(os.Stderr, "%s config error: %s\n",
+			ui.Warning, err)
+	}
+	if loaded != nil {
+		cfg = loaded
+	} else {
+		cfg = &config.Config{}
+	}
+
+	if format == "" && cfg.Output.Format != "" {
+		format = cfg.Output.Format
+	}
+	if format == "" {
+		format = "terminal"
+	}
+
+	if !verbose && cfg.Output.Verbose {
+		verbose = true
+	}
+	if !noColor && cfg.Output.N
```

---

## Code Evolution

### Change Analysis

**What was Changed:**
The commit introduces a new file `root.go` in the `internal/cli` package, which sets up and executes a CLI for the `Portia` secrets scanner. The file defines command-line flags, initializes configuration settings, and handles signal notifications for graceful shutdown.

**Why it Was Likely Changed:**
This change was likely made to provide a comprehensive command-line interface (CLI) for users to interact with the `Portia` secrets scanner. By adding various flags and commands, the developers aim to make the tool more flexible and user-friendly, allowing users to customize the scan according to their needs.

**Impact on Behavior:**
The new CLI allows users to specify configuration files, output formats, verbosity levels, exclusions, maximum file sizes, and HIBP breach verification. The `Execute` function ensures that errors are handled gracefully by printing a colored error message and exiting with status 1 if an error occurs during execution.

**Risks or Concerns:**
- **Error Handling:** While the code handles some errors, it may not cover all potential issues, such as invalid configuration files or unsupported output formats.
- **Resource Management:** The use of `signal.NotifyContext` ensures that the CLI can handle interruptions gracefully. However, proper cleanup and resource management should be verified to avoid leaks.
- **Configuration Loading:** The configuration loading mechanism checks for default values if no explicit settings are provided, which is good practice but could be improved with more robust validation.

Overall, this change significantly enhances the usability of the `Portia` secrets scanner by providing a powerful CLI interface.

---

*Generated by CodeWorm on 2026-02-22 20:16*
