# metrics.types

**Type:** Code Evolution
**Repository:** oneIsNun_
**File:** react-scss/src/api/types/metrics.types.ts
**Language:** typescript
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```typescript
Commit: 4ffe4b69
Message: feat: add real-time query speeds to dashboard

Backend:
- Add current_ops array to DashboardMetrics with query details
- Add CurrentOperation type with collection, type, timing, client
- Extract collection name from namespace
- Include microseconds and milliseconds for each active operation

Frontend:
- Add CurrentOperation schema to metrics types
- Display live operations table when operations are active
- Show collection, operation type, speed (µs or ms), and client
- Style operations table with hover effects and monospace speed
- Fix undefined $bg-surface-150 variable (use $bg-overlay)

Real-time query speeds now visible in dashboard via WebSocket!
Author: CarterPerez-dev
File: react-scss/src/api/types/metrics.types.ts
Change type: modified

Diff:
@@ -49,6 +49,16 @@ export const NetworkStatsSchema = z.object({
   num_requests: z.number(),
 })
 
+export const CurrentOperationSchema = z.object({
+  opid: z.number(),
+  type: z.string(),
+  namespace: z.string(),
+  collection: z.string(),
+  microsecs_running: z.number(),
+  millis_running: z.number(),
+  client: z.string(),
+})
+
 export const DashboardMetricsSchema = z.object({
   timestamp: z.string(),
   server: ServerMetricsSchema,
@@ -58,6 +68,7 @@ export const DashboardMetricsSchema = z.object({
   memory: MemoryStatsSchema,
   network: NetworkStatsSchema,
   active_ops: z.number(),
+  current_ops: z.array(CurrentOperationSchema),
   paid_subscribers: z.number(),
 })
 
@@ -132,6 +143,7 @@ export type ConnectionStats = z.infer<typeof ConnectionStatsSchema>
 export type OpCounters = z.infer<typeof OpCountersSchema>
 export type MemoryStats = z.infer<typeof MemoryStatsSchema>
 export type NetworkStats = z.infer<typeof NetworkStatsSchema>
+export type CurrentOperation = z.infer<typeof CurrentOperationSchema>
 export type DashboardMetrics = z.infer<typeof DashboardMetricsSchema>
 export type SlowQuery = z.infer<typeof SlowQuerySchema>
 export type SlowQueryReport = z.infer<typeof SlowQueryReportSchema>

```

---

## Code Evolution

### Change Analysis

**What was Changed:**
- Added `CurrentOperation` type and schema in `metrics.types.ts`.
- Modified `DashboardMetricsSchema` to include a new `current_ops` array.
- Updated frontend to display live operations table with details like collection, operation type, speed (µs or ms), and client.

**Why it was Likely Changed:**
This change likely aims to provide real-time query performance insights directly on the dashboard. By adding detailed metrics for active operations, users can monitor current database activity and potential bottlenecks in near-real time.

**Impact on Behavior:**
The addition of `current_ops` allows the dashboard to show live operation details, enhancing monitoring capabilities. Users will now see a dynamic table listing ongoing queries with their respective performance metrics.

**Risks or Concerns:**
- **Performance Impact:** Displaying real-time data could introduce additional overhead if not optimized.
- **Data Consistency:** Ensuring that `current_ops` updates accurately and without race conditions is crucial for reliable monitoring.
- **User Experience:** The new table should be designed to handle a high number of operations smoothly, avoiding performance degradation.

Overall, this change improves the dashboard's functionality by providing more detailed insights into current database activities.

---

*Generated by CodeWorm on 2026-02-23 00:02*
