# jwt

**Type:** Code Evolution
**Repository:** fullstack-template
**File:** stacks/go-react/go-backend/internal/auth/jwt.go
**Language:** go
**Lines:** 1-1
**Complexity:** 0.0

---

## Source Code

```go
Commit: bf95949c
Message: go backend to react-go stack
Author: CarterPerez-dev
File: stacks/go-react/go-backend/internal/auth/jwt.go
Change type: new file

Diff:
@@ -0,0 +1,295 @@
+// AngelaMos | 2026
+// jwt.go
+
+package auth
+
+import (
+	"context"
+	"crypto/ecdsa"
+	"crypto/elliptic"
+	"crypto/rand"
+	"encoding/json"
+	"fmt"
+	"net/http"
+	"os"
+	"strings"
+	"time"
+
+	"github.com/google/uuid"
+	"github.com/lestrrat-go/jwx/v3/jwa"
+	"github.com/lestrrat-go/jwx/v3/jwk"
+	"github.com/lestrrat-go/jwx/v3/jwt"
+
+	"github.com/carterperez-dev/templates/go-backend/internal/config"
+	"github.com/carterperez-dev/templates/go-backend/internal/core"
+	"github.com/carterperez-dev/templates/go-backend/internal/middleware"
+)
+
+type JWTManager struct {
+	privateKey jwk.Key
+	publicKey  jwk.Key
+	publicJWKS jwk.Set
+	config     config.JWTConfig
+}
+
+func NewJWTManager(cfg config.JWTConfig) (*JWTManager, error) {
+	privateKeyPEM, err := os.ReadFile(cfg.PrivateKeyPath)
+	if err != nil {
+		return nil, fmt.Errorf("read private key: %w", err)
+	}
+
+	privateKey, err := jwk.ParseKey(privateKeyPEM, jwk.WithPEM(true))
+	if err != nil {
+		return nil, fmt.Errorf("parse private key: %w", err)
+	}
+
+	if setErr := privateKey.Set(jwk.AlgorithmKey, jwa.ES256()); setErr != nil {
+		return nil, fmt.Errorf("set algorithm: %w", setErr)
+	}
+
+	keyID := uuid.New().String()[:8]
+	if setErr := privateKey.Set(jwk.KeyIDKey, keyID); setErr != nil {
+		return nil, fmt.Errorf("set key id: %w", setErr)
+	}
+
+	publicKey, err := privateKey.PublicKey()
+	if err != nil {
+		return nil, fmt.Errorf("derive public key: %w", err)
+	}
+
+	if setErr := publicKey.Set(jwk.KeyUsageKey, "sig"); setErr != nil {
+		return nil, fmt.Errorf("set key usage: %w", setErr)
+	}
+
+	publicJWKS := jwk.NewSet()
+	if addErr := publicJWKS.AddKey(publicKey); addErr != nil {
+		return nil, fmt.Errorf("add key to set: %w", addErr)
+	}
+
+	return &JWTManager{
+		privateKey: privateKey,
+		publicKey:  publicKey,
+		publicJWKS: publicJWKS,
+		config:     cfg,
+	}, nil
+}
+
+func GenerateKeyPair(privateKeyPath, publicKeyPath string) error {
+	privateKey, err := ecdsa.GenerateKey(elliptic.P256(), rand.Reader)
+	if err != nil {
+		return fmt.Errorf("generate key: %w", err)
+	}
+
+	jwkPrivate, err := jwk.Import(privateKey)
+	if err != nil {
+		return fmt.Errorf("import private key: %w", err)
+	}
+
+	keyID := uuid.New().String()[:8]
+	if setErr := jwkPrivate.Set(jwk.KeyIDKey, keyID); setErr != nil {
+		return fmt.Errorf("set key id: %w", setErr)
+	}
+	if setErr := jwkPrivate.Set(jwk.AlgorithmKey, jwa.ES256()); setErr != nil {
+		return fmt.Errorf("set algorithm: %w", setErr)
+	}
+
+	privatePEM, err := jwk.Pem(jwkPrivate)
+	if err != nil {
+		return fmt.Errorf("encode private key: %w", err)
+	}
+
+	if writeErr := os.WriteFile(privateKeyPath, privatePEM, 0o600); writeErr != nil {
+		return fmt.Errorf("write private key: %w", writeErr)
+	}
+
+	jwkPublic, err := jwkPrivate.PublicKey()
+	if err != nil {
+		return fmt.Error
```

---

## Code Evolution

### Change Analysis

**What was Changed**: 
A new file `jwt.go` was added to the Go backend, introducing a JWT manager for handling access tokens. The code includes functions for generating and verifying JWTs using EC256 elliptic curve cryptography.

**Why it was Likely Changed**: 
This change likely aims to implement secure authentication and authorization mechanisms in the application stack by leveraging JSON Web Tokens (JWT). The introduction of JWT support is crucial for maintaining session state across multiple services, ensuring that only authorized users can access protected resources.

**Impact on Behavior**: 
- **Token Generation**: The `CreateAccessToken` function generates a signed JWT with claims such as user ID, role, and expiration time.
- **Token Verification**: The `VerifyAccessToken` function checks the validity of an incoming token against predefined criteria like issuer, audience, and expiration.

**Risks or Concerns**: 
1. **Security Risks**: Improper handling of private keys could lead to unauthorized access if they are compromised.
2. **Error Handling**: While error handling is present, it should be thoroughly tested to ensure robustness.
3. **Performance Considerations**: Verifying tokens can introduce latency; however, this is mitigated by efficient implementation.

This change enhances the security and functionality of the application by implementing JWT-based authentication, ensuring that only valid and authorized users can access protected resources.

---

*Generated by CodeWorm on 2026-02-22 13:47*
