# CodeWormNotifier

**Type:** Class Documentation
**Repository:** CodeWorm
**File:** codeworm/core/notifier.py
**Language:** python
**Lines:** 17-95
**Complexity:** 0.0

---

## Source Code

```python
class CodeWormNotifier:
    """
    Telegram notification wrapper for the CodeWorm daemon
    """
    def __init__(self, settings: TelegramSettings) -> None:
        self._notifier = Notifier(
            config = TelehookConfig(
                bot_token = settings.bot_token,
                chat_id = settings.chat_id,
            ),
            middleware = [
                RateLimiter(max_per_second = 1,
                            burst = 3),
                Dedup(window_seconds = 300),
                Retry(max_attempts = 3),
            ],
        )

    async def send_alert(
        self,
        title: str,
        last_error: str | None = None,
        details: str | None = None,
    ) -> None:
        try:
            msg = alert_formatter(
                title = title,
                app = "CodeWorm",
                last_error = last_error,
                details = details,
            )
            await self._notifier.send(msg)
        except Exception:  # noqa: S110
            pass

    async def send_error(self, exc: BaseException, component: str) -> None:
        try:
            msg = error_formatter(
                exception = exc,
                component = component,
                app = "CodeWorm"
            )
            await self._notifier.send(msg)
        except Exception:  # noqa: S110
            pass

    def send_alert_sync(
        self,
        title: str,
        last_error: str | None = None,
        details: str | None = None,
    ) -> None:
        try:
            msg = alert_formatter(
                title = title,
                app = "CodeWorm",
                last_error = last_error,
                details = details,
            )
            self._notifier.send_sync(msg)
        except Exception:  # noqa: S110
            pass

    def send_error_sync(self, exc: BaseException, component: str) -> None:
        try:
            msg = error_formatter(
                exception = exc,
                component = component,
                app = "CodeWorm"
            )
            self._notifier.send_sync(msg)
        except Exception:  # noqa: S110
            pass

    async def close(self) -> None:
        try:  # noqa: SIM105
            await self._notifier.close()
        except Exception:  # noqa: S110
            pass
```

---

## Class Documentation

### CodeWormNotifier

**Class Responsibility and Purpose:**
The `CodeWormNotifier` class is responsible for handling notifications via Telegram for the CodeWorm daemon. It encapsulates the logic to send both alert and error messages, ensuring that these communications are rate-limited, deduplicated, and retried if necessary.

**Public Interface (Key Methods):**
- **`send_alert(title: str, last_error: str | None = None, details: str | None = None)`**: Asynchronously sends an alert message with the specified title, error, and optional details.
- **`send_error(exc: BaseException, component: str)`**: Asynchronously sends an error message containing the exception and its context.
- **`send_alert_sync(title: str, last_error: str | None = None, details: str | None = None)`**: Synchronously sends an alert message with the specified title, error, and optional details.
- **`send_error_sync(exc: BaseException, component: str)`**: Synchronously sends an error message containing the exception and its context.
- **`close()`**: Closes the notifier gracefully, ensuring any open connections are properly terminated.

**Design Patterns Used:**
The class utilizes several design patterns:
- **Factory Pattern**: The `Notifier` instance is created with a configuration that includes middleware for rate limiting, deduplication, and retries.
- **Strategy Pattern**: Different strategies (middleware) can be applied to the notifier's behavior without changing its core functionality.

**How it Fits in the Architecture:**
The `CodeWormNotifier` class serves as an intermediary between the CodeWorm daemon and external notification services. It ensures that notifications are handled efficiently, with mechanisms for rate limiting and error handling. This design allows for easy integration and maintenance of the notification system within the broader architecture of the CodeWorm application.

---

*Generated by CodeWorm on 2026-02-28 14:48*
