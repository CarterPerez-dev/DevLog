# ReferralCode

**Type:** Class Documentation
**Repository:** stripe-referral
**File:** src/stripe_referral/models/ReferralCode.py
**Language:** python
**Lines:** 38-84
**Complexity:** 0.0

---

## Source Code

```python
class ReferralCode(Base, TimestampMixin):
    """
    Individual referral code for a user
    """
    __tablename__ = "referral_codes"

    id: Mapped[int] = mapped_column(
        primary_key = True,
        autoincrement = True
    )
    code: Mapped[str] = mapped_column(
        String(MAX_CODE_LENGTH),
        unique = True,
        index = True
    )

    user_id: Mapped[str] = mapped_column(
        String(MAX_USER_ID_LENGTH),
        index = True
    )
    program_id: Mapped[int] = mapped_column(
        ForeignKey("referral_programs.id"),
        nullable = False
    )

    status: Mapped[str] = mapped_column(
        String(20),
        default = ReferralCodeStatus.ACTIVE.value,
        index = True
    )

    uses_count: Mapped[int] = mapped_column(Integer, default = 0)
    max_uses: Mapped[int | None] = mapped_column(Integer, nullable = True)

    expires_at: Mapped[datetime | None] = mapped_column(
        DateTime(timezone = True),
        nullable = True
    )

    program: Mapped[ReferralProgram] = relationship(
        "ReferralProgram",
        back_populates = "codes"
    )
    trackings: Mapped[list[ReferralTracking]] = relationship(
        "ReferralTracking",
        back_populates = "code"
    )
```

---

## Class Documentation

### ReferralCode Class Documentation

**Class Responsibility and Purpose:**
The `ReferralCode` class represents an individual referral code for a user within the `stripe-referral` application. It manages the lifecycle of referral codes, including their creation, usage tracking, status updates, and expiration.

**Public Interface (Key Methods):**
- No public methods are defined in this class; all interactions occur through relationships with other classes or via database operations.
- Key attributes include:
  - `id`: Unique identifier for each code.
  - `code`: The referral code string.
  - `user_id`: Identifier of the user associated with the code.
  - `program_id`: Identifier of the referral program to which the code belongs.
  - `status`: Current status (e.g., active, expired).
  - `uses_count`: Number of times the code has been used.
  - `max_uses`: Maximum number of uses allowed for the code.
  - `expires_at`: Timestamp indicating when the code expires.

**Design Patterns Used:**
- **Relationships**: The class utilizes relationships to link with other entities such as `ReferralProgram` and `ReferralTracking`, enabling a many-to-one relationship with programs and a one-to-many relationship with tracking records. This is achieved using SQLAlchemy's `relationship` method.
- **TimestampMixin**: Inherited from `TimestampMixin`, this class automatically manages creation and update timestamps for each record.

**How it Fits in the Architecture:**
The `ReferralCode` class plays a crucial role in managing referral programs by providing unique codes to users. It integrates with other models like `ReferralProgram` and `ReferralTracking` through relationships, allowing for comprehensive tracking of code usage and program performance. This class is part of the data model layer, ensuring that all interactions related to referral codes are encapsulated within a single entity, adhering to the Single Responsibility Principle.

---

*Generated by CodeWorm on 2026-02-18 23:57*
