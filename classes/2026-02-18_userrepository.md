# UserRepository

**Type:** Class Documentation
**Repository:** my-portfolio
**File:** v1/backend/app/user/repository.py
**Language:** python
**Lines:** 15-109
**Complexity:** 0.0

---

## Source Code

```python
class UserRepository(BaseRepository[User]):
    """
    Repository for User model database operations
    """
    model = User

    @classmethod
    async def get_by_email(
        cls,
        session: AsyncSession,
        email: str,
    ) -> User | None:
        """
        Get user by email address
        """
        result = await session.execute(select(User).where(User.email == email))
        return result.scalars().first()

    @classmethod
    async def get_by_id(
        cls,
        session: AsyncSession,
        id: UUID,
    ) -> User | None:
        """
        Get user by ID
        """
        return await session.get(User, id)

    @classmethod
    async def email_exists(
        cls,
        session: AsyncSession,
        email: str,
    ) -> bool:
        """
        Check if email is already registered
        """
        result = await session.execute(
            select(User.id).where(User.email == email)
        )
        return result.scalars().first() is not None

    @classmethod
    async def create_user(
        cls,
        session: AsyncSession,
        email: str,
        hashed_password: str,
        full_name: str | None = None,
        role: UserRole = UserRole.USER,
    ) -> User:
        """
        Create a new user
        """
        user = User(
            email = email,
            hashed_password = hashed_password,
            full_name = full_name,
            role = role,
        )
        session.add(user)
        await session.flush()
        await session.refresh(user)
        return user

    @classmethod
    async def update_password(
        cls,
        session: AsyncSession,
        user: User,
        hashed_password: str,
    ) -> User:
        """
        Update user password and increment token version
        """
        user.hashed_password = hashed_password
        user.increment_token_version()
        await session.flush()
        await session.refresh(user)
        return user

    @classmethod
    async def increment_token_version(
        cls,
        session: AsyncSession,
        user: User,
    ) -> User:
        """
        Invalidate all user tokens
        """
        user.increment_token_version()
        await session.flush()
        await session.refresh(user)
        return user
```

---

## Class Documentation

### UserRepository Documentation

**Class Responsibility and Purpose**
The `UserRepository` class is responsible for handling database operations related to the `User` model in a Python application using SQLAlchemy. It provides a clean, abstracted interface for common user management tasks such as fetching users by email or ID, checking if an email is registered, creating new users, updating passwords, and invalidating tokens.

**Public Interface**
- **get_by_email**: Retrieves a user by their email address.
- **get_by_id**: Fetches a user by their unique identifier (ID).
- **email_exists**: Checks if an email address is already in use.
- **create_user**: Creates a new user with specified details.
- **update_password**: Updates the password and increments the token version for a given user.
- **increment_token_version**: Invalidates all tokens associated with a user.

**Design Patterns Used**
The class employs the **Repository Pattern**, which abstracts database operations, making it easier to switch between different data storage mechanisms. The use of `@classmethod` methods ensures that these operations can be called without instantiating the repository itself.

**How It Fits in the Architecture**
In the architecture of the application, `UserRepository` acts as a central hub for all user-related database interactions. It is designed to be agnostic of the specific implementation details, allowing the application to easily switch between different data storage solutions if needed. This class interacts with other components such as the `User` model and SQLAlchemy sessions, providing a robust interface for managing users in the system.

---

*Generated by CodeWorm on 2026-02-18 19:48*
