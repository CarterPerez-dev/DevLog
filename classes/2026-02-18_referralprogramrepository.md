# ReferralProgramRepository

**Type:** Class Documentation
**Repository:** stripe-referral
**File:** src/stripe_referral/repositories/program_repo.py
**Language:** python
**Lines:** 14-74
**Complexity:** 0.0

---

## Source Code

```python
class ReferralProgramRepository(BaseRepository[ReferralProgram]):
    """
    Repository for ReferralProgram database operations
    """
    def __init__(self, db: Session) -> None:
        """
        Initialize with ReferralProgram model
        """
        super().__init__(db, ReferralProgram)

    def get_by_key(self, program_key: str) -> ReferralProgram | None:
        """
        Get program by unique program key
        """
        stmt = select(ReferralProgram).where(
            ReferralProgram.program_key == program_key
        )
        return self.db.execute(stmt).scalar_one_or_none()

    def get_by_name(self, name: str) -> ReferralProgram | None:
        """
        Get program by unique name
        """
        stmt = select(ReferralProgram).where(ReferralProgram.name == name)
        return self.db.execute(stmt).scalar_one_or_none()

    def get_active_programs(self) -> list[ReferralProgram]:
        """
        Get all active programs
        """
        stmt = select(ReferralProgram).where(ReferralProgram.is_active)
        return list(self.db.execute(stmt).scalars().all())

    def deactivate_program(
        self,
        program_id: int
    ) -> ReferralProgram | None:
        """
        Deactivate a program
        """
        program = self.get_by_id(program_id)
        if not program:
            return None

        program.is_active = False
        self.db.commit()
        self.db.refresh(program)
        return program

    def activate_program(self, program_id: int) -> ReferralProgram | None:
        """
        Activate a program
        """
        program = self.get_by_id(program_id)
        if not program:
            return None

        program.is_active = True
        self.db.commit()
        self.db.refresh(program)
        return program
```

---

## Class Documentation

### ReferralProgramRepository Documentation

**Class Responsibility and Purpose:**
The `ReferralProgramRepository` class is responsible for managing database operations related to `ReferralProgram` entities, ensuring that CRUD-like operations are encapsulated within a consistent interface.

**Public Interface (Key Methods):**
- **`get_by_key(program_key: str) -> ReferralProgram | None`:** Retrieves a referral program by its unique key.
- **`get_by_name(name: str) -> ReferralProgram | None`:** Fetches a referral program by name.
- **`get_active_programs() -> list[ReferralProgram]`:** Returns all active referral programs.
- **`deactivate_program(program_id: int) -> ReferralProgram | None`:** Deactivates a specific referral program by ID.
- **`activate_program(program_id: int) -> ReferralProgram | None`:** Activates a specific referral program by ID.

**Design Patterns Used:**
The class leverages the **Repository Pattern**, which abstracts data access and encapsulates database operations. It also uses SQLAlchemy's ORM for querying and managing database interactions.

**How it Fits in the Architecture:**
`ReferralProgramRepository` acts as an intermediary between the application logic and the database, providing a clean interface for interacting with `ReferralProgram` entities. This design promotes separation of concerns and makes the codebase more maintainable by decoupling business logic from data access operations. It is part of the repository layer in the architecture, ensuring that all database interactions are managed through this single class.

---

*Generated by CodeWorm on 2026-02-18 22:59*
