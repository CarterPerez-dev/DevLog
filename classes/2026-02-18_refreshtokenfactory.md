# RefreshTokenFactory

**Type:** Class Documentation
**Repository:** fullstack-template
**File:** stacks/fastapi-react/backend/conftest.py
**Language:** python
**Lines:** 163-190
**Complexity:** 0.0

---

## Source Code

```python
class RefreshTokenFactory:
    """
    Factory for creating test refresh tokens
    """
    @classmethod
    async def create(
        cls,
        session: AsyncSession,
        user: User,
        *,
        is_revoked: bool = False,
        expires_delta: timedelta = timedelta(days = 7),
    ) -> tuple[RefreshToken,
               str]:
        raw_token = secrets.token_urlsafe(32)
        token_hash = hashlib.sha256(raw_token.encode()).hexdigest()

        token = RefreshToken(
            user_id = user.id,
            token_hash = token_hash,
            family_id = uuid4(),
            expires_at = datetime.now(UTC) + expires_delta,
            is_revoked = is_revoked,
        )
        session.add(token)
        await session.flush()
        await session.refresh(token)
        return token, raw_token
```

---

## Class Documentation

### RefreshTokenFactory Documentation

**Class Responsibility and Purpose:**
The `RefreshTokenFactory` class is responsible for generating test refresh tokens for a FastAPI application. It ensures that each token is unique, secure, and properly stored in the database.

**Public Interface (Key Methods):**
- **`create(session: AsyncSession, user: User, *, is_revoked: bool = False, expires_delta: timedelta = timedelta(days=7)) -> tuple[RefreshToken, str]`:** This method creates a new refresh token for a given `User`. It returns the created `RefreshToken` object and its raw token string.

**Design Patterns Used:**
- **Factory Method:** The class acts as a factory that generates `RefreshToken` objects. This pattern is used to encapsulate the creation logic, making it flexible and easy to extend in the future if different types of tokens need to be created.

**How It Fits in the Architecture:**
The `RefreshTokenFactory` is part of the backend's test utilities, specifically designed for generating test data in integration or unit tests. It interacts with an `AsyncSession` from a database session manager and uses SQLAlchemy models (`User`, `RefreshToken`) to manage token creation. The method ensures that tokens are securely generated using URL-safe random strings and stored with appropriate expiration times and revocation statuses, fitting into the overall security and testing architecture of the application.

---

*Generated by CodeWorm on 2026-02-18 16:08*
