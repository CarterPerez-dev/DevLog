# AuthService

**Type:** Class Documentation
**Repository:** Cybersecurity-Projects
**File:** TEMPLATES/fullstack-template/examples/minimal-production/backend/app/auth/service.py
**Language:** python
**Lines:** 25-82
**Complexity:** 0.0

---

## Source Code

```python
class AuthService:
    """
    Business logic for authentication operations
    """
    def __init__(self, session: AsyncSession) -> None:
        self.session = session

    async def authenticate(
        self,
        email: str,
        password: str,
    ) -> tuple[str,
               User]:
        """
        Authenticate user and create access token
        """
        user = await UserRepository.get_by_email(self.session, email)
        hashed_password = user.hashed_password if user else None

        is_valid, new_hash = await verify_password_with_timing_safety(
            password, hashed_password
        )

        if not is_valid or user is None:
            raise InvalidCredentials()

        if not user.is_active:
            raise InvalidCredentials()

        if new_hash:
            await UserRepository.update_password(
                self.session,
                user,
                new_hash
            )

        access_token = create_access_token(user.id)

        return access_token, user

    async def login(
        self,
        email: str,
        password: str,
    ) -> TokenWithUserResponse:
        """
        Login and return token with user data
        """
        access_token, user = await self.authenticate(
            email,
            password,
        )

        response = TokenWithUserResponse(
            access_token = access_token,
            user = UserResponse.model_validate(user),
        )
        return response
```

---

## Class Documentation

### AuthService Documentation

**Class Responsibility and Purpose:**
The `AuthService` class handles authentication operations, including user validation and token generation. It ensures that only active users with valid credentials can log in.

**Public Interface (Key Methods):**
- **`authenticate(email: str, password: str) -> tuple[str, User]`:** Authenticates a user by verifying their email and password. If the credentials are correct and the user is active, it creates an access token.
- **`login(email: str, password: str) -> TokenWithUserResponse`:** A convenience method that calls `authenticate` and returns a structured response containing the access token and user data.

**Design Patterns Used:**
- **Strategy Pattern:** The class delegates the responsibility of password verification to the `verify_password_with_timing_safety` function.
- **Repository Pattern:** It interacts with a `UserRepository` to retrieve and update user records, ensuring separation of concerns.

**How it Fits in the Architecture:**
`AuthService` acts as a service layer that encapsulates business logic for authentication. It interfaces with the database through the `UserRepository`, which manages persistence operations. The class ensures that all authentication-related tasks are handled in one place, promoting maintainability and testability. Its methods return structured responses, making it easy to integrate with other parts of the application or external services.

---

*Generated by CodeWorm on 2026-02-18 11:58*
