# BulkUploadService

**Type:** Class Documentation
**Repository:** vuemantics
**File:** backend/services/bulk_upload_service.py
**Language:** python
**Lines:** 59-327
**Complexity:** 0.0

---

## Source Code

```python
class BulkUploadService:
    """
    Service for handling bulk upload operations

    Responsibilities:
    - Validate bulk upload requests
    - Create batch records
    - Process and save files
    - Queue batches for background processing
    - Track batch status
    """
    @staticmethod
    def _validate_bulk_upload(files: list[UploadFile]) -> None:
        """
        Validate bulk upload request

        Args:
            files: List of uploaded files

        Raises:
            ValidationError: If validation fails
        """
        if len(files) == 0:
            raise ValidationError("No files provided")

        if len(files) > config.MAX_BULK_FILES:
            raise ValidationError(
                f"Too many files. Maximum {config.MAX_BULK_FILES} files per batch"
            )

        total_size = sum(file.size or 0 for file in files)
        if total_size > config.MAX_BULK_SIZE:
            max_gb = config.MAX_BULK_SIZE / (1024 * 1024 * 1024)
            raise ValidationError(
                f"Total file size exceeds {max_gb}GB limit"
            )

    @staticmethod
    async def create_bulk_upload(
        user_id: UUID,
        files: list[UploadFile],
    ) -> BulkUploadResult:
        """
        Create and queue a bulk upload batch

        Args:
            user_id: User's UUID
            files: List of files to upload

        Returns:
            BulkUploadResult with batch info

        Process:
        1. Validate bulk upload request
        2. Create batch record
        3. Save each file to storage
        4. Create upload records linked to batch
        5. Queue batch for background processing
        6. Return batch ID and results
        """
        # Validate bulk upload
        BulkUploadService._validate_bulk_upload(files)

        total_size = sum(file.size or 0 for file in files)
        logger.info(
            f"Creating bulk upload for user {user_id}: "
            f"{len(files)} files, {total_size / (1024 * 1024):.2f} MB total"
        )

        batch = await UploadBatch.create(
            user_id = user_id,
            total_uploads = len(files),
        )

        logger.info(f"Created batch {batch.id} with {len(files)} uploads")

        upload_ids = []
        failed_files = []

        for file in files:
            try:
                if not file.filename:
                    failed_files.append(
                        {
                            "filename": "unknown",
                            "error": "No filename provided",
                        }
                    )
                    continue

                upload_id = uuid4()

                file_content = await file.read()
                file_size = len(file_content)

                await file.seek(0)

                file_type, extension = await storage_service.validate_file(
                    filename = file.filename,
                    mime_type = file.content_type or "application/octet-stream",
                    
```

---

## Class Documentation

### BulkUploadService Documentation

**Class Responsibility and Purpose:**
The `BulkUploadService` class is responsible for handling bulk file upload operations, including validation, batch creation, file processing, storage, and background queueing. It ensures that uploaded files meet size and quantity constraints before saving them to the storage system.

**Public Interface (Key Methods):**
- `_validate_bulk_upload(files: list[UploadFile])`: Validates the bulk upload request.
- `create_bulk_upload(user_id: UUID, files: list[UploadFile]) -> BulkUploadResult`: Creates a batch record, processes and saves each file, and queues the batch for background processing.

**Design Patterns Used:**
The class employs the **Factory Method** pattern implicitly through its static methods. It also uses **Observer** pattern indirectly by logging events and errors, which can be observed by external systems or developers.

**How it Fits in the Architecture:**
`BulkUploadService` acts as a central service for bulk file uploads, interacting with `UploadBatch`, `Upload`, and `storage_service`. It ensures that all operations related to bulk uploads are encapsulated within this class, making the system more modular and easier to maintain. The service communicates with other components via static methods, adhering to the Single Responsibility Principle by focusing solely on handling bulk upload logic.

---

*Generated by CodeWorm on 2026-02-19 02:49*
