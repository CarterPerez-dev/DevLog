# CodeAnalyzer

**Type:** Class Documentation
**Repository:** CodeWorm
**File:** codeworm/analysis/analyzer.py
**Language:** python
**Lines:** 50-286
**Complexity:** 0.0

---

## Source Code

```python
class CodeAnalyzer:
    """
    Main code analysis engine
    Combines parsing, complexity analysis, and interest scoring
    """
    def __init__(
        self,
        repos: list[RepoEntry],
        settings: AnalyzerSettings | None = None,
    ) -> None:
        """
        Initialize analyzer with repository configurations
        """
        self.repos = repos
        self.settings = settings
        self.repo_selector = WeightedRepoSelector(repos)
        self.scanner = RepoScanner(
            include_patterns = settings.include_patterns if settings else None,
            exclude_patterns = settings.exclude_patterns if settings else None,
        )
        self.complexity_analyzer = ComplexityAnalyzer()
        self.scorer = InterestScorer()

        self._git_repos: dict[Path, Repo | None] = {}

        ParserManager.initialize()

    def _get_git_repo(self, repo_path: Path) -> Repo | None:
        """
        Get or create git repo instance for a path
        """
        if repo_path in self._git_repos:
            return self._git_repos[repo_path]
        try:
            repo = Repo(repo_path, search_parent_directories = True)
            git_root = Path(repo.working_dir)
            if git_root in self._git_repos:
                repo.close()
                self._git_repos[repo_path] = self._git_repos[git_root]
            else:
                self._git_repos[git_root] = repo
                self._git_repos[repo_path] = repo
        except InvalidGitRepositoryError:
            self._git_repos[repo_path] = None
        return self._git_repos[repo_path]

    def close_repos(self) -> None:
        """
        Close all cached git repo handles and clear the cache
        """
        seen = set()
        for repo in self._git_repos.values():
            if repo is not None and id(repo) not in seen:
                seen.add(id(repo))
                try:  # noqa: SIM105
                    repo.close()
                except Exception:  # noqa: S110
                    pass
        self._git_repos.clear()

    def analyze_file(self,
                     scanned_file: ScannedFile) -> Iterator[AnalysisCandidate]:
        """
        Analyze a single file and yield documentation candidates
        """
        try:
            source = scanned_file.path.read_text(encoding = "utf-8")
        except Exception:
            return

        try:
            extractor = CodeExtractor(source, scanned_file.language)
        except Exception:
            return

        complexity_results = self.complexity_analyzer.analyze_source(
            source,
            str(scanned_file.path),
        )
        complexity_map = {m.name: m for m in complexity_results}

        git_repo = self._get_git_repo(scanned_file.path.parent)
        if git_repo:
            self.scorer.git_repo = git_repo

        for parsed_func in extractor.extract_functions():
            try:
                if self._should_skip_function(parsed_func):
                    continue

```

---

## Class Documentation

### CodeAnalyzer Documentation

**Class Responsibility and Purpose:**
The `CodeAnalyzer` class is the central component of the code analysis engine, responsible for combining parsing, complexity analysis, and interest scoring to generate documentation candidates from source code files.

**Public Interface (Key Methods):**
- **`__init__(repos: list[RepoEntry], settings: AnalyzerSettings | None = None)`**: Initializes the analyzer with repository configurations.
- **`_get_git_repo(repo_path: Path) -> Repo | None`**: Retrieves or creates a Git repository instance for a given path.
- **`close_repos()`**: Closes all cached git repo handles and clears the cache.
- **`analyze_file(scanned_file: ScannedFile) -> Iterator[AnalysisCandidate]`**: Analyzes a single file, yielding documentation candidates.

**Design Patterns Used:**
- **Factory Pattern**: `ParserManager.initialize()` initializes parsing tools.
- **Strategy Pattern**: The complexity analysis is delegated to the `ComplexityAnalyzer`, and scoring is handled by the `InterestScorer`.

**Relationship to Other Classes:**
- **`RepoEntry`**: Represents repository configurations.
- **`AnalyzerSettings`**: Contains settings for inclusion/exclusion patterns.
- **`WeightedRepoSelector`**: Selects repositories based on weights.
- **`RepoScanner`**: Scans files according to include/exclude patterns.
- **`ComplexityAnalyzer`**: Analyzes code complexity.
- **`InterestScorer`**: Scores the interest of functions based on various metrics.

**State Management Approach:**
The class maintains a dictionary `_git_repos` to cache Git repository instances, optimizing repeated access. The `close_repos()` method ensures resources are properly released when analysis is complete.

---

*Generated by CodeWorm on 2026-02-28 13:07*
