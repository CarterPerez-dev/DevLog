# Transport

**Type:** Class Documentation
**Repository:** Telehook
**File:** src/telehook/transport.py
**Language:** python
**Lines:** 27-58
**Complexity:** 0.0

---

## Source Code

```python
class Transport:
    def __init__(self, config: TelehookConfig):
        self._config = config
        self._client = httpx.AsyncClient()

    async def send(self, message: Message) -> dict[str, Any]:
        payload = message.to_payload(chat_id = self._config.chat_id)
        response = await self._client.post(self._config.send_url, json = payload)
        data = response.json()

        if not data.get("ok"):
            retry_after = None
            params = data.get("parameters", {})
            if params:
                retry_after = params.get("retry_after")
            raise TelegramAPIError(
                status_code = response.status_code,
                description = data.get("description",
                                       "Unknown error"),
                retry_after = retry_after,
            )

        return data["result"]

    async def close(self) -> None:
        await self._client.aclose()

    async def __aenter__(self) -> "Transport":
        return self

    async def __aexit__(self, *exc: object) -> None:
        await self.close()
```

---

## Class Documentation

### Transport Class Documentation

**Class Responsibility and Purpose:**
The `Transport` class is responsible for sending messages to a Telegram chat using the Telehook API. It encapsulates the configuration details, HTTP client setup, and message sending logic.

**Public Interface (Key Methods):**
- **`__init__(self, config: TelehookConfig)`**: Initializes the transport with a `TelehookConfig` object.
- **`send(self, message: Message) -> dict[str, Any]`**: Sends a message to the configured chat and returns the API response as a dictionary.
- **`close(self) -> None`**: Closes the underlying HTTP client session.
- **`__aenter__(self) -> "Transport"`**: Context manager entry point for async operations.
- **`__aexit__(self, *exc: object) -> None`**: Context manager exit point that ensures the transport is properly closed.

**Design Patterns Used:**
The class utilizes the **Context Manager** pattern via `__aenter__` and `__aexit__` methods to manage asynchronous resources effectively. It also employs error handling through custom exceptions, ensuring robustness in API interactions.

**How it Fits in the Architecture:**
In the Telehook architecture, the `Transport` class acts as a bridge between application logic and the Telegram API. It adheres to the Single Responsibility Principle by focusing solely on message sending operations. The class interacts with other components like `TelehookConfig` for configuration settings and `Message` for constructing payloads, making it modular and easy to maintain.

---

*Generated by CodeWorm on 2026-02-28 21:51*
