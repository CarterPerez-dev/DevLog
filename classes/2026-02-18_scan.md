# Scan

**Type:** Class Documentation
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/api-security-scanner/backend/models/Scan.py
**Language:** python
**Lines:** 23-84
**Complexity:** 0.0

---

## Source Code

```python
class Scan(BaseModel):
    """
    Stores metadata about scans performed on target URLs
    """

    __tablename__ = "scans"

    user_id = Column(
        Integer,
        ForeignKey("users.id",
                   ondelete = "CASCADE"),
        nullable = False,
        index = True,
    )
    target_url = Column(
        String(settings.URL_MAX_LENGTH),
        nullable = False,
    )
    scan_date = Column(
        DateTime(timezone = True),
        default = lambda: datetime.now(UTC),
        nullable = False,
    )

    user = relationship("User", backref = "scans")
    test_results = relationship(
        "TestResult",
        back_populates = "scan",
        cascade = "all, delete-orphan",
    )

    def __repr__(self) -> str:
        """
        String representation of Scan
        """
        return f"<Scan(id={self.id}, target_url={self.target_url}, user_id={self.user_id})>"

    @property
    def has_vulnerabilities(self) -> bool:
        """
        Check if scan found any vulnerabilities

        Returns:
            bool: True if any test result is vulnerable
        """
        return any(
            result.status == "vulnerable"
            for result in self.test_results
        )

    @property
    def vulnerability_count(self) -> int:
        """
        Count of vulnerabilities found in this scan

        Returns:
            int: Number of vulnerable test results
        """
        return sum(
            1 for result in self.test_results
            if result.status == "vulnerable"
        )
```

---

## Class Documentation

### Scan Class Documentation

**Class Responsibility and Purpose:**
The `Scan` class represents metadata about security scans performed on target URLs. It stores information such as the user who initiated the scan, the target URL, the date of the scan, and associated test results.

**Public Interface (Key Methods):**
- **Constructor:** Initializes a new `Scan` instance with necessary attributes.
- **`__repr__()` Method:** Provides a string representation of the `Scan` object for debugging purposes.
- **`has_vulnerabilities()` Property:** Checks if any of the associated test results indicate vulnerabilities.
- **`vulnerability_count()` Property:** Returns the count of vulnerable test results.

**Design Patterns Used:**
The class utilizes Python's descriptor pattern through properties (`has_vulnerabilities`, `vulnerability_count`) to encapsulate logic for retrieving scan-related information. It also employs SQLAlchemy ORM relationships, specifically using `relationship` and `back_populates` decorators to manage associations with `User` and `TestResult` classes.

**Relationship to Other Classes:**
- **User:** A one-to-many relationship where a user can have multiple scans.
- **TestResult:** A many-to-one relationship where each scan can have multiple test results, and these results are managed via cascade operations (`all, delete-orphan`).

**State Management Approach:**
The class manages its state through SQLAlchemy columns and relationships. The `scan_date` column is auto-populated with the current UTC datetime upon creation. The `user_id` column ensures referential integrity by cascading deletes to related user records.

This class fits into the architecture as a core model for managing scan metadata, facilitating efficient retrieval and analysis of security test results in an API security scanner application.

---

*Generated by CodeWorm on 2026-02-18 11:51*
