# PayoutService

**Type:** Class Documentation
**Repository:** stripe-referral
**File:** src/stripe_referral/services/payout_service.py
**Language:** python
**Lines:** 38-307
**Complexity:** 0.0

---

## Source Code

```python
class PayoutService:
    """
    Service for payout business logic
    """
    @staticmethod
    def _get_adapter(
        adapter_type: str,
        adapter_config: dict[str,
                             Any] | None = None
    ) -> PayoutAdapter:
        """
        Factory method to get the appropriate payout adapter instance
        """
        config = adapter_config or {}

        if adapter_type == AdapterType.MANUAL.value:
            return ManualBankAdapter()
        if adapter_type == AdapterType.STRIPE_CONNECT.value:
            api_key = config.get("api_key", "")
            return StripeConnectAdapter(api_key = api_key)
        if adapter_type == AdapterType.WISE.value:
            api_token = config.get("api_token", "")
            sandbox = config.get("sandbox", False)
            return WiseAdapter(api_token = api_token, sandbox = sandbox)

        raise InvalidRecipientDataError(
            f"Unknown adapter type: {adapter_type}",
            adapter_type = adapter_type,
        )

    @staticmethod
    def create_program(
        db: Session,
        name: str,
        program_key: str,
        reward_amount: float,
        *,
        reward_currency: str = CurrencyCode.USD.value,
        reward_type: str = RewardType.ONE_TIME.value,
        adapter_type: str = AdapterType.MANUAL.value,
        max_rewards_per_user: int | None = None,
        conversion_window_days: int | None = None,
        adapter_config: dict[str,
                             Any] | None = None,
    ) -> ProgramInfo:
        """
        Create a new referral program
        """
        valid_adapter_types = [at.value for at in AdapterType]
        if adapter_type not in valid_adapter_types:
            raise InvalidRecipientDataError(
                f"Invalid adapter_type. Must be one of: {valid_adapter_types}",
                adapter_type = adapter_type,
            )

        program_repo = ReferralProgramRepository(db)

        program = program_repo.create(
            name = name,
            program_key = program_key,
            reward_amount = reward_amount,
            reward_currency = reward_currency,
            reward_type = reward_type,
            adapter_type = adapter_type,
            max_rewards_per_user = max_rewards_per_user,
            conversion_window_days = conversion_window_days,
            adapter_config = adapter_config or {},
        )

        return ProgramInfo(
            id = program.id,
            name = program.name,
            program_key = program.program_key,
            reward_amount = program.reward_amount,
            reward_currency = program.reward_currency,
            reward_type = program.reward_type,
            is_active = program.is_active,
        )

    @staticmethod
    def get_program_info(db: Session, program_key: str) -> ProgramInfo:
        """
        Get program information by key
        """
        program_repo = ReferralProgramRepository(db)
        program = program_repo.get_by_key(program
```

---

## Class Documentation

### PayoutService Documentation

**Class Responsibility and Purpose:**
The `PayoutService` class is responsible for handling payout-related business logic, including creating programs, processing payouts, and managing adapters for different payment methods.

**Public Interface (Key Methods):**
- **create_program**: Creates a new referral program with specified parameters.
- **get_program_info**: Retrieves information about a referral program by its key.
- **create_payout**: Initiates a payout process for a tracking entry using the appropriate adapter based on the configured adapter type.

**Design Patterns Used:**
- **Factory Method**: The `_get_adapter` method acts as a factory to instantiate the correct adapter class based on the `adapter_type`.
- **Repository Pattern**: Utilizes repository classes (`ReferralProgramRepository`, `ReferralTrackingRepository`, and `PayoutRepository`) for data access.

**Relationship to Other Classes:**
- Interacts with various repositories to manage program, tracking, and payout records.
- Uses adapters (e.g., `ManualBankAdapter`, `StripeConnectAdapter`, `WiseAdapter`) to handle different payment methods.

**State Management Approach:**
The class manages state through method parameters and repository interactions. It ensures that each method call is self-contained while leveraging the repositories for data persistence and retrieval.

---

*Generated by CodeWorm on 2026-02-18 22:40*
