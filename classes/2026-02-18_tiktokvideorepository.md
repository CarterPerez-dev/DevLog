# TikTokVideoRepository

**Type:** Class Documentation
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/analytics/facets/data_input/repository.py
**Language:** python
**Lines:** 17-113
**Complexity:** 0.0

---

## Source Code

```python
class TikTokVideoRepository(BaseRepository[TikTokVideo]):
    """
    Repository for TikTok video analytics operations
    """
    model = TikTokVideo

    @classmethod
    async def get_by_rank_range(
        cls,
        session: AsyncSession,
        min_rank: int,
        max_rank: int,
    ) -> Sequence[TikTokVideo]:
        """
        Get videos within a rank range
        """
        result = await session.execute(
            select(TikTokVideo)
            .where(TikTokVideo.rank >= min_rank, TikTokVideo.rank <= max_rank)
            .order_by(TikTokVideo.rank)
        )
        return result.scalars().all()

    @classmethod
    async def get_by_date_range(
        cls,
        session: AsyncSession,
        start_date: date,
        end_date: date,
    ) -> Sequence[TikTokVideo]:
        """
        Get videos posted within a date range
        """
        result = await session.execute(
            select(TikTokVideo)
            .where(
                TikTokVideo.date_posted >= start_date,
                TikTokVideo.date_posted <= end_date
            )
            .order_by(TikTokVideo.date_posted.desc())
        )
        return result.scalars().all()

    @classmethod
    async def get_by_min_views(
        cls,
        session: AsyncSession,
        min_views: int,
    ) -> Sequence[TikTokVideo]:
        """
        Get videos with minimum view count
        """
        result = await session.execute(
            select(TikTokVideo)
            .where(TikTokVideo.views >= min_views)
            .order_by(TikTokVideo.views.desc())
        )
        return result.scalars().all()

    @classmethod
    async def search_videos(
        cls,
        session: AsyncSession,
        query: str,
    ) -> Sequence[TikTokVideo]:
        """
        Search across hook, description, hashtags, CTA, and transcription
        """
        search_term = f"%{query}%"
        result = await session.execute(
            select(TikTokVideo)
            .where(
                or_(
                    TikTokVideo.hook.ilike(search_term),
                    TikTokVideo.description.ilike(search_term),
                    TikTokVideo.cta.ilike(search_term),
                    TikTokVideo.full_transcription.ilike(search_term),
                )
            )
            .order_by(TikTokVideo.rank)
        )
        return result.scalars().all()

    @classmethod
    async def get_all_ordered(
        cls,
        session: AsyncSession,
        order_by: str = "rank",
    ) -> Sequence[TikTokVideo]:
        """
        Get all videos ordered by specified field
        """
        order_field = getattr(TikTokVideo, order_by, TikTokVideo.rank)
        result = await session.execute(
            select(TikTokVideo).order_by(order_field)
        )
        return result.scalars().all()
```

---

## Class Documentation

### TikTokVideoRepository

**Class Responsibility and Purpose:**
The `TikTokVideoRepository` class is responsible for managing operations related to TikTok video analytics within a database context. It provides methods to retrieve videos based on various criteria such as rank, date range, minimum views, and search queries.

**Public Interface (Key Methods):**
- `get_by_rank_range`: Retrieves videos within a specified rank range.
- `get_by_date_range`: Fetches videos posted between two dates.
- `get_by_min_views`: Returns videos with at least the specified number of views.
- `search_videos`: Searches for videos based on keywords in various fields like hook, description, CTA, and transcription.
- `get_all_ordered`: Retrieves all videos ordered by a specified field (default is rank).

**Design Patterns Used:**
The class does not explicitly use any design patterns. However, it employs the **Repository Pattern**, which abstracts data access operations to separate business logic from database interactions.

**How It Fits in the Architecture:**
`TikTokVideoRepository` acts as a central hub for video analytics operations within the `angelamos-operations` repository. It interacts with an `AsyncSession` to perform database queries, ensuring that all data retrieval and manipulation is encapsulated within this class. This design promotes loose coupling between the business logic and the data access layer, making the system more maintainable and testable.

This class is part of a larger analytics framework where it interfaces with other components such as services or controllers that require video data for analysis or reporting purposes.

---

*Generated by CodeWorm on 2026-02-18 17:15*
