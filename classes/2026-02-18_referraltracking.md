# ReferralTracking

**Type:** Class Documentation
**Repository:** stripe-referral
**File:** src/stripe_referral/models/ReferralTracking.py
**Language:** python
**Lines:** 45-113
**Complexity:** 0.0

---

## Source Code

```python
class ReferralTracking(Base, TimestampMixin):
    """
    Tracks successful referral conversions
    """
    __tablename__ = "referral_trackings"

    id: Mapped[int] = mapped_column(
        primary_key = True,
        autoincrement = True
    )

    referrer_user_id: Mapped[str] = mapped_column(
        String(MAX_USER_ID_LENGTH),
        index = True
    )
    referred_user_id: Mapped[str] = mapped_column(
        String(MAX_USER_ID_LENGTH),
        index = True
    )

    code_id: Mapped[int] = mapped_column(
        ForeignKey("referral_codes.id"),
        nullable = False
    )
    program_id: Mapped[int] = mapped_column(
        ForeignKey("referral_programs.id"),
        nullable = False
    )

    transaction_id: Mapped[str | None] = mapped_column(
        String(MAX_TRANSACTION_ID_LENGTH),
        nullable = True
    )
    transaction_amount: Mapped[float | None] = mapped_column(
        Float,
        nullable = True
    )

    amount_earned: Mapped[float] = mapped_column(Float, nullable = False)
    currency: Mapped[str] = mapped_column(
        String(3),
        default = CurrencyCode.USD.value
    )

    converted_at: Mapped[datetime] = mapped_column(
        DateTime(timezone = True),
        default = lambda: datetime.now(UTC),
        index = True
    )

    payout_status: Mapped[str] = mapped_column(
        String(20),
        default = ReferralTrackingStatus.PENDING.value,
        index = True
    )

    code: Mapped[ReferralCode] = relationship(
        "ReferralCode",
        back_populates = "trackings"
    )
    program: Mapped[ReferralProgram] = relationship(
        "ReferralProgram",
        back_populates = "trackings"
    )
    payout: Mapped[Payout | None] = relationship(
        "Payout",
        back_populates = "tracking",
        uselist = False
    )
```

---

## Class Documentation

### ReferralTracking Class Documentation

**Class Responsibility and Purpose:**
The `ReferralTracking` class is responsible for tracking successful referral conversions within a referral program system. It records details such as referrer and referred user IDs, transaction amounts, and payout statuses.

**Public Interface (Key Methods):**
- No public methods are defined in this class; it primarily serves as a data model with attributes representing various aspects of a referral conversion.
- Key attributes include `referrer_user_id`, `referred_user_id`, `code_id`, `program_id`, `transaction_id`, `transaction_amount`, and `amount_earned`.

**Design Patterns Used:**
The class utilizes the **Active Record pattern**, where each instance represents a row in the database table. It also employs **Relationships** with other classes like `ReferralCode` and `Payout` through SQLAlchemy relationships.

**How it Fits in the Architecture:**
`ReferralTracking` is part of the data model layer, interacting directly with the database to store referral conversion records. It is closely related to `ReferralCode` and `ReferralProgram`, which define the context for each tracking instance. The class also interacts with the `Payout` entity when a successful payout occurs, indicating that the tracked referral has been processed financially.

This class ensures that all necessary data for tracking referrals are captured and stored efficiently, supporting broader business logic related to referral programs and payouts.

---

*Generated by CodeWorm on 2026-02-18 23:41*
