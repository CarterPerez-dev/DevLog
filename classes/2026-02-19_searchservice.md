# SearchService

**Type:** Class Documentation
**Repository:** vuemantics
**File:** backend/services/search_service.py
**Language:** python
**Lines:** 28-371
**Complexity:** 0.0

---

## Source Code

```python
class SearchService:
    """
    Handles semantic search functionality

    Workflow:
    1. Generate embedding for search query using local bge-m3
    2. Find similar uploads using pgvector
    3. Apply additional filters
    4. Format and return results
    """
    def __init__(self) -> None:
        """
        Initialize search service
        """
        logger.info("Search service initialized")

    async def search(
        self,
        request: SearchRequest,
        user_id: UUID | None = None
    ) -> SearchResponse:
        """
        Perform semantic search on uploads

        Args:
            request: Search parameters including query and filters
            user_id: Optional user ID to limit search scope

        Returns:
            SearchResponse with ranked results
        """
        start_time = time.time()

        try:
            logger.info(
                f"Generating embedding for query: {request.query[:50]}..."
            )
            query_embedding = await self._generate_query_embedding(
                request.query
            )

            results = await self._search_uploads(
                query_embedding = query_embedding,
                user_id = user_id
                if request.user_id is None else request.user_id,
                limit = request.limit * config.SEARCH_RESULT_MULTIPLIER,
                similarity_threshold = request.similarity_threshold,
            )

            filtered_results = self._apply_filters(results, request)

            final_results = filtered_results[: request.limit]

            search_time_ms = (time.time() - start_time) * 1000

            response = SearchResponse(
                results = final_results,
                total_found = len(filtered_results),
                returned_count = len(final_results),
                search_time_ms = search_time_ms,
                query = request.query,
                query_embedding_generated = True,
                applied_filters = self._get_applied_filters(request),
            )

            logger.info(
                f"Search completed: {len(final_results)} results in {search_time_ms:.1f}ms"
            )
            return response

        except Exception as e:
            logger.error(f"Search failed: {e}")
            search_time_ms = (time.time() - start_time) * 1000
            return SearchResponse(
                results = [],
                total_found = 0,
                returned_count = 0,
                search_time_ms = search_time_ms,
                query = request.query,
                query_embedding_generated = False,
                applied_filters = None,
            )

    async def _generate_query_embedding(self, query: str) -> list[float]:
        """
        Generate embedding vector for search query

        Args:
            query: Search query text

        Returns:
            1024-dimensional embedding vector
        """
        try:
            cleaned_query = " ".join(query.spli
```

---

## Class Documentation

### SearchService Documentation

**Class Responsibility and Purpose:**
The `SearchService` class handles semantic search functionality, including generating embeddings for queries, searching uploads using vector similarity, applying filters, and formatting results.

**Public Interface:**
- **search(request: SearchRequest, user_id: UUID | None = None) -> SearchResponse:** Performs a full semantic search workflow, from embedding generation to result filtering and formatting.
- **_generate_query_embedding(query: str) -> list[float]:** Generates an embedding vector for the given query text.
- **_search_uploads(query_embedding: list[float], user_id: UUID | None, limit: int, similarity_threshold: float) -> list[SearchResult]:** Searches uploads using vector similarity and returns results with similarity scores.

**Design Patterns Used:**
- **Factory Method:** Implicitly used in the embedding generation process by leveraging `local_ai_service.create_embedding_for_query`.
- **Strategy Pattern:** The search algorithm can be extended or modified without changing the core logic, as seen in `_search_uploads`.

**Relationship to Other Classes:**
- Interacts with `SearchRequest` and `SearchResponse` for input and output.
- Dependent on `Upload` class for searching uploads by embedding similarity.

**State Management Approach:**
The state is managed through method parameters and local variables, ensuring that the search process is isolated and reusable. The use of context managers and async/await ensures efficient handling of asynchronous operations.

---

*Generated by CodeWorm on 2026-02-19 01:20*
