# NoteRepository

**Type:** Class Documentation
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/life_manager/facets/notes/repository.py
**Language:** python
**Lines:** 103-204
**Complexity:** 0.0

---

## Source Code

```python
class NoteRepository(BaseRepository[Note]):
    """
    Repository for Note operations
    """
    model = Note

    @classmethod
    async def get_all(
        cls,
        session: AsyncSession,
        folder_id: UUID | None = None,
    ) -> Sequence[Note]:
        """
        Get all non-deleted notes, optionally filtered by folder
        """
        query = select(Note).where(Note.deleted_at.is_(None)
                                   ).order_by(Note.sort_order,
                                              Note.title)
        if folder_id is not None:
            query = query.where(Note.folder_id == folder_id)
        result = await session.execute(query)
        return result.scalars().all()

    @classmethod
    async def get_root_notes(
        cls,
        session: AsyncSession,
    ) -> Sequence[Note]:
        """
        Get non-deleted notes without a folder
        """
        result = await session.execute(
            select(Note).where(Note.folder_id.is_(None)).where(
                Note.deleted_at.is_(None)
            ).order_by(Note.sort_order,
                       Note.title)
        )
        return result.scalars().all()

    @classmethod
    async def get_deleted(
        cls,
        session: AsyncSession,
    ) -> Sequence[Note]:
        """
        Get all soft-deleted notes
        """
        result = await session.execute(
            select(Note).where(Note.deleted_at.is_not(None)).order_by(
                Note.deleted_at.desc()
            )
        )
        return result.scalars().all()

    @classmethod
    async def soft_delete(
        cls,
        session: AsyncSession,
        note: Note,
    ) -> Note:
        """
        Soft delete a note
        """
        from datetime import datetime, timezone
        note.deleted_at = datetime.now(timezone.utc)
        await session.flush()
        await session.refresh(note)
        return note

    @classmethod
    async def restore(
        cls,
        session: AsyncSession,
        note: Note,
    ) -> Note:
        """
        Restore a soft-deleted note
        """
        note.deleted_at = None
        await session.flush()
        await session.refresh(note)
        return note

    @classmethod
    async def bulk_soft_delete(
        cls,
        session: AsyncSession,
        note_ids: list[UUID],
    ) -> int:
        """
        Bulk soft delete multiple notes by their IDs
        """
        from datetime import datetime, timezone
        from sqlalchemy import update

        result = await session.execute(
            update(Note).where(Note.id.in_(note_ids)).where(
                Note.deleted_at.is_(None)
            ).values(deleted_at = datetime.now(timezone.utc))
        )
        await session.flush()
        return result.rowcount
```

---

## Class Documentation

### NoteRepository

**Class Responsibility and Purpose:**
The `NoteRepository` class is responsible for managing CRUD operations on notes, specifically focusing on soft deletion and restoration of notes. It provides a clean abstraction layer over database interactions using SQLAlchemy.

**Public Interface (Key Methods):**
- `get_all`: Retrieves all non-deleted notes optionally filtered by folder.
- `get_root_notes`: Fetches non-deleted notes without a folder.
- `get_deleted`: Lists all soft-deleted notes.
- `soft_delete`: Soft deletes a note by setting its `deleted_at` timestamp.
- `restore`: Restores a soft-deleted note by clearing the `deleted_at` field.
- `bulk_soft_delete`: Deletes multiple notes by their IDs in bulk.

**Design Patterns Used:**
The class leverages the **Repository Pattern**, which encapsulates data access logic and provides a clean interface for interacting with the database. The use of SQLAlchemy queries ensures efficient and type-safe interactions.

**How it Fits in the Architecture:**
`NoteRepository` is part of the Data Access Layer (DAL) in the application architecture, ensuring that business logic remains separate from data handling. It interacts directly with the `Session` object to perform database operations, making it a key component for managing note entities within the system.

---

*Generated by CodeWorm on 2026-02-22 02:13*
