# User

**Type:** Class Documentation
**Repository:** vuemantics
**File:** backend/models/User.py
**Language:** python
**Lines:** 19-319
**Complexity:** 0.0

---

## Source Code

```python
class User(BaseModel):
    """
    User model for authentication

    Attributes:
        id: Unique identifier (UUID)
        email: Unique email address
        password_hash: Bcrypt hashed password
        is_active: Whether user account is active
        created_at: Timestamp of account creation
        updated_at: Timestamp of last update
    """
    __tablename__ = "users"

    def __init__(self, **kwargs: Any) -> None:
        """
        Initialize user instance.
        """
        super().__init__(**kwargs)
        self.id: UUID = kwargs["id"]  # Users from DB always have IDs
        self.email: str = kwargs.get("email", "")
        self.password_hash: str = kwargs.get("password_hash", "")
        self.is_active: bool = kwargs.get("is_active", True)
        self.token_version: int = kwargs.get("token_version", 0)

    @classmethod
    async def create_table(cls) -> None:
        """
        Create users table with indexes.
        """
        query = """
            CREATE TABLE IF NOT EXISTS users (
                id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
                email VARCHAR(255) UNIQUE NOT NULL,
                password_hash VARCHAR(255) NOT NULL,
                is_active BOOLEAN DEFAULT TRUE,
                token_version INTEGER DEFAULT 0,
                created_at TIMESTAMP DEFAULT NOW(),
                updated_at TIMESTAMP DEFAULT NOW()
            );

            CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
            CREATE INDEX IF NOT EXISTS idx_users_is_active ON users(is_active);
        """

        await database.db.execute(query)

    @classmethod
    async def create(
        cls,
        email: str,
        password_hash: str,
        is_active: bool = True
    ) -> User:
        """
        Create a new user
        """
        await cls.ensure_table_exists()

        query = """
            INSERT INTO users (email, password_hash, is_active)
            VALUES ($1, $2, $3)
            RETURNING *
        """

        try:
            record = await database.db.fetchrow(
                query,
                email.lower(),
                password_hash,
                is_active
            )
            if record is None:
                raise ValueError("Failed to create user")
            user = cls.from_record(record)
            if user is None:
                raise ValueError("Failed to create user from record")
            return user
        except UniqueViolationError as e:
            raise ValueError(
                f"User with email {email} already exists"
            ) from e

    @classmethod
    async def find_by_email(cls, email: str) -> User | None:
        """
        Find user by email address
        """
        await cls.ensure_table_exists()

        query = """
            SELECT * FROM users
            WHERE LOWER(email) = LOWER($1)
        """

        record = await database.db.fetchrow(query, email)
        return cls.from_record(record)

    @classmeth
```

---

## Class Documentation

### User Class Documentation

**Class Responsibility and Purpose:**
The `User` class serves as a model for user authentication and management, providing methods to create, retrieve, and manage user records in the database. It ensures data integrity by handling unique constraints and active status checks.

**Public Interface (Key Methods):**
- **`__init__`:** Initializes a new instance of the `User` class with provided attributes.
- **`create_table`:** Creates or ensures the existence of the users table, including necessary indexes.
- **`create`:** Inserts a new user into the database and returns the created user object.
- **`find_by_email`:** Retrieves a user by email address.
- **`find_active_by_email`:** Retrieves an active user by email address.
- **`get_all_active`:** Fetches all active users with pagination.

**Design Patterns Used:**
- **Factory Method:** The `create` class method acts as a factory for creating new user instances from database records.
- **Observer Pattern:** Implicitly used through the `@classmethod` methods that interact with the database, ensuring data consistency and integrity.

**How it Fits in the Architecture:**
The `User` class is integral to the backend's authentication and user management system. It interacts directly with the database via SQLAlchemy queries and ensures that all operations adhere to the defined schema and constraints. The class methods provide a clean interface for other components of the application, such as user registration, login, and account management, making it easier to maintain and extend the functionality.

---

*Generated by CodeWorm on 2026-02-19 02:40*
