# User

**Type:** Class Documentation
**Repository:** ios-test
**File:** fastapi/app/user/User.py
**Language:** python
**Lines:** 35-83
**Complexity:** 0.0

---

## Source Code

```python
class User(Base, UUIDMixin, TimestampMixin):
    """
    User account model
    """
    __tablename__ = "users"

    email: Mapped[str] = mapped_column(
        String(EMAIL_MAX_LENGTH),
        unique = True,
        index = True,
    )
    hashed_password: Mapped[str] = mapped_column(
        String(PASSWORD_HASH_MAX_LENGTH)
    )

    full_name: Mapped[str | None] = mapped_column(
        String(FULL_NAME_MAX_LENGTH),
        default = None,
    )

    is_active: Mapped[bool] = mapped_column(default = True)
    is_verified: Mapped[bool] = mapped_column(default = False)

    role: Mapped[UserRole] = mapped_column(
        SafeEnum(UserRole,
                 unknown_value = UserRole.UNKNOWN),
        default = UserRole.USER,
    )

    token_version: Mapped[int] = mapped_column(default = 0)

    refresh_tokens: Mapped[list[RefreshToken]] = relationship(
        back_populates = "user",
        cascade = "all, delete-orphan",
        lazy = "raise",
    )

    partner: Mapped["Partner | None"] = relationship(
        back_populates = "user",
        cascade = "all, delete-orphan",
        uselist = False,
        lazy = "raise",
    )

    def increment_token_version(self) -> None:
        """
        Invalidate all existing tokens for this user
        """
        self.token_version += 1
```

---

## Class Documentation

### User Class Documentation

**Class Responsibility and Purpose**
The `User` class models a user account within an application, adhering to the Entity-Attribute-Value (EAV) pattern common in database-driven applications. It encapsulates essential attributes such as email, password hash, full name, active status, verification status, role, token version, and relationships with refresh tokens and partners.

**Public Interface**
The key methods of the `User` class include:
- `increment_token_version()`: Increments the token version to invalidate all existing tokens for this user.

**Design Patterns Used**
- **Value Objects**: The use of string types with specific length constraints (e.g., `email`, `hashed_password`) enforces value object principles.
- **Active Record Pattern**: The class manages its own persistence, handling database interactions through SQLAlchemy ORM mappings.

**Relationships and Architecture Fit**
The `User` class is part of a broader application architecture that likely includes services for user authentication, authorization, and partner management. It interacts with the `RefreshToken` and `Partner` classes via relationships, ensuring data integrity and consistency. The use of SQLAlchemy mixins (`Base`, `UUIDMixin`, `TimestampMixin`) helps manage common attributes like timestamps and unique identifiers efficiently.

This class is crucial for managing user accounts, ensuring that each user has a unique email, secure password storage, and appropriate role-based access control.

---

*Generated by CodeWorm on 2026-02-19 09:44*
