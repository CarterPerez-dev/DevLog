# email_validator

**Type:** Security Review
**Repository:** CertGames-Core
**File:** backend/api/domains/account/middleware/schemas.py
**Language:** python
**Lines:** 197-240
**Complexity:** 13.0

---

## Source Code

```python
def email_validator(email: str) -> str:
    """
    Validates an email with strict rules:
    """
    errors = []
    if not email:
        raise ValueError("Email is required.")

    email_nfc = trim_and_normalize(email).lower()

    if not AuthConfig.Email.MIN_LENGTH <= len(
            email_nfc) <= AuthConfig.Email.MAX_LENGTH:
        errors.append(
            f"Email length must be between {AuthConfig.Email.MIN_LENGTH} and {AuthConfig.Email.MAX_LENGTH} characters."
        )

    for ch in email_nfc:
        if ch in AuthConfig.Email.FORBIDDEN_CHARS:
            errors.append(
                "Email contains forbidden characters like <, >, or whitespace."
            )
            break

    if email_nfc.count("@") != 1:
        errors.append("Email must contain exactly one '@' symbol.")
    else:
        parts = email_nfc.split("@")
        if len(parts) == 2:
            local_part, domain_part = parts
            if not local_part:
                errors.append("Email must have a local part before '@'.")
            if not domain_part:
                errors.append("Email must have a domain after '@'.")
            elif "." not in domain_part:
                errors.append(
                    "Email domain must contain at least one '.'."
                )
            elif domain_part.startswith(".") or domain_part.endswith("."):
                errors.append("Email domain cannot start or end with '.'.")

    if errors:
        raise ValueError("; ".join(errors))

    return str(email_nfc)
```

---

## Security Review

### Security Review for `email_validator` Function

#### Vulnerabilities Found:

1. **Input Validation Gaps** (Medium):
   - The function does not validate the email's format using a regular expression, which could allow invalid emails to pass through.
   
2. **Error Handling Leaks Information** (Low):
   - If an error is raised, it provides details about why validation failed, which might be useful for an attacker.

#### Attack Vectors:

- An attacker could exploit the lack of comprehensive validation to bypass email format checks and inject malicious data.

#### Recommended Fixes:

1. **Enhance Input Validation:**
   ```python
   import re

   EMAIL_REGEX = r"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"

   def email_validator(email: str) -> str:
       if not re.match(EMAIL_REGEX, email):
           raise ValueError("Invalid email format.")
       
       # Existing validation logic
   ```

2. **Improve Error Handling:**
   ```python
   if errors:
       raise ValueError("Email validation failed for the following reasons: " + "; ".join(errors))
   ```

#### Overall Security Posture:

The current implementation has some security gaps, particularly in input validation. Enhancing these areas will significantly improve the function's robustness against common attacks.

---

*Generated by CodeWorm on 2026-02-28 00:54*
