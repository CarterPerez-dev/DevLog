# ScanGPUShadows

**Type:** Security Review
**Repository:** Yoshi-Audit
**File:** internal/audit/scanner.go
**Language:** go
**Lines:** 143-163
**Complexity:** 4.0

---

## Source Code

```go
func (s *Scanner) ScanGPUShadows(procs []system.ProcessInfo, gpuProcs []system.GPUProcess) []Finding {
	pidSet := make(map[int]bool)
	for _, p := range procs {
		pidSet[p.PID] = true
	}

	var findings []Finding
	for _, gp := range gpuProcs {
		if !pidSet[gp.PID] {
			findings = append(findings, Finding{
				Type:     FindingGPUShadow,
				Severity: SeverityWarn,
				PID:      gp.PID,
				Name:     fmt.Sprintf("gpu-pid-%d", gp.PID),
				Message:  "GPU process not visible in process list",
				Detail:   fmt.Sprintf("VRAM usage: %d MiB", gp.UsedVRAM/(1024*1024)),
			})
		}
	}
	return findings
}
```

---

## Security Review

### Security Review for `ScanGPUShadows` Function

#### Vulnerabilities and Issues:

1. **Info - Input Validation Gaps:**
   - The function does not validate the input data (`procs` and `gpuProcs`) for potential injection or malformed inputs, which could lead to unexpected behavior.
   
2. **Info - Error Handling:**
   - There is no explicit error handling in case of issues with `fmt.Sprintf`. While unlikely, it's good practice to handle errors.

#### Attack Vectors:

- If the input data (`procs` and `gpuProcs`) contains malicious values, it could lead to unexpected behavior or crashes.
  
#### Recommended Fixes:

1. **Input Validation:**
   - Ensure that all inputs are validated for expected formats and ranges before processing.
   
2. **Error Handling:**
   - Add error handling around `fmt.Sprintf` calls:
     ```go
     name := "gpu-pid-" + strconv.Itoa(gp.PID)
     message := fmt.Sprintf("VRAM usage: %d MiB", gp.UsedVRAM/(1024*1024))
     if name == "" || message == "" {
         return nil, errors.New("invalid input")
     }
     ```

#### Overall Security Posture:

The current function is relatively secure but could benefit from better input validation and error handling to prevent unexpected behavior. Ensuring robustness in data processing will help maintain a strong security posture.

**Severity Ratings:**
- Input Validation Gaps: Info
- Error Handling: Info

---

*Generated by CodeWorm on 2026-03-02 01:44*
