# run

**Type:** Security Review
**Repository:** CertGames-Core
**File:** frontend/user-app/scripts/verify-guards.ts
**Language:** typescript
**Lines:** 150-201
**Complexity:** 12.0

---

## Source Code

```typescript
async function run(): Promise<void> {
  const active = tests.filter(t => !t.skip).length;
  const skipped = tests.filter(t => t.skip).length;
  console.log(`\nðŸ”  Guard Verification  ${BASE}`);
  console.log(`    ${active} active  |  ${skipped} skipped\n`);

  const results: Result[] = [];

  for (const t of tests) {
    if (t.skip) {
      results.push({ name: t.name, status: 'skip', detail: t.skip });
      process.stdout.write(`  â­  ${t.name}  (${t.skip})\n`);
      continue;
    }

    try {
      const { status: http, data } = await client.request({
        method: t.method ?? 'GET',
        url: t.url,
        data: t.body,
      });

      if (http >= 400) {
        const detail = `HTTP ${http} â€” ${JSON.stringify(data).slice(0, 140)}`;
        results.push({ name: t.name, status: 'http_err', detail });
        process.stdout.write(`  ðŸ”´  ${t.name}  â†’  ${detail}\n`);
        continue;
      }

      const ok = t.guard(data);
      results.push({ name: t.name, status: ok ? 'pass' : 'fail', detail: ok ? undefined : JSON.stringify(data).slice(0, 240) });
      process.stdout.write(ok ? `  âœ…  ${t.name}\n` : `  âŒ  ${t.name}\n`);
      if (!ok) process.stdout.write(`       ${JSON.stringify(data).slice(0, 240)}\n`);

    } catch (err) {
      const msg = err instanceof Error ? err.message : String(err);
      results.push({ name: t.name, status: 'throw', detail: msg });
      process.stdout.write(`  ðŸ’¥  ${t.name}  â†’  ${msg}\n`);
    }
  }

  const pass  = results.filter(r => r.status === 'pass').length;
  const fail  = results.filter(r => r.status === 'fail').length;
  const err   = results.filter(r => r.status === 'http_err' || r.status === 'throw').length;
  const skip  = results.filter(r => r.status === 'skip').length;

  console.log('\n' + 'â”€'.repeat(56));
  console.log(`  âœ… ${pass} passed  âŒ ${fail} guard-fail  ðŸ”´ ${err} http/throw  â­ ${skip} skipped`);
  console.log('â”€'.repeat(56) + '\n');

  if (fail > 0 || err > 0) process.exit(1);
}
```

---

## Security Review

### Security Review for `run` Function

#### Vulnerabilities Found:

1. **Information Disclosure** - **Severity: Low**
   - The error messages and HTTP response details are logged to the console, which could potentially leak sensitive information.
   - **Line 26-34**: Consider logging only generic error messages instead of detailed data.

2. **Input Validation Gaps** - **Severity: Medium**
   - `t.guard(data)` is called without validating its input or handling potential errors.
   - **Line 18, 25, 30**: Ensure that `guard` functions are robust and do not introduce vulnerabilities.

#### Attack Vectors:

- An attacker could exploit the logging of sensitive data to infer internal state or extract credentials.
- Malformed inputs in `t.guard(data)` could lead to unexpected behavior or potential security issues if not handled properly.

#### Recommended Fixes:

1. **Information Disclosure**:
   - Replace detailed error logs with generic messages: 
     ```typescript
     process.stdout.write(`  ðŸ’¥  ${t.name}  â†’  Error occurred\n`);
     ```

2. **Input Validation Gaps**:
   - Ensure `guard` functions are robust and handle errors gracefully.
   - Add validation for inputs in `t.guard(data)` to prevent unexpected behavior.

#### Overall Security Posture:

The current code has some minor security issues that could be improved with better error handling and input validation. By addressing these, the overall security posture can be enhanced, ensuring that sensitive information is not leaked and that the system remains robust against malformed inputs.

---

*Generated by CodeWorm on 2026-02-28 00:38*
