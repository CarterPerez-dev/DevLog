# ShannonEntropy

**Type:** Security Review
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/secrets-scanner/internal/rules/entropy.go
**Language:** go
**Lines:** 48-83
**Complexity:** 9.0

---

## Source Code

```go
func ShannonEntropy(data, charset string) float64 {
	if len(data) == 0 {
		return 0.0
	}

	filtered := data
	if charset != "" {
		cs := charsetSet(charset)
		var b strings.Builder
		b.Grow(len(data))
		for _, c := range data {
			if cs[c] {
				b.WriteRune(c)
			}
		}
		filtered = b.String()
		if len(filtered) == 0 {
			return 0.0
		}
	}

	freq := make(map[rune]int)
	for _, c := range filtered {
		freq[c]++
	}

	length := float64(len([]rune(filtered)))
	entropy := 0.0
	for _, count := range freq {
		p := float64(count) / length
		if p > 0 {
			entropy -= p * math.Log2(p)
		}
	}
	return entropy
}
```

---

## Security Review

### Security Review for `ShannonEntropy` Function

#### Vulnerabilities Found:

- **Info**: The function does not contain any obvious injection, authentication, or authorization issues.
- **Info**: There are no hardcoded secrets or credentials present.

#### Attack Vectors:

- **Info**: No direct attack vectors are apparent. However, the function could be misused if `data` and `charset` inputs are manipulated in ways that affect entropy calculations.

#### Recommended Fixes:

1. **Input Validation**:
   - Ensure all input parameters (`data` and `charset`) are properly validated to prevent unexpected behavior.
   ```go
   if len(data) == 0 || (charset != "" && len(charset) < 2) {
       return 0.0, errors.New("invalid input")
   }
   ```

2. **Error Handling**:
   - Add error handling for `math.Log2` to avoid panics on invalid probabilities.
   ```go
   if p > 0 {
       entropy -= p * math.Log2(p)
   } else {
       // Handle or log the case where probability is zero
   }
   ```

#### Overall Security Posture:

- **Low**: The function appears to be secure but could benefit from improved input validation and error handling. Ensuring robustness against edge cases will further enhance its security posture.

By addressing these minor issues, you can improve the overall reliability and security of your code.

---

*Generated by CodeWorm on 2026-03-01 14:09*
