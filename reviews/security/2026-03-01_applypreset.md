# ApplyPreset

**Type:** Security Review
**Repository:** Yoshi-Audit
**File:** internal/docker/presets.go
**Language:** go
**Lines:** 10-49
**Complexity:** 21.0

---

## Source Code

```go
func ApplyPreset(preset config.PrunePreset, images []ImageInfo, volumes []VolumeInfo, protection *ProtectionEngine) (imageIDs []string, volumeNames []string) {
	hasDangling := false
	hasStopped := false
	for _, p := range preset.Patterns {
		switch p {
		case "dangling":
			hasDangling = true
		case "stopped":
			hasStopped = true
		}
	}
	_ = hasStopped

	if hasDangling {
		for _, img := range images {
			if img.Dangling && !protection.IsProtected(img.Repository) && !protection.IsProtected(img.ID) {
				imageIDs = append(imageIDs, img.ID)
			}
		}
	}

	for _, p := range preset.Patterns {
		if p == "dangling" || p == "buildcache" || p == "stopped" {
			continue
		}
		pe := NewProtectionEngine([]string{p})
		for _, img := range images {
			if !img.Dangling && pe.MatchesPattern(img.Repository) && !protection.IsProtected(img.Repository) && !protection.IsProtected(img.ID) {
				imageIDs = append(imageIDs, img.ID)
			}
		}
		for _, vol := range volumes {
			if pe.MatchesPattern(vol.Name) && !protection.IsProtected(vol.Name) {
				volumeNames = append(volumeNames, vol.Name)
			}
		}
	}

	return imageIDs, volumeNames
}
```

---

## Security Review

### Security Review for `ApplyPreset` Function

#### Vulnerabilities and Severity:

1. **Info - Input Validation Gaps**: The function processes patterns from the `preset.Patterns` slice without any input validation, which could lead to unexpected behavior if non-string values are present.
2. **Low - Hardcoded Secrets or Credentials**: No hardcoded secrets or credentials are found in this snippet.

#### Attack Vectors:

- An attacker could inject invalid or malicious patterns into the `preset.Patterns` slice, potentially leading to unintended actions.

#### Recommended Fixes:

1. Add input validation for `preset.Patterns` to ensure only valid string values are processed.
   ```go
   if len(p) == 0 {
       return nil, fmt.Errorf("invalid pattern: %q", p)
   }
   ```

2. Ensure that the `ProtectionEngine` methods (`MatchesPattern`, `IsProtected`) handle inputs safely and do not introduce vulnerabilities.

#### Overall Security Posture:

The function is relatively secure but could benefit from better input validation to prevent unexpected behavior. The current implementation does not expose critical security issues, but adding robust input handling will further enhance its security posture.

---

*Generated by CodeWorm on 2026-03-01 20:26*
