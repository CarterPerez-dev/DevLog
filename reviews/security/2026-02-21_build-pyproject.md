# build_pyproject

**Type:** Security Review
**Repository:** pyproject-setup
**File:** src/pyproject_setup/generator.py
**Language:** python
**Lines:** 131-211
**Complexity:** 8.0

---

## Source Code

```python
def build_pyproject(config: ProjectConfig) -> dict[str, Any]:
    """
    Build complete pyproject.toml structure from config
    """
    preset: Preset = PRESETS[config.preset]

    project: dict[str,
                  Any] = {
                      "name": config.name,
                      "version": config.version,
                      "description": config.description,
                      "requires-python": config.python_version,
                      "dependencies": preset.dependencies.copy(),
                  }

    if preset.dev_dependencies:
        project["optional-dependencies"] = {
            "dev": preset.dev_dependencies.copy()
        }

    urls: dict[str, str] = {}
    if config.homepage:
        urls["Homepage"] = config.homepage
    if config.repository:
        urls["Repository"] = config.repository
        urls["Issues"] = f"{config.repository}/issues"
        urls["Changelog"] = f"{config.repository}/blob/main/CHANGELOG.md"
    if urls:
        project["urls"] = urls

    if config.author_name and config.author_email:
        project["authors"] = [
            {
                "name": config.author_name,
                "email": config.author_email
            }
        ]

    pyproject: dict[str,
                    Any] = {
                        "project": project,
                        "build-system": {
                            "requires": ["hatchling"],
                            "build-backend": "hatchling.build",
                        },
                        "tool": {
                            "hatch": {
                                "build": {
                                    "targets": {
                                        "wheel": {
                                            "packages":
                                            [config.package_path]
                                        }
                                    }
                                }
                            },
                            "ruff":
                            get_ruff_config(config.package_path),
                            "mypy":
                            get_mypy_config(config.package_path),
                            "pydantic-mypy":
                            get_pydantic_mypy_config(),
                            "pylint":
                            get_pylint_config(config.package_path),
                            "pytest": {
                                "ini_options": get_pytest_config()
                            },
                            "coverage":
                            get_coverage_config(config.package_path),
                            "ty":
                            get_ty_config(config.package_path),
                        },
                    }

    if preset.entry_point:
        pyproject["project"]["scripts"] = {
            config.name:
            f"{config.package_path.replace('/', '.')}.{preset.entry_point}"
        }

    return pyproject
```

---

## Security Review

### Security Review for `build_pyproject` Function

**Vulnerabilities:**

1. **Info - Input Validation Gaps**: Lines 6-9, 15-18, and 27-30 use dynamic values from the `config` object without validation.
   - **Attack Vector**: Malicious input could lead to unexpected behavior or injection attacks if not properly sanitized.

2. **Info - Hardcoded Secrets or Credentials**: Lines 6-9, 15-18, and 27-30 use dynamic values from the `config` object without validation.
   - **Attack Vector**: If sensitive information is incorrectly stored in configuration objects, it could be exposed.

**Recommendations:**

1. **Input Validation**: Ensure all inputs are validated before usage. For example:
   ```python
   if config.homepage and not validate_url(config.homepage):
       raise ValueError("Invalid homepage URL")
   ```

2. **Secure Configuration Handling**: Use environment variables or secure configuration files for sensitive data instead of hardcoding them.

3. **Error Handling**: Improve error handling to avoid leaking information:
   ```python
   except Exception as e:
       logging.error(f"Failed to process config: {str(e)}")
       return None  # Return a default value or handle appropriately.
   ```

**Overall Security Posture:**

The current code has some potential issues with input validation and handling of dynamic values. Improving these areas will enhance the security posture by preventing unexpected behavior and reducing the risk of injection attacks.

---

*Generated by CodeWorm on 2026-02-21 15:24*
