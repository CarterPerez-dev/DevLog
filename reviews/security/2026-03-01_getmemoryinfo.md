# GetMemoryInfo

**Type:** Security Review
**Repository:** Yoshi-Audit
**File:** internal/system/memory.go
**Language:** go
**Lines:** 36-89
**Complexity:** 8.0

---

## Source Code

```go
func GetMemoryInfo() (MemoryInfo, error) {
	f, err := os.Open("/proc/meminfo")
	if err != nil {
		return MemoryInfo{}, err
	}
	defer f.Close()

	values := make(map[string]uint64)
	scanner := bufio.NewScanner(f)
	for scanner.Scan() {
		line := scanner.Text()
		parts := strings.SplitN(line, ":", 2)
		if len(parts) != 2 {
			continue
		}

		key := strings.TrimSpace(parts[0])
		valStr := strings.TrimSpace(parts[1])
		valStr = strings.TrimSuffix(valStr, " kB")
		valStr = strings.TrimSpace(valStr)

		val, parseErr := strconv.ParseUint(valStr, 10, 64)
		if parseErr != nil {
			continue
		}

		values[key] = val * 1024
	}

	if err := scanner.Err(); err != nil {
		return MemoryInfo{}, err
	}

	memTotal, ok := values["MemTotal"]
	if !ok {
		return MemoryInfo{}, fmt.Errorf("MemTotal not found in /proc/meminfo")
	}

	memAvailable, ok := values["MemAvailable"]
	if !ok {
		return MemoryInfo{}, fmt.Errorf("MemAvailable not found in /proc/meminfo")
	}

	swapTotal := values["SwapTotal"]
	swapFree := values["SwapFree"]

	return MemoryInfo{
		TotalRAM:     memTotal,
		UsedRAM:      memTotal - memAvailable,
		AvailableRAM: memAvailable,
		TotalSwap:    swapTotal,
		UsedSwap:     swapTotal - swapFree,
	}, nil
}
```

---

## Security Review

### Security Review for `GetMemoryInfo` Function

#### Vulnerabilities and Severity:

1. **Info:**
   - The function reads `/proc/meminfo`, which is a system file, but there are no injection or hardcoded secrets issues.
   
2. **Input Validation (Low):**
   - The function uses `strings.SplitN` to parse the meminfo lines, which could be improved for robustness.

3. **Error Handling (Medium):**
   - Error handling is basic; it returns an error if a required field is missing but does not provide detailed error messages.
   
4. **Overall Security Posture:**
   - The function is secure in terms of injection and hardcoded secrets, but could benefit from more robust error handling.

#### Recommended Fixes:

1. **Enhance Error Handling (Medium):**
   ```go
   return MemoryInfo{}, fmt.Errorf("Failed to parse meminfo: %w", err)
   ```
   This ensures all errors are properly logged and handled.

2. **Improve Input Validation (Low):**
   - Add checks for valid keys:
   ```go
   if key == "MemTotal" || key == "MemAvailable" || key == "SwapTotal" || key == "SwapFree" {
       values[key] = val * 1024
   }
   ```

3. **Document and Test (Info):**
   - Add comments explaining the function's purpose and add unit tests to cover edge cases.

By implementing these fixes, you can improve the robustness of error handling and input validation, enhancing the overall security posture of your code.

---

*Generated by CodeWorm on 2026-03-01 21:45*
