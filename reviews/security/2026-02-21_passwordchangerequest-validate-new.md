# PasswordChangeRequest.validate_new_password

**Type:** Security Review
**Repository:** vuemantics
**File:** backend/schemas/user.py
**Language:** python
**Lines:** 121-135
**Complexity:** 4.0

---

## Source Code

```python
def validate_new_password(cls, v: str, info: ValidationInfo) -> str:
        """
        Validate new password using centralized validation logic.
        """
        is_valid, error_msg = validate_password_strength(v)
        if not is_valid:
            raise ValueError(error_msg)

        if "current_password" in info.data and v == info.data[
                "current_password"]:
            raise ValueError(
                "New password must be different from current password"
            )

        return v
```

---

## Security Review

### Security Review for `validate_new_password`

#### Vulnerabilities Found:

1. **Info Leakage via Error Messages** - [Critical]
   - The function raises a `ValueError` with an error message that could potentially leak information about the password validation process.
   
2. **Hardcoded Password Comparison** - [Medium]
   - Direct comparison of `"current_password"` in the code might indicate hardcoding, though it seems to be a placeholder.

#### Attack Vectors:
- An attacker could exploit the error messages to infer details about the password strength rules or current password validation logic.
- Hardcoded string comparison might reveal sensitive information if not properly managed.

#### Recommended Fixes:

1. **Info Leakage** - [Critical]
   - Use generic error messages that do not disclose any specific details: 
     ```python
     raise ValueError("Password must meet complexity requirements")
     ```

2. **Hardcoded Password Comparison** - [Medium]
   - Ensure dynamic comparison using a secure method, e.g., by comparing hashes:
     ```python
     if info.data.get('current_password_hash') == hash(v):
         raise ValueError("New password must be different from current password")
     ```

#### Overall Security Posture:

The code has critical vulnerabilities that could expose sensitive information and should be addressed immediately. Implementing generic error handling and secure comparison methods will significantly improve the security posture of this function.

---

*Generated by CodeWorm on 2026-02-21 14:07*
