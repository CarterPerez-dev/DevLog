# load_config_from_yaml

**Type:** Security Review
**Repository:** CodeWorm
**File:** codeworm/core/config.py
**Language:** python
**Lines:** 269-291
**Complexity:** 6.0

---

## Source Code

```python
def load_config_from_yaml(config_dir: Path | None = None) -> dict:
    """
    Load configuration from YAML files in config directory
    """
    if config_dir is None:
        config_dir = DEFAULT_CONFIG_DIR

    config_dir = Path(os.path.expandvars(str(config_dir))).expanduser()

    config = load_yaml_file(config_dir / "config.yaml")

    repos_config = load_yaml_file(config_dir / "repos.yaml")
    if "repositories" in repos_config:
        repos = [
            r for r in repos_config["repositories"] if r.get("enabled", True)
        ]
        config["repos"] = repos

    prompts_config = load_yaml_file(config_dir / "prompts.yaml")
    if prompts_config:
        config["prompts"] = prompts_config

    return config
```

---

## Security Review

### Security Review

**Vulnerabilities Found:**

1. **Hardcoded Secrets or Credentials**: No hardcoded secrets are present in the provided code.
   - **Severity**: Info

2. **Input Validation Gaps**: The function does not validate user input for `config_dir`, which could lead to path traversal attacks if `DEFAULT_CONFIG_DIR` is not properly sanitized.
   - **Severity**: Medium
   - **Attack Vector**: An attacker could provide a malicious path to `load_config_from_yaml`.

3. **Error Handling that Leaks Information**: The function does not handle errors when loading YAML files, which might leak information about file paths or existence.
   - **Severity**: Low

**Recommended Fixes:**

1. Validate and sanitize the `config_dir` parameter:
   ```python
   if config_dir is None:
       config_dir = Path(DEFAULT_CONFIG_DIR).expanduser().resolve()
   else:
       config_dir = Path(os.path.expandvars(str(config_dir))).expanduser().resolve()
       # Ensure it's within a trusted path
       if not config_dir.is_absolute() or not config_dir.parent.samefile(Path.home()):
           raise ValueError("Invalid configuration directory")
   ```

2. Add error handling for file loading:
   ```python
   try:
       config = load_yaml_file(config_dir / "config.yaml")
   except FileNotFoundError as e:
       logger.error(f"Config file not found: {e}")
       return {}
   ```

**Overall Security Posture**: The code has a moderate security posture. While it does not contain severe vulnerabilities, there are areas for improvement in input validation and error handling to prevent information leakage and path traversal attacks.

---

*Generated by CodeWorm on 2026-03-01 21:54*
