# init

**Type:** Security Review
**Repository:** pyproject-setup
**File:** src/pyproject_setup/cli.py
**Language:** python
**Lines:** 62-265
**Complexity:** 21.0

---

## Source Code

```python
def init(
    name: str | None = typer.Option(
        None,
        "--name",
        "-n",
        help = "Project name"
    ),
    description: str | None = typer.Option(
        None,
        "--description",
        "-d",
        help = "Project description"
    ),
    preset: str | None = typer.Option(
        None,
        "--preset",
        "-p",
        help = "Project preset (fastapi-backend, library, cli-tool)",
    ),
    python: str = typer.Option(
        ">=3.12",
        "--python",
        help = "Python version requirement"
    ),
    package_path: str = typer.Option(
        "src",
        "--package-path",
        help = "Package source path"
    ),
    repository: str | None = typer.Option(
        None,
        "--repository",
        "-r",
        help = "Repository URL"
    ),
    homepage: str | None = typer.Option(
        None,
        "--homepage",
        help = "Homepage URL"
    ),
    workflow: bool = typer.Option(
        True,
        "--workflow/--no-workflow",
        help = "Add PyPI workflow"
    ),
    output: Path = typer.Option(
        Path(),
        "--output",
        "-o",
        help = "Output directory"
    ),
    force: bool = typer.Option(
        False,
        "--force",
        "-f",
        help = "Overwrite existing files"
    ),
    yapf: bool = typer.Option(
        False,
        "--yapf/--no-yapf",
        help = "Add .style.yapf config file"
    ),
) -> None:
    """
    [bold green]Initialize[/bold green] a new pyproject.toml with pre-configured tooling.

    Run interactively or pass flags for automation.
    """
    console.print()
    console.print(
        Panel(
            "[bold cyan]pyproject-setup[/bold cyan] - Project Scaffolder",
            border_style = "cyan",
        )
    )
    console.print()

    pyproject_path = output / "pyproject.toml"
    if (
        pyproject_path.exists()
        and not force
        and not Confirm.ask(
            f"[yellow]pyproject.toml already exists at {output}. Overwrite?[/yellow]"
        )
    ):
        console.print("[red]Aborted.[/red]")
        raise typer.Exit(1)

    if name is None:
        name = Prompt.ask(
            "[bold]Project name[/bold]",
            default = output.resolve().name
        )

    if description is None:
        description = Prompt.ask("[bold]Description[/bold]", default = "")

    if preset is None:
        preset_choices = list(PRESETS.keys())
        console.print("\n[bold]Available presets:[/bold]")
        for i, p in enumerate(preset_choices, 1):
            preset_obj = PRESETS[p]
            console.print(
                f"  [cyan]{i}[/cyan]. {p} - {preset_obj.description}"
            )

        while True:
            choice = Prompt.ask(
                "\n[bold]Select preset[/bold]",
                default = "1",
            )
            try:
                idx = int(choice) - 1
                if 0 <= idx < len(preset_choices):
                    preset = preset_choices[idx]
     
```

---

## Security Review

### Security Review for `init` Function in `pyproject_setup/cli.py`

#### Vulnerabilities and Severity:

1. **Input Validation Gaps** (Medium):
   - Lines 56-70: The `preset` option allows users to input a preset name, which is then used directly without validation against the `PRESETS` dictionary keys.
   - **Severity**: Medium
   - **Attack Vector**: An attacker could provide an invalid or malicious preset value that might lead to unexpected behavior or errors.

2. **Hardcoded Secrets** (Info):
   - No hardcoded secrets found in the provided code snippet.

3. **Error Handling** (Low):
   - Lines 91-97: The error handling for `preset` validation could be improved by raising a more specific exception.
   - **Severity**: Low
   - **Attack Vector**: Improper error messages might leak information about the application's structure or behavior.

#### Recommended Fixes:

1. **Validate Preset Input**:
   ```python
   if preset not in PRESETS.keys():
       console.print(f"[red]Unknown preset: {preset}[/red]")
       raise typer.Exit(1)
   ```

2. **Improve Error Messages**:
   - Ensure error messages do not reveal sensitive information.
   ```python
   except ValueError as e:
       if choice in preset_choices:
           preset = choice
       else:
           console.print(f"[red]Invalid choice: {e}[/red]")
           raise typer.Exit(1)
   ```

#### Overall Security Posture:

The overall security posture is good, with no critical or high-severity issues. However, input validation and error handling can be improved to prevent potential misconfigurations and information leakage. Regular code reviews and static analysis tools should be used to maintain a robust security posture.

--- 

This review focuses on the specific vulnerabilities found in the provided code snippet and suggests concrete fixes to enhance its security.

---

*Generated by CodeWorm on 2026-02-21 15:18*
