# BlogFactory.create

**Type:** Security Review
**Repository:** my-portfolio
**File:** v1/backend/conftest.py
**Language:** python
**Lines:** 417-444
**Complexity:** 4.0

---

## Source Code

```python
async def create(
        cls,
        session: AsyncSession,
        *,
        language: Language = Language.ENGLISH,
        title: str | None = None,
        description: str | None = None,
        external_url: str | None = None,
        category: BlogCategory = BlogCategory.TUTORIAL,
        is_visible: bool = True,
        is_featured: bool = False,
    ) -> Blog:
        cls._counter += 1

        blog = Blog(
            language = language,
            title = title or f"Test Blog {cls._counter}",
            description = description or f"Blog description {cls._counter}",
            external_url = external_url
            or f"https://blog.test.com/post-{cls._counter}",
            category = category,
            is_visible = is_visible,
            is_featured = is_featured,
        )
        session.add(blog)
        await session.flush()
        await session.refresh(blog)
        return blog
```

---

## Security Review

### Security Review

#### Vulnerabilities Found:

1. **Info - Input Validation Gaps:**
   - Lines 5-9: The `title`, `description`, and `external_url` parameters are optional but not validated for length or content, which could allow injection attacks.

2. **Info - Hardcoded Secrets or Credentials:**
   - No hardcoded secrets found in the snippet provided.

3. **Info - Error Handling that Leaks Information:**
   - The function does not handle potential exceptions from `session.flush()` and `session.refresh()`, which might leak database connection errors.

#### Attack Vectors:

- An attacker could inject malicious content into `title` or `external_url` parameters, potentially leading to SQL injection if the underlying database is misconfigured.
- Unhandled exceptions during database operations could reveal sensitive information about the database schema or state.

#### Recommended Fixes:

1. **Input Validation:**
   - Add length and content validation for `title`, `description`, and `external_url`.
     ```python
     from typing import Annotated

     def validate_input(value: str) -> str:
         if len(value) > 255:
             raise ValueError("Value too long")
         return value

     title = validate_input(title or f"Test Blog {cls._counter}")
     description = validate_input(description or f"Blog description {cls._counter}")
     external_url = validate_input(external_url or f"https://blog.test.com/post-{cls._counter}")
     ```

2. **Error Handling:**
   - Implement try-except blocks to handle potential exceptions.
     ```python
     try:
         await session.flush()
         await session.refresh(blog)
     except Exception as e:
         print(f"Database error: {e}")
         raise
     ```

3. **Overall Security Posture:**
   - Ensure the database is properly configured and secured against injection attacks.
   - Regularly review and update security practices, especially around input validation and error handling.

By addressing these issues, you can significantly improve the security posture of your application.

---

*Generated by CodeWorm on 2026-02-21 12:06*
