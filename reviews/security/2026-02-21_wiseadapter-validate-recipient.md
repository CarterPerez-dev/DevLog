# WiseAdapter.validate_recipient

**Type:** Security Review
**Repository:** stripe-referral
**File:** src/stripe_referral/adapters/wise.py
**Language:** python
**Lines:** 176-229
**Complexity:** 12.0

---

## Source Code

```python
def validate_recipient(
        self,
        recipient_data: dict[str,
                             Any]
    ) -> RecipientValidation:
        """
        Validate Wise recipient data
        """
        required_fields = ["account_holder_name", "details"]

        missing_fields = [
            field for field in required_fields
            if field not in recipient_data
        ]

        if missing_fields:
            return RecipientValidation(
                valid = False,
                error =
                f"Missing required fields: {', '.join(missing_fields)}",
            )

        account_holder_name = recipient_data.get(
            "account_holder_name",
            ""
        )
        if not account_holder_name or len(account_holder_name) < 2:
            return RecipientValidation(
                valid = False,
                error = "Invalid account holder name",
            )

        details = recipient_data.get("details", {})
        if not isinstance(details, dict):
            return RecipientValidation(
                valid = False,
                error = "Details must be a dictionary",
            )

        account_type = recipient_data.get("account_type", "aba")
        if account_type == "aba":
            if "accountNumber" not in details or "routingNumber" not in details:
                return RecipientValidation(
                    valid = False,
                    error =
                    "Missing accountNumber or routingNumber for ABA transfer",
                )
        elif account_type == "iban" and "iban" not in details:
            return RecipientValidation(
                valid = False,
                error = "Missing IBAN for IBAN transfer",
            )

        return RecipientValidation(valid = True)
```

---

## Security Review

### Security Review for `validate_recipient` Function

#### Vulnerabilities Found:

1. **Input Validation Gaps** (Line 8-16, Line 25-30) - **Medium**
   - The function currently checks if required fields are present but does not validate the format or content of these fields thoroughly.
   - For example, `account_holder_name` is checked for length but not for any specific pattern.

2. **Error Handling** (Line 14, Line 30) - **Low**
   - Error messages could potentially leak information about the internal structure of the data, though this is mitigated by using generic error messages.

#### Attack Vectors:

- An attacker could provide invalid or malformed `recipient_data` to exploit potential validation gaps.
- If an attacker provides a very short `account_holder_name`, it might bypass the length check.

#### Recommended Fixes:

1. **Enhance Input Validation**:
   - Add more specific checks for `account_holder_name`. For example, ensure it only contains alphanumeric characters and spaces.
   - Validate `details` dictionary to ensure all required keys are present and of correct types.

2. **Refine Error Messages**:
   - Use generic error messages that do not reveal internal structure or logic.

#### Overall Security Posture:

The current implementation has some room for improvement in input validation, but the overall security posture is manageable with the suggested fixes. Ensure all data points are thoroughly validated to prevent potential attacks.

---

*Generated by CodeWorm on 2026-02-21 12:31*
