# _score_hex

**Type:** Security Review
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/beginner/base64-tool/src/base64_tool/detector.py
**Language:** python
**Lines:** 127-169
**Complexity:** 16.0

---

## Source Code

```python
def _score_hex(data: str) -> float:
    stripped = data.strip()
    if len(stripped) < MIN_INPUT_LENGTH:
        return 0.0

    hex_only = stripped
    for sep in HEX_SEPARATORS:
        hex_only = hex_only.replace(sep, "")

    if not hex_only:
        return 0.0
    if not all(c in HEX_CHARSET for c in hex_only):
        return 0.0
    if len(hex_only) % 2 != 0:
        return 0.0

    score = W.HEX_BASE

    has_separators = any(sep in stripped for sep in HEX_SEPARATORS)
    if has_separators:
        score += W.HEX_SEPARATOR_PRESENT

    has_alpha = any(c in "abcdefABCDEF" for c in hex_only)
    if has_alpha:
        score += W.HEX_ALPHA_CHARS
    else:
        score -= W.HEX_NO_ALPHA_PENALTY

    is_consistent_case = (hex_only == hex_only.lower() or hex_only == hex_only.upper())
    if is_consistent_case:
        score += W.HEX_CONSISTENT_CASE

    if len(hex_only) >= 8:
        score += W.LONGER_INPUT

    decoded = try_decode(stripped, EncodingFormat.HEX)
    if decoded is None:
        return 0.0
    score += W.HEX_DECODE_SUCCESS
    if is_printable_text(decoded):
        score += W.PRINTABLE_RESULT

    return min(score, 1.0)
```

---

## Security Review

### Security Review for `_score_hex` Function

**Vulnerabilities:**

1. **Input Validation Gaps (Medium):**
   - The function does not validate the input type, which could allow injection of non-string data.
   - Line 3: `stripped = data.strip()` should check if `data` is indeed a string.

2. **Error Handling (Info):**
   - Lines 17-20: The error handling for `try_decode(stripped, EncodingFormat.HEX)` does not provide any information on potential exceptions or errors.

**Attack Vectors:**

- An attacker could inject non-string data into the function, leading to unexpected behavior.
- Potential injection of malicious code if input is not properly sanitized.

**Recommended Fixes:**

1. **Input Validation:**
   - Add a type check at line 3: `if not isinstance(data, str): return 0.0`
   
2. **Error Handling:**
   - Improve error handling by catching and logging exceptions in lines 17-20:
     ```python
     try:
         decoded = try_decode(stripped, EncodingFormat.HEX)
     except Exception as e:
         logger.error(f"Decoding failed: {e}")
         return 0.0
     ```

**Overall Security Posture:**

The function is relatively secure but could benefit from better input validation and error handling to prevent unexpected behavior and potential injection attacks. Improving these areas will enhance the overall security posture of the code.

---

*Generated by CodeWorm on 2026-02-18 21:25*
