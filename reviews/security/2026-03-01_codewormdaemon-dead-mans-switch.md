# CodeWormDaemon._dead_mans_switch

**Type:** Security Review
**Repository:** CodeWorm
**File:** codeworm/daemon.py
**Language:** python
**Lines:** 342-368
**Complexity:** 8.0

---

## Source Code

```python
async def _dead_mans_switch(self) -> None:
        check_interval = 300
        alert_threshold = 2700
        alerted = False

        await asyncio.sleep(check_interval)

        while self.running:
            reference = self.stats.last_success or self._start_time
            age = (datetime.now() - reference).total_seconds()
            if age > alert_threshold and not alerted:
                self.logger.warning(
                    "dead_mans_switch_triggered",
                    minutes_since_last_commit = round(age / 60,
                                                      1),
                )
                if self.notifier:
                    log_tail = self._tail_log(20)
                    await self.notifier.send_alert(
                        f"No commits in {int(age / 60)} minutes",
                        details = f"<pre>{log_tail}</pre>",
                    )
                alerted = True
            elif age <= alert_threshold and alerted:
                alerted = False

            await asyncio.sleep(check_interval)
```

---

## Security Review

### Security Review for `CodeWormDaemon._dead_mans_switch`

#### Vulnerabilities and Severity

1. **Info - No obvious injection, authentication, or authorization issues.**
2. **Info - No hardcoded secrets or credentials found.**
3. **Info - No race conditions or TOCTOU bugs identified.**
4. **Info - Input validation is not applicable as the function does not accept external input.**
5. **Info - Insecure deserialization is not a concern in this context.**
6. **Info - Error handling is basic and does not leak information.**

#### Attack Vectors

- The function relies on internal state (`self.stats.last_success`, `self.running`) which could be manipulated if the class is improperly secured.
- Logging sensitive information (like log tail) to an external notifier might expose data, but this is managed within the code.

#### Recommended Fixes

1. **Ensure Secure External Notifier Usage**: Verify that any external service used for notifications (`notifier.send_alert`) is secure and properly configured.
2. **Logging Best Practices**: Consider logging only non-sensitive information. Ensure sensitive data (like log tail) is sanitized or not logged at all if unnecessary.

#### Overall Security Posture

The function appears to be well-protected against common vulnerabilities given its internal nature. However, ensure that the external components used for notifications are secure and properly configured to maintain overall security posture.

---

*Generated by CodeWorm on 2026-03-01 17:45*
