# alert_formatter

**Type:** Security Review
**Repository:** Telehook
**File:** src/telehook/formatters/alert.py
**Language:** python
**Lines:** 11-31
**Complexity:** 4.0

---

## Source Code

```python
def alert_formatter(
    title: str,
    app: str | None = None,
    last_error: str | None = None,
    details: str | None = None,
) -> str:
    header = f"\u26a0\ufe0f <b>{title}</b>"
    if app:
        header = f"\u26a0\ufe0f <b>{app}: {title}</b>"

    timestamp = datetime.now(UTC).strftime("%Y-%m-%d %H:%M:%S UTC")
    parts = [header, ""]

    if last_error:
        parts.append(f"<b>Last error:</b> <code>{last_error}</code>")
    if details:
        parts.append(f"{details}")

    parts.append(f"<b>Time:</b> {timestamp}")

    return truncate("\n".join(parts))
```

---

## Security Review

### Security Review for `alert_formatter`

#### Vulnerabilities Found:

1. **XSS (Cross-Site Scripting)**: Line 9 and 15 - The function directly includes user input (`last_error` and `details`) into the string without sanitization or escaping, which could lead to XSS attacks.
   - **Severity**: High
   - **Attack Vector**: An attacker could inject malicious scripts in `last_error` or `details`, potentially compromising other users.

2. **Information Leakage**: Line 17 - The timestamp is included verbatim, which might leak sensitive information about the system's time and possibly its timezone.
   - **Severity**: Low
   - **Attack Vector**: An attacker could use this to infer timing information, though itâ€™s less severe than XSS.

#### Recommended Fixes:

1. Sanitize user inputs before including them in the string:
   ```python
   from html import escape

   def alert_formatter(
       title: str,
       app: str | None = None,
       last_error: str | None = None,
       details: str | None = None,
   ) -> str:
       header = f"\u26a0\ufe0f <b>{title}</b>"
       if app:
           header = f"\u26a0\ufe0f <b>{app}: {title}</b>"

       timestamp = datetime.now(UTC).strftime("%Y-%m-%d %H:%M:%S UTC")
       parts = [header, ""]

       if last_error:
           parts.append(f"<b>Last error:</b> <code>{escape(last_error)}</code>")
       if details:
           parts.append(f"{details}")

       parts.append(f"<b>Time:</b> {timestamp}")

       return truncate("\n".join(parts))
   ```

2. Consider removing or obfuscating the timestamp to reduce information leakage.

#### Overall Security Posture:

The function is relatively secure but needs improvements in input handling and output sanitization to prevent XSS attacks. Ensuring all user inputs are properly sanitized will significantly enhance the security posture of this code.

---

*Generated by CodeWorm on 2026-03-01 19:12*
