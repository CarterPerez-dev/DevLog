# ProjectFactory.create

**Type:** Security Review
**Repository:** my-portfolio
**File:** v1/backend/conftest.py
**Language:** python
**Lines:** 284-312
**Complexity:** 4.0

---

## Source Code

```python
async def create(
        cls,
        session: AsyncSession,
        *,
        slug: str | None = None,
        language: Language = Language.ENGLISH,
        title: str | None = None,
        description: str | None = None,
        tech_stack: list[str] | None = None,
        is_featured: bool = False,
        status: ProjectStatus = ProjectStatus.ACTIVE,
    ) -> Project:
        cls._counter += 1

        project = Project(
            slug = slug or f"test-project-{cls._counter}",
            language = language,
            title = title or f"Test Project {cls._counter}",
            description = description
            or f"Description for project {cls._counter}",
            tech_stack = tech_stack or ["Python",
                                        "FastAPI"],
            is_featured = is_featured,
            status = status,
        )
        session.add(project)
        await session.flush()
        await session.refresh(project)
        return project
```

---

## Security Review

### Security Review

#### Vulnerabilities Found:

1. **Info - Input Validation Gaps**
   - Lines: 5-8, 10-12
     - The function does not validate the input parameters, which could lead to unexpected behavior or errors.
   
2. **Info - Hardcoded Secrets or Credentials**
   - Not applicable in this snippet.

3. **Info - Insecure Deserialization**
   - Not applicable in this snippet.

4. **Info - Error Handling that Leaks Information**
   - The function does not handle potential exceptions, which could leak information about the database state.
   
5. **Info - Race Conditions and TOCTOU Bugs**
   - Not directly applicable here, but consider thread safety if `cls._counter` is shared.

6. **Info - Authentication and Authorization Issues**
   - Not applicable in this snippet.

#### Attack Vectors:

- If an attacker can manipulate the input parameters, they might cause unexpected project creation or data corruption.
- Lack of error handling could expose internal database states to attackers.

#### Recommended Fixes:

1. **Input Validation:**
   ```python
   async def create(
       cls,
       session: AsyncSession,
       *,
       slug: str | None = None,
       language: Language = Language.ENGLISH,
       title: str | None = None,
       description: str | None = None,
       tech_stack: list[str] | None = None,
       is_featured: bool = False,
       status: ProjectStatus = ProjectStatus.ACTIVE,
   ) -> Project:
       if not slug or len(slug) > 255:
           raise ValueError("Invalid slug")
       # Add other validations as needed
       
       cls._counter += 1

       project = Project(
           slug=slug or f"test-project-{cls._counter}",
           language=language,
           title=title or f"Test Project {cls._counter}",
           description=description or f"Description for project {cls._counter}",
           tech_stack=tech_stack or ["Python", "FastAPI"],
           is_featured=is_featured,
           status=status,
       )
       session.add(project)
       await session.flush()
       await session.refresh(project)
       return project
   ```

2. **Error Handling:**
   ```python
   try:
       # Function body
   except Exception as e:
       logger.error(f"Failed to create project: {str(e)}")
       raise
   ```

3. **Overall Security Posture:**

The current code is relatively safe but can be improved by adding proper input validation and error handling. Ensure that the `Project` class and related enums are securely defined elsewhere in your codebase.

---

*Generated by CodeWorm on 2026-02-21 11:58*
