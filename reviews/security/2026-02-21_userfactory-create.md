# UserFactory.create

**Type:** Security Review
**Repository:** my-portfolio
**File:** v1/backend/conftest.py
**Language:** python
**Lines:** 124-148
**Complexity:** 4.0

---

## Source Code

```python
async def create(
        cls,
        session: AsyncSession,
        *,
        email: str | None = None,
        password: str = "TestPass123",
        full_name: str | None = None,
        role: UserRole = UserRole.USER,
        is_active: bool = True,
        is_verified: bool = True,
    ) -> User:
        cls._counter += 1

        user = User(
            email = email or f"user{cls._counter}@test.com",
            hashed_password = await hash_password(password),
            full_name = full_name or f"Test User {cls._counter}",
            role = role,
            is_active = is_active,
            is_verified = is_verified,
        )
        session.add(user)
        await session.flush()
        await session.refresh(user)
        return user
```

---

## Security Review

### Security Review

**Vulnerabilities Found:**

1. **Hardcoded Secrets or Credentials (Low):**
   - The `password` parameter is hardcoded to `"TestPass123"` in the `create` method.
   
2. **Input Validation Gaps (Medium):**
   - The `email`, `full_name`, and `role` parameters are not validated for length, format, or potential injection attacks.

**Attack Vectors:**

- An attacker could exploit hardcoded credentials to test unauthorized access.
- Malformed inputs in `email`, `full_name`, or `role` could potentially lead to unexpected behavior or injection vulnerabilities if not properly sanitized.

**Recommended Fixes:**

1. **Remove Hardcoded Password:**
   ```python
   password: str = "TestPass123"
   ```
   Replace with a dynamic password generation or parameterization.
   
2. **Input Validation:**
   - Validate `email` and `full_name` for format and length:
     ```python
     import re

     if not re.match(r"[^@]+@[^@]+\.[^@]+", email):
         raise ValueError("Invalid email")
     if len(full_name) > 255:
         raise ValueError("Full name too long")
     ```

3. **Use Type Hints and Decorators:**
   - Ensure all parameters are properly typed and validated.

**Overall Security Posture:**

The current code has some security risks, particularly with hardcoded credentials and lack of input validation. Addressing these issues will improve the overall security posture by reducing the attack surface and ensuring robust data handling.

---

*Generated by CodeWorm on 2026-02-21 11:39*
