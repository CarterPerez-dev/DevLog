# UserFactory.create

**Type:** Security Review
**Repository:** my-portfolio
**File:** v1/backend/conftest.py
**Language:** python
**Lines:** 124-148
**Complexity:** 4.0

---

## Source Code

```python
async def create(
        cls,
        session: AsyncSession,
        *,
        email: str | None = None,
        password: str = "TestPass123",
        full_name: str | None = None,
        role: UserRole = UserRole.USER,
        is_active: bool = True,
        is_verified: bool = True,
    ) -> User:
        cls._counter += 1

        user = User(
            email = email or f"user{cls._counter}@test.com",
            hashed_password = await hash_password(password),
            full_name = full_name or f"Test User {cls._counter}",
            role = role,
            is_active = is_active,
            is_verified = is_verified,
        )
        session.add(user)
        await session.flush()
        await session.refresh(user)
        return user
```

---

## Security Review

### Security Review for `UserFactory.create`

#### Vulnerabilities Found:

1. **Hardcoded Secrets or Credentials**:
   - **Severity**: Low
   - **Line 5**: The password is hardcoded as `"TestPass123"`. This should be dynamic and securely managed.
   - **Fix**: Use environment variables, secrets management tools like Hashicorp Vault, or a secure vault service.

2. **Input Validation Gaps**:
   - **Severity**: Medium
   - **Lines 4-5**: `email` is optional but not validated for format or existence. Ensure all inputs are properly sanitized and validated.
   - **Fix**: Implement validation checks using libraries like `pydantic`.

3. **Error Handling that Leaks Information**:
   - **Severity**: Low
   - **Lines 10-12**: Error handling is minimal, which could leak information about the database state or session issues.
   - **Fix**: Add proper error handling to catch and log exceptions without exposing sensitive details.

#### Attack Vectors:

- An attacker could exploit hardcoded credentials for unauthorized access.
- Invalid input could lead to unexpected behavior or injection attacks if not properly sanitized.

#### Recommended Fixes:

1. Replace hardcoded password with a secure method:
   ```python
   from os import environ

   password = environ.get('USER_PASSWORD', 'TestPass123')
   ```

2. Validate and sanitize inputs using `pydantic` or similar libraries.
3. Implement robust error handling to avoid information leakage.

#### Overall Security Posture:

The code has some security concerns, particularly with hardcoded credentials and input validation. Addressing these issues will significantly improve the overall security posture of the application.

---

*Generated by CodeWorm on 2026-02-21 11:39*
