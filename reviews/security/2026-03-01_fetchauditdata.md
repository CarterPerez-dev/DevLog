# FetchAuditData

**Type:** Security Review
**Repository:** Yoshi-Audit
**File:** internal/ui/audittab/audittab.go
**Language:** go
**Lines:** 71-116
**Complexity:** 8.0

---

## Source Code

```go
func FetchAuditData(scanner *audit.Scanner, rssHistory map[int][]uint64) tea.Msg {
	procs, err := system.GetProcesses()
	if err != nil {
		return AuditDataMsg{Err: err}
	}

	gpuProcs, _ := system.GetGPUProcesses()

	for _, p := range procs {
		rssHistory[p.PID] = append(rssHistory[p.PID], p.RSS)
	}

	findings := scanner.ScanAll(procs, gpuProcs)
	findings = append(findings, scanner.ScanMemoryLeaks(procs, rssHistory)...)

	summary := make(map[audit.FindingType]SummaryCount)
	allTypes := []audit.FindingType{
		audit.FindingZombie,
		audit.FindingOrphan,
		audit.FindingDaemon,
		audit.FindingKernelThread,
		audit.FindingGPUShadow,
		audit.FindingMemoryLeak,
		audit.FindingUnknownSvc,
	}
	for _, ft := range allTypes {
		summary[ft] = SummaryCount{}
	}
	for _, f := range findings {
		sc := summary[f.Type]
		switch f.Severity {
		case audit.SeverityOK:
			sc.OK++
		case audit.SeverityWarn:
			sc.Warn++
		case audit.SeverityCrit:
			sc.Crit++
		}
		summary[f.Type] = sc
	}

	return AuditDataMsg{
		Findings: findings,
		Summary:  summary,
	}
}
```

---

## Security Review

### Security Review for `FetchAuditData` Function

#### Vulnerabilities and Severity:

1. **Info - No Injection or Deserialization Issues**: The function does not involve SQL, command execution, or deserialization.
2. **Info - No Hardcoded Secrets**: There are no hardcoded secrets or credentials in the snippet.
3. **Info - No Race Conditions**: The function is synchronous and does not use goroutines for concurrent operations, reducing race condition risks.
4. **Info - Input Validation**: While `procs` and `gpuProcs` are iterated over, there's no explicit validation of input types or values.
5. **Info - Error Handling**: Basic error handling exists but could be more robust.

#### Attack Vectors:

- **Potential for Unhandled Errors**: If an error occurs during process retrieval, the function returns a message with the error. However, it does not log errors, which could leak information in production environments.

#### Recommended Fixes:

1. **Enhance Error Logging**:
   ```go
   if err != nil {
       return AuditDataMsg{Err: fmt.Errorf("error fetching processes: %w", err)}
   }
   ```

2. **Add Input Validation**:
   Ensure that `procs` and `gpuProcs` are of the expected type before processing.

3. **Improve Error Handling**:
   Use structured error handling to provide more context in logs.
   
4. **Code Review for Security Best Practices**: Regularly review code for security best practices, especially when dealing with sensitive data or external inputs.

#### Overall Security Posture:

The function is relatively secure but could benefit from improved logging and validation. Ensuring robust error handling and input validation will further enhance the security posture of this function.

---

*Generated by CodeWorm on 2026-03-01 21:23*
