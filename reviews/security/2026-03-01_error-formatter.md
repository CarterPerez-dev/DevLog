# error_formatter

**Type:** Security Review
**Repository:** Telehook
**File:** src/telehook/formatters/error.py
**Language:** python
**Lines:** 12-50
**Complexity:** 4.0

---

## Source Code

```python
def error_formatter(
    exception: BaseException,
    component: str,
    app: str | None = None,
) -> str:
    error_type = type(exception).__name__
    error_msg = str(exception)

    frames = tb_module.extract_tb(exception.__traceback__)
    condensed_lines = []
    for frame in frames:
        filename = frame.filename.rsplit("/", maxsplit = 1)[-1]
        condensed_lines.append(
            f"  {filename}:{frame.lineno} \u2192 {frame.name}()"
        )

    condensed_tb = "\n".join(
        condensed_lines
    ) if condensed_lines else "  (no traceback)"

    header = f"\U0001f534 <b>Error: {component}</b>"
    if app:
        header = f"\U0001f534 <b>{app} \u2014 Error: {component}</b>"

    timestamp = datetime.now(UTC).strftime("%Y-%m-%d %H:%M:%S UTC")

    parts = [
        header,
        "",
        f"<code>{error_type}: {error_msg}</code>",
        "",
        "<b>Traceback (condensed):</b>",
        f"<pre>{condensed_tb}</pre>",
        "",
        f"<b>Component:</b> {component}",
        f"<b>Time:</b> {timestamp}",
    ]

    return truncate("\n".join(parts))
```

---

## Security Review

### Security Review for `error_formatter` Function

#### Vulnerabilities and Severity:

1. **Injection Vulnerabilities**:
   - **Severity: Info**
   - **Line**: All string concatenations.
   - **Details**: The function constructs error messages by concatenating user input (e.g., `component`, `app`) into strings, which could potentially introduce injection vulnerabilities if these inputs are not properly sanitized.

2. **Error Handling**:
   - **Severity: Low**
   - **Line**: All error handling.
   - **Details**: The function does not handle specific exceptions or provide robust error messages that might leak sensitive information.

3. **Overall Security Posture**:
   - The code is generally clean and follows Pythonic patterns, but it lacks proper input validation and sanitization for user inputs.

#### Recommended Fixes:

1. **Input Validation**:
   - Sanitize `component` and `app` parameters to ensure they do not contain malicious content.
   - Use string formatting methods like f-strings or `.format()` with placeholders to avoid injection risks.

2. **Error Handling**:
   - Implement specific exception handling to catch and log errors without exposing sensitive information.

3. **Code Example**:

```python
def error_formatter(
    exception: BaseException,
    component: str,
    app: str | None = None,
) -> str:
    # Sanitize inputs
    component = sanitize_input(component)
    if app:
        app = sanitize_input(app)

    error_type = type(exception).__name__
    error_msg = str(exception)

    frames = tb_module.extract_tb(exception.__traceback__)
    condensed_lines = []
    for frame in frames:
        filename = frame.filename.rsplit("/", maxsplit=1)[-1]
        condensed_lines.append(
            f"  {filename}:{frame.lineno} \u2192 {frame.name}()"
        )

    condensed_tb = "\n".join(condensed_lines) if condensed_lines else "  (no traceback)"

    header = f"\U0001f534 <b>Error: {component}</b>"
    if app:
        header = f"\U0001f534 <b>{app} \u2014 Error: {component}</b>"

    timestamp = datetime.now(UTC).strftime("%Y-%m-%d %H:%M:%S UTC")

    parts = [
        header,
        "",
        f"<code>{error_type}: {error_msg}</code>",
        "",
        "<b>Traceback (condensed):</b>",
        f"<pre>{condensed_tb}</pre>",
        "",
        f"<b>Component:</b> {component}",
        f"<b>Time:</b> {timestamp}",
    ]

    return truncate("\n".join(parts))

def sanitize_input(input_str: str) -> str:
    # Implement input sanitization logic here
    return input_str.replace("<", "&lt;").replace(">", "&gt;")
```

By implementing these changes, the function will be more secure and robust against potential injection attacks.

---

*Generated by CodeWorm on 2026-03-01 18:31*
