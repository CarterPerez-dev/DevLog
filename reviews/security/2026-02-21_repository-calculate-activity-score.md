# Repository.calculate_activity_score

**Type:** Security Review
**Repository:** kill-pr0cess.inc
**File:** backend/src/models/github.rs
**Language:** rust
**Lines:** 213-264
**Complexity:** 12.0

---

## Source Code

```rust
pub fn calculate_activity_score(&self) -> f64 {
        let mut score = 0.0;

        // Stars contribute to score (logarithmic scale to prevent skewing)
        if self.stargazers_count > 0 {
            score += (self.stargazers_count as f64).ln() * 10.0;
        }

        // Recent activity bonus
        if let Some(pushed_at) = self.pushed_at {
            let days_since_push = (Utc::now() - pushed_at).num_days();
            if days_since_push < 30 {
                score += 20.0;
            } else if days_since_push < 90 {
                score += 10.0;
            }
        }

        // Fork ratio (indicates usefulness)
        if self.stargazers_count > 0 {
            let fork_ratio = self.forks_count as f64 / self.stargazers_count as f64;
            score += fork_ratio * 15.0;
        }

        // Issue management (lower open issues ratio is better)
        if self.open_issues_count > 0 {
            score -= (self.open_issues_count as f64).ln() * 2.0;
        }

        // Documentation (has description and topics)
        if self.description.is_some() {
            score += 5.0;
        }
        if let Some(topics) = &self.topics {
            if !topics.is_empty() {
                score += topics.len() as f64 * 2.0;
            }
        }

        // License indicates maturity
        if self.license_name.is_some() {
            score += 5.0;
        }

        // Penalize archived repositories
        if self.is_archived {
            score *= 0.5;
        }

        // Normalize to 0-100 scale
        score.max(0.0).min(100.0)
    }
```

---

## Security Review

### Security Review

#### Vulnerabilities Found:

1. **Information Disclosure - Info**
   - **Line:** 26, 39, 50, 58
   - **Issue:** The function uses `is_some()` and `len()`, which could potentially leak information about the presence or size of optional values.

2. **Normalization - Low**
   - **Line:** 71
   - **Issue:** The score is normalized to a 0-100 scale, but there's no explicit handling for edge cases where scores might be negative or exceed 100.

#### Attack Vectors:

- An attacker could exploit the optional checks to infer repository metadata.
- Normalization issues could lead to unexpected behavior if not properly handled.

#### Recommended Fixes:

1. **Information Disclosure:**
   - Replace `is_some()` with pattern matching and handle cases explicitly:
     ```rust
     if let Some(description) = &self.description {
         score += 5.0;
     }
     ```
   - Ensure all optional values are handled appropriately to avoid information disclosure.

2. **Normalization:**
   - Add explicit checks for normalization:
     ```rust
     score.max(0.0).min(100.0);
     ```

#### Overall Security Posture:

The code is relatively secure but could benefit from more robust handling of optional values and edge cases. Ensuring proper error handling and avoiding information leaks will improve the overall security posture.

---

*Generated by CodeWorm on 2026-02-21 10:38*
