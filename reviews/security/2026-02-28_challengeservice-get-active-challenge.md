# ChallengeService.get_active_challenge

**Type:** Security Review
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/challenge/facets/tracker/service.py
**Language:** python
**Lines:** 75-129
**Complexity:** 3.0

---

## Source Code

```python
async def get_active_challenge(
        session: AsyncSession,
    ) -> ChallengeWithStats:
        """
        Get active challenge with stats and logs
        """
        challenge = await ChallengeRepository.get_active(session)
        if not challenge:
            raise ChallengeNotFound()

        total_content, total_jobs = await ChallengeLogRepository.get_totals(
            session,
            challenge.id,
        )

        logs_response = [
            LogResponse(
                id = log.id,
                challenge_id = log.challenge_id,
                log_date = log.log_date,
                day_number = ChallengeService._calculate_day_number(
                    challenge,
                    log.log_date
                ),
                tiktok = log.tiktok,
                instagram_reels = log.instagram_reels,
                youtube_shorts = log.youtube_shorts,
                twitter = log.twitter,
                reddit = log.reddit,
                linkedin_personal = log.linkedin_personal,
                linkedin_company = log.linkedin_company,
                youtube_full = log.youtube_full,
                medium = log.medium,
                jobs_applied = log.jobs_applied,
                created_at = log.created_at,
                updated_at = log.updated_at,
            ) for log in challenge.logs
        ]

        return ChallengeWithStats(
            id = challenge.id,
            name = challenge.name,
            start_date = challenge.start_date,
            end_date = challenge.end_date,
            is_active = challenge.is_active,
            content_goal = challenge.content_goal,
            jobs_goal = challenge.jobs_goal,
            total_content = total_content,
            total_jobs = total_jobs,
            current_day = ChallengeService.
            _calculate_current_day(challenge),
            logs = logs_response,
            created_at = challenge.created_at,
            updated_at = challenge.updated_at,
        )
```

---

## Security Review

### Security Review for `ChallengeService.get_active_challenge`

#### Vulnerabilities Found:

1. **Info: Input Validation Gaps**
   - The function does not validate the input parameters, which could lead to unexpected behavior or errors.
   
2. **Info: Error Handling Leaks Information**
   - The code raises a custom exception `ChallengeNotFound()`, which might leak information about the system's internal structure.

#### Attack Vectors:

- An attacker could exploit these issues by providing invalid inputs or causing exceptions, potentially leading to unexpected responses or error messages.

#### Recommended Fixes:

1. **Input Validation:**
   ```python
   async def get_active_challenge(
       session: AsyncSession,
       challenge_id: int = None  # Add input validation for challenge_id if needed
   ) -> ChallengeWithStats:
       """
       Get active challenge with stats and logs
       """
       if not challenge_id:
           raise ValueError("Challenge ID is required")
       
       challenge = await ChallengeRepository.get_active(session, challenge_id)
       if not challenge:
           raise ChallengeNotFound()
   ```

2. **Error Handling:**
   - Modify the exception handling to provide generic error messages.
   ```python
   try:
       # Existing code
   except Exception as e:
       raise InternalServerError() from e  # Use a generic internal server error
   ```

#### Overall Security Posture:

The current implementation is relatively secure but could benefit from better input validation and more robust error handling. Adding these improvements will help mitigate potential vulnerabilities and enhance the overall security posture of the application.

---

*Generated by CodeWorm on 2026-02-28 01:42*
