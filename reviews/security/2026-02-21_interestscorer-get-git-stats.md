# InterestScorer.get_git_stats

**Type:** Security Review
**Repository:** CodeWorm
**File:** codeworm/analysis/scoring.py
**Language:** python
**Lines:** 242-295
**Complexity:** 9.0

---

## Source Code

```python
def get_git_stats(
        self,
        file_path: Path,
        _start_line: int = 0,
        _end_line: int = 0
    ) -> GitStats:
        """
        Get git statistics for a file
        """
        if not self.git_repo:
            return GitStats()

        try:
            commits_30d = 0
            commits_90d = 0
            last_modified = None
            authors = set()

            now = datetime.now()
            cutoff_30d = now - timedelta(days = 30)
            cutoff_90d = now - timedelta(days = 90)

            rel_path = str(file_path)
            with contextlib.suppress(ValueError):
                rel_path = str(file_path.relative_to(self.git_repo.working_dir))

            for commit in self.git_repo.iter_commits(paths = rel_path,
                                                     max_count = 100):
                commit_date = datetime.fromtimestamp(commit.committed_date)

                if last_modified is None:
                    last_modified = commit_date

                if commit_date >= cutoff_30d:
                    commits_30d += 1
                if commit_date >= cutoff_90d:
                    commits_90d += 1

                authors.add(commit.author.email)

            is_new = commits_90d <= 2 and last_modified and (
                now - last_modified
            ).days <= 14

            return GitStats(
                commit_count_30d = commits_30d,
                commit_count_90d = commits_90d,
                last_modified = last_modified,
                unique_authors = len(authors),
                is_new = is_new,
            )

        except Exception:
            return GitStats()
```

---

## Security Review

### Security Review for `get_git_stats` Method

#### Vulnerabilities and Severity:

1. **Error Handling (Info):**
   - The `try-except` block catches all exceptions, potentially masking critical errors.
   - **Fix:** Catch specific exceptions like `GitCommandError`, log the error, and return a meaningful response.

2. **Date Calculations (Low):**
   - The date calculations are based on local time, which might not be consistent across systems.
   - **Fix:** Ensure all datetime operations use UTC to avoid timezone issues.

3. **Overall Security Posture:**
   - The function does not appear to have direct input from external sources that could lead to injection or deserialization issues.
   - However, the method's robustness can be improved by ensuring consistent date handling and better error logging.

#### Recommendations:

1. **Error Handling (Info):**
   ```python
   except GitCommandError as e:
       logger.error(f"Git command failed: {e}")
       return GitStats()
   ```

2. **Date Calculations (Low):**
   - Ensure all datetime operations use `datetime.utcnow()` instead of `datetime.now()`.

3. **Logging and Error Handling:**
   - Add logging to capture and report errors more effectively.
   ```python
   import logging

   logger = logging.getLogger(__name__)

   try:
       # ... existing code ...
   except GitCommandError as e:
       logger.error(f"Git command failed: {e}")
       return GitStats()
   ```

By addressing these minor issues, the overall security and robustness of the function can be improved.

---

*Generated by CodeWorm on 2026-02-21 16:25*
