# DataInputService.get_all_videos

**Type:** Security Review
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/analytics/facets/data_input/service.py
**Language:** python
**Lines:** 86-109
**Complexity:** 2.0

---

## Source Code

```python
async def get_all_videos(
        session: AsyncSession,
        page: int = 1,
        page_size: int = 50,
    ) -> TikTokVideoListResponse:
        """
        Get all videos with pagination
        """
        skip = (page - 1) * page_size
        videos = await TikTokVideoRepository.get_multi(
            session,
            skip = skip,
            limit = page_size
        )
        total = await TikTokVideoRepository.count(session)

        return TikTokVideoListResponse(
            items = [
                TikTokVideoResponse.model_validate(v) for v in videos
            ],
            total = total,
            page = page,
            page_size = page_size,
        )
```

---

## Security Review

### Security Review for `get_all_videos` Function

#### Vulnerabilities Found:

1. **Info - Input Validation Gaps:**
   - The function does not validate the `page` and `page_size` parameters, which could lead to potential injection attacks if these values are derived from untrusted sources.

2. **Info - Hardcoded Secrets or Credentials:**
   - No hardcoded secrets or credentials are present in this snippet.

3. **Info - Error Handling:**
   - The function does not handle errors that might occur during database operations, which could leak information about the underlying system.

#### Attack Vectors:

- An attacker could manipulate `page` and `page_size` to cause SQL injection if these parameters come from an untrusted source.
- Improper error handling can expose sensitive information through exceptions.

#### Recommended Fixes:

1. **Input Validation:**
   - Add input validation for `page` and `page_size` to ensure they are within expected ranges:
     ```python
     page = max(1, min(page, 100))  # Example range limit
     page_size = max(1, min(page_size, 50))
     ```

2. **Error Handling:**
   - Implement proper error handling to catch and log exceptions without exposing sensitive information:
     ```python
     try:
         videos = await TikTokVideoRepository.get_multi(
             session,
             skip=skip,
             limit=page_size
         )
         total = await TikTokVideoRepository.count(session)
     except Exception as e:
         logger.error(f"Error fetching videos: {e}")
         raise HTTPException(status_code=500, detail="Internal Server Error")
     ```

3. **Overall Security Posture:**
   - Ensure all parameters are validated and sanitized before use.
   - Use logging to handle errors securely without exposing sensitive information.

By addressing these issues, the overall security posture of the function can be significantly improved.

---

*Generated by CodeWorm on 2026-02-28 02:10*
