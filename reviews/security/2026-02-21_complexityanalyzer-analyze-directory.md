# ComplexityAnalyzer.analyze_directory

**Type:** Security Review
**Repository:** CodeWorm
**File:** codeworm/analysis/complexity.py
**Language:** python
**Lines:** 165-183
**Complexity:** 6.0

---

## Source Code

```python
def analyze_directory(self,
                          directory: Path,
                          recursive: bool = True) -> Iterator[FileComplexity]:
        """
        Analyze all supported files in a directory
        """
        pattern = "**/*" if recursive else "*"
        for ext in self._extensions:
            for file_path in directory.glob(f"{pattern}{ext}"):
                if file_path.is_file():
                    try:
                        yield self.analyze_file(file_path)
                    except Exception as e:
                        logger.debug(
                            "file_analysis_failed",
                            file = str(file_path),
                            error = str(e)
                        )
                        continue
```

---

## Security Review

### Security Review for `analyze_directory` Function

**Vulnerabilities Found:**

1. **Error Handling Leakage (Info):**
   - **Line:** 9-10
   - **Issue:** The error message logged includes the file path and exception details, which could potentially leak sensitive information.
   - **Severity:** Info
   - **Attack Vector:** An attacker could exploit this to gather detailed information about the system's structure or running state.

2. **Input Validation Gap (Low):**
   - **Line:** 4-5
   - **Issue:** The `directory` parameter is not validated for type or existence, which might allow injection of invalid paths.
   - **Severity:** Low
   - **Attack Vector:** An attacker could provide a non-existent directory path to cause the function to fail.

**Recommended Fixes:**

1. **Error Handling Leakage (Info):**
   - Replace `logger.debug` with more controlled logging that does not include sensitive information.
     ```python
     logger.debug("file_analysis_failed", file=str(file_path))
     ```

2. **Input Validation Gap (Low):**
   - Validate the `directory` parameter to ensure it is a valid directory path.
     ```python
     if not directory.is_dir():
         raise ValueError(f"Invalid directory: {directory}")
     ```

**Overall Security Posture:**

The overall security posture of this function can be improved by addressing the logging issue and validating input. While these issues are relatively low severity, they should still be addressed to prevent potential information leakage and ensure robustness against invalid inputs.

---

*Generated by CodeWorm on 2026-02-21 16:48*
