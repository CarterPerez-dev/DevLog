# SystemInfo.calculate_health_score

**Type:** Security Review
**Repository:** kill-pr0cess.inc
**File:** backend/src/models/performance.rs
**Language:** rust
**Lines:** 476-517
**Complexity:** 13.0

---

## Source Code

```rust
pub fn calculate_health_score(&self) -> f64 {
        let mut score: f64 = 100.0;

        // CPU usage impact
        if self.cpu_usage_percent > 90.0 {
            score -= 30.0;
        } else if self.cpu_usage_percent > 80.0 {
            score -= 20.0;
        } else if self.cpu_usage_percent > 70.0 {
            score -= 10.0;
        }

        // Memory usage impact
        if self.memory_usage_percent > 95.0 {
            score -= 25.0;
        } else if self.memory_usage_percent > 85.0 {
            score -= 15.0;
        } else if self.memory_usage_percent > 75.0 {
            score -= 8.0;
        }

        // Disk usage impact
        if self.disk_usage_percent > 95.0 {
            score -= 20.0;
        } else if self.disk_usage_percent > 90.0 {
            score -= 10.0;
        } else if self.disk_usage_percent > 80.0 {
            score -= 5.0;
        }

        // Load average impact
        let load_ratio = self.load_average_1m / self.cpu_cores as f64;
        if load_ratio > 2.0 {
            score -= 20.0;
        } else if load_ratio > 1.5 {
            score -= 10.0;
        } else if load_ratio > 1.0 {
            score -= 5.0;
        }

        score.max(0.0)
    }
```

---

## Security Review

### Security Review for `calculate_health_score` Function

#### Vulnerabilities and Severity:

1. **Info - Input Validation Gaps**: The function does not validate the input values of `cpu_usage_percent`, `memory_usage_percent`, `disk_usage_percent`, and `load_average_1m`. These could be manipulated to cause unexpected behavior.

2. **Info - Error Handling**: There is no error handling for potential division by zero in the line:
   ```rust
   let load_ratio = self.load_average_1m / self.cpu_cores as f64;
   ```
   If `cpu_cores` is 0, this could lead to a runtime error.

#### Attack Vectors:

- An attacker could provide invalid or malicious input values to manipulate the health score.
- Division by zero can occur if `cpu_cores` is set to 0, leading to undefined behavior.

#### Recommended Fixes:

1. **Input Validation**:
   ```rust
   pub fn calculate_health_score(&self) -> f64 {
       let mut score: f64 = 100.0;

       // Validate input values before processing
       if self.cpu_usage_percent < 0.0 || self.cpu_usage_percent > 100.0 {
           return score; // or handle error appropriately
       }
       if self.memory_usage_percent < 0.0 || self.memory_usage_percent > 100.0 {
           return score;
       }
       if self.disk_usage_percent < 0.0 || self.disk_usage_percent > 100.0 {
           return score;
       }

       // ... rest of the function remains unchanged
   }
   ```

2. **Error Handling**:
   ```rust
   let load_ratio = match self.cpu_cores {
       0 => 0.0, // or handle error appropriately
       _ => self.load_average_1m / self.cpu_cores as f64,
   };
   ```

#### Overall Security Posture:

The current function has minimal security concerns but could benefit from proper input validation and error handling to prevent unexpected behavior and potential runtime errors. Improving these areas will enhance the overall security posture of the codebase.

---

*Generated by CodeWorm on 2026-02-21 10:24*
