# inspectToProject

**Type:** Security Review
**Repository:** angelamos-operations
**File:** Docker-Kentros/internal/docker/containers.go
**Language:** go
**Lines:** 194-266
**Complexity:** 14.0

---

## Source Code

```go
func inspectToProject(info container.InspectResponse) model.Container {
	name := strings.TrimPrefix(info.Name, "/")

	ports := make([]model.PortMapping, 0)
	if info.NetworkSettings != nil {
		for portProto, bindings := range info.NetworkSettings.Ports {
			parts := strings.Split(string(portProto), "/")
			containerPort := uint16(0)
			protocol := "tcp"
			if len(parts) >= 1 {
				_, _ = fmt.Sscanf(parts[0], "%d", &containerPort)
			}
			if len(parts) >= 2 {
				protocol = parts[1]
			}

			for _, binding := range bindings {
				hostPort := uint16(0)
				_, _ = fmt.Sscanf(binding.HostPort, "%d", &hostPort)
				ports = append(ports, model.PortMapping{
					HostIP:        binding.HostIP,
					HostPort:      hostPort,
					ContainerPort: containerPort,
					Protocol:      protocol,
				})
			}
		}
	}

	health := ""
	if info.State != nil && info.State.Health != nil {
		health = info.State.Health.Status
	}

	var createdAt, startedAt time.Time
	if info.Created != "" {
		createdAt, _ = time.Parse(time.RFC3339Nano, info.Created)
	}
	if info.State != nil && info.State.StartedAt != "" {
		startedAt, _ = time.Parse(time.RFC3339Nano, info.State.StartedAt)
	}

	state := ""
	status := ""
	if info.State != nil {
		state = info.State.Status
		status = info.State.Status
	}

	labels := make(map[string]string)
	if info.Config != nil {
		labels = info.Config.Labels
	}

	image := ""
	if info.Config != nil {
		image = info.Config.Image
	}

	return model.Container{
		ID:          info.ID,
		Name:        name,
		ServiceName: labels["com.docker.compose.service"],
		Image:       image,
		Status:      status,
		State:       state,
		Health:      health,
		Ports:       ports,
		Labels:      labels,
		CreatedAt:   createdAt,
		StartedAt:   startedAt,
	}
}
```

---

## Security Review

### Security Review for `inspectToProject` Function

**Vulnerabilities Found:**

1. **Input Validation Gaps (Medium):**
   - Lines 7-15: The function parses the `info.NetworkSettings.Ports` without validating the input format, which could lead to unexpected behavior or errors.
   
2. **Error Handling (Info):**
   - Lines 9-10 and 13-14: The error from `fmt.Sscanf` is ignored, potentially masking issues during parsing.

**Attack Vectors:**

- Malformed port bindings in the container's network settings could cause unexpected behavior or errors.
- Ignored errors might lead to silent failures.

**Recommended Fixes:**

1. **Input Validation Gaps (Medium):**
   - Validate and sanitize input before processing:
     ```go
     if _, err := fmt.Sscanf(parts[0], "%d", &containerPort); err != nil {
         return model.Container{}, fmt.Errorf("invalid port format: %w", err)
     }
     ```

2. **Error Handling (Info):**
   - Properly handle errors to ensure robustness:
     ```go
     if _, err := time.Parse(time.RFC3339Nano, info.Created); err != nil {
         return model.Container{}, fmt.Errorf("failed to parse created date: %w", err)
     }
     ```

**Overall Security Posture:**

The function has some input validation gaps and error handling issues that could be exploited. Addressing these will improve the security posture by ensuring robustness against malformed inputs and providing better diagnostics in case of errors.

---

*Generated by CodeWorm on 2026-02-20 20:19*
