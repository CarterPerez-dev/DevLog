# SearchRequest.validate_date_range

**Type:** Security Review
**Repository:** vuemantics
**File:** backend/schemas/search.py
**Language:** python
**Lines:** 95-107
**Complexity:** 5.0

---

## Source Code

```python
def validate_date_range(
        cls,
        v: datetime | None,
        info: ValidationInfo
    ) -> datetime | None:
        """
        Ensure date_to is after date_from if both provided
        """
        if v is not None and "date_from" in info.data:
            date_from = info.data["date_from"]
            if date_from is not None and v <= date_from:
                raise ValueError("date_to must be after date_from")
        return v
```

---

## Security Review

### Security Review for `validate_date_range` Function

**Vulnerabilities:**

1. **Input Validation Gap - Medium**
   - **Line:** 5-7
   - **Issue:** The function does not validate the types of `v` and `date_from`. If these are not datetime objects, a `TypeError` could occur.
   - **Severity:** Medium

2. **Error Handling - Info**
   - **Line:** 6-8
   - **Issue:** The error message is generic and could be improved for better logging and security.
   - **Severity:** Info

**Attack Vectors:**

- An attacker could provide non-datetime objects, leading to unexpected behavior or errors.

**Recommended Fixes:**

1. Add type checks and conversions:
   ```python
   if v is not None and "date_from" in info.data:
       date_from = info.data.get("date_from")
       if isinstance(date_from, datetime) and isinstance(v, datetime):
           if v <= date_from:
               raise ValueError("date_to must be after date_from")
       else:
           raise TypeError("Both date_from and date_to must be datetime objects")
   ```

2. Improve error messages for better logging:
   ```python
   raise ValueError(f"Invalid date range: date_to ({v}) must be after date_from ({date_from}).")
   ```

**Overall Security Posture:**

The current implementation has a medium severity issue due to potential type mismatches and lacks robust input validation. By adding type checks and improving error messages, the security posture can be significantly enhanced.

---

*Generated by CodeWorm on 2026-02-21 13:57*
