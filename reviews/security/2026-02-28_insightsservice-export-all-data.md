# InsightsService.export_all_data

**Type:** Security Review
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/analytics/facets/insights/service.py
**Language:** python
**Lines:** 418-462
**Complexity:** 4.0

---

## Source Code

```python
async def export_all_data(
        session: AsyncSession,
    ) -> ExportDataResponse:
        """Export all video data as JSON"""
        videos = await InsightsRepository.get_all_videos(session)

        video_dicts = [
            {
                "id": str(v.id),
                "rank": v.rank,
                "date_posted": v.date_posted.isoformat(),
                "video_url": v.video_url,
                "views": v.views,
                "comments": v.comments,
                "likes": v.likes,
                "bookmarks": v.bookmarks,
                "shares": v.shares,
                "avg_watch_time": v.avg_watch_time,
                "new_followers": v.new_followers,
                "watched_full_video_percentage": v.watched_full_video_percentage,
                "top_comment_words": v.top_comment_words,
                "search_queries": v.search_queries,
                "traffic_sources": v.traffic_sources,
                "hook": v.hook,
                "text_on_screen_hook": v.text_on_screen_hook,
                "length": v.length,
                "description": v.description,
                "hashtags": v.hashtags,
                "cta": v.cta,
                "full_transcription": v.full_transcription,
                "notes": v.notes,
                "created_at": v.created_at.isoformat() if v.created_at else None,
                "updated_at": v.updated_at.isoformat() if v.updated_at else None,
                # Calculated fields
                "engagement_rate": InsightsRepository.calculate_engagement_rate(v),
                "follower_conversion_rate": InsightsRepository.calculate_follower_conversion_rate(v),
            }
            for v in videos
        ]

        return ExportDataResponse(
            videos = video_dicts,
            total_count = len(video_dicts),
            export_date = datetime.utcnow().isoformat(),
        )
```

---

## Security Review

### Security Review

**Vulnerabilities Found:**

1. **Information Leakage**: The `ExportDataResponse` object includes the current UTC timestamp in the `export_date`. While this is not a direct security issue, it could be seen as an information leakage if the timestamps are logged or exposed.

2. **Potential Data Exposure**: The response includes detailed video data such as views, comments, likes, and other metrics which might expose sensitive information if misused.

**Severity:**
- Information Leakage: **Low**
- Potential Data Exposure: **Medium**

**Attack Vectors:**
- An attacker could exploit the `ExportDataResponse` structure to infer timing or usage patterns of the application.
- Sensitive data exposure can be leveraged for further attacks, such as social engineering.

**Recommended Fixes:**
1. **Information Leakage**: Remove the `export_date` field from the response if it is not necessary.
2. **Data Exposure**: Ensure that sensitive fields are only included in export responses when absolutely necessary and consider anonymizing or aggregating data before exporting.

**Overall Security Posture:**
The code snippet does not exhibit critical vulnerabilities but has areas for improvement, particularly around data exposure and information leakage. By addressing these issues, the overall security posture can be enhanced.

---

*Generated by CodeWorm on 2026-02-28 01:01*
