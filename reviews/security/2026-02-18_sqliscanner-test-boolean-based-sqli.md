# SQLiScanner._test_boolean_based_sqli

**Type:** Security Review
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/api-security-scanner/backend/scanners/sqli_scanner.py
**Language:** python
**Lines:** 141-214
**Complexity:** 15.0

---

## Source Code

```python
def _test_boolean_based_sqli(self) -> dict[str, Any]:
        """
        Test for boolean based blind SQL injection

        Compares responses from true vs false conditions to detect SQLi

        Returns:
            dict[str, Any]: Boolean based SQLi test results
        """
        try:
            baseline_response = self.make_request("GET", "/?id=1")
            baseline_length = len(baseline_response.text)
            baseline_status = baseline_response.status_code

            if baseline_status != 200:
                return {
                    "vulnerable": False,
                    "description": "Baseline request failed",
                    "baseline_status": baseline_status,
                }

            boolean_payloads = SQLiPayloads.BOOLEAN_BASED_BLIND
            true_payloads = [
                p for p in boolean_payloads
                if "AND '1'='1" in p or "AND 1=1" in p
            ]
            false_payloads = [
                p for p in boolean_payloads if "AND '1'='2" in p
                or "AND 1=2" in p or "AND 1=0" in p
            ]

            true_lengths = []
            for payload in true_payloads:
                response = self.make_request("GET", f"/?id={payload}")
                true_lengths.append(len(response.text))

            false_lengths = []
            for payload in false_payloads:
                response = self.make_request("GET", f"/?id={payload}")
                false_lengths.append(len(response.text))

            avg_true = statistics.mean(true_lengths)
            avg_false = statistics.mean(false_lengths)

            length_diff = abs(avg_true - avg_false)

            if length_diff > 100 and avg_true != avg_false:
                return {
                    "vulnerable":
                    True,
                    "baseline_length":
                    baseline_length,
                    "true_condition_avg_length":
                    avg_true,
                    "false_condition_avg_length":
                    avg_false,
                    "length_difference":
                    length_diff,
                    "confidence":
                    "HIGH" if length_diff > 500 else "MEDIUM",
                }

            return {
                "vulnerable": False,
                "description": "No boolean-based SQLi detected",
                "length_difference": length_diff,
            }

        except Exception as e:
            return {
                "vulnerable": False,
                "error": str(e),
                "description": "Error testing boolean-based SQLi",
            }
```

---

## Security Review

### Security Review

**Vulnerabilities Found:**

1. **SQL Injection (Critical):**
   - Line 15-27 and 30-42: The code constructs SQL-like payloads directly into URLs, which can lead to SQL injection if the `id` parameter is not properly sanitized.

2. **Error Handling (Low):**
   - Line 68: The generic exception handling may leak information about the application's internal state or database structure through error messages.

3. **Security Posture:**
   - The code lacks input validation and uses direct string concatenation, which can be exploited by attackers to inject malicious SQL queries.

### Attack Vectors:

- An attacker could manipulate the `id` parameter to execute arbitrary SQL commands.
- Error messages in case of exceptions might reveal sensitive information about the application's structure or database.

### Recommended Fixes:

1. **SQL Injection:**
   - Use parameterized queries or an ORM to safely handle input (e.g., use `psycopg2` with placeholders).
   - Example:
     ```python
     cursor.execute("SELECT * FROM users WHERE id = %s", (payload,))
     ```

2. **Error Handling:**
   - Log errors securely and return generic error messages to users.
   - Example:
     ```python
     except Exception as e:
         logging.error(f"An error occurred: {e}")
         return {"vulnerable": False, "description": "Error testing boolean-based SQLi"}
     ```

3. **Overall Security Posture:**
   - Implement comprehensive input validation and sanitization.
   - Use secure coding practices to prevent common vulnerabilities.

By addressing these issues, the security posture of the application can be significantly improved.

---

*Generated by CodeWorm on 2026-02-18 20:47*
