# ManualBankAdapter.validate_recipient

**Type:** Security Review
**Repository:** stripe-referral
**File:** src/stripe_referral/adapters/manual.py
**Language:** python
**Lines:** 40-90
**Complexity:** 10.0

---

## Source Code

```python
def validate_recipient(
        self,
        recipient_data: dict[str,
                             Any]
    ) -> RecipientValidation:
        """
        Validate bank account information is present
        """
        required_fields = [
            "bank_account_number",
            "routing_number",
            "account_holder_name",
        ]

        missing_fields = [
            field for field in required_fields
            if field not in recipient_data
        ]

        if missing_fields:
            return RecipientValidation(
                valid = False,
                error =
                f"Missing required fields: {', '.join(missing_fields)}",
            )

        account_number = recipient_data.get("bank_account_number", "")
        if not account_number or len(account_number) < 4:
            return RecipientValidation(
                valid = False,
                error = "Invalid bank account number",
            )

        routing_number = recipient_data.get("routing_number", "")
        if not routing_number or len(routing_number) != 9:
            return RecipientValidation(
                valid = False,
                error = "Invalid routing number (must be 9 digits)",
            )

        account_holder_name = recipient_data.get(
            "account_holder_name",
            ""
        )
        if not account_holder_name or len(account_holder_name) < 2:
            return RecipientValidation(
                valid = False,
                error = "Invalid account holder name",
            )

        return RecipientValidation(valid = True)
```

---

## Security Review

### Security Review for `validate_recipient` Function

#### Vulnerabilities and Severity:

1. **Input Validation Gaps** - **Medium**
   - The function does not validate the types of the input fields, which could allow for unexpected data formats.

2. **Error Handling that Leaks Information** - **Low**
   - Error messages provide minimal information about the validation process but do not disclose sensitive details.

#### Attack Vectors:

- An attacker could attempt to bypass validation by providing invalid or unexpected data types.
- Misleading error messages might help in understanding the structure of the input dictionary, which is generally low risk.

#### Recommended Fixes:

1. **Type Validation**:
   ```python
   if not isinstance(account_number, str) or len(account_number) < 4:
       return RecipientValidation(valid=False, error="Invalid bank account number")
   ```

2. **Enhance Error Messages** (if needed):
   - Ensure that error messages do not reveal sensitive information.

#### Overall Security Posture:

The current implementation is relatively secure but can be improved by adding type validation to ensure the input data matches expected formats. This will prevent potential issues and reduce the attack surface. The function does a good job of validating required fields, but ensuring robustness against unexpected data types is crucial.

---

*Generated by CodeWorm on 2026-02-21 12:47*
