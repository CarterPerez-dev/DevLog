# FetchStats

**Type:** Security Review
**Repository:** Yoshi-Audit
**File:** internal/ui/dashboard/dashboard.go
**Language:** go
**Lines:** 53-95
**Complexity:** 7.0

---

## Source Code

```go
func FetchStats() tea.Msg {
	var stats StatsMsg

	cpu, err := system.GetCPUUsage()
	if err != nil {
		stats.Err = err
		return stats
	}
	stats.CPU = cpu

	mem, err := system.GetMemoryInfo()
	if err != nil {
		stats.Err = err
		return stats
	}
	stats.Memory = mem

	disk, err := system.GetDiskUsage("/")
	if err != nil {
		stats.Err = err
		return stats
	}
	stats.Disk = disk

	gpuInfo, err := system.GetGPUInfo()
	if err == nil {
		stats.GPU = gpuInfo
	}

	gpuProcs, err := system.GetGPUProcesses()
	if err == nil {
		stats.GPUProcs = gpuProcs
	}

	procs, err := system.GetProcesses()
	if err != nil {
		stats.Err = err
		return stats
	}
	stats.Procs = procs

	return stats
}
```

---

## Security Review

### Security Review for `FetchStats` Function

**Vulnerabilities Found:**

1. **Error Handling and Information Leakage (Info):**
   - Lines 7-9, 13-15, 20-22, 26: The function returns a message containing errors if any occur during the fetching of stats. While this is good for debugging, it could potentially leak sensitive information to users.

2. **Overall Security Posture (Medium):**
   - The code does not appear to have direct injection or deserialization issues.
   - There are no hardcoded secrets or credentials visible in the snippet.
   - Input validation and race conditions do not seem to be an issue here, as the functions `GetCPUUsage`, `GetMemoryInfo`, etc., are assumed to handle their own input validation.

### Recommendations:

1. **Improve Error Handling:**
   - Instead of returning errors directly, consider logging them internally or using a more controlled error handling mechanism.
   ```go
   log.Printf("Error fetching stats: %v", err)
   ```

2. **Use Structured Logging:**
   - Use structured logs to capture errors without exposing sensitive information.

3. **Review External Function Security:**
   - Ensure that the functions `GetCPUUsage`, `GetMemoryInfo`, etc., are secure and do not introduce vulnerabilities.

4. **Consider Contextual Errors:**
   - If errors need to be returned, consider wrapping them in a context or using an error interface that can provide more controlled feedback.

By addressing these points, you can enhance the security posture of your application while maintaining robust error handling practices.

---

*Generated by CodeWorm on 2026-03-01 23:45*
