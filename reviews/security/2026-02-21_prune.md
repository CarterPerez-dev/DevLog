# Prune

**Type:** Security Review
**Repository:** angelamos-operations
**File:** Docker-Kentros/internal/docker/system.go
**Language:** go
**Lines:** 150-202
**Complexity:** 9.0

---

## Source Code

```go
func (c *Client) Prune(
	ctx context.Context,
	pruneImages, pruneVolumes, pruneBuildCache bool,
) (uint64, error) {
	c.mu.RLock()
	defer c.mu.RUnlock()

	var totalReclaimed uint64

	containerReport, err := c.cli.ContainersPrune(ctx, filters.Args{})
	if err != nil {
		return 0, fmt.Errorf("pruning containers: %w", err)
	}
	totalReclaimed += containerReport.SpaceReclaimed

	if pruneImages {
		imageReport, err := c.cli.ImagesPrune(
			ctx,
			filters.NewArgs(filters.Arg("dangling", "false")),
		)
		if err != nil {
			return totalReclaimed, fmt.Errorf("pruning images: %w", err)
		}
		totalReclaimed += imageReport.SpaceReclaimed
	}

	if pruneVolumes {
		volumeReport, err := c.cli.VolumesPrune(ctx, filters.Args{})
		if err != nil {
			return totalReclaimed, fmt.Errorf("pruning volumes: %w", err)
		}
		totalReclaimed += volumeReport.SpaceReclaimed
	}

	if pruneBuildCache {
		buildReport, err := c.cli.BuildCachePrune(
			ctx,
			build.CachePruneOptions{All: true},
		)
		if err != nil {
			return totalReclaimed, fmt.Errorf("pruning build cache: %w", err)
		}
		totalReclaimed += buildReport.SpaceReclaimed
	}

	networkReport, err := c.cli.NetworksPrune(ctx, filters.Args{})
	if err != nil {
		return totalReclaimed, fmt.Errorf("pruning networks: %w", err)
	}
	_ = networkReport

	return totalReclaimed, nil
}
```

---

## Security Review

### Security Review for `Prune` Function

**Vulnerabilities:**

1. **Info - No Injection or Deserialization Issues**: The code does not involve any user input that could lead to SQL, command, or XSS injection vulnerabilities.
2. **Info - No Hardcoded Secrets**: There are no hardcoded secrets or credentials in the provided snippet.
3. **Low - Input Validation Gaps for Filters**: While filters are used, they do not validate their inputs, which could potentially allow malicious filter arguments.

**Attack Vectors:**

- An attacker could manipulate `filters.Args` to include harmful parameters that might be misinterpreted by Docker's API.

**Recommended Fixes:**

1. **Validate Filter Inputs**: Ensure all filter arguments passed to the `cli.ContainersPrune`, `ImagesPrune`, etc., are validated and sanitized.
   ```go
   func (c *Client) Prune(
       ctx context.Context,
       pruneImages, pruneVolumes, pruneBuildCache bool,
   ) (uint64, error) {
       c.mu.RLock()
       defer c.mu.RUnlock()

       var totalReclaimed uint64

       containerReport, err := validateAndPrune(ctx, "containers", filters.Args{})
       if err != nil {
           return 0, fmt.Errorf("pruning containers: %w", err)
       }
       totalReclaimed += containerReport.SpaceReclaimed

       // Similar validation for other prune calls
   }

   func validateAndPrune(ctx context.Context, pruneType string, args filters.Args) (types.ContainerPruneReport, error) {
       // Validate and sanitize args here
       return c.cli.ContainersPrune(ctx, args)
   }
   ```

**Overall Security Posture:**

The current implementation is secure against common injection and deserialization attacks. However, input validation for filter arguments should be added to prevent potential misuse. The overall security posture can be improved by ensuring all user inputs are properly validated before being passed to external APIs or commands.

---

*Generated by CodeWorm on 2026-02-21 08:18*
