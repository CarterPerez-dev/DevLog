# Update

**Type:** Security Review
**Repository:** Yoshi-Audit
**File:** internal/ui/audittab/audittab.go
**Language:** go
**Lines:** 118-187
**Complexity:** 23.0

---

## Source Code

```go
func (at AuditTab) Update(msg tea.Msg) (AuditTab, tea.Cmd) {
	switch msg := msg.(type) {
	case AuditDataMsg:
		if msg.Err != nil {
			at.err = msg.Err
			at.scanning = false
			return at, nil
		}
		at.findings = msg.Findings
		at.summary = msg.Summary
		at.lastScan = time.Now()
		at.scanning = false
		at.err = nil
	case tea.KeyMsg:
		filtered := at.filteredFindings()
		switch msg.String() {
		case "r":
			at.scanning = true
			scanner := at.scanner
			rssHistory := at.rssHistory
			return at, func() tea.Msg {
				return FetchAuditData(scanner, rssHistory)
			}
		case "up", "k":
			if at.cursor > 0 {
				at.cursor--
			}
		case "down", "j":
			if at.cursor < len(filtered)-1 {
				at.cursor++
			}
		case "a":
			if at.cursor < len(filtered) && at.baseline != nil {
				f := filtered[at.cursor]
				at.baseline.Add(f.Name)
				at.baseline.Save(config.DefaultBaselinePath())
				at.scanning = true
				scanner := at.scanner
				rssHistory := at.rssHistory
				return at, func() tea.Msg {
					return FetchAuditData(scanner, rssHistory)
				}
			}
		case "i":
			if at.cursor < len(filtered) {
				target := filtered[at.cursor]
				var newFindings []audit.Finding
				removed := false
				for _, f := range at.findings {
					if !removed && f.PID == target.PID && f.Type == target.Type && f.Name == target.Name {
						removed = true
						continue
					}
					newFindings = append(newFindings, f)
				}
				at.findings = newFindings
				if at.cursor >= len(at.filteredFindings()) && at.cursor > 0 {
					at.cursor--
				}
			}
		case "enter":
			if at.showDetail == at.cursor {
				at.showDetail = -1
			} else {
				at.showDetail = at.cursor
			}
		}
	}
	return at, nil
}
```

---

## Security Review

### Security Review for `Update` Function

**Vulnerabilities:**

1. **Info - Input Validation Gaps:** The function does not validate the input strings for "r", "up", "down", "a", "i", and "enter". This could lead to unexpected behavior if non-alphanumeric characters are used.

2. **Info - Error Handling:** The error handling is minimal, only setting `at.err` on key errors. Consider adding more robust error handling for all operations.

3. **Info - Hardcoded Path:** The path `config.DefaultBaselinePath()` is hardcoded and could be a potential security risk if not properly managed.

4. **Info - Race Conditions:** There are no apparent race conditions or TOCTOU bugs in this function, but ensure that external functions like `FetchAuditData` handle concurrency safely.

**Attack Vectors:**

- Malicious input for key messages could disrupt the UI flow.
- Unhandled errors during file operations might lead to data corruption or loss.

**Recommended Fixes:**

1. **Input Validation:** Validate all string inputs against expected values before processing them.
   ```go
   case "r":
       if msg.String() != "r" {
           return at, nil // or handle appropriately
       }
   ```

2. **Error Handling:** Add error handling for file operations and external function calls.
   ```go
   err := at.baseline.Save(config.DefaultBaselinePath())
   if err != nil {
       log.Println("Failed to save baseline:", err)
       return at, nil // or handle appropriately
   }
   ```

3. **Path Management:** Ensure `config.DefaultBaselinePath()` is securely managed and does not expose sensitive information.

4. **Concurrency Safety:** If `FetchAuditData` is called in a goroutine, ensure it handles concurrency safely.

**Overall Security Posture:**

The code has some minor security concerns related to input validation and error handling. Addressing these will improve the overall security posture of the application.

---

*Generated by CodeWorm on 2026-03-01 20:41*
