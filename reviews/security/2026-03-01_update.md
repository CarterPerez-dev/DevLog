# Update

**Type:** Security Review
**Repository:** Yoshi-Audit
**File:** internal/ui/dashboard/dashboard.go
**Language:** go
**Lines:** 97-120
**Complexity:** 7.0

---

## Source Code

```go
func (d Dashboard) Update(msg tea.Msg) (Dashboard, tea.Cmd) {
	switch msg := msg.(type) {
	case StatsMsg:
		d.cpu = msg.CPU
		d.memory = msg.Memory
		d.disk = msg.Disk
		d.gpu = msg.GPU
		d.gpuProcs = msg.GPUProcs
		d.procs = msg.Procs
		d.err = msg.Err
	case tea.KeyMsg:
		switch msg.String() {
		case "m":
			d.sortMode = SortByMemory
		case "c":
			d.sortMode = SortByCPU
		case "g":
			d.sortMode = SortByGPU
		case "n":
			d.sortMode = SortByName
		}
	}
	return d, nil
}
```

---

## Security Review

### Security Review for `Update` Function in `dashboard.go`

#### 1. Vulnerabilities Found

**Severity: Info**
- **Input Validation Gaps**: The function directly updates the state based on user input without any validation or sanitization, which could lead to unexpected behavior if invalid messages are processed.

**Recommendation**: Implement proper input validation and ensure that only expected message types are handled.

#### 2. Attack Vectors

- An attacker could send unexpected `msg` types leading to incorrect state updates.
- If the `StatsMsg` struct contains any sensitive data, improper handling might lead to information leakage.

#### 3. Recommended Fixes

```go
func (d *Dashboard) Update(msg tea.Msg) (Dashboard, tea.Cmd) {
	switch msg := msg.(type) {
	case StatsMsg:
		if err := validateStatsMsg(msg); err != nil {
			d.err = err
			return d, nil
		}
		d.cpu = msg.CPU
		d.memory = msg.Memory
		d.disk = msg.Disk
		d.gpu = msg.GPU
		d.gpuProcs = msg.GPUProcs
		d.procs = msg.Procs
	case tea.KeyMsg:
		switch msg.String() {
		case "m":
			d.sortMode = SortByMemory
		case "c":
			d.sortMode = SortByCPU
		case "g":
			d.sortMode = SortByGPU
		case "n":
			d.sortMode = SortByName
		default:
			return d, nil // Handle unknown keys
		}
	}
	return *d, nil
}

func validateStatsMsg(msg StatsMsg) error {
	// Add validation logic here
	return nil
}
```

#### 4. Overall Security Posture

The current code has a low security risk but can be improved by adding proper input validation and handling unexpected messages gracefully. This ensures the application remains robust against unexpected inputs and potential attacks.

--- 

Note: Ensure that any sensitive data within `StatsMsg` is properly handled or encrypted if necessary.

---

*Generated by CodeWorm on 2026-03-01 23:51*
