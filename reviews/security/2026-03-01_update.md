# Update

**Type:** Security Review
**Repository:** Yoshi-Audit
**File:** internal/ui/app.go
**Language:** go
**Lines:** 79-165
**Complexity:** 27.0

---

## Source Code

```go
func (a App) Update(msg tea.Msg) (tea.Model, tea.Cmd) {
	if a.showSplash {
		if wsm, ok := msg.(tea.WindowSizeMsg); ok {
			a.width = wsm.Width
			a.height = wsm.Height
		}
		var cmd tea.Cmd
		a.splash, cmd = a.splash.Update(msg)
		if a.splash.Done() {
			a.showSplash = false
			return a, a.initDataFetches()
		}
		return a, cmd
	}

	switch msg := msg.(type) {
	case tea.WindowSizeMsg:
		a.width = msg.Width
		a.height = msg.Height
	case dashboard.StatsMsg:
		a.dashboard, _ = a.dashboard.Update(msg)
	case dockertab.DockerDataMsg:
		a.dockerTab, _ = a.dockerTab.Update(msg)
	case audittab.AuditDataMsg:
		a.auditTab, _ = a.auditTab.Update(msg)
	case dockertab.DeleteResultMsg:
		var cmd tea.Cmd
		a.dockerTab, cmd = a.dockerTab.Update(msg)
		return a, cmd
	case tea.KeyMsg:
		if a.activeTab == TabDocker {
			switch msg.String() {
			case "q", "ctrl+c":
				return a, tea.Quit
			case "tab":
				a.activeTab = (a.activeTab + 1) % 3
			case "r":
				cfg := a.cfg
				return a, func() tea.Msg { return dockertab.FetchDockerData(cfg) }
			default:
				var cmd tea.Cmd
				a.dockerTab, cmd = a.dockerTab.Update(msg)
				return a, cmd
			}
			return a, nil
		}

		if a.activeTab == TabAudit {
			switch msg.String() {
			case "q", "ctrl+c":
				return a, tea.Quit
			case "tab":
				a.activeTab = (a.activeTab + 1) % 3
			default:
				var cmd tea.Cmd
				a.auditTab, cmd = a.auditTab.Update(msg)
				return a, cmd
			}
			return a, nil
		}

		switch msg.String() {
		case "q", "ctrl+c":
			return a, tea.Quit
		case "1":
			a.activeTab = TabDashboard
		case "2":
			a.activeTab = TabDocker
		case "3":
			a.activeTab = TabAudit
		case "tab":
			a.activeTab = (a.activeTab + 1) % 3
		case "p":
			a.paused = !a.paused
		case "m", "c", "g", "n":
			if a.activeTab == TabDashboard {
				a.dashboard, _ = a.dashboard.Update(msg)
			}
		}
	case TickMsg:
		if !a.paused {
			return a, tea.Batch(doTick(), dashboard.FetchStats)
		}
		return a, doTick()
	}
	return a, nil
}
```

---

## Security Review

### Security Review for `Update` Function in Go

#### Vulnerabilities Found:

1. **Info - Input Validation Gaps:**
   - Lines 20-35 and 48-69: The function handles various message types without thorough validation of the input strings (`msg.String()`). This could allow an attacker to inject malicious values, potentially leading to unexpected behavior or security issues.

2. **Info - Error Handling:**
   - Lines 17, 23, 29, and 45: The function does not handle errors returned from `Update` methods of `dockerTab`, `auditTab`, and `dashboard`. This could lead to silent failures or unexpected behavior if these methods return an error.

#### Attack Vectors:

- An attacker could send crafted messages that exploit the lack of validation, potentially leading to incorrect state transitions or unintended actions.
- Errors from internal components might not be properly handled, causing the application to behave unpredictably.

#### Recommended Fixes:

1. **Input Validation:**
   - Validate input strings before processing them in lines 20-35 and 48-69. Use regular expressions or predefined constants for expected values.

2. **Error Handling:**
   - Add error handling around calls to `Update` methods, e.g., `a.dockerTab, cmd, err := a.dockerTab.Update(msg)`. Ensure errors are logged or handled appropriately.

#### Overall Security Posture:

The current implementation has some minor security concerns related to input validation and error handling. Addressing these issues will improve the overall security posture of the application. Regular code reviews and static analysis tools can help identify similar vulnerabilities in the future.

---

*Generated by CodeWorm on 2026-03-01 20:17*
