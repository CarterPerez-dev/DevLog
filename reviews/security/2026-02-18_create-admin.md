# create_admin

**Type:** Security Review
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/siem-dashboard/backend/app/cli.py
**Language:** python
**Lines:** 24-53
**Complexity:** 5.0

---

## Source Code

```python
def create_admin(username: str, email: str, password: str) -> None:
    """
    Create a new admin account or promote an existing user
    """
    existing = User.find_by_username(username)
    if existing is not None:
        if existing.role == UserRole.ADMIN:
            click.echo(f"User '{username}' is already an admin.")
            return
        existing.set_role(UserRole.ADMIN)
        click.echo(f"Promoted existing user '{username}' to admin.")
        return

    existing_email = User.find_by_email(email)
    if existing_email is not None:
        if existing_email.role == UserRole.ADMIN:
            click.echo(f"User with email '{email}' is already an admin.")
            return
        existing_email.set_role(UserRole.ADMIN)
        click.echo(f"Promoted existing user '{existing_email.username}' to admin.")
        return

    hashed = hash_password(password)
    User.create_user(
        username = username,
        email = email,
        password_hash = hashed,
        role = UserRole.ADMIN,
    )
    click.echo(f"Admin account '{username}' created successfully.")
```

---

## Security Review

### Security Review for `create_admin` Function

**Vulnerabilities Found:**

1. **Info - Hardcoded Secret or Credential:** The function uses the `hash_password` function, but no implementation is shown. Ensure this function securely hashes passwords.
2. **Low - Input Validation Gap:** The code does not validate if `username`, `email`, and `password` are non-empty strings.
3. **Info - Error Handling that Leaks Information:** Using `click.echo` for logging might reveal sensitive information in logs.

**Attack Vectors:**

- An attacker could provide an empty or invalid input, leading to unexpected behavior.
- If the password hashing is weak, it can be exploited by attackers trying to crack passwords.

**Recommended Fixes:**

1. **Input Validation:** Add checks to ensure `username`, `email`, and `password` are non-empty strings.
   ```python
   if not username or not email or not password:
       raise ValueError("Username, email, and password must be provided.")
   ```

2. **Secure Password Hashing:** Ensure the `hash_password` function uses a secure hashing algorithm like bcrypt.
3. **Error Handling:** Use structured logging with a library like `logging` instead of `click.echo`.
   ```python
   import logging

   logger = logging.getLogger(__name__)

   def create_admin(username: str, email: str, password: str) -> None:
       # Input validation and hashing code here
       try:
           # Existing user checks and creation logic
       except Exception as e:
           logger.error(f"Failed to create admin account: {e}")
   ```

**Overall Security Posture:** The current implementation has some basic security issues, but with the suggested fixes, it can be significantly improved. Ensure all dependencies are up-to-date and follow best practices for secure coding.

---

*Generated by CodeWorm on 2026-02-18 16:54*
