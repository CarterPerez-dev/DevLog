# schedule_preview

**Type:** Security Review
**Repository:** CodeWorm
**File:** codeworm/cli.py
**Language:** python
**Lines:** 230-261
**Complexity:** 4.0

---

## Source Code

```python
def schedule_preview(ctx: click.Context, days: int, timezone: str | None) -> None:
    """
    Preview upcoming scheduled commit times
    """
    from codeworm.scheduler import CodeWormScheduler

    settings = load_settings(config_dir = ctx.obj["config_dir"])
    configure_logging(debug = ctx.obj["debug"])

    if timezone:
        settings.schedule.timezone = timezone

    scheduler = CodeWormScheduler(settings.schedule)
    preview = scheduler.get_schedule_preview(days = days)

    console.print(f"[bold]Schedule Preview ({days} day(s))[/bold]\n")

    table = Table()
    table.add_column("Time", style = "cyan")
    table.add_column("Hour", justify = "right")
    table.add_column("Day", style = "dim")

    for entry in preview:
        day_type = "[yellow]Weekend[/yellow]" if entry["is_weekend"] else "Weekday"
        table.add_row(
            entry["time"],
            str(entry["hour"]),
            day_type,
        )

    console.print(table)
    console.print(f"\n[dim]Total commits scheduled: {len(preview)}[/dim]")
```

---

## Security Review

### Security Review for `schedule_preview` Function

#### Vulnerabilities Found:

1. **Info: Hardcoded Secrets or Credentials**
   - **Severity:** Info
   - **Line:** N/A (Not present in the provided code)
   - **Fix:** Ensure no hardcoded secrets are used and follow best practices like environment variables.

2. **Info: Input Validation Gaps**
   - **Severity:** Low
   - **Line:** `days` parameter is not validated.
   - **Fix:** Add input validation to ensure `days` is a positive integer, e.g., `if days <= 0: raise ValueError("Days must be a positive number")`.

3. **Info: Insecure Deserialization**
   - **Severity:** Info
   - **Line:** N/A (Not applicable in this context)
   - **Fix:** Ensure no untrusted data is deserialized, especially from external sources.

4. **Info: Error Handling that Leaks Information**
   - **Severity:** Info
   - **Line:** N/A (No error handling present)
   - **Fix:** Implement try-except blocks to handle potential exceptions and log errors securely.

#### Attack Vectors:

- **Input Manipulation:** An attacker could provide invalid or malicious input, such as negative days values, which might cause unexpected behavior.
- **Logging Information Disclosure:** Improper error handling could potentially expose sensitive information if an exception occurs.

#### Recommended Fixes:

1. Validate `days` parameter to ensure it is a positive integer.
2. Use environment variables for any hardcoded secrets.
3. Implement robust logging and error handling practices.

Overall, the security posture of this function is good but can be improved by addressing minor issues like input validation and ensuring secure coding practices are followed throughout the application.

---

*Generated by CodeWorm on 2026-02-21 15:55*
