# stats

**Type:** Security Review
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/beginner/network-traffic-analyzer/python/src/netanal/main.py
**Language:** python
**Lines:** 263-315
**Complexity:** 7.0

---

## Source Code

```python
def stats(
    pcap_file: Annotated[
        Path,
        typer.Argument(help="PCAP file to analyze"),
    ],
    bandwidth: Annotated[
        bool,
        typer.Option(
            "--bandwidth",
            "-b",
            help="Show bandwidth statistics",
        ),
    ] = False,
    protocols: Annotated[
        bool,
        typer.Option(
            "--protocols",
            "-p",
            help="Show protocol distribution",
        ),
    ] = False,
    endpoints: Annotated[
        bool,
        typer.Option(
            "--endpoints",
            "-e",
            help="Show endpoint statistics",
        ),
    ] = False,
) -> None:
    """
    [bold green]Display statistics[/bold green] from a PCAP file

    Examples:
        netanal stats traffic.pcap --bandwidth
        netanal stats traffic.pcap --protocols --endpoints
    """
    if not pcap_file.exists():
        print_error(f"File not found: {pcap_file}")
        raise typer.Exit(1)

    stats_result, _ = _analyze_pcap_to_stats(pcap_file)

    print_capture_summary(stats_result)

    if protocols or (not bandwidth and not endpoints):
        print_protocol_table(stats_result)

    if endpoints:
        print_top_talkers(stats_result, limit=20)

    if bandwidth:
        print_bandwidth_stats(stats_result)
```

---

## Security Review

### Security Review for `stats` Function

**Vulnerabilities Found:**

1. **Info - Input Validation Gaps**: The function does not validate the input file type or content, which could lead to unexpected behavior.
   - **Severity:** Info
   - **Fix Suggestion:** Add checks to ensure the file is a valid PCAP file.

2. **Info - Error Handling Leaks Information**: The error message includes the file path, which might reveal sensitive information.
   - **Severity:** Info
   - **Fix Suggestion:** Use a generic error message: `print_error("File not found.")`.

3. **Medium - Hardcoded Secrets or Credentials**: No hardcoded secrets are present in this snippet.

4. **Info - Insecure Deserialization**: Not applicable as there is no deserialization logic.

5. **Low - Race Conditions and TOCTOU Bugs**: The function does not interact with files in a way that would expose these issues.
   - **Severity:** Info

**Attack Vectors:**

- An attacker could provide an invalid or malicious PCAP file, leading to unexpected behavior or potential security risks if the file is processed further.

**Recommended Fixes:**

1. Validate the input file type:
   ```python
   from scapy.all import PcapReader
   
   def stats(...):
       if not pcap_file.exists():
           print_error("File not found.")
           raise typer.Exit(1)
       
       with PcapReader(pcap_file) as pcap_reader:
           # Ensure it is a valid PCAP file
           if not pcap_reader:
               print_error("Invalid PCAP file.")
               raise typer.Exit(1)
   ```

2. Improve error handling:
   ```python
   def stats(...):
       try:
           stats_result, _ = _analyze_pcap_to_stats(pcap_file)
       except Exception as e:
           print_error(f"An error occurred: {str(e)}")
           raise typer.Exit(1)
   ```

**Overall Security Posture:**

The function is relatively secure but could benefit from additional input validation and improved error handling to prevent information leaks and ensure robustness.

---

*Generated by CodeWorm on 2026-02-27 23:59*
