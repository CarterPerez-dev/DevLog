# TelehookLoggingHandler.emit

**Type:** Security Review
**Repository:** Telehook
**File:** src/telehook/adapters/logging_handler.py
**Language:** python
**Lines:** 18-37
**Complexity:** 5.0

---

## Source Code

```python
def emit(self, record: logging.LogRecord) -> None:
        try:
            if record.exc_info and record.exc_info[1]:
                text = error_formatter(
                    exception = record.exc_info[1],
                    component = record.name,
                )
            else:
                text = (
                    f"\u26a0\ufe0f <b>{record.levelname}: {record.name}</b>"
                    f"\n\n<code>{record.getMessage()}</code>"
                )

            try:
                loop = asyncio.get_running_loop()
                loop.create_task(self._notifier.send(text))
            except RuntimeError:
                self._notifier.send_sync(text)
        except Exception:
            self.handleError(record)
```

---

## Security Review

### Security Review

**Vulnerabilities Found:**

1. **Error Handling Leakage**: Line 9-12 - The `handleError` method is called with a bare `Exception`, which could leak sensitive information about the application's internal state (Critical).
   
   **Attack Vector**: An attacker could exploit this to gain insights into how the system handles exceptions.

2. **Potential XSS Risk**: Lines 5-7 - If `record.getMessage()` contains user input, it might be vulnerable to Cross-Site Scripting (XSS) attacks unless properly sanitized (Medium).

**Recommendations:**

1. **Improve Error Handling**: Catch specific exceptions instead of a bare `Exception` to avoid leaking sensitive information.
   ```python
   except asyncio.CancelledError:
       pass  # or handle appropriately
   ```

2. **Sanitize User Input**: Ensure that any user-generated content passed through `record.getMessage()` is properly sanitized before being used in the log message.

3. **Use Decorators for Logging**: Consider using logging decorators to standardize and secure logging practices across the application.

**Overall Security Posture:**

The current implementation has critical security gaps, particularly around error handling that could expose sensitive information. Addressing these issues will significantly improve the overall security posture of the application.

---

*Generated by CodeWorm on 2026-03-01 19:11*
