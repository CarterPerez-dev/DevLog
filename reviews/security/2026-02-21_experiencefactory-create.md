# ExperienceFactory.create

**Type:** Security Review
**Repository:** my-portfolio
**File:** v1/backend/conftest.py
**Language:** python
**Lines:** 326-359
**Complexity:** 4.0

---

## Source Code

```python
async def create(
        cls,
        session: AsyncSession,
        *,
        language: Language = Language.ENGLISH,
        company: str | None = None,
        role: str | None = None,
        start_date: date | None = None,
        end_date: date | None = None,
        is_current: bool = False,
        description: str | None = None,
        employment_type: EmploymentType = EmploymentType.FULL_TIME,
        is_visible: bool = True,
    ) -> Experience:
        cls._counter += 1

        experience = Experience(
            language = language,
            company = company or f"Test Company {cls._counter}",
            role = role or f"Software Engineer {cls._counter}",
            start_date = start_date or date(2023,
                                            1,
                                            1),
            end_date = end_date,
            is_current = is_current,
            description = description
            or f"Experience description {cls._counter}",
            employment_type = employment_type,
            is_visible = is_visible,
        )
        session.add(experience)
        await session.flush()
        await session.refresh(experience)
        return experience
```

---

## Security Review

### Security Review

#### Vulnerabilities Found:

1. **Info - Hardcoded Secrets or Credentials**
   - **Line:** N/A
   - **Issue:** The code does not contain hardcoded secrets, but it could be used in a context where such issues might arise.

2. **Low - Input Validation Gaps**
   - **Lines:** 6-9
   - **Issue:** The function accepts `company`, `role`, `start_date`, and `end_date` as optional parameters with default values. While this is convenient, it could lead to unexpected behavior if these fields are not properly validated elsewhere.
   - **Attack Vector:** Malicious input could be passed through these parameters.

3. **Info - Insecure Deserialization**
   - **Line:** N/A
   - **Issue:** The function does not involve deserialization of data, so this is not applicable here.

4. **Info - Error Handling that Leaks Information**
   - **Line:** N/A
   - **Issue:** No explicit error handling is present in the snippet.
   - **Attack Vector:** Potential information leakage if an exception occurs during database operations.

#### Recommended Fixes:

1. **Input Validation:**
   ```python
   from datetime import date

   def validate_date(date_str):
       try:
           return date.fromisoformat(date_str)
       except ValueError:
           raise ValueError("Invalid date format")

   async def create(
       cls,
       session: AsyncSession,
       *,
       language: Language = Language.ENGLISH,
       company: str | None = None,
       role: str | None = None,
       start_date: str | None = None,
       end_date: str | None = None,
       is_current: bool = False,
       description: str | None = None,
       employment_type: EmploymentType = EmploymentType.FULL_TIME,
       is_visible: bool = True,
   ) -> Experience:
       cls._counter += 1

       start_date = validate_date(start_date) if start_date else date(2023, 1, 1)
       end_date = validate_date(end_date) if end_date else None

       experience = Experience(
           language=language,
           company=company or f"Test Company {cls._counter}",
           role=role or f"Software Engineer {cls._counter}",
           start_date=start_date,
           end_date=end_date,
           is_current=is_current,
           description=description
               or f"Experience description {cls._counter}",
           employment_type=employment_type,
           is_visible=is_visible,
       )
       session.add(experience)
       await session.flush()
       await session.refresh(experience)
       return experience
   ```

2. **Error Handling:**
   ```python
   try:
       # Database operations
   except Exception as e:
       logger.error(f"Database operation failed: {e}")
       raise
   ```

#### Overall Security Posture:

The code is relatively secure but could benefit from proper input validation and error handling to prevent unexpected behavior and information leakage.

---

*Generated by CodeWorm on 2026-02-21 11:58*
