# ReportService.get_report

**Type:** Security Review
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/advanced/bug-bounty-platform/backend/app/report/service.py
**Language:** python
**Lines:** 79-136
**Complexity:** 11.0

---

## Source Code

```python
async def get_report(
        self,
        user: User,
        report_id: UUID,
    ) -> ReportDetailResponse:
        """
        Get report by ID with details
        """
        report = await ReportRepository.get_by_id_with_details(
            self.session,
            report_id
        )
        if not report:
            raise ReportNotFound(str(report_id))

        program = await ProgramRepository.get_by_id(
            self.session,
            report.program_id
        )

        is_researcher = report.researcher_id == user.id
        is_program_owner = program and program.company_id == user.id

        if not is_researcher and not is_program_owner:
            raise ReportNotFound(str(report_id))

        comments = report.comments
        if is_researcher and not is_program_owner:
            comments = [c for c in comments if not c.is_internal]

        return ReportDetailResponse(
            id = report.id,
            created_at = report.created_at,
            updated_at = report.updated_at,
            program_id = report.program_id,
            researcher_id = report.researcher_id,
            title = report.title,
            description = report.description,
            steps_to_reproduce = report.steps_to_reproduce,
            impact = report.impact,
            severity_submitted = report.severity_submitted,
            severity_final = report.severity_final,
            status = report.status,
            cvss_score = report.cvss_score,
            cwe_id = report.cwe_id,
            bounty_amount = report.bounty_amount,
            duplicate_of_id = report.duplicate_of_id,
            triaged_at = report.triaged_at,
            resolved_at = report.resolved_at,
            disclosed_at = report.disclosed_at,
            comments = [
                CommentResponse.model_validate(c) for c in comments
            ],
            attachments = [
                AttachmentResponse.model_validate(a)
                for a in report.attachments
            ],
        )
```

---

## Security Review

### Security Review for `ReportService.get_report`

#### Vulnerabilities Found:

1. **Authentication and Authorization Issues** - [High]
   - The function checks the user's role but does not verify if the user is authenticated.
   - Line 9: Ensure that `user` is a valid, authenticated User object.

2. **Input Validation Gaps** - [Medium]
   - The `report_id` and `program_id` are assumed to be correctly formatted UUIDs without validation.
   - Lines 3-4: Add type hints and input validation for `report_id`.

#### Attack Vectors:

1. **Unauthenticated Access**: An attacker could attempt to access reports by guessing or brute-forcing user IDs.
2. **Incorrect Permissions**: A non-researcher with program ownership might bypass restrictions on internal comments.

#### Recommended Fixes:

1. **Authentication and Authorization**:
   - Ensure `user` is authenticated before proceeding.
   ```python
   if not user.is_authenticated():
       raise UnauthorizedAccess()
   ```

2. **Input Validation**:
   - Validate `report_id` as a UUID.
   ```python
   from uuid import UUID

   report_id = UUID(report_id)
   ```

3. **Error Handling**:
   - Use more specific exceptions for better error handling and less information leakage.

#### Overall Security Posture:

The code has good authorization checks but lacks authentication validation, which is critical to prevent unauthorized access. Adding proper input validation and ensuring the user is authenticated will significantly enhance the security posture of this function.

---

*Generated by CodeWorm on 2026-02-23 07:44*
