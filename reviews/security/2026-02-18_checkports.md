# checkPorts

**Type:** Security Review
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/docker-security-audit/internal/analyzer/compose.go
**Language:** go
**Lines:** 477-539
**Complexity:** 15.0

---

## Source Code

```go
func (a *ComposeAnalyzer) checkPorts(
	target finding.Target,
	serviceName string,
	node *yaml.Node,
) finding.Collection {
	var findings finding.Collection

	portsNode := findNode(node, "ports")
	if portsNode == nil {
		return findings
	}

	for _, portNode := range portsNode.Content {
		var portSpec string
		switch portNode.Kind {
		case yaml.ScalarNode:
			portSpec = portNode.Value
		case yaml.MappingNode:
			publishedNode := findNode(portNode, "published")
			hostIPNode := findNode(portNode, "host_ip")
			if publishedNode != nil {
				portSpec = publishedNode.Value
			}
			if hostIPNode != nil && hostIPNode.Value == "0.0.0.0" {
				loc := &finding.Location{Path: a.path, Line: hostIPNode.Line}
				f := finding.New("DS-COMPOSE-BIND", "Service '"+serviceName+"' explicitly binds to 0.0.0.0", finding.SeverityInfo, target).
					WithDescription("Binding to 0.0.0.0 exposes the port on all network interfaces.").
					WithCategory(string(CategoryCompose)).
					WithLocation(loc).
					WithRemediation("Consider binding to 127.0.0.1 for local-only access.")
				findings = append(findings, f)
			}
		}

		if portSpec == "" {
			continue
		}

		parts := strings.Split(portSpec, ":")
		var hostPort string
		if len(parts) >= 2 {
			hostPort = parts[0]
			if strings.Contains(hostPort, ".") {
				hostPort = parts[1]
			}
		}

		if hostPort != "" {
			portNum, err := strconv.Atoi(hostPort)
			if err == nil && portNum > 0 && portNum < 1024 {
				loc := &finding.Location{Path: a.path, Line: portNode.Line}
				f := finding.New("DS-COMPOSE-PRIVPORT", "Service '"+serviceName+"' exposes privileged port "+hostPort, finding.SeverityInfo, target).
					WithDescription("Privileged ports (below 1024) typically require root privileges on the host.").
					WithCategory(string(CategoryCompose)).
					WithLocation(loc).
					WithRemediation("Consider using non-privileged ports (>1024) with port mapping.")
				findings = append(findings, f)
			}
		}
	}

	return findings
}
```

---

## Security Review

### Security Review for `checkPorts` Function

**Vulnerabilities:**

1. **Info - Input Validation Gaps:** The function does not validate or sanitize the input strings, which could potentially lead to issues like command injection if the input is manipulated.
   - **Attack Vector:** Maliciously crafted YAML files can exploit this by injecting commands into `portSpec`.
   - **Fix:** Ensure all inputs are validated and sanitized. For example, use regular expressions to validate port numbers.

2. **Info - Error Handling Gaps:** The function does not handle errors from `strconv.Atoi` or other potential errors.
   - **Attack Vector:** Potential crashes if invalid input is provided.
   - **Fix:** Add proper error handling for all functions that return errors.

3. **Info - Hardcoded Secrets or Credentials:** No hardcoded secrets are found in the snippet, but ensure no such issues exist elsewhere in the codebase.
   - **Fix:** Review and remove any hardcoded credentials.

**Overall Security Posture:**

The function is relatively secure but has some minor issues that could be improved for better security. The primary concerns are input validation and error handling. Addressing these will significantly enhance the security posture of this function.

### Recommended Fixes:

1. Validate `portSpec` using regular expressions to ensure it only contains valid port numbers.
2. Add comprehensive error handling, especially around `strconv.Atoi`.
3. Ensure no hardcoded secrets or credentials are present in the codebase.

---

*Generated by CodeWorm on 2026-02-18 12:19*
