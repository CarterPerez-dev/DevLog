# email_validator

**Type:** Performance Analysis
**Repository:** CertGames-Core
**File:** backend/api/domains/account/middleware/schemas.py
**Language:** python
**Lines:** 197-240
**Complexity:** 13.0

---

## Source Code

```python
def email_validator(email: str) -> str:
    """
    Validates an email with strict rules:
    """
    errors = []
    if not email:
        raise ValueError("Email is required.")

    email_nfc = trim_and_normalize(email).lower()

    if not AuthConfig.Email.MIN_LENGTH <= len(
            email_nfc) <= AuthConfig.Email.MAX_LENGTH:
        errors.append(
            f"Email length must be between {AuthConfig.Email.MIN_LENGTH} and {AuthConfig.Email.MAX_LENGTH} characters."
        )

    for ch in email_nfc:
        if ch in AuthConfig.Email.FORBIDDEN_CHARS:
            errors.append(
                "Email contains forbidden characters like <, >, or whitespace."
            )
            break

    if email_nfc.count("@") != 1:
        errors.append("Email must contain exactly one '@' symbol.")
    else:
        parts = email_nfc.split("@")
        if len(parts) == 2:
            local_part, domain_part = parts
            if not local_part:
                errors.append("Email must have a local part before '@'.")
            if not domain_part:
                errors.append("Email must have a domain after '@'.")
            elif "." not in domain_part:
                errors.append(
                    "Email domain must contain at least one '.'."
                )
            elif domain_part.startswith(".") or domain_part.endswith("."):
                errors.append("Email domain cannot start or end with '.'.")

    if errors:
        raise ValueError("; ".join(errors))

    return str(email_nfc)
```

---

## Performance Analysis

### Performance Analysis

**Time Complexity:** The function has a time complexity of \(O(n^2)\), where \(n\) is the length of the email string, due to the `count` and `split` operations within the loop.

**Space Complexity:** The space complexity is \(O(1)\) for variables like `errors`, but it can grow up to \(O(n)\) if many errors are appended.

**Bottlenecks or Inefficiencies:**
- **Redundant Operations:** The `count` and `split` operations inside the loop are redundant, as they are called multiple times.
- **Unnecessary Iteration:** Checking each character in the email string is unnecessary since you can validate it more efficiently.
- **Error Handling:** Appending the same error message for forbidden characters repeatedly is inefficient.

**Optimization Opportunities:**
1. Use a single `count` and `split` operation outside the loop to check the presence of '@' and domain parts.
2. Validate character set in one pass without iterating through each character.
3. Use a set for forbidden characters to reduce lookup time from \(O(n)\) to \(O(1)\).

**Resource Usage Concerns:**
- Ensure that `AuthConfig.Email` is properly defined and does not cause any import delays.

### Optimized Code

```python
def email_validator(email: str) -> str:
    """
    Validates an email with strict rules.
    """
    if not email:
        raise ValueError("Email is required.")

    email_nfc = trim_and_normalize(email).lower()

    if (len(email_nfc) < AuthConfig.Email.MIN_LENGTH or 
            len(email_nfc) > AuthConfig.Email.MAX_LENGTH):
        raise ValueError(
            f"Email length must be between {AuthConfig.Email.MIN_LENGTH} and {AuthConfig.Email.MAX_LENGTH} characters."
        )

    forbidden_chars = set(AuthConfig.Email.FORBIDDEN_CHARS)
    if any(ch in forbidden_chars for ch in email_nfc):
        raise ValueError("Email contains forbidden characters like <, >, or whitespace.")

    parts = email_nfc.split("@")
    if len(parts) != 2:
        raise ValueError("Email must contain exactly one '@' symbol.")
    
    local_part, domain_part = parts
    if not local_part or not domain_part:
        raise ValueError("Invalid local or domain part in the email.")
    
    if "." not in domain_part or domain_part.startswith(".") or domain_part.endswith("."):
        raise ValueError(
            "Email domain must contain at least one '.', and cannot start or end with '.'."
        )

    return str(email_nfc)
```

This optimized version reduces redundancy, improves readability, and enhances performance.

---

*Generated by CodeWorm on 2026-03-01 09:36*
