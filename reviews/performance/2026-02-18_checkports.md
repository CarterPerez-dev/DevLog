# checkPorts

**Type:** Performance Analysis
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/docker-security-audit/internal/analyzer/compose.go
**Language:** go
**Lines:** 477-539
**Complexity:** 15.0

---

## Source Code

```go
func (a *ComposeAnalyzer) checkPorts(
	target finding.Target,
	serviceName string,
	node *yaml.Node,
) finding.Collection {
	var findings finding.Collection

	portsNode := findNode(node, "ports")
	if portsNode == nil {
		return findings
	}

	for _, portNode := range portsNode.Content {
		var portSpec string
		switch portNode.Kind {
		case yaml.ScalarNode:
			portSpec = portNode.Value
		case yaml.MappingNode:
			publishedNode := findNode(portNode, "published")
			hostIPNode := findNode(portNode, "host_ip")
			if publishedNode != nil {
				portSpec = publishedNode.Value
			}
			if hostIPNode != nil && hostIPNode.Value == "0.0.0.0" {
				loc := &finding.Location{Path: a.path, Line: hostIPNode.Line}
				f := finding.New("DS-COMPOSE-BIND", "Service '"+serviceName+"' explicitly binds to 0.0.0.0", finding.SeverityInfo, target).
					WithDescription("Binding to 0.0.0.0 exposes the port on all network interfaces.").
					WithCategory(string(CategoryCompose)).
					WithLocation(loc).
					WithRemediation("Consider binding to 127.0.0.1 for local-only access.")
				findings = append(findings, f)
			}
		}

		if portSpec == "" {
			continue
		}

		parts := strings.Split(portSpec, ":")
		var hostPort string
		if len(parts) >= 2 {
			hostPort = parts[0]
			if strings.Contains(hostPort, ".") {
				hostPort = parts[1]
			}
		}

		if hostPort != "" {
			portNum, err := strconv.Atoi(hostPort)
			if err == nil && portNum > 0 && portNum < 1024 {
				loc := &finding.Location{Path: a.path, Line: portNode.Line}
				f := finding.New("DS-COMPOSE-PRIVPORT", "Service '"+serviceName+"' exposes privileged port "+hostPort, finding.SeverityInfo, target).
					WithDescription("Privileged ports (below 1024) typically require root privileges on the host.").
					WithCategory(string(CategoryCompose)).
					WithLocation(loc).
					WithRemediation("Consider using non-privileged ports (>1024) with port mapping.")
				findings = append(findings, f)
			}
		}
	}

	return findings
}
```

---

## Performance Analysis

### Performance Analysis

**Time Complexity:** The function has a time complexity of \(O(n \times m)\), where \(n\) is the number of nodes under "ports" and \(m\) is the average length of each port specification string. This is due to the nested loops and string operations.

**Space Complexity:** The space complexity is \(O(1)\) for variables like `findings`, but it could be higher if many findings are appended, leading to increased memory usage.

**Bottlenecks:**
- **String Operations:** Repeated calls to `strings.Split` and `strconv.Atoi` can be costly.
- **Redundant Checks:** The function checks the same conditions multiple times within nested loops.

**Optimization Opportunities:**
1. **Cache Results:** Cache results of repeated string operations like `strings.Split` and `strconv.Atoi`.
2. **Early Exit:** If a node is not relevant, exit early from inner loops to avoid unnecessary computations.
3. **Error Handling:** Improve error handling for `strconv.Atoi` to avoid panics.

**Resource Usage Concerns:**
- Ensure proper error handling to prevent resource leaks in case of errors during string conversion or finding creation.
- Consider using goroutines if the function can be parallelized, but ensure it doesn't introduce race conditions.

By caching and optimizing repeated operations, you can significantly reduce the time complexity and improve overall performance.

---

*Generated by CodeWorm on 2026-02-18 14:59*
