# ReportService.get_report

**Type:** Performance Analysis
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/advanced/bug-bounty-platform/backend/app/report/service.py
**Language:** python
**Lines:** 79-136
**Complexity:** 11.0

---

## Source Code

```python
async def get_report(
        self,
        user: User,
        report_id: UUID,
    ) -> ReportDetailResponse:
        """
        Get report by ID with details
        """
        report = await ReportRepository.get_by_id_with_details(
            self.session,
            report_id
        )
        if not report:
            raise ReportNotFound(str(report_id))

        program = await ProgramRepository.get_by_id(
            self.session,
            report.program_id
        )

        is_researcher = report.researcher_id == user.id
        is_program_owner = program and program.company_id == user.id

        if not is_researcher and not is_program_owner:
            raise ReportNotFound(str(report_id))

        comments = report.comments
        if is_researcher and not is_program_owner:
            comments = [c for c in comments if not c.is_internal]

        return ReportDetailResponse(
            id = report.id,
            created_at = report.created_at,
            updated_at = report.updated_at,
            program_id = report.program_id,
            researcher_id = report.researcher_id,
            title = report.title,
            description = report.description,
            steps_to_reproduce = report.steps_to_reproduce,
            impact = report.impact,
            severity_submitted = report.severity_submitted,
            severity_final = report.severity_final,
            status = report.status,
            cvss_score = report.cvss_score,
            cwe_id = report.cwe_id,
            bounty_amount = report.bounty_amount,
            duplicate_of_id = report.duplicate_of_id,
            triaged_at = report.triaged_at,
            resolved_at = report.resolved_at,
            disclosed_at = report.disclosed_at,
            comments = [
                CommentResponse.model_validate(c) for c in comments
            ],
            attachments = [
                AttachmentResponse.model_validate(a)
                for a in report.attachments
            ],
        )
```

---

## Performance Analysis

### Performance Analysis

**Time Complexity:** The function has a time complexity of \(O(n)\), where \(n\) is the number of comments in `report.comments`. This is due to the iteration over the comments list when filtering or validating them.

**Space Complexity:** The space complexity is also \(O(n)\) for storing the comments and attachments. Additionally, creating new lists from the original data structures increases memory usage.

**Bottlenecks/Inefficiencies:**
1. **Redundant `ReportNotFound` Check:** The initial check for `report` can be combined with the program retrieval to reduce redundant calls.
2. **Filtering Comments:** Filtering comments inside a conditional block is unnecessary if the filtering logic can be applied during the initial fetch.

**Optimization Opportunities:**
1. **Combine Repository Calls:** Fetch the report and its associated program in a single query using `JOIN` or by passing additional parameters to the repository method.
2. **Filter Comments During Fetch:** Modify the `ReportRepository.get_by_id_with_details` to filter comments based on user roles during retrieval.

**Resource Usage Concerns:**
- Ensure that database connections are properly managed, especially if this function is called frequently.
- Use context managers or connection pools for database operations to avoid resource leaks.

By optimizing these areas, you can reduce the number of database calls and improve both time and space efficiency.

---

*Generated by CodeWorm on 2026-02-23 07:07*
