# GetCollectionStats

**Type:** Performance Analysis
**Repository:** angelamos-operations
**File:** CertGamesDB-Argos/go-backend/internal/mongodb/collections.go
**Language:** go
**Lines:** 153-206
**Complexity:** 15.0

---

## Source Code

```go
func (r *CollectionsRepository) GetCollectionStats(ctx context.Context, dbName, collName string) (*CollectionStats, error) {
	db := r.client.client.Database(dbName)

	var stats bson.M
	if err := db.RunCommand(ctx, bson.D{{"collStats", collName}}).Decode(&stats); err != nil {
		return nil, fmt.Errorf("get collection stats: %w", err)
	}

	result := &CollectionStats{
		Name: collName,
	}

	if count, ok := stats["count"].(int32); ok {
		result.DocumentCount = int64(count)
	} else if count, ok := stats["count"].(int64); ok {
		result.DocumentCount = count
	}

	if size, ok := stats["size"].(int32); ok {
		result.SizeBytes = int64(size)
	} else if size, ok := stats["size"].(int64); ok {
		result.SizeBytes = size
	}

	if avgSize, ok := stats["avgObjSize"].(int32); ok {
		result.AvgDocSize = int64(avgSize)
	} else if avgSize, ok := stats["avgObjSize"].(int64); ok {
		result.AvgDocSize = avgSize
	} else if avgSize, ok := stats["avgObjSize"].(float64); ok {
		result.AvgDocSize = int64(avgSize)
	}

	if storageSize, ok := stats["storageSize"].(int32); ok {
		result.StorageSize = int64(storageSize)
	} else if storageSize, ok := stats["storageSize"].(int64); ok {
		result.StorageSize = storageSize
	}

	if nindexes, ok := stats["nindexes"].(int32); ok {
		result.IndexCount = int(nindexes)
	}

	if totalIndexSize, ok := stats["totalIndexSize"].(int32); ok {
		result.TotalIndexSize = int64(totalIndexSize)
	} else if totalIndexSize, ok := stats["totalIndexSize"].(int64); ok {
		result.TotalIndexSize = totalIndexSize
	}

	if capped, ok := stats["capped"].(bool); ok {
		result.Capped = capped
	}

	return result, nil
}
```

---

## Performance Analysis

### Performance Analysis

**Time Complexity:** O(1) - The function performs a fixed number of operations regardless of input size.

**Space Complexity:** O(1) - The memory usage is constant, as it only depends on the size of the `CollectionStats` struct and not the input data.

**Bottlenecks or Inefficiencies:**
- **Redundant Type Casting:** The function repeatedly checks for type conversions (e.g., `int32`, `int64`, `float64`) to extract values from the `stats` map. This can be optimized by directly accessing the expected types.
- **Error Handling:** While error handling is present, it could be more explicit and informative.

**Optimization Opportunities:**
- Use type assertions with direct casting to reduce redundant checks:
  ```go
  if count := stats["count"].(int64); count != -1 {
    result.DocumentCount = count
  }
  ```
- Simplify the error handling by using `errors.As` or custom error types for better clarity.

**Resource Usage Concerns:**
- Ensure that the MongoDB connection is managed properly. Use context cancellation to avoid hanging connections.
- Consider caching frequently accessed stats to reduce database load and improve performance.

By optimizing type checks and simplifying error handling, you can make the function more efficient and maintainable.

---

*Generated by CodeWorm on 2026-02-21 17:03*
