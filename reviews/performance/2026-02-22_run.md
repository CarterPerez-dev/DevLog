# run

**Type:** Performance Analysis
**Repository:** CodeWorm
**File:** codeworm/cli.py
**Language:** python
**Lines:** 59-103
**Complexity:** 8.0

---

## Source Code

```python
def run(
    ctx: click.Context,
    devlog: Path | None,
    repo: tuple,
    dry_run: bool
) -> None:
    """
    Run the CodeWorm daemon with scheduler
    """
    from codeworm.daemon import CodeWormDaemon

    overrides = {"debug": ctx.obj["debug"]}

    if devlog:
        overrides["devlog"] = {"repo_path": devlog}

    if repo:
        repos = [
            {
                "name": name,
                "path": Path(path),
                "weight": 5
            } for name, path in repo
        ]
        overrides["repos"] = repos

    settings = load_settings(config_dir = ctx.obj["config_dir"], **overrides)
    redis_url = settings.dashboard.redis.connection_url if settings.dashboard.redis.enabled else ""
    configure_logging(debug = settings.debug, redis_url = redis_url)

    if not settings.repos:
        console.print("[red]Error:[/red] No repositories configured")
        console.print("Add repos to config/repos.yaml or use --repo NAME PATH")
        raise SystemExit(1)

    mode = "[yellow][DRY RUN][/yellow] " if dry_run else ""
    console.print(f"{mode}[bold green]Starting CodeWorm[/bold green]")
    console.print(f"  DevLog: {settings.devlog.repo_path}")
    console.print(f"  Repos: {len(settings.repos)}")
    console.print(f"  Ollama: {settings.ollama.base_url}")
    if redis_url:
        console.print(f"  Redis: {redis_url}")

    daemon = CodeWormDaemon(settings, dry_run = dry_run)
    daemon.run()
```

---

## Performance Analysis

### Performance Analysis

**Time Complexity:** The function has a time complexity of \(O(n)\), where \(n\) is the number of repositories specified in `repo`. This is due to the list comprehension used for repository initialization.

**Space Complexity:** The space complexity is also \(O(n)\) because the `repos` list grows with the number of repositories. Additionally, the function uses several string and dictionary operations which are generally \(O(1)\).

**Bottlenecks or Inefficiencies:**
- **Repository Initialization:** The list comprehension for repository initialization can be optimized using a generator expression if memory is a concern.
- **Redundant Operations:** The `console.print` statements could be combined to reduce the number of calls, improving performance slightly.

**Optimization Opportunities:**
- Use a generator expression instead of a list comprehension for repositories:
  ```python
  repos = (
      {"name": name, "path": Path(path), "weight": 5}
      for name, path in repo
  )
  ```
- Combine `console.print` statements to reduce I/O operations.

**Resource Usage Concerns:**
- Ensure that `load_settings`, `configure_logging`, and other functions handle resources properly (e.g., closing file handles).
- Consider using context managers or `with` statements for any resource-intensive operations, though they are not present in this snippet.

By making these changes, you can improve both the performance and readability of your code.

---

*Generated by CodeWorm on 2026-02-22 00:34*
