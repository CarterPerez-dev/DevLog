# CodeWormDaemon._find_documentation_target

**Type:** Performance Analysis
**Repository:** CodeWorm
**File:** codeworm/daemon.py
**Language:** python
**Lines:** 392-442
**Complexity:** 11.0

---

## Source Code

```python
async def _find_documentation_target(self) -> DocumentationTarget | None:
        """
        Find a documentation target using weighted doc type selection
        Tries the selected type first, then falls back to others
        """
        type_weights = self.settings.documentation.type_weights
        redoc_days = self.settings.documentation.redocument_after_days
        enabled_repos = [r for r in self.settings.repos if r.enabled]

        selected_type = select_doc_type(type_weights)
        tried_types: set[DocType] = set()

        all_types = list(type_weights.keys())

        for type_str in [selected_type.value] + all_types:
            try:
                doc_type = DocType(type_str)
            except ValueError:
                continue

            if doc_type in tried_types:
                continue
            if doc_type in (DocType.WEEKLY_SUMMARY, DocType.MONTHLY_SUMMARY):
                continue
            tried_types.add(doc_type)

            for repo in enabled_repos:
                if repo.name in self.stats.repos_exhausted:
                    continue

                targets = self.target_router.find_targets(
                    doc_type = doc_type,
                    repo = repo,
                    limit = 30,
                )

                for target in targets:
                    if self.state.should_document(
                            target.snippet,
                            doc_type = doc_type,
                            redocument_after_days = redoc_days,
                    ):
                        self.logger.debug(
                            "target_found",
                            doc_type = doc_type.value,
                            target = target.display_name,
                            repo = repo.name,
                        )
                        return target

        return None
```

---

## Performance Analysis

### Performance Analysis

**Time Complexity:** The time complexity is O(n * m), where `n` is the number of enabled repositories, and `m` is the average number of targets returned by `find_targets`. This is due to nested loops iterating over repositories and target lists.

**Space Complexity:** Space complexity is O(k + l), where `k` is the size of `tried_types` set (up to 4 types) and `l` is the space used by `targets`.

**Bottlenecks:**
1. **Nested Loops:** The nested loops over repositories and targets can be costly, especially if there are many repositories or large target lists.
2. **Redundant Checks:** The checks for `tried_types` and summary types (`DocType.WEEKLY_SUMMARY`, `DocType.MONTHLY_SUMMARY`) can be optimized.

**Optimization Opportunities:**
1. **Memoization:** Cache the results of `self.state.should_document()` to avoid redundant calls.
2. **Early Exit:** Move the early return inside the loop to reduce unnecessary iterations.
3. **Async Iteration:** If `find_targets` is async, consider using asynchronous iteration to avoid blocking.

**Resource Usage Concerns:**
1. Ensure that all database connections and file handles are properly closed using context managers or `async with`.
2. Consider batch processing targets to reduce the number of calls to `self.state.should_document()`.

By applying these optimizations, you can improve both performance and resource management in your code.

---

*Generated by CodeWorm on 2026-02-22 09:12*
