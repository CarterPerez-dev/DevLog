# resolveUpdates

**Type:** Performance Analysis
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/beginner/simple-vulnerability-scanner/internal/cli/update.go
**Language:** go
**Lines:** 404-504
**Complexity:** 12.0

---

## Source Code

```go
func resolveUpdates(
	deps []types.Dependency,
	versionMap map[string][]string,
	safe bool,
	includePrerelease bool,
	ignoreDeps []string,
) ([]types.UpdateResult, map[string]string) {
	var results []types.UpdateResult
	specs := make(map[string]string)

	ignoreSet := make(map[string]bool, len(ignoreDeps))
	for _, name := range ignoreDeps {
		ignoreSet[pypi.NormalizeName(name)] = true
	}

	for _, dep := range deps {
		if ignoreSet[pypi.NormalizeName(dep.Name)] {
			results = append(results, types.UpdateResult{
				Name:    dep.Name,
				Skipped: true,
				Reason:  "ignored in config",
			})
			continue
		}

		versions, ok := versionMap[dep.Name]
		if !ok {
			results = append(results, types.UpdateResult{
				Name:    dep.Name,
				Skipped: true,
				Reason:  "not found on PyPI",
			})
			continue
		}

		currentStr := pyproject.ExtractMinVersion(dep.Spec)
		if currentStr == "" {
			results = append(results, types.UpdateResult{
				Name:    dep.Name,
				Skipped: true,
				Reason:  "no version specifier",
			})
			continue
		}

		current, err := pypi.ParseVersion(currentStr)
		if err != nil {
			results = append(results, types.UpdateResult{
				Name:    dep.Name,
				Skipped: true,
				Reason:  "unparseable version",
			})
			continue
		}

		var latest pypi.Version
		if includePrerelease {
			latest, err = latestAny(versions)
		} else {
			latest, err = pypi.LatestStable(versions)
		}
		if err != nil {
			results = append(results, types.UpdateResult{
				Name:    dep.Name,
				Skipped: true,
				Reason:  err.Error(),
			})
			continue
		}

		if latest.Compare(current) <= 0 {
			continue
		}

		change := pypi.ClassifyChange(current, latest)
		if safe && change == pypi.Major {
			results = append(results, types.UpdateResult{
				Name:    dep.Name,
				OldVer:  current.String(),
				NewVer:  latest.String(),
				Change:  change.String(),
				Skipped: true,
				Reason:  "major bump (use --all to include)",
			})
			continue
		}

		newSpec := ">=" + latest.String()
		results = append(results, types.UpdateResult{
			Name:    dep.Name,
			OldVer:  current.String(),
			NewVer:  latest.String(),
			OldSpec: dep.Spec,
			NewSpec: newSpec,
			Change:  change.String(),
		})
		specs[dep.Name] = newSpec
	}

	return results, specs
}
```

---

## Performance Analysis

### Performance Analysis

#### Time Complexity
The function has a time complexity of \(O(n \times m)\), where \(n\) is the number of dependencies, and \(m\) is the average length of version lists in `versionMap`. The main bottleneck is the iteration over each dependency and the subsequent lookup in `versionMap`.

#### Space Complexity
Space complexity is \(O(k + l)\), where \(k\) is the size of `results` and `specs`, and \(l\) is the space used by `ignoreSet` and `versions`. Memory allocation for `results` and `specs` can grow significantly with more dependencies.

#### Bottlenecks or Inefficiencies
1. **Redundant Operations**: The `pypi.ParseVersion` function is called multiple times, which could be costly if version parsing is complex.
2. **Unnecessary Iterations**: The function iterates over each dependency and performs the same operations for each one, even when a dependency is skipped.

#### Optimization Opportunities
1. **Memoization**: Cache parsed versions to avoid redundant calls to `pypi.ParseVersion`.
2. **Early Exit**: Use early exit conditions in loops to reduce unnecessary iterations.
3. **Concurrency**: Utilize goroutines to process dependencies concurrently if the operation is I/O-bound.

#### Resource Usage Concerns
- Ensure that any external connections or file handles are properly closed, especially if `pypi.ParseVersion` or other functions involve network calls.
- Consider using context cancellation in async operations to handle timeouts and graceful shutdowns.

---

*Generated by CodeWorm on 2026-02-18 11:58*
