# run_once

**Type:** Performance Analysis
**Repository:** CodeWorm
**File:** codeworm/cli.py
**Language:** python
**Lines:** 125-173
**Complexity:** 8.0

---

## Source Code

```python
def run_once(
    ctx: click.Context,
    devlog: Path | None,
    repo: tuple,
    dry_run: bool
) -> None:
    """
    Run a single documentation cycle then exit
    """
    from codeworm.daemon import CodeWormDaemon

    overrides = {"debug": ctx.obj["debug"]}

    if devlog:
        overrides["devlog"] = {"repo_path": devlog}

    if repo:
        repos = [
            {
                "name": name,
                "path": Path(path),
                "weight": 5
            } for name, path in repo
        ]
        overrides["repos"] = repos

    settings = load_settings(config_dir = ctx.obj["config_dir"], **overrides)
    redis_url = settings.dashboard.redis.connection_url if settings.dashboard.redis.enabled else ""
    configure_logging(debug = settings.debug, redis_url = redis_url)

    if not settings.repos:
        console.print("[red]Error:[/red] No repositories configured")
        console.print("Add repos to config/repos.yaml or use --repo NAME PATH")
        raise SystemExit(1)

    mode = "[yellow][DRY RUN][/yellow] " if dry_run else ""
    console.print(f"{mode}[bold]Running single documentation cycle...[/bold]")
    console.print(f"  DevLog: {settings.devlog.repo_path}")
    console.print(f"  Repos: {[r.name for r in settings.repos]}")

    daemon = CodeWormDaemon(settings)
    result = asyncio.run(daemon.run_once(dry_run = dry_run))

    if result:
        console.print("[green]Documentation generated successfully[/green]")
    else:
        console.print(
            "[yellow]No candidates found or all already documented[/yellow]"
        )
```

---

## Performance Analysis

### Performance Analysis of `run_once` Function

**Time Complexity:**
The function has a time complexity of \(O(n)\), where \(n\) is the number of repositories provided. The primary bottleneck is the list comprehension that constructs the `repos` list, which iterates over each repository tuple.

**Space Complexity and Memory Allocation:**
- The space complexity is also \(O(n)\) due to the storage required for the `repos` list.
- No significant memory leaks are present, but consider using context managers if any external resources are used within `CodeWormDaemon`.

**Bottlenecks or Inefficiencies:**
1. **Redundant List Comprehension:** The list comprehension in constructing `repos` is redundant since each repository is assigned a fixed weight of 5.
2. **Unnecessary Iteration:** The function iterates over settings to check if repos are configured, which can be optimized by directly checking the length.

**Optimization Opportunities:**
1. **Simplify List Comprehension:** Remove the hardcoded weight and simplify the list comprehension:
   ```python
   repos = [{"name": name, "path": Path(path)} for name, path in repo]
   ```
2. **Direct Length Check:** Replace the repository check with a direct length comparison to avoid iteration:
   ```python
   if not settings.repos:
       console.print("[red]Error:[/red] No repositories configured")
       raise SystemExit(1)
   ```

**Resource Usage Concerns:**
- Ensure `CodeWormDaemon` and its methods are properly closed or managed using context managers to avoid resource leaks.
- Consider caching frequently accessed settings if the function is called multiple times with similar configurations.

By addressing these points, you can improve both the performance and readability of the code.

---

*Generated by CodeWorm on 2026-02-22 00:29*
