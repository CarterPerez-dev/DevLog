# BulkUploadService.get_batch_status

**Type:** Performance Analysis
**Repository:** vuemantics
**File:** backend/services/bulk_upload_service.py
**Language:** python
**Lines:** 240-277
**Complexity:** 6.0

---

## Source Code

```python
async def get_batch_status(
        batch_id: UUID,
        user_id: UUID,
    ) -> BatchStatusResult:
        """
        Get batch status for a user

        Args:
            batch_id: Batch UUID
            user_id: User UUID

        Returns:
            BatchStatusResult
        """
        batch = await UploadBatch.find_by_id(batch_id)

        if not batch:
            raise NotFoundError("Batch not found")

        if batch.user_id != user_id:
            raise NotFoundError("Batch not found")

        return BatchStatusResult(
            batch_id = batch.id,
            status = batch.status,
            total_uploads = batch.total_uploads,
            processed_uploads = batch.processed_uploads,
            successful_uploads = batch.successful_uploads,
            failed_uploads = batch.failed_uploads,
            progress_percentage = batch.get_progress_percentage(),
            created_at = batch.created_at.isoformat()
            if batch.created_at else None,
            started_at = batch.started_at.isoformat()
            if batch.started_at else None,
            completed_at = batch.completed_at.isoformat()
            if batch.completed_at else None,
            error_message = batch.error_message,
        )
```

---

## Performance Analysis

### Performance Analysis

**Time Complexity:** The function has a time complexity of \(O(1)\) for the main operations, as it involves a single database query and a few attribute checks. However, the `get_progress_percentage()` method could be costly if it performs complex calculations.

**Space Complexity:** The space complexity is also \(O(1)\), assuming that the `BatchStatusResult` object creation does not involve significant memory overhead.

**Bottlenecks or Inefficiencies:**
- **Redundant Checks:** The function checks for both `batch.user_id != user_id` and `not batch`, which can be combined into a single check.
- **String Formatting:** The repeated string formatting (e.g., `isoformat()`) could be optimized using f-strings or string concatenation.

**Optimization Opportunities:**
1. Combine the checks for `batch` existence and ownership:
   ```python
   batch = await UploadBatch.find_by_id(batch_id)
   if not batch or batch.user_id != user_id:
       raise NotFoundError("Batch not found")
   ```

2. Use f-strings for ISO format conversion:
   ```python
   created_at = batch.created_at.isoformat() if batch.created_at else None,
   started_at = batch.started_at.isoformat() if batch.started_at else None,
   completed_at = batch.completed_at.isoformat() if batch.completed_at else None,
   ```

3. If `get_progress_percentage()` is expensive, consider caching the result or optimizing its implementation.

**Resource Usage Concerns:**
- Ensure that the database connection is properly managed using context managers or async context managers.
- Avoid unclosed connections by ensuring all asynchronous operations complete before closing the session.

By making these optimizations, you can improve both readability and performance.

---

*Generated by CodeWorm on 2026-02-21 23:04*
