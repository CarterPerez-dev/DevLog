# _score_hex

**Type:** Performance Analysis
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/beginner/base64-tool/src/base64_tool/detector.py
**Language:** python
**Lines:** 127-169
**Complexity:** 16.0

---

## Source Code

```python
def _score_hex(data: str) -> float:
    stripped = data.strip()
    if len(stripped) < MIN_INPUT_LENGTH:
        return 0.0

    hex_only = stripped
    for sep in HEX_SEPARATORS:
        hex_only = hex_only.replace(sep, "")

    if not hex_only:
        return 0.0
    if not all(c in HEX_CHARSET for c in hex_only):
        return 0.0
    if len(hex_only) % 2 != 0:
        return 0.0

    score = W.HEX_BASE

    has_separators = any(sep in stripped for sep in HEX_SEPARATORS)
    if has_separators:
        score += W.HEX_SEPARATOR_PRESENT

    has_alpha = any(c in "abcdefABCDEF" for c in hex_only)
    if has_alpha:
        score += W.HEX_ALPHA_CHARS
    else:
        score -= W.HEX_NO_ALPHA_PENALTY

    is_consistent_case = (hex_only == hex_only.lower() or hex_only == hex_only.upper())
    if is_consistent_case:
        score += W.HEX_CONSISTENT_CASE

    if len(hex_only) >= 8:
        score += W.LONGER_INPUT

    decoded = try_decode(stripped, EncodingFormat.HEX)
    if decoded is None:
        return 0.0
    score += W.HEX_DECODE_SUCCESS
    if is_printable_text(decoded):
        score += W.PRINTABLE_RESULT

    return min(score, 1.0)
```

---

## Performance Analysis

### Performance Analysis

**Time Complexity:** The function has a time complexity of \(O(n^2)\) due to the nested `replace` operations, where `n` is the length of the input string. This can be improved by using a regular expression for replacements.

**Space Complexity:** The space complexity is \(O(n)\), as it uses additional strings and sets but does not grow with the input size.

**Bottlenecks or Inefficiencies:**
1. **Nested `replace` operations:** Repeatedly replacing separators in a loop can be costly.
2. **Redundant checks:** The function performs multiple checks on the same string, such as checking for separators and hex characters separately.
3. **Multiple calls to `isprintable_text`:** This function is called after decoding, which could be optimized.

### Optimization Opportunities:
1. Use a regular expression for replacing separators: `re.sub` can replace all occurrences in one pass.
2. Combine checks into fewer operations: Perform combined hex character and separator checks using sets or regex.
3. Cache results of `isprintable_text`: If called multiple times, cache the result to avoid redundant checks.

### Resource Usage Concerns:
- No resource leaks detected; ensure that external functions like `try_decode` and `isprintable_text` handle resources correctly (e.g., file handles).

By optimizing the string operations and combining checks, you can significantly reduce the time complexity while maintaining readability.

---

*Generated by CodeWorm on 2026-02-19 12:39*
