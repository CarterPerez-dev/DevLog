# create_admin

**Type:** Performance Analysis
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/siem-dashboard/backend/app/cli.py
**Language:** python
**Lines:** 24-53
**Complexity:** 5.0

---

## Source Code

```python
def create_admin(username: str, email: str, password: str) -> None:
    """
    Create a new admin account or promote an existing user
    """
    existing = User.find_by_username(username)
    if existing is not None:
        if existing.role == UserRole.ADMIN:
            click.echo(f"User '{username}' is already an admin.")
            return
        existing.set_role(UserRole.ADMIN)
        click.echo(f"Promoted existing user '{username}' to admin.")
        return

    existing_email = User.find_by_email(email)
    if existing_email is not None:
        if existing_email.role == UserRole.ADMIN:
            click.echo(f"User with email '{email}' is already an admin.")
            return
        existing_email.set_role(UserRole.ADMIN)
        click.echo(f"Promoted existing user '{existing_email.username}' to admin.")
        return

    hashed = hash_password(password)
    User.create_user(
        username = username,
        email = email,
        password_hash = hashed,
        role = UserRole.ADMIN,
    )
    click.echo(f"Admin account '{username}' created successfully.")
```

---

## Performance Analysis

### Performance Analysis of `create_admin` Function

**Time Complexity:** The function has a time complexity of \(O(1)\) for each user lookup, but the overall complexity is dominated by the two lookups and one potential creation, resulting in \(O(2 + 1) = O(1)\). However, if multiple users are checked or created, this could degrade to \(O(n)\).

**Space Complexity:** The space complexity is \(O(1)\), as no additional data structures depend on input size. Memory usage is minimal.

**Bottlenecks and Inefficiencies:**
- **Redundant Lookups:** Two separate lookups by `username` and `email` can be combined into a single query to avoid redundant database calls.
- **Blocking Calls:** The function makes synchronous database calls, which could block the execution if not handled asynchronously.

**Optimization Opportunities:**
- Combine user lookup logic using a single query with conditions for both username and email.
- Use asynchronous queries to handle database operations non-blocking.

```python
from typing import Optional

async def create_admin(username: str, email: str, password: str) -> None:
    existing_user = await User.find_by_username_or_email(username, email)
    if existing_user is not None and existing_user.role == UserRole.ADMIN:
        click.echo(f"User '{existing_user.username}' is already an admin.")
        return
    elif existing_user is not None:
        existing_user.set_role(UserRole.ADMIN)
        await existing_user.save()
        click.echo(f"Promoted existing user '{existing_user.username}' to admin.")
        return

    hashed_password = hash_password(password)
    new_user = User(
        username=username,
        email=email,
        password_hash=hashed_password,
        role=UserRole.ADMIN
    )
    await new_user.create()
    click.echo(f"Admin account '{username}' created successfully.")
```

**Resource Usage Concerns:**
- Ensure database connections are properly managed using context managers or connection pooling to avoid leaks.
- Use `asyncio` for asynchronous operations to improve responsiveness.

---

*Generated by CodeWorm on 2026-02-18 22:18*
