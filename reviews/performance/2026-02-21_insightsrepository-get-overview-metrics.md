# InsightsRepository.get_overview_metrics

**Type:** Performance Analysis
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/analytics/facets/insights/repository.py
**Language:** python
**Lines:** 73-103
**Complexity:** 10.0

---

## Source Code

```python
async def get_overview_metrics(session: AsyncSession) -> dict:
        """Calculate overall performance metrics"""
        result = await session.execute(
            select(
                func.count(TikTokVideo.id).label("total_videos"),
                func.sum(TikTokVideo.views).label("total_views"),
                func.sum(TikTokVideo.likes).label("total_likes"),
                func.sum(TikTokVideo.comments).label("total_comments"),
                func.sum(TikTokVideo.shares).label("total_shares"),
                func.sum(TikTokVideo.bookmarks).label("total_bookmarks"),
                func.sum(TikTokVideo.new_followers).label("total_new_followers"),
                func.avg(TikTokVideo.avg_watch_time).label("avg_watch_time"),
                func.avg(TikTokVideo.watched_full_video_percentage).label("avg_watch_percentage"),
                func.min(TikTokVideo.date_posted).label("min_date"),
                func.max(TikTokVideo.date_posted).label("max_date"),
            )
        )
        row = result.one()
        return {
            "total_videos": row.total_videos or 0,
            "total_views": row.total_views or 0,
            "total_likes": row.total_likes or 0,
            "total_comments": row.total_comments or 0,
            "total_shares": row.total_shares or 0,
            "total_bookmarks": row.total_bookmarks or 0,
            "total_new_followers": row.total_new_followers or 0,
            "avg_watch_time": float(row.avg_watch_time or 0),
            "avg_watch_percentage": float(row.avg_watch_percentage or 0),
            "min_date": row.min_date,
            "max_date": row.max_date,
        }
```

---

## Performance Analysis

### Performance Analysis

**Time Complexity:** The time complexity of the function is \(O(1)\), as it performs a fixed number of operations regardless of the input size.

**Space Complexity:** The space complexity is also \(O(1)\) since the memory used does not scale with the input size. However, there are some inefficiencies:

- **Bottlenecks:**
  - The function executes a single SQL query that aggregates multiple columns from the `TikTokVideo` table. This could potentially be optimized if the database schema or indexing is suboptimal.
  
**Optimization Opportunities:**

1. **Indexing:** Ensure that indexes are in place on the columns used in the aggregation (e.g., `id`, `views`, `likes`, etc.). This can significantly reduce query execution time.

2. **Query Optimization:** Consider breaking down the query into smaller parts if certain aggregations are more complex or if you need to filter data before aggregation.

3. **Caching:** If this function is called frequently, consider caching the results using a library like `functools.lru_cache` or an external cache service.

**Resource Usage Concerns:**

- Ensure that the database connection (`session`) is properly managed and closed after use.
- Use context managers to handle asynchronous sessions correctly:

```python
async with session.begin():
    result = await session.execute(query)
```

This ensures that the session is properly closed, preventing resource leaks.

---

*Generated by CodeWorm on 2026-02-21 17:44*
