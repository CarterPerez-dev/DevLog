# repository_pattern

**Type:** Pattern Analysis
**Repository:** stripe-referral
**File:** src/stripe_referral/repositories/program_repo.py
**Language:** python
**Lines:** 1-75
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2025 | CertGames.com
Referral program repository
"""

from sqlalchemy import select
from sqlalchemy.orm import Session

from ..models.ReferralProgram import ReferralProgram

from .base import BaseRepository


class ReferralProgramRepository(BaseRepository[ReferralProgram]):
    """
    Repository for ReferralProgram database operations
    """
    def __init__(self, db: Session) -> None:
        """
        Initialize with ReferralProgram model
        """
        super().__init__(db, ReferralProgram)

    def get_by_key(self, program_key: str) -> ReferralProgram | None:
        """
        Get program by unique program key
        """
        stmt = select(ReferralProgram).where(
            ReferralProgram.program_key == program_key
        )
        return self.db.execute(stmt).scalar_one_or_none()

    def get_by_name(self, name: str) -> ReferralProgram | None:
        """
        Get program by unique name
        """
        stmt = select(ReferralProgram).where(ReferralProgram.name == name)
        return self.db.execute(stmt).scalar_one_or_none()

    def get_active_programs(self) -> list[ReferralProgram]:
        """
        Get all active programs
        """
        stmt = select(ReferralProgram).where(ReferralProgram.is_active)
        return list(self.db.execute(stmt).scalars().all())

    def deactivate_program(
        self,
        program_id: int
    ) -> ReferralProgram | None:
        """
        Deactivate a program
        """
        program = self.get_by_id(program_id)
        if not program:
            return None

        program.is_active = False
        self.db.commit()
        self.db.refresh(program)
        return program

    def activate_program(self, program_id: int) -> ReferralProgram | None:
        """
        Activate a program
        """
        program = self.get_by_id(program_id)
        if not program:
            return None

        program.is_active = True
        self.db.commit()
        self.db.refresh(program)
        return program

```

---

## Pattern Analysis

### Pattern Analysis

**Pattern Used:** Repository Pattern

**Implementation:**
The `ReferralProgramRepository` class implements the repository pattern by encapsulating database operations for the `ReferralProgram` model. It provides methods like `get_by_key`, `get_by_name`, and `get_active_programs` to interact with the database in a structured way, using SQLAlchemy's ORM.

**Benefits:**
- **Encapsulation:** The repository abstracts the database interactions, making it easier to switch between different data storage solutions.
- **Testability:** By separating business logic from persistence concerns, unit testing becomes simpler and more straightforward.
- **Maintainability:** Changes in database schema or queries can be managed within the repository without affecting other parts of the application.

**Deviations:**
- The `get_by_id` method is not explicitly defined but used internally by methods like `deactivate_program` and `activate_program`.
- Methods return a single entity (`ReferralProgram | None`) or a list of entities, providing flexibility in handling different query results.

**Appropriateness:**
This pattern is highly appropriate for applications that need to interact with a database in a structured manner. It ensures that the application logic remains clean and decoupled from the data access layer, making it easier to manage and scale.

---

*Generated by CodeWorm on 2026-03-02 01:26*
