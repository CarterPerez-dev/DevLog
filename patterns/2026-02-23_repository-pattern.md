# repository_pattern

**Type:** Pattern Analysis
**Repository:** CertGames-Core
**File:** backend/api/domains/social/services/certification_ops.py
**Language:** python
**Lines:** 1-156
**Complexity:** 0.0

---

## Source Code

```python
"""
Certification Service Operations
/api/domains/social/services/certification_ops.py
"""

from bson import ObjectId
from contextlib import suppress
from datetime import datetime, UTC

from api.core.validation.exceptions import NotFoundError

from .s3_ops import S3Service
from ..models.EarnedCertification import (
    EarnedCertification,
    VerificationStatus,
)


class CertificationService:
    """
    Service class for earned certification operations
    """
    @staticmethod
    def upload_certification(
        user_id: str | ObjectId,
        certification_type: str,
        file_data: bytes,
        filename: str,
        content_type: str,
        earned_date: datetime | None = None,
        certification_number: str | None = None,
        is_public: bool = True
    ) -> EarnedCertification:
        """
        Upload a certification image and create database record
        """
        user_id = ObjectId(user_id
                           ) if isinstance(user_id,
                                           str) else user_id

        upload_result = S3Service.upload_certification_image(
            user_id = str(user_id),
            file_data = file_data,
            filename = filename,
            content_type = content_type
        )

        certification = EarnedCertification(
            userId = user_id,
            certificationType = certification_type,
            imageUrl = upload_result["imageUrl"],
            s3Key = upload_result["s3Key"],
            earnedDate = earned_date,
            uploadedAt = datetime.now(UTC),
            verificationStatus = VerificationStatus.VERIFIED.value,
            certificationNumber = certification_number,
            isPublic = is_public
        )
        certification.save()
        return certification

    @staticmethod
    def get_user_certifications(
        user_id: str | ObjectId,
        include_private: bool = False
    ) -> list[EarnedCertification]:
        """
        Get all certifications for a user
        """
        user_id = ObjectId(user_id
                           ) if isinstance(user_id,
                                           str) else user_id

        query: dict[str, ObjectId | bool] = {"userId": user_id}
        if not include_private:
            query["isPublic"] = True

        certifications = EarnedCertification.objects(
            **query
        ).order_by('-uploadedAt')
        return list(certifications)

    @staticmethod
    def get_certification_by_id(
        certification_id: str | ObjectId
    ) -> EarnedCertification | None:
        """
        Get a specific certification by ID
        """
        certification_id = ObjectId(certification_id) if isinstance(
            certification_id,
            str
        ) else certification_id

        return EarnedCertification.objects(id = certification_id).first()

    @staticmethod
    def delete_certification(certification_id: str | ObjectId) -> None:
        """
        Delete a certification 
```

---

## Pattern Analysis

### Pattern Analysis

**Pattern Used:** Repository Pattern

**Implementation:**
The `CertificationService` class encapsulates operations related to earned certifications, including uploading, retrieving, updating, and deleting certifications. It interacts with a database model (`EarnedCertification`) and an S3 service for file storage. The methods are static, providing clear responsibilities such as `upload_certification`, `get_user_certifications`, `delete_certification`, etc.

**Benefits:**
- **Separation of Concerns:** By encapsulating data access logic within the service class, it separates business rules from database operations.
- **Testability:** Static methods and clear responsibilities make unit testing easier.
- **Consistency:** A uniform interface for CRUD operations simplifies client code.

**Deviations:**
- The use of `@staticmethod` might be a deviation if these methods are not intended to operate independently of the class instance. Typically, repository patterns involve instance methods interacting with an injected repository object.
- Direct interaction with database models (`EarnedCertification.objects`) without an explicit repository abstraction can make it harder to switch storage mechanisms later.

**Appropriateness:**
This pattern is appropriate for this context where the service layer needs to handle business logic and interact with both a database and external services like S3. However, consider refactoring towards a more traditional repository pattern if the complexity grows or if you need to decouple the service from specific storage implementations.

---

*Generated by CodeWorm on 2026-02-23 13:51*
