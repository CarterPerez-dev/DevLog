# repository_pattern

**Type:** Pattern Analysis
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/analytics/facets/data_input/service.py
**Language:** python
**Lines:** 1-185
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2026
service.py
"""

from datetime import date
from uuid import UUID

from sqlalchemy.ext.asyncio import AsyncSession

from core.exceptions import ResourceNotFound
from aspects.analytics.facets.data_input.repository import TikTokVideoRepository
from aspects.analytics.facets.data_input.schemas import (
    TikTokVideoCreate,
    TikTokVideoUpdate,
    TikTokVideoResponse,
    TikTokVideoListResponse,
)


class TikTokVideoNotFound(ResourceNotFound):
    """
    Raised when TikTok video not found
    """
    def __init__(self, video_id: UUID) -> None:
        super().__init__(
            resource = "TikTokVideo",
            identifier = str(video_id)
        )


class DataInputService:
    """
    Service for TikTok video data input operations
    """
    @staticmethod
    async def create_video(
        session: AsyncSession,
        data: TikTokVideoCreate,
    ) -> TikTokVideoResponse:
        """
        Create a TikTok video record
        """
        video = await TikTokVideoRepository.create(
            session,
            rank = data.rank,
            date_posted = data.date_posted,
            video_url = data.video_url,
            views = data.views,
            comments = data.comments,
            likes = data.likes,
            bookmarks = data.bookmarks,
            shares = data.shares,
            avg_watch_time = data.avg_watch_time,
            new_followers = data.new_followers,
            watched_full_video_percentage = data.
            watched_full_video_percentage,
            top_comment_words = data.top_comment_words,
            search_queries = data.search_queries,
            traffic_sources = data.traffic_sources,
            hook = data.hook,
            text_on_screen_hook = data.text_on_screen_hook,
            length = data.length,
            description = data.description,
            hashtags = data.hashtags,
            cta = data.cta,
            full_transcription = data.full_transcription,
            notes = data.notes,
        )
        return TikTokVideoResponse.model_validate(video)

    @staticmethod
    async def get_video(
        session: AsyncSession,
        video_id: UUID,
    ) -> TikTokVideoResponse:
        """
        Get a single video by ID
        """
        video = await TikTokVideoRepository.get_by_id(session, video_id)
        if not video:
            raise TikTokVideoNotFound(video_id)
        return TikTokVideoResponse.model_validate(video)

    @staticmethod
    async def get_all_videos(
        session: AsyncSession,
        page: int = 1,
        page_size: int = 50,
    ) -> TikTokVideoListResponse:
        """
        Get all videos with pagination
        """
        skip = (page - 1) * page_size
        videos = await TikTokVideoRepository.get_multi(
            session,
            skip = skip,
            limit = page_size
        )
        total = await TikTokVideoRepository.count(session)

        return TikTokVideoListResponse(
            items = [
 
```

---

## Pattern Analysis

### Pattern Analysis

**Pattern Used:** Repository Pattern

#### Implementation
The `DataInputService` class encapsulates operations related to TikTok video data input, delegating database interactions to the `TikTokVideoRepository`. This repository handles CRUD (Create, Read, Update, Delete) and search operations. For example:
- `create_video`, `get_video`, `update_video`, and `delete_video` methods call corresponding methods on `TikTokVideoRepository`.
- `search_videos` and `get_videos_by_date_range` use custom repository methods to filter data.

#### Benefits
1. **Decoupling**: The service layer is decoupled from the database implementation, making it easier to switch databases or modify storage logic without changing the service code.
2. **Maintainability**: Repository methods can be easily tested and modified independently of the business logic in the service class.
3. **Consistency**: Ensures that all data access operations follow a consistent pattern, reducing errors.

#### Deviations
- The `DataInputService` uses static methods for each operation, which is slightly different from the typical instance-based repository pattern where repositories are often instances with state.
- Custom validation and error handling (e.g., raising `TikTokVideoNotFound`) are done in service methods rather than within the repository.

#### Appropriateness
The Repository Pattern is highly appropriate here because:
- The application needs to interact with a database, and separation of concerns between business logic and data access is crucial.
- Custom validation and error handling can be managed more effectively at the service level.

---

*Generated by CodeWorm on 2026-02-25 18:06*
