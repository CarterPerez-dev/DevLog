# repository_pattern

**Type:** Pattern Analysis
**Repository:** stripe-referral
**File:** src/stripe_referral/repositories/base.py
**Language:** python
**Lines:** 1-84
**Complexity:** 0.0

---

## Source Code

```python
"""
â’¸AngelaMos | 2025 | CertGames.com
Base repository with generic CRUD operations
"""

from typing import (
    Any,
    Generic,
    TypeVar,
)
from sqlalchemy import select
from sqlalchemy.orm import Session

from ..database.Base import Base


T = TypeVar("T", bound = Base)


class BaseRepository(Generic[T]):
    """
    Base repository with common CRUD operations
    """
    def __init__(self, db: Session, model: type[T]) -> None:
        """
        Initialize repository with database session and model type
        """
        self.db = db
        self.model = model

    def create(self, **kwargs: Any) -> T:
        """
        Create a new record
        """
        instance = self.model(**kwargs)
        self.db.add(instance)
        self.db.commit()
        self.db.refresh(instance)
        return instance

    def get_by_id(self, record_id: int) -> T | None:
        """
        Get record by ID
        """
        return self.db.get(self.model, record_id)

    def get_all(self,
                limit: int | None = None,
                offset: int = 0) -> list[T]:
        """
        Get all records with pagination
        """
        stmt = select(self.model).offset(offset)
        if limit:
            stmt = stmt.limit(limit)
        return list(self.db.execute(stmt).scalars().all())

    def update(self, record_id: int, **kwargs: Any) -> T | None:
        """
        Update record by ID
        """
        instance = self.get_by_id(record_id)
        if not instance:
            return None

        for key, value in kwargs.items():
            setattr(instance, key, value)

        self.db.commit()
        self.db.refresh(instance)
        return instance

    def delete(self, record_id: int) -> bool:
        """
        Delete record by ID
        """
        instance = self.get_by_id(record_id)
        if not instance:
            return False

        self.db.delete(instance)
        self.db.commit()
        return True

```

---

## Pattern Analysis

### Pattern Analysis

**Pattern Used:** Repository Pattern

#### Implementation
The `BaseRepository` class in the provided code implements the repository pattern, which abstracts data access operations and encapsulates business logic related to database interactions. It uses generic types (`TypeVar`) to make it flexible for any model that inherits from `Base`, a SQLAlchemy ORM base class.

- **Methods**: The class includes methods like `create`, `get_by_id`, `get_all`, `update`, and `delete` which perform common CRUD operations.
- **Initialization**: It initializes with a database session (`Session`) and the model type (`model`).

#### Benefits
1. **Encapsulation**: Abstracts data access logic, making it easier to switch between different databases or storage mechanisms.
2. **Flexibility**: Generic types allow reuse across multiple models.
3. **Maintainability**: Centralizes business logic related to database operations.

#### Deviations
- The implementation uses SQLAlchemy's `Session` and ORM features directly, which is a common deviation from the pure repository pattern that might separate data access concerns more strictly.
- Methods like `get_all` use pagination through `offset` and optional `limit`, providing flexibility but potentially making it less generic compared to some patterns.

#### Appropriateness
This pattern is appropriate in scenarios where you need to abstract database interactions, especially when dealing with multiple models or switching between different databases. It's particularly useful for projects like the `stripe-referral` repository where data access logic needs to be centralized and flexible.

---

*Generated by CodeWorm on 2026-03-01 09:20*
