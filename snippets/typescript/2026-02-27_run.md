# run

**Type:** Documentation
**Repository:** CertGames-Core
**File:** frontend/user-app/scripts/verify-guards.ts
**Language:** typescript
**Lines:** 150-201
**Complexity:** 12.0

---

## Source Code

```typescript
async function run(): Promise<void> {
  const active = tests.filter(t => !t.skip).length;
  const skipped = tests.filter(t => t.skip).length;
  console.log(`\nðŸ”  Guard Verification  ${BASE}`);
  console.log(`    ${active} active  |  ${skipped} skipped\n`);

  const results: Result[] = [];

  for (const t of tests) {
    if (t.skip) {
      results.push({ name: t.name, status: 'skip', detail: t.skip });
      process.stdout.write(`  â­  ${t.name}  (${t.skip})\n`);
      continue;
    }

    try {
      const { status: http, data } = await client.request({
        method: t.method ?? 'GET',
        url: t.url,
        data: t.body,
      });

      if (http >= 400) {
        const detail = `HTTP ${http} â€” ${JSON.stringify(data).slice(0, 140)}`;
        results.push({ name: t.name, status: 'http_err', detail });
        process.stdout.write(`  ðŸ”´  ${t.name}  â†’  ${detail}\n`);
        continue;
      }

      const ok = t.guard(data);
      results.push({ name: t.name, status: ok ? 'pass' : 'fail', detail: ok ? undefined : JSON.stringify(data).slice(0, 240) });
      process.stdout.write(ok ? `  âœ…  ${t.name}\n` : `  âŒ  ${t.name}\n`);
      if (!ok) process.stdout.write(`       ${JSON.stringify(data).slice(0, 240)}\n`);

    } catch (err) {
      const msg = err instanceof Error ? err.message : String(err);
      results.push({ name: t.name, status: 'throw', detail: msg });
      process.stdout.write(`  ðŸ’¥  ${t.name}  â†’  ${msg}\n`);
    }
  }

  const pass  = results.filter(r => r.status === 'pass').length;
  const fail  = results.filter(r => r.status === 'fail').length;
  const err   = results.filter(r => r.status === 'http_err' || r.status === 'throw').length;
  const skip  = results.filter(r => r.status === 'skip').length;

  console.log('\n' + 'â”€'.repeat(56));
  console.log(`  âœ… ${pass} passed  âŒ ${fail} guard-fail  ðŸ”´ ${err} http/throw  â­ ${skip} skipped`);
  console.log('â”€'.repeat(56) + '\n');

  if (fail > 0 || err > 0) process.exit(1);
}
```

---

## Documentation

### Documentation for `run` Function

**Purpose and Behavior:**
The `run` function in `/home/yoshi/dev/CertGames-Core/frontend/user-app/scripts/verify-guards.ts` is an asynchronous verification process that checks the status of various tests defined in the `tests` array. It logs the results to the console, categorizing each test as 'pass', 'fail', 'http_err', or 'skip'. If any tests fail or throw errors, the function exits with a non-zero status code.

**Key Implementation Details:**
- The function iterates over an array of `tests`, filtering and processing them based on their `skip` property.
- It uses asynchronous HTTP requests via `client.request` to check for HTTP errors.
- Results are stored in the `results` array, which is used to summarize test outcomes at the end.

**When/Why to Use This Code:**
This function is ideal for verifying API guards and ensuring that all tests pass before deployment. It can be run as part of a CI pipeline or manually during development to catch issues early.

**Patterns and Gotchas:**
- The use of `try-catch` blocks ensures robust error handling, but be cautious with the string truncation in case of large responses.
- The function relies on external `client.request`, which must be properly configured for HTTP requests. Ensure that this client is available and correctly set up before using this code.

This function provides a comprehensive overview of test outcomes, making it easy to identify issues quickly.

---

*Generated by CodeWorm on 2026-02-27 23:21*
