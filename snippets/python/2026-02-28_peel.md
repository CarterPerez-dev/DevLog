# peel

**Type:** Documentation
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/beginner/base64-tool/src/base64_tool/peeler.py
**Language:** python
**Lines:** 55-99
**Complexity:** 7.0

---

## Source Code

```python
def peel(
    data: str,
    *,
    max_depth: int = PEEL_MAX_DEPTH,
    threshold: float = CONFIDENCE_THRESHOLD,
    verbose: bool = False,
) -> PeelResult:
    layers: list[PeelLayer] = []
    current_text = data
    current_bytes = data.encode("utf-8")

    for depth in range(max_depth):
        detection = detect_best(current_text)

        if detection is None:
            break
        if detection.confidence < threshold:
            break
        if detection.decoded is None:
            break

        scores = (tuple(score_all_formats(current_text).items()) if verbose else ())

        decoded_bytes = detection.decoded
        layer = PeelLayer(
            depth = depth + 1,
            format = detection.format,
            confidence = detection.confidence,
            encoded_preview = truncate(current_text),
            decoded_preview = safe_bytes_preview(decoded_bytes),
            all_scores = scores,
        )
        layers.append(layer)
        current_bytes = decoded_bytes

        try:
            current_text = decoded_bytes.decode("utf-8")
        except (UnicodeDecodeError, ValueError):
            break

    return PeelResult(
        layers = tuple(layers),
        final_output = current_bytes,
        success = len(layers) > 0,
    )
```

---

## Documentation

### Documentation for `peel` Function

**Purpose and Behavior:**
The `peel` function decodes a given string by detecting layers of encoding, such as base64, until it reaches the final decoded text or exceeds a specified depth limit. It returns a structured result containing details about each detected layer.

**Key Implementation Details:**
- **Parameters:** The function accepts `data`, `max_depth`, `threshold`, and `verbose` with default values.
- **Looping Logic:** Iterates up to `max_depth`, detecting the best encoding format at each step. Breaks early if no detection, low confidence, or missing decoded data.
- **Layer Construction:** Each detected layer is stored in a list, including metadata like format, confidence, and previews of encoded/decoded text.
- **Error Handling:** Attempts to decode bytes back to text; breaks on decoding errors.

**When/Why to Use:**
Use this function when you need to iteratively decode nested or obfuscated data strings. It's particularly useful in cybersecurity contexts where data might be encoded multiple times.

**Patterns and Gotchas:**
- **Default Parameters:** `max_depth` and `threshold` are configurable, allowing flexibility.
- **Error Handling:** The try-except block ensures the function gracefully handles decoding errors without breaking.
- **Performance Considerations:** The function may be slow for very deep or complex encodings due to multiple iterations.

---

*Generated by CodeWorm on 2026-02-28 14:22*
