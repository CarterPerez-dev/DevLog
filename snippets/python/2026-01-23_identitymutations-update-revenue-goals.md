# IdentityMutations.update_revenue_goals

**Repository:** angelamos-operations
**File:** CarterOS-Server/src/core/foundation/repositories/identity_mutations.py
**Language:** python
**Lines:** 617-656
**Complexity:** 7.0

---

## Source Code

```python
async def update_revenue_goals(
        session: AsyncSession,
        data: dict
    ) -> RevenueGoal:
        """
        Update revenue goals - partial update supported

        Args:
            data: {paying_users_target, monthly_price, monthly_revenue_target, current_paying_users, note}
        """
        result = await session.execute(select(RevenueGoal).limit(1))
        revenue_goal = result.scalar_one_or_none()

        if not revenue_goal:
            identity = await session.execute(select(CoreIdentity).limit(1))
            revenue_goal = RevenueGoal(
                identity_id = identity.scalar_one().id,
                paying_users_target = 0,
                monthly_price = 0,
                monthly_revenue_target = 0,
                current_paying_users = 0,
            )
            session.add(revenue_goal)

        if "paying_users_target" in data:
            revenue_goal.paying_users_target = data["paying_users_target"]
        if "monthly_price" in data:
            revenue_goal.monthly_price = data["monthly_price"]
        if "monthly_revenue_target" in data:
            revenue_goal.monthly_revenue_target = data[
                "monthly_revenue_target"]
        if "current_paying_users" in data:
            revenue_goal.current_paying_users = data["current_paying_users"
                                                     ]
        if "note" in data:
            revenue_goal.note = data["note"]

        await session.flush()
        await session.refresh(revenue_goal)
        return revenue_goal
```

---

## Documentation

### Documentation for `update_revenue_goals`

**Purpose and Behavior**
The `update_revenue_goals` function updates revenue goals in a database, supporting partial updates by modifying specified fields based on the provided data dictionary.

**Key Implementation Details**
- **Session Management**: Uses an `AsyncSession` to interact with the database asynchronously.
- **Partial Update Support**: Only modifies fields present in the input `data` dictionary. 
- **CoreIdentity Relationship Handling**: If no existing `RevenueGoal` is found, a new one is created and linked to a `CoreIdentity`.
- **Data Validation**: Ensures that only specified fields are updated.

**When/Why to Use This Code**
Use this function when you need to update revenue goals in your application. It's particularly useful for scenarios where only certain aspects of the goal may change, allowing efficient updates without overwriting unrelated data.

**Patterns and Gotchas**
- **Partial Updates**: Only modify fields present in `data`, avoiding unnecessary changes.
- **Database Interaction**: Ensure proper handling of asynchronous database operations to avoid concurrency issues.
- **CoreIdentity Dependency**: The function relies on a `CoreIdentity` being available, which might need additional checks or error handling.

This function is part of the CarterOS-Server project and is designed for flexibility in updating revenue goals without requiring full rewrites.

---

*Generated by CodeWorm on 2026-01-23 15:05*
