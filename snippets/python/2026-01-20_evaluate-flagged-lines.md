# evaluate_flagged_lines

**Repository:** CertGames-Core
**File:** backend/api/domains/games/services/threat/evaluation_engine.py
**Language:** python
**Lines:** 58-119
**Complexity:** 16.0

---

## Source Code

```python
def evaluate_flagged_lines(
    flagged_lines: list[dict[str, Any]],
    suspicious_lines: list[dict[str, Any]],
    scenario: dict[str, Any]  # noqa: ARG001
) -> tuple[list[dict[str, Any]], list[dict[str, Any]], list[dict[str, Any]], list[dict[str, Any]], list[dict[str, Any]]]:
    """
    Evaluate flagged lines against actual suspicious lines
    """
    correctly_flagged_lines = []
    incorrect_flagged_lines = []
    flagged_correct = []
    flagged_incorrect = []

    suspicious_set: dict[str, set[int]] = {}
    for line in suspicious_lines:
        log_id = line.get("logId", "")
        line_index = line.get("lineIndex")
        if log_id not in suspicious_set:
            suspicious_set[log_id] = set()
        if line_index is not None:
            suspicious_set[log_id].add(line_index)

    for flagged in flagged_lines:
        log_id = flagged.get("logId", "")
        line_index = flagged.get("lineIndex")

        if log_id in suspicious_set and line_index in suspicious_set[log_id
                                                                     ]:
            correctly_flagged_lines.append(flagged)
            for susp in suspicious_lines:
                if susp.get("logId") == log_id and susp.get(
                        "lineIndex") == line_index:
                    flagged_correct.append(susp)
                    break
        else:
            incorrect_flagged_lines.append(flagged)
            flagged_incorrect.append(flagged)

    flagged_set: dict[str, set[int]] = {}
    for flagged in flagged_lines:
        log_id = flagged.get("logId", "")
        line_index = flagged.get("lineIndex")
        if log_id not in flagged_set:
            flagged_set[log_id] = set()
        if line_index is not None:
            flagged_set[log_id].add(line_index)

    missed_flagged_lines = []
    for susp in suspicious_lines:
        log_id = susp.get("logId", "")
        line_index = susp.get("lineIndex")
        if log_id not in flagged_set or line_index not in flagged_set[
                log_id]:
            missed_flagged_lines.append(susp)

    return (
        correctly_flagged_lines,
        missed_flagged_lines,
        incorrect_flagged_lines,
        flagged_correct,
        flagged_incorrect
    )
```

---

## Documentation

### Documentation for `evaluate_flagged_lines`

**Purpose and Behavior:**
The function `evaluate_flagged_lines` evaluates a list of flagged lines against suspicious lines, categorizing them into correctly flagged, incorrectly flagged, missed flags, and incorrect flagging cases. It returns five lists containing the categorized lines.

**Key Implementation Details:**
1. **Data Structures:** Uses sets to efficiently check for line indices.
2. **Nested Loops:** The function iterates over `flagged_lines` and `suspicious_lines` multiple times to categorize them.
3. **Type Hints:** Utilizes type hints for better code readability and maintainability.

**When/Why to Use:**
This function is useful in scenarios where you need to assess the accuracy of flagged lines against known suspicious lines, such as in security threat detection systems or static code analysis tools. It helps identify false positives, false negatives, and correct detections.

**Patterns/Gotchas:**
- **Nested Loops:** The multiple nested loops can be computationally expensive for large datasets.
- **Type `Any`:** The use of `Any` in type hints indicates a lack of specific types; consider defining the exact types if possible to improve code clarity.
- **Efficiency:** Consider optimizing by reducing redundant checks or using more efficient data structures.

---

*Generated by CodeWorm on 2026-01-20 14:44*
