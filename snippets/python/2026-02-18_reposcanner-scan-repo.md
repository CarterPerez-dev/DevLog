# RepoScanner.scan_repo

**Type:** Documentation
**Repository:** CodeWorm
**File:** codeworm/analysis/scanner.py
**Language:** python
**Lines:** 148-212
**Complexity:** 16.0

---

## Source Code

```python
def scan_repo(self, repo_path: Path, repo_name: str) -> Iterator[ScannedFile]:
        """
        Scan a repository and yield discovered files
        """
        if not repo_path.exists():
            return

        gitignore_filter = GitignoreFilter(repo_path)
        include_spec = pathspec.PathSpec.from_lines(
            "gitwildmatch",
            self.include_patterns
        )

        for root, dirs, files in os.walk(repo_path):
            root_path = Path(root)

            dirs[:] = [
                d for d in dirs if not d.startswith(".")
                and not gitignore_filter.is_ignored(root_path / d)
            ]

            for filename in files:
                file_path = root_path / filename

                try:
                    rel_path = file_path.relative_to(repo_path)
                except ValueError:
                    continue

                if not include_spec.match_file(str(rel_path)):
                    continue

                if self._exclude_spec.match_file(str(rel_path)):
                    continue

                if gitignore_filter.is_ignored(file_path):
                    continue

                ext = file_path.suffix.lower()
                language = LANGUAGE_EXTENSIONS.get(ext)
                if not language:
                    continue

                try:
                    stat = file_path.stat()
                    if stat.st_size > self.MAX_FILE_SIZE:
                        continue
                    if stat.st_size == 0:
                        continue

                    is_binary = self._is_binary(file_path)
                    if is_binary:
                        continue

                    yield ScannedFile(
                        path = file_path,
                        language = language,
                        repo_name = repo_name,
                        relative_path = rel_path,
                        size_bytes = stat.st_size,
                        is_binary = False,
                    )

                except (OSError, PermissionError):
                    continue
```

---

## Documentation

### Documentation for `RepoScanner.scan_repo`

**Purpose and Behavior:**
The `scan_repo` method scans a specified repository directory, filtering out ignored files based on `.gitignore`, inclusion patterns, and exclusion patterns. It yields `ScannedFile` objects containing details about each file that meets the criteria.

**Key Implementation Details:**
- The method uses `os.walk` to traverse the directory tree.
- It filters directories and files using a combination of `.gitignore`, inclusion/exclusion patterns, and size checks.
- Potential binary files are skipped by checking if they are empty or exceed `MAX_FILE_SIZE`.
- File paths are normalized to relative paths within the repository.

**When/Why to Use:**
This method is useful for static code analysis tools that need to process large repositories efficiently. It ensures only relevant files are processed, reducing unnecessary computations and improving performance.

**Patterns/Gotchas:**
- The use of `pathspec` for pattern matching can be complex; ensure patterns are correctly defined.
- The `try-except` blocks handle potential errors gracefully but may miss some edge cases (e.g., permission issues).
- The method relies on external configurations like `include_patterns` and `MAX_FILE_SIZE`, which must be set appropriately.

---

*Generated by CodeWorm on 2026-02-18 08:21*
