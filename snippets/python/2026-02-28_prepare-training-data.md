# prepare_training_data

**Type:** Documentation
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/advanced/ai-threat-detection/backend/ml/splitting.py
**Language:** python
**Lines:** 28-84
**Complexity:** 4.0

---

## Source Code

```python
def prepare_training_data(
    X: np.ndarray,
    y: np.ndarray,
    train_ratio: float = 0.70,
    val_ratio: float = 0.15,
    smote_strategy: float = 0.3,
    smote_k: int = 5,
    random_state: int = 42,
) -> TrainingSplit:
    """
    Split data into train/val/test with SMOTE on training set only
    """
    n_classes = len(np.unique(y))
    if n_classes < 2:
        raise ValueError("y must contain at least 2 classes")

    test_size = 1.0 - train_ratio
    X_train, X_rem, y_train, y_rem = train_test_split(
        X,
        y,
        test_size=test_size,
        stratify=y,
        random_state=random_state,
    )

    X_val, X_test, y_val, y_test = train_test_split(
        X_rem,
        y_rem,
        test_size=0.5,
        stratify=y_rem,
        random_state=random_state,
    )

    X_normal_train = X_train[y_train == 0]

    class_counts = np.bincount(y_train)
    minority_count = class_counts.min()
    majority_count = class_counts.max()
    current_ratio = minority_count / majority_count

    if (minority_count >= smote_k + 1 and current_ratio < smote_strategy):
        sampler = SMOTE(
            sampling_strategy=smote_strategy,
            k_neighbors=smote_k,
            random_state=random_state,
        )
        X_train, y_train = sampler.fit_resample(X_train, y_train)

    return TrainingSplit(
        X_train=X_train,
        y_train=y_train,
        X_val=X_val,
        y_val=y_val,
        X_test=X_test,
        y_test=y_test,
        X_normal_train=X_normal_train,
    )
```

---

## Documentation

### Documentation for `prepare_training_data`

**Purpose and Behavior:**
The function `prepare_training_data` splits input data into training, validation, and test sets while applying SMOTE (Synthetic Minority Over-sampling Technique) only to the training set. It ensures a balanced dataset by adjusting class ratios using SMOTE if necessary.

**Key Implementation Details:**
- **Input Parameters:** The function accepts various parameters including feature matrix `X`, label vector `y`, split ratios, and SMOTE strategy.
- **Data Splitting:** Initially, data is split into training and remaining sets. Then, the remaining set is further divided into validation and test sets.
- **SMOTE Application:** If the minority class count is sufficient and the current ratio is below the specified threshold, SMOTE is applied to balance the training dataset.

**When/Why to Use:**
This function should be used when preparing datasets for machine learning models in cybersecurity projects where balanced class distribution is crucial. It ensures that the model can generalize well by addressing class imbalance issues during the training phase.

**Patterns and Gotchas:**
- **SMOTE Strategy:** Ensure `smote_strategy` is set appropriately to avoid overfitting.
- **Class Imbalance Handling:** The function only applies SMOTE if conditions are met, which might not always be necessary depending on the dataset characteristics.

---

*Generated by CodeWorm on 2026-02-28 08:20*
