# InsightsRepository.get_time_series_data

**Type:** Documentation
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/analytics/facets/insights/repository.py
**Language:** python
**Lines:** 432-469
**Complexity:** 3.0

---

## Source Code

```python
async def get_time_series_data(cls,
                                   session: AsyncSession) -> list[dict]:
        """Get performance metrics over time"""
        videos = await cls.get_all_videos(session)

        # Group by date
        date_stats = defaultdict(
            lambda: {
                "views": 0,
                "engagement": 0,
                "new_followers": 0,
                "count": 0,}
        )

        for video in videos:
            date_str = video.date_posted.isoformat()
            engagement_rate = cls.calculate_engagement_rate(video)

            date_stats[date_str]["views"] += video.views
            date_stats[date_str]["engagement"] += engagement_rate
            date_stats[date_str]["new_followers"] += video.new_followers
            date_stats[date_str]["count"] += 1

        # Convert to list and calculate averages
        result = []
        for date_str, stats in sorted(date_stats.items()):
            count = stats["count"]
            result.append(
                {
                    "date": date_str,
                    "views": stats["views"],
                    "engagement_rate": stats["engagement"] / count,
                    "new_followers": stats["new_followers"],
                    "video_count": count,
                }
            )

        return result
```

---

## Documentation

### Documentation for `get_time_series_data`

**Purpose and Behavior:**
The function `InsightsRepository.get_time_series_data` retrieves performance metrics (views, engagement rate, new followers) for videos over time and calculates averages per day.

**Key Implementation Details:**
- **Asynchronous**: The function is marked as `async`, indicating it operates asynchronously.
- **Session Management**: It takes an `AsyncSession` object to interact with the database.
- **Grouping by Date**: Video data is grouped by date using a `defaultdict`. Each group accumulates views, engagement rates, and new followers.
- **Averaging Metrics**: The function calculates average engagement rates for each day by dividing total engagements by video counts.

**When/Why to Use:**
Use this code when you need to analyze the performance of videos over time. It's particularly useful in analytics dashboards or reports where daily metrics are required.

**Patterns and Gotchas:**
- **Asynchronous Operations**: Ensure that `AsyncSession` is properly managed, especially in a production environment.
- **Type Hints**: The function returns a list of dictionaries, each representing a dayâ€™s aggregated metrics. This structure can be easily consumed by front-end applications or stored for later analysis.
- **Performance Considerations**: While the code handles grouping and averaging efficiently, large datasets might require optimization to avoid performance bottlenecks.

This function is ideal for scenarios where you need detailed time-series data for video analytics, providing a clear view of trends over days.

---

*Generated by CodeWorm on 2026-02-27 18:27*
