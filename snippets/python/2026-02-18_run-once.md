# run_once

**Type:** Documentation
**Repository:** CodeWorm
**File:** codeworm/cli.py
**Language:** python
**Lines:** 125-173
**Complexity:** 8.0

---

## Source Code

```python
def run_once(
    ctx: click.Context,
    devlog: Path | None,
    repo: tuple,
    dry_run: bool
) -> None:
    """
    Run a single documentation cycle then exit
    """
    from codeworm.daemon import CodeWormDaemon

    overrides = {"debug": ctx.obj["debug"]}

    if devlog:
        overrides["devlog"] = {"repo_path": devlog}

    if repo:
        repos = [
            {
                "name": name,
                "path": Path(path),
                "weight": 5
            } for name, path in repo
        ]
        overrides["repos"] = repos

    settings = load_settings(config_dir = ctx.obj["config_dir"], **overrides)
    redis_url = settings.dashboard.redis.connection_url if settings.dashboard.redis.enabled else ""
    configure_logging(debug = settings.debug, redis_url = redis_url)

    if not settings.repos:
        console.print("[red]Error:[/red] No repositories configured")
        console.print("Add repos to config/repos.yaml or use --repo NAME PATH")
        raise SystemExit(1)

    mode = "[yellow][DRY RUN][/yellow] " if dry_run else ""
    console.print(f"{mode}[bold]Running single documentation cycle...[/bold]")
    console.print(f"  DevLog: {settings.devlog.repo_path}")
    console.print(f"  Repos: {[r.name for r in settings.repos]}")

    daemon = CodeWormDaemon(settings)
    result = asyncio.run(daemon.run_once(dry_run = dry_run))

    if result:
        console.print("[green]Documentation generated successfully[/green]")
    else:
        console.print(
            "[yellow]No candidates found or all already documented[/yellow]"
        )
```

---

## Documentation

### Documentation for `run_once` Function

**Purpose and Behavior:**
The `run_once` function in the CodeWorm CLI is designed to execute a single documentation cycle based on specified repository configurations and settings. It initializes logging, sets up the daemon with overrides from command-line arguments, and runs the documentation process.

**Key Implementation Details:**
- **Parameters:** The function accepts parameters like `ctx`, `devlog`, `repo`, and `dry_run` to customize its behavior.
- **Overrides Handling:** Overrides for settings are dynamically created based on provided arguments (e.g., `devlog`, `repo`).
- **Asynchronous Execution:** Uses `asyncio.run()` to execute the daemon's `run_once` method asynchronously.
- **Error Handling:** Checks if any repositories are configured and exits with an error message if none are found.

**When/Why to Use:**
Use this function when you need to run a one-time documentation generation process. It is particularly useful for testing or quick setup scenarios where detailed configuration management is not required.

**Patterns/Gotchas:**
- **Dry Run Mode:** The `dry_run` parameter allows simulating the execution without actually generating documentation, which can be helpful for debugging.
- **Repository Configuration:** Ensure repositories are correctly specified in the config file or via command-line arguments to avoid runtime errors.

---

*Generated by CodeWorm on 2026-02-18 08:11*
