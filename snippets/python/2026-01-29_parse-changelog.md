# parse_changelog

**Repository:** vuemantics
**File:** backend/routers/v1/changelog.py
**Language:** python
**Lines:** 28-103
**Complexity:** 27.0

---

## Source Code

```python
def parse_changelog() -> ChangelogResponse:
    """
    Parse CHANGELOG.md and return structured data
    """
    if not CHANGELOG_PATH.exists():
        return ChangelogResponse(versions = [])

    content = CHANGELOG_PATH.read_text(encoding = "utf-8")
    versions = []

    # Match version headers: ## [1.0.1] - 2026-01-26
    version_pattern = r"##\s+\[([^\]]+)\]\s+-\s+(\d{4}-\d{2}-\d{2})"
    version_matches = list(re.finditer(version_pattern, content))

    for i, match in enumerate(version_matches):
        version_num = match.group(1)
        date = match.group(2)

        start = match.end()
        end = version_matches[i + 1].start(
        ) if i + 1 < len(version_matches) else len(content)
        version_content = content[start : end]

        changes = ChangelogSection()
        current_section = None
        items: list[str] = []

        for line in version_content.split("\n"):
            line = line.strip()

            if line.startswith("### Added"):
                if current_section and items:
                    setattr(changes, current_section, items)
                current_section = "added"
                items = []
            elif line.startswith("### Changed"):
                if current_section and items:
                    setattr(changes, current_section, items)
                current_section = "changed"
                items = []
            elif line.startswith("### Deprecated"):
                if current_section and items:
                    setattr(changes, current_section, items)
                current_section = "deprecated"
                items = []
            elif line.startswith("### Removed"):
                if current_section and items:
                    setattr(changes, current_section, items)
                current_section = "removed"
                items = []
            elif line.startswith("### Fixed"):
                if current_section and items:
                    setattr(changes, current_section, items)
                current_section = "fixed"
                items = []
            elif line.startswith("### Security"):
                if current_section and items:
                    setattr(changes, current_section, items)
                current_section = "security"
                items = []

            elif line.startswith("- ") and current_section:
                items.append(line[2 :])

        if current_section and items:
            setattr(changes, current_section, items)

        versions.append(
            ChangelogVersion(
                version = version_num,
                date = date,
                changes = changes,
            )
        )

    return ChangelogResponse(versions = versions)
```

---

## Documentation

### Documentation for `parse_changelog`

**Purpose and Behavior**
The `parse_changelog` function reads a `CHANGELOG.md` file, extracts version information, and structures the changelog into a more readable format. It returns a `ChangelogResponse` object containing an array of `ChangelogVersion` objects, each representing a different version with its date and changes categorized by "Added", "Changed", "Deprecated", "Removed", "Fixed", and "Security".

**Key Implementation Details**
- The function uses regular expressions to find version headers in the changelog.
- It iterates through the content, categorizing changes under specific sections based on their headings.
- Each `ChangelogVersion` object is populated with a list of changes for each category.

**When/Why to Use This Code**
Use this code when you need to parse and structure a changelog file into a more usable format. It's particularly useful in version control systems or release notes generation tools where detailed change tracking is necessary.

**Patterns and Gotchas**
- The function uses `re.finditer` for efficient pattern matching.
- Categorizing changes requires careful handling of line prefixes to avoid misclassification.
- The use of `@lru_cache(maxsize=1)` ensures that the parsed changelog is cached, reducing redundant parsing on subsequent calls. However, this might not be ideal if the changelog frequently updates.

This function provides a robust way to manage and display version history in a structured manner.

---

*Generated by CodeWorm on 2026-01-29 08:24*
