# Transport.send

**Type:** Documentation
**Repository:** Telehook
**File:** src/telehook/transport.py
**Language:** python
**Lines:** 32-49
**Complexity:** 3.0

---

## Source Code

```python
async def send(self, message: Message) -> dict[str, Any]:
        payload = message.to_payload(chat_id = self._config.chat_id)
        response = await self._client.post(self._config.send_url, json = payload)
        data = response.json()

        if not data.get("ok"):
            retry_after = None
            params = data.get("parameters", {})
            if params:
                retry_after = params.get("retry_after")
            raise TelegramAPIError(
                status_code = response.status_code,
                description = data.get("description",
                                       "Unknown error"),
                retry_after = retry_after,
            )

        return data["result"]
```

---

## Documentation

### Documentation for `send` Method in Telehook Transport Class

**Purpose and Behavior:**
The `send` method sends a message via an asynchronous HTTP POST request using the Telegram API. It constructs a payload from the provided `Message` object, including the chat ID from configuration settings. The response is then parsed to check if the operation was successful. If not, it raises a `TelegramAPIError` with relevant details such as status code, description, and retry period.

**Key Implementation Details:**
- **Asynchronous Handling:** Uses `async/await` for asynchronous HTTP requests.
- **Payload Construction:** Constructs JSON payload from the message object, including chat ID.
- **Response Parsing:** Parses the response to extract necessary information like status, description, and retry time.
- **Error Handling:** Raises a custom `TelegramAPIError` if the operation fails.

**When/Why to Use This Code:**
This method should be used when sending messages through the Telegram API from within your application. It abstracts away the details of constructing payloads and handling responses, making it easier to integrate with the Telegram API while ensuring proper error handling.

**Patterns/Gotchas:**
- **Custom Error Handling:** The use of a custom `TelegramAPIError` class ensures that errors are handled consistently across the application.
- **Asynchronous I/O:** Asynchronous nature is crucial for non-blocking operations, especially in IO-bound tasks like HTTP requests. Ensure your environment supports async/await.

This method encapsulates the complexity of interacting with the Telegram API, making it a robust choice for sending messages while handling potential errors gracefully.

---

*Generated by CodeWorm on 2026-02-28 20:42*
