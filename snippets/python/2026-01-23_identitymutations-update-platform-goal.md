# IdentityMutations.update_platform_goal

**Repository:** angelamos-operations
**File:** CarterOS-Server/src/core/foundation/repositories/identity_mutations.py
**Language:** python
**Lines:** 573-599
**Complexity:** 6.0

---

## Source Code

```python
async def update_platform_goal(
        session: AsyncSession,
        goal_id: UUID,
        data: dict
    ) -> PlatformGoal:
        """
        Update platform goal - partial update supported
        """
        result = await session.execute(
            select(PlatformGoal).where(PlatformGoal.id == goal_id)
        )
        goal = result.scalar_one()

        if "current_followers" in data:
            goal.current_followers = data["current_followers"]
        if "goal_followers" in data:
            goal.goal_followers = data["goal_followers"]
        if "time_to_goal" in data:
            goal.time_to_goal = data["time_to_goal"]
        if "current_status" in data:
            goal.current_status = data["current_status"]
        if "strategy" in data:
            goal.strategy = data["strategy"]

        await session.flush()
        await session.refresh(goal)
        return goal
```

---

## Documentation

### Documentation for `update_platform_goal`

**Purpose and Behavior:**
The `update_platform_goal` function is an asynchronous method designed to partially update a `PlatformGoal` object in the database using provided data. It supports updating specific fields like `current_followers`, `goal_followers`, `time_to_goal`, `current_status`, and `strategy`.

**Key Implementation Details:**
- **Session Management:** The function uses an `AsyncSession` from SQLAlchemy to interact with the database asynchronously.
- **Query Execution:** It executes a SELECT query to fetch the existing `PlatformGoal` object based on the provided `goal_id`.
- **Partial Updates:** Conditional checks are used to update only the fields that have new data, ensuring efficient and targeted updates.
- **Database Operations:** After updating the fields, it calls `session.flush()` to write changes to the database and `session.refresh(goal)` to refresh the object in memory.

**When/Why to Use:**
This function should be used when you need to update specific attributes of a `PlatformGoal` object without fetching all its data. It's efficient for partial updates, reducing unnecessary data transfer and processing.

**Patterns/Gotchas:**
- **Type Hints:** The use of type hints (`AsyncSession`, `UUID`, `dict`) ensures clear expectations about the input parameters.
- **Conditional Updates:** Only relevant fields are updated, which can help in optimizing database operations but requires careful handling to avoid missing updates.

---

*Generated by CodeWorm on 2026-01-23 19:02*
