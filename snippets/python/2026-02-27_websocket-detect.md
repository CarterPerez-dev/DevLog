# websocket_detect

**Type:** Documentation
**Repository:** angelamos-3d
**File:** backend/app/wake/router.py
**Language:** python
**Lines:** 24-54
**Complexity:** 8.0

---

## Source Code

```python
async def websocket_detect(websocket: WebSocket) -> None:
    """
    WebSocket endpoint for real-time wake word detection.
    Send audio chunks as binary, receive JSON detection events.
    """
    await websocket.accept()

    model = service.create_session_model()

    try:
        while True:
            msg = await websocket.receive()

            if msg.get("type") == "websocket.disconnect":
                break

            if "text" in msg:
                if msg["text"] == "reset":
                    model.reset()
                continue

            if "bytes" not in msg:
                continue

            detections = service.process_audio(model, msg["bytes"])

            for detection in detections:
                await websocket.send_json(detection.model_dump())

    except WebSocketDisconnect:
        pass
```

---

## Documentation

### Documentation for `websocket_detect` Function

**Purpose and Behavior:**
The `websocket_detect` function is an asynchronous WebSocket endpoint designed for real-time wake word detection. It accepts audio chunks as binary data, processes them using a pre-trained model, and sends JSON-encoded detection events back to the client.

**Key Implementation Details:**
- **WebSocket Acceptance:** The function starts by accepting the WebSocket connection.
- **Model Initialization:** A session model is created via `service.create_session_model()`.
- **Main Loop:** It enters an infinite loop where it continuously receives messages. If a disconnect message is received, it breaks out of the loop.
- **Message Handling:**
  - For "reset" commands, the model resets its state.
  - For audio data, the function processes the audio and sends detection results back to the client.

**When/Why to Use This Code:**
This code should be used in applications requiring real-time wake word detection, such as voice-activated assistants or smart home devices. It ensures efficient handling of incoming audio streams and immediate feedback through WebSocket connections.

**Patterns and Gotchas:**
- **Error Handling:** The `WebSocketDisconnect` exception is caught but not logged, which could lead to silent failures.
- **Resource Management:** Properly managing the WebSocket connection state and model lifecycle is crucial for performance and reliability.

---

*Generated by CodeWorm on 2026-02-27 20:47*
