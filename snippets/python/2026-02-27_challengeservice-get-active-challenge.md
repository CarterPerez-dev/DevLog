# ChallengeService.get_active_challenge

**Type:** Documentation
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/challenge/facets/tracker/service.py
**Language:** python
**Lines:** 75-129
**Complexity:** 3.0

---

## Source Code

```python
async def get_active_challenge(
        session: AsyncSession,
    ) -> ChallengeWithStats:
        """
        Get active challenge with stats and logs
        """
        challenge = await ChallengeRepository.get_active(session)
        if not challenge:
            raise ChallengeNotFound()

        total_content, total_jobs = await ChallengeLogRepository.get_totals(
            session,
            challenge.id,
        )

        logs_response = [
            LogResponse(
                id = log.id,
                challenge_id = log.challenge_id,
                log_date = log.log_date,
                day_number = ChallengeService._calculate_day_number(
                    challenge,
                    log.log_date
                ),
                tiktok = log.tiktok,
                instagram_reels = log.instagram_reels,
                youtube_shorts = log.youtube_shorts,
                twitter = log.twitter,
                reddit = log.reddit,
                linkedin_personal = log.linkedin_personal,
                linkedin_company = log.linkedin_company,
                youtube_full = log.youtube_full,
                medium = log.medium,
                jobs_applied = log.jobs_applied,
                created_at = log.created_at,
                updated_at = log.updated_at,
            ) for log in challenge.logs
        ]

        return ChallengeWithStats(
            id = challenge.id,
            name = challenge.name,
            start_date = challenge.start_date,
            end_date = challenge.end_date,
            is_active = challenge.is_active,
            content_goal = challenge.content_goal,
            jobs_goal = challenge.jobs_goal,
            total_content = total_content,
            total_jobs = total_jobs,
            current_day = ChallengeService.
            _calculate_current_day(challenge),
            logs = logs_response,
            created_at = challenge.created_at,
            updated_at = challenge.updated_at,
        )
```

---

## Documentation

### Documentation for `ChallengeService.get_active_challenge`

**Purpose and Behavior:**
The function `get_active_challenge` retrieves an active challenge along with its associated logs from the database using asynchronous methods. It calculates total content and job counts, then constructs a detailed `ChallengeWithStats` object.

**Key Implementation Details:**
- **Asynchronous Operations:** Utilizes `AsyncSession` for database interaction.
- **Error Handling:** Raises `ChallengeNotFound` if no active challenge is found.
- **Log Aggregation:** Computes summary statistics for each log entry and aggregates them into a list of `LogResponse`.
- **Data Transformation:** Converts raw logs to structured responses, including calculated fields like day numbers.

**When/Why to Use:**
This function should be used when you need detailed information about an active challenge, including its current state, content goals, job progress, and log entries. It's particularly useful for analytics or reporting purposes where comprehensive data is required.

**Patterns and Gotchas:**
- **Dependency Injection:** `session` is passed as a parameter, promoting testability.
- **Complex Calculations:** `_calculate_day_number` and `_calculate_current_day` are used to derive meaningful metrics from the challenge and logs.
- **Potential Performance Issues:** The function may be slow if the database contains many log entries or challenges. Consider optimizing queries or caching results in production environments.

This code is a good example of handling asynchronous operations, error propagation, and data transformation in Python.

---

*Generated by CodeWorm on 2026-02-27 18:52*
