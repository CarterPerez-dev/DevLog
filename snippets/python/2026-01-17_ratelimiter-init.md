# RateLimiter.init

**Repository:** Cybersecurity-Projects
**File:** PROJECTS/api-rate-limiter/src/fastapi_420/limiter.py
**Language:** python
**Lines:** 84-139
**Complexity:** 10.0

---

## Source Code

```python
async def init(self) -> None:
        """
        Initialize storage, algorithm, and fingerprinter
        """
        async with self._lock:
            if self._initialized:
                return

            if self._storage is None:
                self._storage = create_storage(self._settings.storage)

            if self._settings.storage.FALLBACK_TO_MEMORY:
                self._fallback_storage = MemoryStorage.from_settings(
                    self._settings.storage
                )
                await self._fallback_storage.start_cleanup_task()

            if isinstance(self._storage, RedisStorage):
                try:
                    await self._storage.connect()
                except StorageConnectionError:
                    if self._settings.FAIL_OPEN and self._fallback_storage:
                        logger.warning(
                            "Redis unavailable, using memory fallback",
                            extra = {
                                "redis_url":
                                self._settings.storage.REDIS_URL
                            },
                        )
                        self._storage = self._fallback_storage
                        self._fallback_storage = None
                    else:
                        raise

            if isinstance(self._storage,
                          MemoryStorage
                          ) and self._storage != self._fallback_storage:
                await self._storage.start_cleanup_task()

            self._algorithm = create_algorithm(self._settings.ALGORITHM)
            self._fingerprinter = CompositeFingerprinter.from_settings(
                self._settings.fingerprint
            )

            self._initialized = True
            logger.info(
                "Rate limiter initialized",
                extra = {
                    "algorithm":
                    self._settings.ALGORITHM.value,
                    "storage":
                    self._storage.storage_type.value,
                    "fingerprint_level":
                    self._settings.fingerprint.LEVEL.value,
                },
            )
```

---

## Documentation

### Documentation for `RateLimiter.init`

**Purpose and Behavior:**
The `init` method initializes the rate limiter by setting up storage, algorithm, and fingerprinter components. It ensures that the correct storage backend is used (falling back to memory if Redis fails), configures cleanup tasks, and logs initialization details.

**Key Implementation Details:**
- **Initialization Check:** The method first checks if the object has already been initialized.
- **Storage Setup:** It creates a storage instance based on settings. If `FALLBACK_TO_MEMORY` is enabled, it sets up a fallback memory storage with a cleanup task.
- **Redis Connection Handling:** Attempts to connect to Redis; falls back to memory storage if Redis fails and `FAIL_OPEN` is set.
- **Cleanup Tasks:** Starts cleanup tasks for both the primary and fallback storages.
- **Algorithm and Fingerprinter Creation:** Initializes the rate limiting algorithm and composite fingerprinter based on settings.

**When/Why to Use:**
Use this method during object initialization in a rate limiter class. It ensures robust setup, handling of different storage backends, and proper logging for debugging and monitoring purposes.

**Patterns and Gotchas:**
- **Context Manager:** The `async with self._lock:` statement ensures thread safety.
- **Error Handling:** Fallback to memory storage on Redis failure is a key pattern.
- **Gotcha:** Ensure that `FAIL_OPEN` setting is correctly configured or handle the exception appropriately in your application.

---

*Generated by CodeWorm on 2026-01-17 23:27*
