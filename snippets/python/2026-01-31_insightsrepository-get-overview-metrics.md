# InsightsRepository.get_overview_metrics

**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/analytics/facets/insights/repository.py
**Language:** python
**Lines:** 73-103
**Complexity:** 10.0

---

## Source Code

```python
async def get_overview_metrics(session: AsyncSession) -> dict:
        """Calculate overall performance metrics"""
        result = await session.execute(
            select(
                func.count(TikTokVideo.id).label("total_videos"),
                func.sum(TikTokVideo.views).label("total_views"),
                func.sum(TikTokVideo.likes).label("total_likes"),
                func.sum(TikTokVideo.comments).label("total_comments"),
                func.sum(TikTokVideo.shares).label("total_shares"),
                func.sum(TikTokVideo.bookmarks).label("total_bookmarks"),
                func.sum(TikTokVideo.new_followers).label("total_new_followers"),
                func.avg(TikTokVideo.avg_watch_time).label("avg_watch_time"),
                func.avg(TikTokVideo.watched_full_video_percentage).label("avg_watch_percentage"),
                func.min(TikTokVideo.date_posted).label("min_date"),
                func.max(TikTokVideo.date_posted).label("max_date"),
            )
        )
        row = result.one()
        return {
            "total_videos": row.total_videos or 0,
            "total_views": row.total_views or 0,
            "total_likes": row.total_likes or 0,
            "total_comments": row.total_comments or 0,
            "total_shares": row.total_shares or 0,
            "total_bookmarks": row.total_bookmarks or 0,
            "total_new_followers": row.total_new_followers or 0,
            "avg_watch_time": float(row.avg_watch_time or 0),
            "avg_watch_percentage": float(row.avg_watch_percentage or 0),
            "min_date": row.min_date,
            "max_date": row.max_date,
        }
```

---

## Documentation

### Documentation for `get_overview_metrics`

**Purpose and Behavior**
The function `get_overview_metrics` calculates overall performance metrics for TikTok videos using an asynchronous database session (`session`). It retrieves counts, sums, averages, minimum, and maximum dates of various video attributes like views, likes, comments, shares, bookmarks, new followers, watch time, and watch percentage.

**Key Implementation Details**
- **Asynchronous Execution**: Utilizes `async` to handle database operations asynchronously.
- **SQLAlchemy**: Uses SQLAlchemy's `select` and `func` for constructing SQL queries.
- **Type Hints**: The function accepts an `AsyncSession` and returns a dictionary of metrics.
- **Null Handling**: Returns 0 or converts to float for numeric values that might be null.

**When/Why to Use This Code**
Use this code when you need to generate high-level analytics on TikTok video performance. It's efficient for summarizing large datasets without needing complex filtering logic, making it suitable for dashboard updates or periodic reporting.

**Patterns and Gotchas**
- **Null Values**: Ensure that null values are handled appropriately by using `or 0` or converting to float.
- **Performance**: While this function is optimized with async operations, ensure the database query is efficient to avoid performance bottlenecks.

---

*Generated by CodeWorm on 2026-01-31 16:06*
