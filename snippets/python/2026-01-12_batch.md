# batch

**Repository:** Cybersecurity-Projects
**File:** PROJECTS/dns-lookup/dnslookup/cli.py
**Language:** python
**Lines:** 278-380
**Complexity:** 8.0

---

## Source Code

```python
def batch(
    file: Annotated[
        Path,
        typer.
        Argument(help = "File containing domains (one per line)"),
    ],
    record_type: Annotated[
        str,
        typer.Option(
            "--type",
            "-t",
            help = "Record types to query",
        ),
    ] = "A,MX,NS",
    server: Annotated[
        str | None,
        typer.Option(
            "--server",
            "-s",
            help = "DNS server to use",
        ),
    ] = None,
    timeout: Annotated[
        float,
        typer.Option(
            "--timeout",
            help = "Query timeout in seconds",
        ),
    ] = 5.0,
    output: Annotated[
        Path | None,
        typer.Option(
            "--output",
            "-o",
            help = "Output file for JSON results",
        ),
    ] = None,
    json_output: Annotated[
        bool,
        typer.Option(
            "--json",
            "-j",
            help = "Output results as JSON to stdout",
        ),
    ] = False,
) -> None:
    """
    [bold cyan]Batch DNS lookup[/bold cyan] for multiple domains from a file.

    The file should contain one domain per line. Empty lines and lines
    starting with # are ignored.

    Examples:
        dnslookup batch domains.txt
        dnslookup batch domains.txt --type A,MX --output results.json
    """
    if not file.exists():
        console.print(f"[red]Error:[/red] File not found: {file}")
        raise typer.Exit(1)

    domains = []
    with open(file) as f:
        for line in f:
            line = line.strip()
            if line and not line.startswith("#"):
                domains.append(line)

    if not domains:
        console.print(
            "[yellow]Warning:[/yellow] No domains found in file"
        )
        raise typer.Exit(0)

    record_types = parse_record_types(record_type)

    with Progress(
            SpinnerColumn(),
            TextColumn("[progress.description]{task.description}"),
            console = console,
            transient = True,
    ) as progress:
        progress.add_task(
            f"Querying {len(domains)} domains...",
            total = None
        )
        results = asyncio.run(
            batch_lookup(domains,
                         record_types,
                         server,
                         timeout)
        )

    if json_output:
        console.print(results_to_json(results))
    elif output:
        with open(output, "w") as f:
            f.write(results_to_json(results))
        console.print(
            f"[green]:heavy_check_mark:[/green] Results saved to {output}"
        )
    else:
        print_batch_progress_header(len(domains))
        print_batch_results(results)
```

---

## Documentation

### Documentation for `batch` Function

**Purpose and Behavior**
The `batch` function performs batch DNS lookups for multiple domains specified in a file. It supports various record types, custom DNS servers, query timeouts, and output formats (JSON or console). The function reads domain names from the input file, processes them with asynchronous queries, and outputs results based on user preferences.

**Key Implementation Details**
- **Type Annotations & Typer Arguments**: Uses `Annotated` for type hints and `typer` for command-line argument parsing.
- **Asynchronous Processing**: Utilizes `asyncio.run()` to handle DNS lookups asynchronously.
- **Progress Tracking**: Implements a progress bar using `Progress` from the `rich` library to track query status.
- **Error Handling**: Checks file existence, handles empty files with warnings, and exits gracefully.

**When/Why to Use This Code**
Use this function when you need to perform batch DNS lookups for multiple domains efficiently. It is particularly useful in network diagnostics or security assessments where large-scale domain queries are required.

**Patterns & Gotchas**
- **Asynchronous Handling**: Ensure your `batch_lookup` function is properly asynchronous.
- **Rich Library**: Make sure the `rich` library is installed and up-to-date to avoid issues with progress bar functionality.
- **File Input Validation**: The code assumes the input file contains valid domain names. Handle unexpected formats or errors in the input file gracefully.

---

*Generated by CodeWorm on 2026-01-12 23:45*
