# BulkUploadService.list_user_batches

**Repository:** vuemantics
**File:** backend/services/bulk_upload_service.py
**Language:** python
**Lines:** 280-327
**Complexity:** 7.0

---

## Source Code

```python
async def list_user_batches(
        user_id: UUID,
        limit: int = config.BATCH_LIST_DEFAULT_LIMIT,
        offset: int = config.BATCH_LIST_DEFAULT_OFFSET,
    ) -> list[BatchStatusResult]:
        """
        List batches for a user

        Args:
            user_id: User UUID
            limit: Max results
            offset: Skip N results

        Returns:
            List of BatchStatusResult
        """
        # Validate pagination parameters
        if limit < 1 or limit > config.BATCH_LIST_MAX_LIMIT:
            raise ValidationError(
                f"Limit must be between 1 and {config.BATCH_LIST_MAX_LIMIT}"
            )

        if offset < 0:
            raise ValidationError("Offset must be non-negative")

        batches = await UploadBatch.find_by_user(
            user_id = user_id,
            limit = min(limit,
                        config.BATCH_LIST_MAX_LIMIT),
            offset = offset,
        )

        return [
            BatchStatusResult(
                batch_id = batch.id,
                status = batch.status,
                total_uploads = batch.total_uploads,
                processed_uploads = batch.processed_uploads,
                successful_uploads = batch.successful_uploads,
                failed_uploads = batch.failed_uploads,
                progress_percentage = batch.get_progress_percentage(),
                created_at = batch.created_at.isoformat() if batch.created_at else None,
                started_at = None,  # Not needed for list view
                completed_at = batch.completed_at.isoformat() if batch.completed_at else None,
                error_message = None,  # Not needed for list view
            )
            for batch in batches
        ]
```

---

## Documentation

### Documentation for `list_user_batches` Method

**Purpose and Behavior**
The `list_user_batches` method retrieves a paginated list of batch statuses for a given user from the database. It validates pagination parameters (`limit`, `offset`) to ensure they are within acceptable ranges, then constructs a list of `BatchStatusResult` objects containing relevant batch details.

**Key Implementation Details**
- **Type Hints and Annotations**: The method uses type hints for input parameters and return value.
- **Validation**: Validates `limit` and `offset` values before querying the database.
- **Pagination**: Limits the number of results based on `min(limit, config.BATCH_LIST_MAX_LIMIT)` to prevent excessive data retrieval.
- **Batch Data Transformation**: Converts each batch object into a `BatchStatusResult` instance with selected attributes.

**When/Why to Use This Code**
Use this method when you need to list batches for a specific user in a paginated manner. It ensures that only relevant and valid parameters are used, preventing potential errors or performance issues.

**Patterns and Gotchas**
- **Default Values**: Default values for `limit` and `offset` are provided via configuration, promoting consistency across the application.
- **Error Handling**: Proper validation of input parameters helps avoid runtime errors by ensuring they meet expected criteria.

---

*Generated by CodeWorm on 2026-01-29 11:06*
