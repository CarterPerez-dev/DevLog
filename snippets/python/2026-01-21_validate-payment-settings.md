# validate_payment_settings

**Repository:** CertGames-Core
**File:** backend/api/domains/referral/middleware/rules.py
**Language:** python
**Lines:** 47-103
**Complexity:** 17.0

---

## Source Code

```python
def validate_payment_settings():
    """
    Validate that required payment info is provided based on payment method
    """
    data = g.validated
    payment_method = data.get('payment_method')

    if payment_method == 'paypal':
        if not data.get('paypal_email'):
            raise BusinessRuleError(
                "PayPal email is required when payment method is PayPal"
            )

    elif payment_method == 'venmo':
        if not data.get('venmo_handle'):
            raise BusinessRuleError(
                "Venmo handle is required when payment method is Venmo"
            )

    elif payment_method == 'cashapp':
        if not data.get('cashapp_username'):
            raise BusinessRuleError(
                "Cash App username is required when payment method is Cash App"
            )

    elif payment_method == 'zelle':
        if not data.get('zelle_phone_or_email'):
            raise BusinessRuleError(
                "Zelle phone number or email is required when payment method is Zelle"
            )

    elif payment_method == 'bank_transfer':
        if not data.get('bank_account_number'):
            raise BusinessRuleError(
                "Bank account number is required when payment method is bank transfer"
            )
        if not data.get('bank_routing_number'):
            raise BusinessRuleError(
                "Bank routing number is required when payment method is bank transfer"
            )
        if not data.get('bank_account_holder_name'):
            raise BusinessRuleError(
                "Account holder name is required when payment method is bank transfer"
            )

    elif payment_method == 'bitcoin':
        if not data.get('bitcoin_address'):
            raise BusinessRuleError(
                "Bitcoin address is required when payment method is Bitcoin"
            )
        if not data.get('bitcoin_address_confirm'):
            raise BusinessRuleError("Please confirm your Bitcoin address")
        if data.get('bitcoin_address') != data.get(
                'bitcoin_address_confirm'):
            raise BusinessRuleError(
                "Bitcoin addresses do not match. Please double-check your address."
            )
```

---

## Documentation

### Documentation for `validate_payment_settings`

**Purpose and Behavior:**
The function `validate_payment_settings` ensures that the required payment information is provided based on the specified payment method. It checks each payment method (PayPal, Venmo, Cash App, Zelle, Bank Transfer, Bitcoin) to verify if the corresponding fields are present in the data dictionary.

**Key Implementation Details:**
- The function retrieves `payment_method` and associated validation rules from a global variable `g.validated`.
- For each payment method, specific keys are checked for presence. If any required field is missing, a `BusinessRuleError` is raised with an appropriate error message.
- Bank transfer requires three additional fields: account number, routing number, and holder name.

**When/Why to Use This Code:**
This function should be used in scenarios where payment information needs to be validated before processing payments. It ensures that all necessary details are provided for each payment method, preventing errors downstream.

**Patterns and Gotchas:**
- **Pattern:** The code follows a pattern of conditional checks based on the `payment_method` value.
- **Gotcha:** Ensure that the global variable `g.validated` is correctly populated before calling this function. Missing or incorrect data can lead to `BusinessRuleError`.
- **Complexity:** With 17 cyclomatic complexity, the code could benefit from refactoring into smaller functions for each payment method to improve readability and maintainability.

This function provides a robust way to validate payment settings, ensuring that all required information is present before processing payments.

---

*Generated by CodeWorm on 2026-01-21 12:13*
