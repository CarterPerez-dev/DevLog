# get_stats

**Type:** Documentation
**Repository:** CodeWorm
**File:** dashboard/backend/api.py
**Language:** python
**Lines:** 40-101
**Complexity:** 3.0

---

## Source Code

```python
async def get_stats() -> StatsResponse:
    db = _get_db_path()
    if not db.exists():
        return StatsResponse()

    with _get_conn() as conn:
        total = conn.execute(
            "SELECT COUNT(*) FROM documented_snippets"
        ).fetchone()[0]

        by_repo = dict(conn.execute(
            "SELECT source_repo, COUNT(*) FROM documented_snippets "
            "GROUP BY source_repo"
        ).fetchall())

        if _has_column(conn, "documented_snippets", "doc_type"):
            by_doc_type = dict(conn.execute(
                "SELECT doc_type, COUNT(*) FROM documented_snippets "
                "GROUP BY doc_type"
            ).fetchall())
        else:
            by_doc_type = {"function_doc": total}

        last_7 = conn.execute(
            "SELECT COUNT(*) FROM documented_snippets "
            "WHERE documented_at > datetime('now', '-7 days')"
        ).fetchone()[0]

        last_30 = conn.execute(
            "SELECT COUNT(*) FROM documented_snippets "
            "WHERE documented_at > datetime('now', '-30 days')"
        ).fetchone()[0]

        today = conn.execute(
            "SELECT COUNT(*) FROM documented_snippets "
            "WHERE date(documented_at) = date('now')"
        ).fetchone()[0]

        lang_rows = conn.execute(
            "SELECT "
            "CASE "
            "  WHEN source_file LIKE '%.py' THEN 'python' "
            "  WHEN source_file LIKE '%.ts' THEN 'typescript' "
            "  WHEN source_file LIKE '%.tsx' THEN 'tsx' "
            "  WHEN source_file LIKE '%.js' THEN 'javascript' "
            "  WHEN source_file LIKE '%.go' THEN 'go' "
            "  WHEN source_file LIKE '%.rs' THEN 'rust' "
            "  ELSE 'other' "
            "END AS lang, COUNT(*) "
            "FROM documented_snippets GROUP BY lang"
        ).fetchall()
        by_language = dict(lang_rows)

    return StatsResponse(
        total_documented=total,
        by_repo=by_repo,
        by_language=by_language,
        by_doc_type=by_doc_type,
        last_7_days=last_7,
        last_30_days=last_30,
        today=today,
    )
```

---

## Documentation

### Documentation for `get_stats` Function

**Purpose and Behavior:**
The `get_stats` function retrieves various statistics from a database related to documented snippets, such as total counts, by repository, language, document type, and recent activity over the last 7, 30 days, and today.

**Key Implementation Details:**
- **Asynchronous Execution:** The function is marked with `async`, indicating it performs asynchronous operations.
- **Database Interaction:** It uses a connection context manager `_get_conn()` to interact with the database safely.
- **SQL Queries:** Multiple SQL queries are executed to fetch different types of statistics, including counts by repository, language, and document type.
- **Conditional Logic:** The function checks if a specific column exists in the `documented_snippets` table before querying it.

**When/Why to Use:**
Use this code when you need up-to-date statistical information about documented snippets. It is particularly useful for generating reports or dashboards that require detailed insights into the content and activity of the repository.

**Patterns/Gotchas:**
- **Type Hints:** The function returns a `StatsResponse` object, ensuring type safety.
- **Case Statement in SQL:** The use of a case statement to categorize file types by language can be complex; ensure that all possible file extensions are covered.
- **Database Existence Check:** The initial check for the database's existence is crucial to avoid errors if no data is available.

---

*Generated by CodeWorm on 2026-02-27 22:31*
