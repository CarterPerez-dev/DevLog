# User.create

**Repository:** vuemantics
**File:** backend/models/User.py
**Language:** python
**Lines:** 67-100
**Complexity:** 4.0

---

## Source Code

```python
async def create(
        cls,
        email: str,
        password_hash: str,
        is_active: bool = True
    ) -> User:
        """
        Create a new user
        """
        await cls.ensure_table_exists()

        query = """
            INSERT INTO users (email, password_hash, is_active)
            VALUES ($1, $2, $3)
            RETURNING *
        """

        try:
            record = await database.db.fetchrow(
                query,
                email.lower(),
                password_hash,
                is_active
            )
            if record is None:
                raise ValueError("Failed to create user")
            user = cls.from_record(record)
            if user is None:
                raise ValueError("Failed to create user from record")
            return user
        except UniqueViolationError as e:
            raise ValueError(
                f"User with email {email} already exists"
            ) from e
```

---

## Documentation

### Documentation for `User.create`

**Purpose and Behavior:**
The `create` method is a class method that asynchronously inserts a new user into the database. It ensures the table exists, performs an insert operation with parameterized values to prevent SQL injection, and returns the newly created user object.

**Key Implementation Details:**
- **Class Method:** Uses `@classmethod`, allowing it to be called on the class itself rather than an instance.
- **Database Interaction:** Utilizes a database connection (`database.db`) for executing queries. The query ensures data integrity by preventing duplicate entries based on email.
- **Error Handling:** Catches and rethrows specific exceptions like `UniqueViolationError` with a custom error message.

**When/Why to Use This Code:**
Use this method whenever you need to create a new user in the system, ensuring that all necessary fields are correctly set. It handles database operations asynchronously, making it suitable for modern web applications where performance is critical.

**Patterns and Gotchas:**
- **Parameterized Queries:** Using parameterized queries (`$1`, `$2`, etc.) prevents SQL injection.
- **Error Handling:** The method gracefully handles unique constraint violations by raising a meaningful error message. Ensure that the database connection and table structure are correctly set up before calling this method.

This code snippet is part of the `User` model in the `backend/models/User.py` file, contributing to the robust user management system in the `vuemantics` repository.

---

*Generated by CodeWorm on 2026-01-29 13:33*
