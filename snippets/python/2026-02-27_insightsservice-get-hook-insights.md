# InsightsService.get_hook_insights

**Type:** Documentation
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/analytics/facets/insights/service.py
**Language:** python
**Lines:** 179-205
**Complexity:** 2.0

---

## Source Code

```python
async def get_hook_insights(
        session: AsyncSession,
        limit: int = 10,
    ) -> HookInsightsResponse:
        """Get hook effectiveness analysis"""
        hook_data = await InsightsRepository.aggregate_hook_performance(
            session
        )

        hooks = [
            HookAnalysis(
                hook = hook,
                video_count = stats["video_count"],
                avg_views = stats["avg_views"],
                avg_watch_time = stats["avg_watch_time"],
                avg_engagement_rate = stats["avg_engagement_rate"],
                total_views = stats["total_views"],
            ) for hook, stats in hook_data.items()
        ]

        # Sort by average views
        hooks.sort(key = lambda h: h.avg_views, reverse = True)

        return HookInsightsResponse(
            top_hooks = hooks[: limit],
            total_unique_hooks = len(hooks),
        )
```

---

## Documentation

### Documentation for `get_hook_insights` Method

**Purpose and Behavior:**
The `get_hook_insights` method retrieves a list of hooks with their performance metrics, sorts them by average views in descending order, and returns the top N hooks along with the total number of unique hooks. It leverages an asynchronous session to interact with a repository for hook performance data.

**Key Implementation Details:**
- **Parameters:** Accepts `session` (an `AsyncSession`) and an optional `limit` (defaulting to 10) to control how many top hooks are returned.
- **Repository Interaction:** Uses `InsightsRepository.aggregate_hook_performance(session)` to fetch aggregated hook performance data.
- **Data Transformation:** Constructs a list of `HookAnalysis` objects, each containing relevant statistics like video count and average views.
- **Sorting:** Sorts the hooks by their average views in descending order using a lambda function.
- **Response Construction:** Returns a `HookInsightsResponse` object with top hooks and total unique hooks.

**When/Why to Use:**
Use this method when you need to analyze and display the most effective hooks based on performance metrics. It's particularly useful for analytics dashboards or reports that require highlighting high-performing hooks.

**Patterns and Gotchas:**
- The use of list comprehensions and sorting is efficient but can be memory-intensive with large datasets.
- Ensure `AsyncSession` and `HookInsightsResponse` are correctly defined elsewhere in the codebase to avoid runtime errors.

---

*Generated by CodeWorm on 2026-02-27 19:44*
