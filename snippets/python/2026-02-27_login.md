# login

**Type:** Documentation
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/auth/routes/auth.py
**Language:** python
**Lines:** 52-70
**Complexity:** 1.0

---

## Source Code

```python
async def login(
    request: Request,
    response: Response,
    db: DBSession,
    ip: ClientIP,
    form_data: Annotated[OAuth2PasswordRequestForm,
                         Depends()],
) -> TokenWithUserResponse:
    """
    Login with email and password
    """
    result, refresh_token = await AuthService.login(
        db,
        email=form_data.username,
        password=form_data.password,
        ip_address=ip,
    )
    set_refresh_cookie(response, refresh_token)
    return result
```

---

## Documentation

### Documentation for `login` Function

**Purpose and Behavior:**
The `login` function handles user authentication using email and password. It asynchronously processes the request, validates credentials against a database via an `AuthService`, sets a refresh token cookie, and returns a `TokenWithUserResponse`.

**Key Implementation Details:**
- **Parameters:** 
  - `request`: The HTTP request object.
  - `response`: The HTTP response object.
  - `db`: A database session for querying user data.
  - `ip`: Client IP address for logging or security purposes.
  - `form_data`: OAuth2 password form data, provided by a dependency injection framework.

- **Return Type:** 
  - `TokenWithUserResponse`: Contains the authenticated token and user information.

- **Async Call:**
  - Calls `AuthService.login` to authenticate the user with email and password.

- **Cookie Management:**
  - Sets a refresh token cookie using `set_refresh_cookie`.

**When/Why to Use This Code:**
Use this function in authentication routes where users need to log in via their email and password. It encapsulates the logic for fetching credentials, authenticating them, and setting necessary cookies.

**Patterns/Gotchas:**
- **Dependency Injection:** The use of `Depends()` ensures that required dependencies like `form_data` are automatically provided.
- **Asynchronous Handling:** The function is marked as `async`, making it suitable for I/O-bound operations without blocking the event loop. Ensure all called functions and external services also support async to maintain efficiency.

This pattern is ideal for maintaining clean, modular code in asynchronous web applications.

---

*Generated by CodeWorm on 2026-02-27 19:09*
