# InsightsService.export_all_data

**Type:** Documentation
**Repository:** angelamos-operations
**File:** CarterOS-Server/src/aspects/analytics/facets/insights/service.py
**Language:** python
**Lines:** 418-462
**Complexity:** 4.0

---

## Source Code

```python
async def export_all_data(
        session: AsyncSession,
    ) -> ExportDataResponse:
        """Export all video data as JSON"""
        videos = await InsightsRepository.get_all_videos(session)

        video_dicts = [
            {
                "id": str(v.id),
                "rank": v.rank,
                "date_posted": v.date_posted.isoformat(),
                "video_url": v.video_url,
                "views": v.views,
                "comments": v.comments,
                "likes": v.likes,
                "bookmarks": v.bookmarks,
                "shares": v.shares,
                "avg_watch_time": v.avg_watch_time,
                "new_followers": v.new_followers,
                "watched_full_video_percentage": v.watched_full_video_percentage,
                "top_comment_words": v.top_comment_words,
                "search_queries": v.search_queries,
                "traffic_sources": v.traffic_sources,
                "hook": v.hook,
                "text_on_screen_hook": v.text_on_screen_hook,
                "length": v.length,
                "description": v.description,
                "hashtags": v.hashtags,
                "cta": v.cta,
                "full_transcription": v.full_transcription,
                "notes": v.notes,
                "created_at": v.created_at.isoformat() if v.created_at else None,
                "updated_at": v.updated_at.isoformat() if v.updated_at else None,
                # Calculated fields
                "engagement_rate": InsightsRepository.calculate_engagement_rate(v),
                "follower_conversion_rate": InsightsRepository.calculate_follower_conversion_rate(v),
            }
            for v in videos
        ]

        return ExportDataResponse(
            videos = video_dicts,
            total_count = len(video_dicts),
            export_date = datetime.utcnow().isoformat(),
        )
```

---

## Documentation

### Documentation for `export_all_data` Function

**Purpose and Behavior:**
The `export_all_data` function retrieves all video data from the database using an `AsyncSession`, processes each video into a dictionary, and returns it as an `ExportDataResponse` object. The response includes detailed metrics such as views, comments, likes, and calculated engagement rates.

**Key Implementation Details:**
- **Asynchronous Operation:** Uses `async def` to handle asynchronous operations efficiently.
- **Type Hints:** Clearly defines the type of `session` as `AsyncSession` and returns an `ExportDataResponse`.
- **List Comprehension:** Iterates over all retrieved videos, converting each one into a dictionary with detailed attributes.
- **Optional Fields:** Handles optional fields like `created_at` and `updated_at` by providing `None` if the field is missing.

**When/Why to Use:**
Use this function when you need to export comprehensive video analytics data for reporting or archival purposes. It ensures that all relevant metrics are included, making it suitable for detailed analysis.

**Patterns and Gotchas:**
- **Performance:** Ensure the database query (`get_all_videos`) is optimized to handle large datasets.
- **Error Handling:** Consider adding error handling around the `InsightsRepository` methods to manage potential failures gracefully.
- **Calculated Fields:** The function calculates engagement rates, which can be computationally intensive. Optimize these calculations if performance becomes an issue.

This function provides a robust way to export video insights while maintaining clarity and maintainability in its implementation.

---

*Generated by CodeWorm on 2026-02-27 18:11*
