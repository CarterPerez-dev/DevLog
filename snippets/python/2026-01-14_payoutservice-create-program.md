# PayoutService.create_program

**Repository:** stripe-referral
**File:** stripe-referral/src/stripe_referral/services/payout_service.py
**Language:** python
**Lines:** 69-115
**Complexity:** 4.0

---

## Source Code

```python
def create_program(
        db: Session,
        name: str,
        program_key: str,
        reward_amount: float,
        *,
        reward_currency: str = CurrencyCode.USD.value,
        reward_type: str = RewardType.ONE_TIME.value,
        adapter_type: str = AdapterType.MANUAL.value,
        max_rewards_per_user: int | None = None,
        conversion_window_days: int | None = None,
        adapter_config: dict[str,
                             Any] | None = None,
    ) -> ProgramInfo:
        """
        Create a new referral program
        """
        valid_adapter_types = [at.value for at in AdapterType]
        if adapter_type not in valid_adapter_types:
            raise InvalidRecipientDataError(
                f"Invalid adapter_type. Must be one of: {valid_adapter_types}",
                adapter_type = adapter_type,
            )

        program_repo = ReferralProgramRepository(db)

        program = program_repo.create(
            name = name,
            program_key = program_key,
            reward_amount = reward_amount,
            reward_currency = reward_currency,
            reward_type = reward_type,
            adapter_type = adapter_type,
            max_rewards_per_user = max_rewards_per_user,
            conversion_window_days = conversion_window_days,
            adapter_config = adapter_config or {},
        )

        return ProgramInfo(
            id = program.id,
            name = program.name,
            program_key = program.program_key,
            reward_amount = program.reward_amount,
            reward_currency = program.reward_currency,
            reward_type = program.reward_type,
            is_active = program.is_active,
        )
```

---

## Documentation

### Documentation for `create_program` Method

**Purpose and Behavior**
The `create_program` method in the `PayoutService` class is responsible for creating a new referral program with specified parameters. It validates the adapter type against predefined values, creates the program using a repository, and returns detailed information about the created program.

**Key Implementation Details**
- **Parameters**: The function accepts several required arguments (`db`, `name`, `program_key`, `reward_amount`) along with optional keyword arguments for additional configuration.
- **Validation**: It checks if the provided `adapter_type` is valid by comparing it against a list of allowed values.
- **Repository Interaction**: Uses `ReferralProgramRepository` to create and store the program details.
- **Return Value**: Returns an instance of `ProgramInfo` containing key attributes of the newly created program.

**When/Why to Use This Code**
Use this method when setting up new referral programs in your application. It ensures that all necessary parameters are correctly configured, including optional settings like currency and adapter type.

**Patterns and Gotchas**
- **Type Hints**: The use of type hints (`Session`, `str`, `float`) makes the function easier to understand and maintain.
- **Default Values**: Default values for optional arguments provide flexibility in program creation without requiring all parameters.
- **Validation Check**: The validation ensures that only valid adapter types are used, preventing runtime errors.

---

*Generated by CodeWorm on 2026-01-14 13:13*
