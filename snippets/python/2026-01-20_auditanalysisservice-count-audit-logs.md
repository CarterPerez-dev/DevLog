# AuditAnalysisService.count_audit_logs

**Repository:** CertGames-Core
**File:** backend/api/admin/domains/audit/services.py
**Language:** python
**Lines:** 148-186
**Complexity:** 11.0

---

## Source Code

```python
def count_audit_logs(
        *,
        start_date: datetime | None = None,
        end_date: datetime | None = None,
        action: str | None = None,
        user_id: str | None = None,
        admin_only: bool = False,
        success: bool | None = None
    ) -> int:
        """
        Count audit logs with filters
        """
        query_filter: dict[str, Any] = {}

        if start_date and end_date:
            query_filter['timestamp__gte'] = start_date
            query_filter['timestamp__lte'] = end_date
        elif start_date:
            query_filter['timestamp__gte'] = start_date

        if action:
            query_filter['action__icontains'] = action

        if user_id:
            try:
                if isinstance(user_id, str) and len(user_id) == 24:
                    ObjectId(user_id)
                    query_filter['user_id'] = user_id
            except (ValueError, TypeError):
                return 0

        if admin_only:
            query_filter['adminLogin'] = True

        if success is not None:
            query_filter['success'] = success

        count_result: int = AuditLog.objects(**query_filter).count()
        return count_result
```

---

## Documentation

### Documentation for `count_audit_logs` Function

**Purpose and Behavior**
The `count_audit_logs` function filters and counts audit logs based on provided parameters such as date range, action, user ID, admin status, and success/failure. It returns the count of matching records.

**Key Implementation Details**
- **Parameters**: Accepts optional filters for start/end dates (`start_date`, `end_date`), action (`action`), user ID (`user_id`), admin-only logs (`admin_only`), and success status (`success`).
- **Query Construction**: Constructs a query filter dictionary to apply various conditions dynamically.
- **Validation**: Validates the `user_id` format using `ObjectId` to ensure it is in the correct MongoDB format before inclusion in the query.

**When/Why to Use This Code**
Use this function when you need to generate reports or perform analytics on audit logs. It allows for flexible filtering based on various criteria, making it suitable for scenarios where detailed log analysis is required without a full database query.

**Patterns and Gotchas**
- **Type Hints**: Utilizes type hints for parameters like `datetime`, `str`, and `bool` to ensure clear function signatures.
- **Optional Parameters**: The use of optional parameters with default values (`None`) allows for flexible calling patterns, but remember that not providing a value will exclude it from the query.
- **Error Handling**: Validates `user_id` format using a try-except block, returning 0 if validation fails. Ensure robust error handling in your application to manage such cases gracefully.

This function is particularly useful when you need to quickly count logs without loading all records into memory, making it efficient for large datasets.

---

*Generated by CodeWorm on 2026-01-20 13:33*
