# sse_generator

**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/siem-dashboard/backend/app/core/streaming.py
**Language:** python
**Lines:** 94-125
**Complexity:** 7.0

---

## Source Code

```python
def sse_generator(
    stream_key: str,
    event_type: str = "message",
) -> Generator[str, None, None]:
    """
    Yield SSE-formatted events by tailing a Redis Stream with XREAD
    """
    r = get_redis()
    last_id = "$"
    while True:
        try:
            results = r.xread(
                {stream_key: last_id},
                count=settings.SSE_READ_COUNT,
                block=settings.SSE_BLOCK_MS,
            )
            if results:
                for _stream, entries in results:
                    for msg_id, fields in entries:
                        last_id = msg_id
                        payload = fields.get("payload", "{}")
                        yield (
                            f"event: {event_type}\n"
                            f"data: {payload}\n\n"
                        )
            else:
                yield ": keepalive\n\n"
        except GeneratorExit:
            return
        except Exception:
            time.sleep(1)
            yield ": reconnecting\n\n"
```

---

## Documentation

### Documentation for `sse_generator`

#### What it Does
The `sse_generator` function is designed to create Server-Sent Events (SSE) by tailing a Redis Stream using the `XREAD` command. It continuously reads from the specified stream and yields events in SSE format.

#### Why It Matters
This code is useful for real-time data streaming applications, such as monitoring systems or dashboards that need to display live updates without frequent page reloads. The generator pattern ensures efficient memory usage by yielding events one at a time.

#### Key Implementation Details
- **Redis Interaction**: Uses the `get_redis()` function to interact with Redis.
- **Event Loop**: Continuously reads from the stream, updating the last ID and yielding SSE-formatted messages.
- **Error Handling**: Handles exceptions gracefully, including reconnecting attempts after short delays.
- **Configuration**: Utilizes settings for block time and read count.

#### When/Why to Use
Use this code in scenarios where you need real-time data updates from a Redis Stream. It's particularly useful for building dynamic web applications that require push notifications or live data feeds.

#### Patterns and Gotchas
- **Generator Pattern**: Efficient for streaming large datasets without loading them all into memory.
- **Error Handling**: Robust error handling ensures the generator can recover from temporary issues, but be cautious about infinite loops in exception blocks.
- **Redis Configuration**: Ensure Redis settings like `SSE_READ_COUNT` and `SSE_BLOCK_MS` are appropriately configured for your use case.

---

*Generated by CodeWorm on 2026-02-05 20:14*
