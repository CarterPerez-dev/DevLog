# create_admin

**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/siem-dashboard/backend/app/cli.py
**Language:** python
**Lines:** 24-53
**Complexity:** 5.0

---

## Source Code

```python
def create_admin(username: str, email: str, password: str) -> None:
    """
    Create a new admin account or promote an existing user
    """
    existing = User.find_by_username(username)
    if existing is not None:
        if existing.role == UserRole.ADMIN:
            click.echo(f"User '{username}' is already an admin.")
            return
        existing.set_role(UserRole.ADMIN)
        click.echo(f"Promoted existing user '{username}' to admin.")
        return

    existing_email = User.find_by_email(email)
    if existing_email is not None:
        if existing_email.role == UserRole.ADMIN:
            click.echo(f"User with email '{email}' is already an admin.")
            return
        existing_email.set_role(UserRole.ADMIN)
        click.echo(f"Promoted existing user '{existing_email.username}' to admin.")
        return

    hashed = hash_password(password)
    User.create_user(
        username = username,
        email = email,
        password_hash = hashed,
        role = UserRole.ADMIN,
    )
    click.echo(f"Admin account '{username}' created successfully.")
```

---

## Documentation

### Purpose and Behavior

The `create_admin` function in the `cli.py` file is designed to create or promote an existing user to an admin role. It checks if a user with the provided username or email already exists and has the admin role. If not, it either promotes the existing user or creates a new admin account.

### Key Implementation Details

- **Type Hints**: The function uses type hints for parameters (`username`, `email`, `password`) and return type (None).
- **User Management**: Utilizes methods from the `User` class to find users by username or email, set their role, and create new users.
- **Password Hashing**: Passwords are hashed before creating a new admin account using the `hash_password` function.
- **Click Integration**: Uses `click` for command-line interface options like `--username`, `--email`, and `--password`.

### When/Why to Use This Code

This code is used in a CLI application where administrators need to manage user roles. It ensures that only authorized users can be promoted or created as admins, maintaining security. The function should be called when an admin needs to add new administrative privileges or promote existing users.

### Patterns and Gotchas

- **Role-Based Access Control (RBAC)**: This function enforces RBAC principles by checking user roles before granting admin access.
- **Password Security**: Passwords are securely hashed, but ensure that `hash_password` is implemented correctly to avoid security vulnerabilities.
- **Duplicate User Handling**: The function handles both username and email checks, preventing accidental duplication of admin accounts.

---

*Generated by CodeWorm on 2026-02-08 16:14*
