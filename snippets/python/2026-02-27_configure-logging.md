# configure_logging

**Type:** Documentation
**Repository:** CodeWorm
**File:** codeworm/core/logging.py
**Language:** python
**Lines:** 16-62
**Complexity:** 5.0

---

## Source Code

```python
def configure_logging(
    json_mode: bool | None = None,
    debug: bool = False,
    redis_url: str = "",
) -> None:
    """
    Configure structlog for the daemon
    Auto-detects JSON mode based on TTY if not specified
    """
    if json_mode is None:
        json_mode = not sys.stderr.isatty()

    log_level = logging.DEBUG if debug else logging.INFO

    shared_processors: list[structlog.types.Processor] = [
        structlog.contextvars.merge_contextvars,
        structlog.processors.add_log_level,
        structlog.processors.TimeStamper(fmt = "iso",
                                         utc = True),
        structlog.processors.StackInfoRenderer(),
        structlog.processors.format_exc_info,
    ]

    if redis_url:
        from codeworm.core.events import init_publisher, redis_log_processor

        init_publisher(redis_url)
        shared_processors.append(redis_log_processor)

    if json_mode:
        processors = [
            *shared_processors,
            structlog.processors.JSONRenderer(serializer = _json_serializer),
        ]
    else:
        processors = [
            *shared_processors,
            structlog.dev.ConsoleRenderer(colors = True),
        ]

    structlog.configure(
        processors = processors,
        wrapper_class = structlog.make_filtering_bound_logger(log_level),
        context_class = dict,
        logger_factory = structlog.PrintLoggerFactory(),
        cache_logger_on_first_use = True,
    )
```

---

## Documentation

### Documentation for `configure_logging`

**Purpose and Behavior:**
The `configure_logging` function sets up the structlog logging library in a daemon application. It configures log levels, processors, and outputs based on input parameters such as JSON mode, debug status, and Redis URL.

**Key Implementation Details:**
- **Auto-detection of JSON Mode:** If not specified, it detects whether to use JSON mode by checking if the standard error stream is a terminal.
- **Shared Processors:** Common log processors are defined in `shared_processors` and can be extended with additional processors like `redis_log_processor` based on the provided Redis URL.
- **Conditional Log Renderers:** Depending on the `json_mode`, it configures either JSON or console renderers for the logs.

**When/Why to Use:**
Use this function when setting up structured logging in a Python daemon application. It provides flexibility by allowing configuration of log levels, processors, and output formats based on environment settings.

**Patterns/Gotchas:**
- **Conditional Imports:** The `redis_log_processor` import is conditional, which can be useful for lazy loading but may lead to runtime errors if the Redis URL is provided without the necessary imports.
- **Processor Composition:** Using a combination of shared processors and conditionally added processors allows for flexible logging configurations.

---

*Generated by CodeWorm on 2026-02-27 22:07*
