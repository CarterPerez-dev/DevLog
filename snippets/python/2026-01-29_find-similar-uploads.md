# find_similar_uploads

**Repository:** vuemantics
**File:** backend/routers/v1/search.py
**Language:** python
**Lines:** 132-170
**Complexity:** 3.0

---

## Source Code

```python
async def find_similar_uploads(
    request: Request,
    upload: Annotated[Upload,
                      Depends(verify_upload_ownership)],
    current_user: Annotated[User,
                            Depends(get_current_user)],
    limit: Annotated[int,
                     Query(ge = 1,
                           le = 50)] = 10,
    include_own: Annotated[
        bool,
        Query(description = "Include your own uploads")] = True,
) -> list[SearchResult]:
    """
    Find uploads similar to a specific upload.

    Uses the embedding of the specified upload to find
    other semantically similar uploads.
    """
    if not upload.embedding_local:
        raise ValidationError("Upload has not been processed yet")

    try:
        # Find similar uploads
        results = await search_service.find_similar_uploads(
            upload = upload,
            user_id = current_user.id,
            limit = limit,
        )

        logger.info(
            f"Found {len(results)} similar uploads for {upload.id}"
        )

        return results

    except Exception as e:
        logger.error(f"Similar search failed: {e}")
        raise
```

---

## Documentation

### Documentation for `find_similar_uploads`

**Purpose and Behavior:**
The function `find_similar_uploads` is an asynchronous endpoint in the backend API that searches for semantically similar uploads based on the embedding of a given upload. It requires authentication to ensure the current user has ownership over the specified upload.

**Key Implementation Details:**
- **Dependencies:** Utilizes `Depends` to validate the request, verify upload ownership, and get the current user.
- **Query Parameters:** Accepts optional parameters for limiting results (`limit`) and including own uploads (`include_own`).
- **Error Handling:** Raises a `ValidationError` if the specified upload has not been processed yet. Logs errors using `logger`.
- **Search Service:** Delegates the search logic to an external service via `search_service.find_similar_uploads`.

**When/Why to Use:**
This function is used in scenarios where users need to find similar content within their uploads or others'. It ensures that only authenticated and authorized users can access this functionality, enhancing security.

**Patterns and Gotchas:**
- **Dependency Injection:** Proper use of `Depends` for validation.
- **Rate Limiting:** The endpoint is rate-limited using `@limiter.limit`, which helps prevent abuse.
- **Error Logging:** Comprehensive error handling with logging ensures issues are tracked effectively.

---

*Generated by CodeWorm on 2026-01-29 11:43*
