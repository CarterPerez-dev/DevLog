# BaseScanner.make_request

**Repository:** Cybersecurity-Projects
**File:** PROJECTS/api-security-scanner/backend/scanners/base_scanner.py
**Language:** python
**Lines:** 104-179
**Complexity:** 8.0

---

## Source Code

```python
def make_request(
        self,
        method: str,
        endpoint: str,
        **kwargs: Any,
    ) -> requests.Response:
        """
        Make HTTP request with retry logic and rate limit handling

        Implements exponential backoff for server errors and respects
        Retry-After headers for 429 responses.

        Args:
            method: HTTP method (GET, POST, etc.)
            endpoint: Endpoint path (will be joined with target_url)
            **kwargs: Additional arguments passed to requests

        Returns:
            requests.Response: Response object

        Raises:
            requests.RequestException: If request fails after retries
        """
        self._wait_before_request()

        url = urljoin(self.target_url, endpoint)
        retry_count = 0
        backoff_factor = 2.0

        kwargs.setdefault(
            "timeout",
            settings.SCANNER_CONNECTION_TIMEOUT
        )

        while retry_count <= settings.DEFAULT_RETRY_COUNT:
            try:
                start_time = time.time()
                response = self.session.request(method, url, **kwargs)
                setattr(
                    response,
                    "request_time",
                    time.time() - start_time
                )

                self.request_count += 1

                if response.status_code == 429:
                    retry_after = response.headers.get(
                        "Retry-After",
                        str(settings.DEFAULT_RETRY_WAIT_SECONDS)
                    )
                    wait_time = (
                        int(retry_after) if retry_after.isdigit() else
                        settings.DEFAULT_RETRY_WAIT_SECONDS
                    )
                    time.sleep(wait_time)
                    retry_count += 1
                    continue

                if response.status_code >= 500 and retry_count < settings.DEFAULT_RETRY_COUNT:
                    wait_time = backoff_factor**retry_count
                    time.sleep(wait_time)
                    retry_count += 1
                    continue

                return response

            except (requests.Timeout, requests.ConnectionError):
                if retry_count < settings.DEFAULT_RETRY_COUNT:
                    wait_time = backoff_factor**retry_count
                    time.sleep(wait_time)
                    retry_count += 1
                else:
                    raise

        return response
```

---

## Documentation

### Documentation for `BaseScanner.make_request`

**Purpose and Behavior:**
The `make_request` method in the `BaseScanner` class handles HTTP requests with retry logic and rate limit handling. It implements exponential backoff for server errors (500 range) and respects `Retry-After` headers for 429 responses, ensuring robustness against temporary service issues.

**Key Implementation Details:**
- **Exponential Backoff:** Retries are attempted with increasing delays (`backoff_factor`) until the maximum retry count is reached.
- **Rate Limit Handling:** For 429 responses, it waits according to `Retry-After` headers or a default wait time.
- **Timeout Setting:** Sets a timeout for requests if not provided in `kwargs`.
- **Timing and Counting:** Tracks request times and increments the total request count.

**When/Why to Use:**
This method is essential for making reliable HTTP requests, especially when dealing with APIs that may experience temporary outages or rate limiting. It ensures that the scanner can handle transient errors gracefully without failing prematurely.

**Patterns and Gotchas:**
- **Retry Logic:** The retry mechanism is designed to be flexible but can lead to long delays if not configured properly.
- **Backoff Factor:** Adjusting `backoff_factor` can impact performance; a higher value results in longer wait times between retries.
- **Rate Limit Handling:** Ensure that the `Retry-After` header is correctly handled by setting appropriate default values.

---

*Generated by CodeWorm on 2026-01-17 17:50*
