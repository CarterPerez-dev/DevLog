# get_languages

**Type:** Documentation
**Repository:** CodeWorm
**File:** dashboard/backend/api.py
**Language:** python
**Lines:** 221-255
**Complexity:** 4.0

---

## Source Code

```python
async def get_languages() -> list[LanguageBreakdown]:
    db = _get_db_path()
    if not db.exists():
        return []

    with _get_conn() as conn:
        total = conn.execute(
            "SELECT COUNT(*) FROM documented_snippets"
        ).fetchone()[0]

        if total == 0:
            return []

        rows = conn.execute(
            "SELECT "
            "CASE "
            "  WHEN source_file LIKE '%.py' THEN 'python' "
            "  WHEN source_file LIKE '%.ts' THEN 'typescript' "
            "  WHEN source_file LIKE '%.tsx' THEN 'tsx' "
            "  WHEN source_file LIKE '%.js' THEN 'javascript' "
            "  WHEN source_file LIKE '%.go' THEN 'go' "
            "  WHEN source_file LIKE '%.rs' THEN 'rust' "
            "  ELSE 'other' "
            "END AS lang, COUNT(*) AS cnt "
            "FROM documented_snippets GROUP BY lang ORDER BY cnt DESC"
        ).fetchall()

    return [
        LanguageBreakdown(
            language=row["lang"],
            count=row["cnt"],
            percentage=round(row["cnt"] / total * 100, 1),
        )
        for row in rows
    ]
```

---

## Documentation

### Documentation for `get_languages` Function

**Purpose and Behavior:**
The `get_languages` function retrieves a breakdown of programming languages used in documented snippets from a database. It returns a list of `LanguageBreakdown` objects, each containing the language name, count, and percentage of total snippets.

**Key Implementation Details:**
- The function is asynchronous (`async`) and returns a list of `LanguageBreakdown`.
- It first checks if the database exists; if not, it returns an empty list.
- Using a context manager (`_get_conn()`) ensures proper connection handling.
- SQL queries are used to count total snippets and categorize them by language.

**When/Why to Use This Code:**
Use this function when you need to analyze the distribution of programming languages in your codebase. It helps in identifying which languages are most prevalent, aiding in decision-making for future development or maintenance tasks.

**Patterns and Gotchas:**
- The use of `CASE` statement in SQL is a common pattern for conditional logic.
- Ensure that the database connection function `_get_conn()` is correctly implemented to avoid runtime errors.
- The `round(row["cnt"] / total * 100, 1)` calculation ensures percentages are rounded to one decimal place.

---

*Generated by CodeWorm on 2026-02-27 23:39*
