# run

**Type:** Documentation
**Repository:** CodeWorm
**File:** codeworm/cli.py
**Language:** python
**Lines:** 59-103
**Complexity:** 8.0

---

## Source Code

```python
def run(
    ctx: click.Context,
    devlog: Path | None,
    repo: tuple,
    dry_run: bool
) -> None:
    """
    Run the CodeWorm daemon with scheduler
    """
    from codeworm.daemon import CodeWormDaemon

    overrides = {"debug": ctx.obj["debug"]}

    if devlog:
        overrides["devlog"] = {"repo_path": devlog}

    if repo:
        repos = [
            {
                "name": name,
                "path": Path(path),
                "weight": 5
            } for name, path in repo
        ]
        overrides["repos"] = repos

    settings = load_settings(config_dir = ctx.obj["config_dir"], **overrides)
    redis_url = settings.dashboard.redis.connection_url if settings.dashboard.redis.enabled else ""
    configure_logging(debug = settings.debug, redis_url = redis_url)

    if not settings.repos:
        console.print("[red]Error:[/red] No repositories configured")
        console.print("Add repos to config/repos.yaml or use --repo NAME PATH")
        raise SystemExit(1)

    mode = "[yellow][DRY RUN][/yellow] " if dry_run else ""
    console.print(f"{mode}[bold green]Starting CodeWorm[/bold green]")
    console.print(f"  DevLog: {settings.devlog.repo_path}")
    console.print(f"  Repos: {len(settings.repos)}")
    console.print(f"  Ollama: {settings.ollama.base_url}")
    if redis_url:
        console.print(f"  Redis: {redis_url}")

    daemon = CodeWormDaemon(settings, dry_run = dry_run)
    daemon.run()
```

---

## Documentation

### Documentation for `run` Function

**Purpose and Behavior:**
The `run` function initializes and starts the CodeWorm daemon with optional configuration overrides, logging setup, and repository validation. It handles command-line arguments like `devlog`, `repo`, and `dry_run`.

**Key Implementation Details:**
- **Context Handling:** Uses a `click.Context` object to access application state.
- **Override Configuration:** Dynamically updates settings based on provided CLI options.
- **Logging and Error Handling:** Configures logging with debug level and prints startup messages. Exits if no repositories are configured.
- **Daemon Initialization:** Creates an instance of `CodeWormDaemon` and starts it.

**When/Why to Use:**
Use this function when starting the CodeWorm daemon from a command line, allowing for flexible configuration via CLI options such as specifying development logs (`devlog`), repository paths (`repo`), or running in dry-run mode. It ensures that necessary configurations are validated before starting the daemon.

**Patterns and Gotchas:**
- **Type Hints:** Utilizes type hints for parameters like `Path | None`, ensuring robustness.
- **Context Managers:** Implicitly uses context managers through `click.Context`.
- **Error Handling:** Gracefully exits with an error message if no repositories are configured, preventing daemon startup without necessary data.

---

*Generated by CodeWorm on 2026-02-18 08:14*
