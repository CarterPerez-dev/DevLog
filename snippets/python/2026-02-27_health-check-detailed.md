# health_check_detailed

**Type:** Documentation
**Repository:** my-portfolio
**File:** v1/backend/app/core/health_routes.py
**Language:** python
**Lines:** 49-80
**Complexity:** 5.0

---

## Source Code

```python
async def health_check_detailed() -> HealthDetailedResponse:
    """
    Detailed health check including database connectivity
    """
    db_status = HealthStatus.UNHEALTHY
    redis_status = None

    try:
        async with sessionmanager.connect() as conn:
            await conn.execute(text("SELECT 1"))
            db_status = HealthStatus.HEALTHY
    except Exception:
        db_status = HealthStatus.UNHEALTHY

    if settings.REDIS_URL:
        try:
            r = redis.from_url(str(settings.REDIS_URL))
            await r.ping()
            redis_status = HealthStatus.HEALTHY
            await r.close()
        except Exception:
            redis_status = HealthStatus.UNHEALTHY

    overall = HealthStatus.HEALTHY if db_status == HealthStatus.HEALTHY else HealthStatus.DEGRADED

    return HealthDetailedResponse(
        status = overall,
        environment = settings.ENVIRONMENT.value,
        version = settings.APP_VERSION,
        database = db_status,
        redis = redis_status,
    )
```

---

## Documentation

### Documentation for `health_check_detailed`

**Purpose and Behavior:**
The function `health_check_detailed` performs a detailed health check of the application, including database connectivity and Redis status. It returns an object with the overall health status, environment details, version number, and specific statuses for the database and Redis.

**Key Implementation Details:**
- The function is asynchronous (`async`) and returns a `HealthDetailedResponse` object.
- It uses a context manager (`sessionmanager.connect()`) to connect to the database and execute a simple query to check connectivity.
- A separate connection to Redis is established if the `REDIS_URL` setting is provided, using the `redis.from_url()` method.
- The overall health status is determined based on the database status; if the database is unhealthy, the overall status is marked as `DEGRADED`.

**When/Why to Use This Code:**
This function should be used in a monitoring or maintenance context where detailed health checks are required. It ensures that both the database and Redis services are operational before considering the application healthy.

**Patterns and Gotchas:**
- The use of `async with` for database connection management is Pythonic and efficient.
- Error handling is minimal, catching all exceptions without specifying types, which might hide specific issues.
- The function assumes that `HealthStatus`, `HealthDetailedResponse`, `settings.ENVIRONMENT`, and `settings.APP_VERSION` are defined elsewhere in the codebase.

---

*Generated by CodeWorm on 2026-02-27 19:50*
