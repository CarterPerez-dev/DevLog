# get_activity

**Type:** Documentation
**Repository:** CodeWorm
**File:** dashboard/backend/api.py
**Language:** python
**Lines:** 201-217
**Complexity:** 3.0

---

## Source Code

```python
async def get_activity(
    days: int = Query(default=90, ge=1, le=365),
) -> list[ActivityDay]:
    db = _get_db_path()
    if not db.exists():
        return []

    with _get_conn() as conn:
        rows = conn.execute(
            "SELECT date(documented_at) AS day, COUNT(*) AS cnt "
            "FROM documented_snippets "
            "WHERE documented_at > datetime('now', ?) "
            "GROUP BY day ORDER BY day",
            (f"-{days} days",),
        ).fetchall()

    return [ActivityDay(date=row["day"], count=row["cnt"]) for row in rows]
```

---

## Documentation

### Documentation for `get_activity` Function

**Purpose and Behavior:**
The `get_activity` function retrieves activity statistics from a database over the last `days` period, returning a list of `ActivityDay` objects. It filters snippets documented in the past 90 to 365 days and groups them by date.

**Key Implementation Details:**
- **Query Parameter:** The `days` parameter is an integer query parameter with default value 90, allowing a range between 1 and 365.
- **Database Interaction:** Uses a context manager `_get_conn()` to ensure proper handling of database connections.
- **SQL Query:** Selects dates from the `documented_snippets` table where the `documented_at` timestamp is within the last `days` period, grouping results by date and counting occurrences.

**When/Why to Use:**
Use this function in scenarios requiring activity analysis over a configurable time frame. It's ideal for tracking user engagement or snippet documentation trends.

**Patterns and Gotchas:**
- **Type Hints:** The use of type hints (`-> list[ActivityDay]`) ensures clear expectations about the return type.
- **Parameter Validation:** The `days` parameter is validated to ensure it falls within a reasonable range, preventing potential SQL injection by limiting the date range dynamically.
- **Database Connection Management:** Context managers are used for safe and efficient database operations.

---

*Generated by CodeWorm on 2026-02-27 23:34*
