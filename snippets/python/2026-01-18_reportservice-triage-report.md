# ReportService.triage_report

**Repository:** Cybersecurity-Projects
**File:** PROJECTS/bug-bounty-platform/backend/app/report/service.py
**Language:** python
**Lines:** 260-296
**Complexity:** 9.0

---

## Source Code

```python
async def triage_report(
        self,
        user: User,
        report_id: UUID,
        triage_data: ReportTriageUpdate,
    ) -> ReportResponse:
        """
        Triage a report (program owner only)
        """
        report = await ReportRepository.get_by_id(self.session, report_id)
        if not report:
            raise ReportNotFound(str(report_id))

        program = await ProgramRepository.get_by_id(
            self.session,
            report.program_id
        )
        if not program or program.company_id != user.id:
            raise NotProgramOwner()

        update_dict = triage_data.model_dump(exclude_unset = True)

        if "status" in update_dict:
            new_status = update_dict["status"]
            if new_status == ReportStatus.TRIAGING and report.triaged_at is None:
                report.mark_triaging()
            elif new_status == ReportStatus.RESOLVED:
                report.mark_resolved()
            elif new_status == ReportStatus.DISCLOSED:
                report.mark_disclosed()

        updated = await ReportRepository.update(
            self.session,
            report,
            **update_dict,
        )
        return ReportResponse.model_validate(updated)
```

---

## Documentation

### Documentation for `triage_report` Method

**Purpose and Behavior:**
The `triage_report` method is an asynchronous function that processes a report triage request, ensuring only program owners can modify reports. It updates the report's status based on provided data and returns a validated response.

**Key Implementation Details:**
1. **User Authentication:** The method checks if the user is authorized to triage the report by verifying their company ID against the programâ€™s company ID.
2. **Report Retrieval:** It fetches the report using `ReportRepository.get_by_id`.
3. **Status Updates:** Depending on the new status, it calls specific methods like `mark_triaging`, `mark_resolved`, or `mark_disclosed` to update the report's state.
4. **Validation and Response:** After updating, it returns a validated `ReportResponse`.

**When/Why to Use:**
Use this method when you need to triage reports in your application, ensuring only authorized users can make changes. It handles status updates and validation efficiently.

**Patterns/Gotchas:**
- **Asynchronous Handling:** The function is designed for asynchronous operations, making it suitable for I/O-bound tasks.
- **Data Validation:** Using `model_dump(exclude_unset=True)` ensures that only provided data fields are updated, preventing accidental overwrites.
- **Repository Pattern:** Leverages repository methods for database interactions, promoting separation of concerns and testability.

---

*Generated by CodeWorm on 2026-01-18 00:23*
