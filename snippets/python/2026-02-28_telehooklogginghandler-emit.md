# TelehookLoggingHandler.emit

**Type:** Documentation
**Repository:** Telehook
**File:** src/telehook/adapters/logging_handler.py
**Language:** python
**Lines:** 18-37
**Complexity:** 5.0

---

## Source Code

```python
def emit(self, record: logging.LogRecord) -> None:
        try:
            if record.exc_info and record.exc_info[1]:
                text = error_formatter(
                    exception = record.exc_info[1],
                    component = record.name,
                )
            else:
                text = (
                    f"\u26a0\ufe0f <b>{record.levelname}: {record.name}</b>"
                    f"\n\n<code>{record.getMessage()}</code>"
                )

            try:
                loop = asyncio.get_running_loop()
                loop.create_task(self._notifier.send(text))
            except RuntimeError:
                self._notifier.send_sync(text)
        except Exception:
            self.handleError(record)
```

---

## Documentation

### Documentation for `emit` Method in `TelehookLoggingHandler`

**Purpose and Behavior:**
The `emit` method processes log records by formatting them into a string based on the presence of an exception. It then schedules sending this formatted message using either an asyncio loop or a synchronous send, depending on whether an event loop is currently running.

**Key Implementation Details:**
- **Type Hints:** The method accepts a `logging.LogRecord` and returns `None`.
- **Conditional Formatting:** If the log record contains exception information, it uses `error_formatter`. Otherwise, it formats the message with level name and component.
- **Asynchronous Handling:** It attempts to use an asyncio loop to send the message asynchronously. If no running event loop is found (`RuntimeError`), it falls back to synchronous sending.

**When/Why to Use:**
This method should be used in logging handlers where asynchronous notifications are desired, particularly when integrating with systems like Telegram for real-time alerts. It ensures that log messages are sent efficiently without blocking the main application flow.

**Patterns and Gotchas:**
- **Error Handling:** The `try-except` block around sending the message is crucial to handle cases where the event loop might not be running.
- **Asynchronous vs Synchronous:** The method gracefully handles both scenarios, ensuring that notifications are sent even if an event loop isn't available.

---

*Generated by CodeWorm on 2026-02-28 19:07*
