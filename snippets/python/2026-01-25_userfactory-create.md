# UserFactory.create

**Repository:** my-portfolio
**File:** v1/backend/conftest.py
**Language:** python
**Lines:** 124-148
**Complexity:** 4.0

---

## Source Code

```python
async def create(
        cls,
        session: AsyncSession,
        *,
        email: str | None = None,
        password: str = "TestPass123",
        full_name: str | None = None,
        role: UserRole = UserRole.USER,
        is_active: bool = True,
        is_verified: bool = True,
    ) -> User:
        cls._counter += 1

        user = User(
            email = email or f"user{cls._counter}@test.com",
            hashed_password = await hash_password(password),
            full_name = full_name or f"Test User {cls._counter}",
            role = role,
            is_active = is_active,
            is_verified = is_verified,
        )
        session.add(user)
        await session.flush()
        await session.refresh(user)
        return user
```

---

## Documentation

### Documentation for `UserFactory.create`

**Purpose and Behavior**
The `create` method is a class method that asynchronously creates an instance of the `User` class within a database session. It sets default values for certain parameters, such as `password`, `full_name`, and `email`. The method increments a counter to generate unique email addresses if not provided.

**Key Implementation Details**
- **Class Method**: Uses `@classmethod` decorator.
- **Session Management**: Operates on an `AsyncSession` object passed as an argument. Ensures the user is saved, flushed, and refreshed within the session before returning it.
- **Default Values**: Provides default values for parameters like `password`, `full_name`, and `email`. Generates a unique email if none is provided.

**When/Why to Use This Code**
Use this method when you need to create test users in an asynchronous context. It simplifies user creation by handling common defaults, making it ideal for testing or initializing databases with sample data.

**Patterns and Gotchas**
- **Session Management**: Ensure the `AsyncSession` is properly managed outside of this method.
- **Counter Logic**: The `_counter` attribute is class-level, which might lead to issues if multiple instances of the factory are created. Consider using a static method or an external counter for better isolation.

This method encapsulates user creation logic, making it reusable and maintainable while abstracting away the complexity of session management.

---

*Generated by CodeWorm on 2026-01-25 12:58*
