# download_csic

**Type:** Documentation
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/advanced/ai-threat-detection/backend/ml/download_csic.py
**Language:** python
**Lines:** 41-103
**Complexity:** 8.0

---

## Source Code

```python
def download_csic(output_dir: Path = DATASET_DIR, ) -> None:
    """
    Download CSIC 2010 dataset files
    """
    output_dir.mkdir(parents=True, exist_ok=True)

    for filename in FILES:
        dest = output_dir / filename

        if dest.exists() and dest.stat().st_size > MIN_FILE_BYTES:
            logger.info("Skipping %s (already exists)", filename)
            continue

        url = f"{BASE_URL}/{filename}"
        logger.info("Downloading %s", url)
        print(f"Downloading {filename}...")

        try:
            with httpx.stream(
                "GET",
                url,
                follow_redirects=True,
            ) as response:
                response.raise_for_status()
                total = int(
                    response.headers.get("content-length", 0)
                )
                downloaded = 0
                with open(dest, "wb") as f:
                    for chunk in response.iter_bytes(
                        chunk_size=65536
                    ):
                        f.write(chunk)
                        downloaded += len(chunk)
                        if total > 0:
                            pct = min(
                                downloaded * 100 / total, 100
                            )
                            sys.stdout.write(f"\r  {pct:.0f}%")
                        else:
                            mb = downloaded / 1_048_576
                            sys.stdout.write(f"\r  {mb:.1f} MB")
                        sys.stdout.flush()
            print()
        except Exception as exc:
            logger.error(
                "Failed to download %s: %s",
                filename,
                exc,
            )
            print(f"\nError downloading {filename}: {exc}")
            continue

        size = dest.stat().st_size
        sha = _compute_sha256(dest)
        print(f"  Saved: {dest}"
              f" ({size:,} bytes, sha256={sha[:12]})")

        if size < MIN_FILE_BYTES:
            print(f"  WARNING: {filename} is suspiciously"
                  f" small ({size:,} bytes)")

    print(f"\nDataset directory: {output_dir.resolve()}")
```

---

## Documentation

### Documentation for `download_csic`

**Purpose and Behavior:**
The `download_csic` function downloads the CSIC 2010 dataset files into a specified directory. It checks if each file already exists and is of sufficient size before downloading, logging relevant information throughout the process.

**Key Implementation Details:**
- **Logging:** Uses Python’s built-in `logging` module to log actions and errors.
- **HTTP Requests:** Utilizes the `httpx` library for making HTTP GET requests, handling redirects, and streaming responses in chunks.
- **File Handling:** Writes downloaded content directly to files using binary mode (`wb`) and updates progress via terminal output.
- **Error Handling:** Catches exceptions during download and logs errors, ensuring the function continues processing other files.

**When/Why to Use:**
Use this code when you need to automate the downloading of a specific dataset for machine learning projects or research. It ensures that only necessary files are downloaded by checking their existence and size, making it efficient in terms of network usage and storage.

**Patterns/Gotchas:**
- **Progress Bar:** The progress bar updates using `sys.stdout.write` and `flush`, which can interfere with other terminal output.
- **Error Logging:** Detailed error logging helps in debugging issues but may clutter the console if not redirected properly.
- **Dependencies:** Ensure `httpx` is installed (`pip install httpx`) as it’s required for making HTTP requests.

---

*Generated by CodeWorm on 2026-02-28 16:12*
