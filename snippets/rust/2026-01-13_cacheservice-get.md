# CacheService.get

**Repository:** kill-pr0cess.inc
**File:** backend/src/services/cache_service.rs
**Language:** rust
**Lines:** 149-208
**Complexity:** 9.0

---

## Source Code

```rust
pub async fn get<T>(&self, key: &str) -> Result<Option<T>>
    where
    T: DeserializeOwned + Send + Sync + Serialize,
    {
        let full_key = self.build_key(key);
        let mut conn = self.get_connection().await?;

        debug!("Cache GET: {}", full_key);

        match conn.get::<_, Option<String>>(&full_key).await {
            Ok(Some(cached_data)) => {
                match serde_json::from_str::<CacheEntry<T>>(&cached_data) {
                    Ok(mut entry) => {
                        let now = self.current_timestamp();

                        // Check if entry has expired
                        if now > entry.expires_at {
                            debug!("Cache entry expired: {}", full_key);
                            // Asynchronously delete expired entry
                            let _ = self.delete(key).await; // Use existing delete method
                            return Ok(None);
                        }

                        // Update access metadata
                        entry.access_count += 1;
                        entry.last_accessed = now;

                        // Update entry in cache (fire and forget, but handle potential errors)
                        let updated_data_res = serde_json::to_string(&entry);
                        if let Ok(updated_data) = updated_data_res {
                           let set_result = conn.set::<_, _, ()>(&full_key, updated_data).await;
                           if let Err(e) = set_result {
                               warn!("Failed to update access metadata for cache key {}: {}", full_key, e);
                           }
                        } else if let Err(e) = updated_data_res {
                             warn!("Failed to serialize updated metadata for cache key {}: {}", full_key, e);
                        }


                        debug!("Cache HIT: {}", full_key);
                        Ok(Some(entry.data))
                    }
                    Err(e) => {
                        warn!("Failed to deserialize cache entry {}: {}", full_key, e);
                        // Delete corrupted entry
                        let _ = self.delete(key).await;
                        Ok(None)
                    }
                }
            }
            Ok(None) => {
                debug!("Cache MISS: {}", full_key);
                Ok(None)
            }
            Err(e) => {
                error!("Cache GET error for {}: {}", full_key, e);
                Err(AppError::CacheError(format!("Failed to get cache entry: {}", e)))
            }
        }
    }
```

---

## Documentation

### Documentation for `CacheService.get`

**Purpose and Behavior:**
The `get` function retrieves a cached entry from the cache service, deserializes it, and updates its metadata if valid. If the entry has expired or is corrupted, it deletes the entry and returns `None`.

**Key Implementation Details:**
- **Async Operations:** The function uses asynchronous operations to handle cache interactions.
- **Type Constraints:** The type `T` must implement `DeserializeOwned`, `Send`, `Sync`, and `Serialize`.
- **Error Handling:** It gracefully handles various errors, such as deserialization failures or cache retrieval issues.
- **Metadata Update:** If the entry is valid and not expired, it updates access metadata and re-saves the entry.

**When/Why to Use:**
Use this function when you need to fetch cached data with automatic expiration handling and metadata updates. It ensures that stale entries are removed and keeps the cache fresh.

**Patterns/Gotchas:**
- **Ownership and Borrowing:** The `self` parameter is borrowed, allowing multiple calls without additional overhead.
- **Asynchronous Operations:** Ensure your environment supports async/await for smooth execution.
- **Error Propagation:** Be prepared to handle potential errors from cache operations and serialization/deserialization.

---

*Generated by CodeWorm on 2026-01-13 18:30*
