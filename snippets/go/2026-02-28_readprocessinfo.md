# readProcessInfo

**Type:** Documentation
**Repository:** Yoshi-Audit
**File:** internal/system/process.go
**Language:** go
**Lines:** 52-110
**Complexity:** 15.0

---

## Source Code

```go
func readProcessInfo(pid int) (ProcessInfo, error) {
	info := ProcessInfo{PID: pid}

	statusPath := fmt.Sprintf("/proc/%d/status", pid)
	f, err := os.Open(statusPath)
	if err != nil {
		return ProcessInfo{}, err
	}
	defer f.Close()

	scanner := bufio.NewScanner(f)
	for scanner.Scan() {
		line := scanner.Text()
		parts := strings.SplitN(line, ":", 2)
		if len(parts) != 2 {
			continue
		}

		key := strings.TrimSpace(parts[0])
		val := strings.TrimSpace(parts[1])

		switch key {
		case "Name":
			info.Name = val
		case "State":
			fields := strings.Fields(val)
			if len(fields) > 0 {
				info.State = fields[0]
			}
		case "PPid":
			ppid, parseErr := strconv.Atoi(val)
			if parseErr == nil {
				info.PPID = ppid
			}
		case "VmRSS":
			valStr := strings.TrimSuffix(val, " kB")
			valStr = strings.TrimSpace(valStr)
			rss, parseErr := strconv.ParseUint(valStr, 10, 64)
			if parseErr == nil {
				info.RSS = rss * 1024
			}
		}
	}

	cmdlinePath := fmt.Sprintf("/proc/%d/cmdline", pid)
	data, err := os.ReadFile(cmdlinePath)
	if err == nil && len(data) > 0 {
		args := strings.Split(string(data), "\x00")
		var cleaned []string
		for _, a := range args {
			if a != "" {
				cleaned = append(cleaned, a)
			}
		}
		info.Cmdline = strings.Join(cleaned, " ")
	}

	return info, nil
}
```

---

## Documentation

### Documentation for `readProcessInfo` Function

**Purpose and Behavior:**
The `readProcessInfo` function in Go reads detailed information about a process given its PID from the `/proc` filesystem. It extracts key fields such as name, state, parent PID (PPid), RSS memory usage, and command line arguments.

**Key Implementation Details:**
- The function uses file I/O to read the `status` and `cmdline` files of the specified process.
- It employs a `bufio.Scanner` for efficient line-by-line processing of the status file.
- Key fields are parsed from the `status` file using string manipulation and type conversion.
- Command line arguments are split by null bytes (`\x00`) and cleaned to remove empty strings.

**When/Why to Use:**
Use this function when you need detailed process information for a specific PID, such as in system monitoring or auditing tools. It provides a comprehensive view of the process state and configuration.

**Patterns and Gotchas:**
- The function handles errors gracefully by returning them immediately.
- String parsing is sensitive to whitespace; ensure fields are properly trimmed.
- Memory usage (`VmRSS`) conversion from kilobytes to bytes requires careful handling.
- The function assumes `/proc` filesystem availability, which may not be present in all environments.

---

*Generated by CodeWorm on 2026-02-28 23:15*
