# GenerateKeyPair

**Repository:** fullstack-template
**File:** stacks/go-react/go-backend/internal/auth/jwt.go
**Language:** go
**Lines:** 77-121
**Complexity:** 10.0

---

## Source Code

```go
func GenerateKeyPair(privateKeyPath, publicKeyPath string) error {
	privateKey, err := ecdsa.GenerateKey(elliptic.P256(), rand.Reader)
	if err != nil {
		return fmt.Errorf("generate key: %w", err)
	}

	jwkPrivate, err := jwk.Import(privateKey)
	if err != nil {
		return fmt.Errorf("import private key: %w", err)
	}

	keyID := uuid.New().String()[:8]
	if setErr := jwkPrivate.Set(jwk.KeyIDKey, keyID); setErr != nil {
		return fmt.Errorf("set key id: %w", setErr)
	}
	if setErr := jwkPrivate.Set(jwk.AlgorithmKey, jwa.ES256()); setErr != nil {
		return fmt.Errorf("set algorithm: %w", setErr)
	}

	privatePEM, err := jwk.Pem(jwkPrivate)
	if err != nil {
		return fmt.Errorf("encode private key: %w", err)
	}

	if writeErr := os.WriteFile(privateKeyPath, privatePEM, 0o600); writeErr != nil {
		return fmt.Errorf("write private key: %w", writeErr)
	}

	jwkPublic, err := jwkPrivate.PublicKey()
	if err != nil {
		return fmt.Errorf("derive public key: %w", err)
	}

	publicPEM, err := jwk.Pem(jwkPublic)
	if err != nil {
		return fmt.Errorf("encode public key: %w", err)
	}

	//nolint:gosec // G306: public key is intentionally world-readable
	if writeErr := os.WriteFile(publicKeyPath, publicPEM, 0o644); writeErr != nil {
		return fmt.Errorf("write public key: %w", writeErr)
	}

	return nil
}
```

---

## Documentation

### Documentation for `GenerateKeyPair`

**Purpose and Behavior:**
The `GenerateKeyPair` function in the provided Go code generates an ECDSA key pair (private and public) using P-256 elliptic curve parameters. It then exports these keys to JWK (JSON Web Key) format, setting appropriate metadata such as key ID and algorithm. The private key is saved with restricted permissions (`0o600`), while the public key is saved with world-readable permissions (`0o644`).

**Key Implementation Details:**
- **Error Handling:** Uses `fmt.Errorf` to create descriptive error messages.
- **ECDSA Key Generation:** Utilizes `ecdsa.GenerateKey` and `rand.Reader` for generating a private ECDSA key.
- **JWK Conversion:** Converts the generated keys into JWK format using `jwk.Import`, setting necessary metadata like `keyID` and `algorithm`.
- **File Writing:** Writes the encoded keys to specified paths with appropriate file permissions.

**When/Why to Use:**
This function is useful for generating secure ECDSA key pairs in Go applications, particularly when implementing JWT (JSON Web Tokens) authentication. It ensures that private keys are stored securely while public keys can be shared freely.

**Patterns and Gotchas:**
- **File Permissions:** The use of `0o600` for the private key file is a good security practice to prevent unauthorized access.
- **World-Readable Public Key:** Although the public key is set as world-readable, this is intentional. Ensure that sensitive data is not exposed through the public key.
- **UUID Usage:** The `uuid.New().String()[:8]` generates an 8-character UUID for the key ID, which can be used to uniquely identify keys.

This function adheres to Go idioms by handling errors appropriately and using standard libraries like `os`, `rand`, and `jwk`.

---

*Generated by CodeWorm on 2026-01-22 12:10*
