# GetLogs

**Repository:** angelamos-operations
**File:** Docker-Kentros/internal/docker/logs.go
**Language:** go
**Lines:** 33-86
**Complexity:** 8.0

---

## Source Code

```go
func (c *Client) GetLogs(
	ctx context.Context,
	containerID string,
	opts LogOptions,
) (*LogOutput, error) {
	c.mu.RLock()
	defer c.mu.RUnlock()

	logOpts := container.LogsOptions{
		ShowStdout: true,
		ShowStderr: true,
		Timestamps: opts.Timestamps,
		Follow:     false,
		Tail:       opts.Tail,
		Since:      opts.Since,
		Until:      opts.Until,
	}

	if logOpts.Tail == "" {
		logOpts.Tail = "100"
	}

	reader, err := c.cli.ContainerLogs(ctx, containerID, logOpts)
	if err != nil {
		return nil, fmt.Errorf("getting logs for %s: %w", containerID, err)
	}
	defer func() { _ = reader.Close() }()

	info, err := c.cli.ContainerInspect(ctx, containerID)
	if err != nil {
		return nil, fmt.Errorf(
			"inspecting container %s for TTY check: %w",
			containerID,
			err,
		)
	}

	var stdoutBuf, stderrBuf bytes.Buffer

	if info.Config != nil && info.Config.Tty {
		if _, err := io.Copy(&stdoutBuf, reader); err != nil {
			return nil, fmt.Errorf("reading TTY logs: %w", err)
		}
	} else {
		if _, err := stdcopy.StdCopy(&stdoutBuf, &stderrBuf, reader); err != nil {
			return nil, fmt.Errorf("demultiplexing logs: %w", err)
		}
	}

	return &LogOutput{
		Stdout: stdoutBuf.String(),
		Stderr: stderrBuf.String(),
	}, nil
}
```

---

## Documentation

### Documentation for `GetLogs` Function

**Purpose and Behavior:**
The `GetLogs` function retrieves logs from a Docker container based on specified options. It handles both TTY (terminal) and non-TTY log outputs, ensuring that stdout and stderr are correctly demultiplexed or concatenated.

**Key Implementation Details:**
- **Context Handling:** The function uses a context to manage the lifecycle of the operation.
- **Locking Mechanism:** A read lock is acquired on `c.mu` to ensure thread safety when accessing shared resources.
- **Error Handling:** Errors are properly propagated using `fmt.Errorf`, and resources like log readers are closed after use.
- **Log Demultiplexing:** For non-TTY containers, the function uses `stdcopy.StdCopy` to separate stdout and stderr streams. For TTY containers, it concatenates both streams into a single buffer.

**When/Why to Use:**
Use this code when you need to fetch logs from Docker containers in your Go application. It handles different log types (TTY vs non-TTY) efficiently and ensures proper error handling.

**Patterns and Gotchas:**
- **Resource Management:** Always ensure that resources like `reader` are closed using deferred functions.
- **Error Propagation:** The function uses `fmt.Errorf` to provide detailed error messages, which is crucial for debugging.
- **TTY Handling:** Be aware of the distinction between TTY and non-TTY containers as it affects how logs are processed.

---

*Generated by CodeWorm on 2026-01-23 20:12*
