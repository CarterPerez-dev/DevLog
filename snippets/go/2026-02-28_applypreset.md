# ApplyPreset

**Type:** Documentation
**Repository:** Yoshi-Audit
**File:** internal/docker/presets.go
**Language:** go
**Lines:** 10-49
**Complexity:** 21.0

---

## Source Code

```go
func ApplyPreset(preset config.PrunePreset, images []ImageInfo, volumes []VolumeInfo, protection *ProtectionEngine) (imageIDs []string, volumeNames []string) {
	hasDangling := false
	hasStopped := false
	for _, p := range preset.Patterns {
		switch p {
		case "dangling":
			hasDangling = true
		case "stopped":
			hasStopped = true
		}
	}
	_ = hasStopped

	if hasDangling {
		for _, img := range images {
			if img.Dangling && !protection.IsProtected(img.Repository) && !protection.IsProtected(img.ID) {
				imageIDs = append(imageIDs, img.ID)
			}
		}
	}

	for _, p := range preset.Patterns {
		if p == "dangling" || p == "buildcache" || p == "stopped" {
			continue
		}
		pe := NewProtectionEngine([]string{p})
		for _, img := range images {
			if !img.Dangling && pe.MatchesPattern(img.Repository) && !protection.IsProtected(img.Repository) && !protection.IsProtected(img.ID) {
				imageIDs = append(imageIDs, img.ID)
			}
		}
		for _, vol := range volumes {
			if pe.MatchesPattern(vol.Name) && !protection.IsProtected(vol.Name) {
				volumeNames = append(volumeNames, vol.Name)
			}
		}
	}

	return imageIDs, volumeNames
}
```

---

## Documentation

### Documentation for `ApplyPreset` Function

**Purpose and Behavior:**
The `ApplyPreset` function processes a configuration preset against a list of images and volumes, identifying those that should be pruned based on the specified patterns. It returns lists of image IDs to prune and volume names.

**Key Implementation Details:**
- The function iterates over predefined patterns in the `preset.Patterns` slice.
- For "dangling" and "stopped" patterns, it directly checks images for pruning conditions.
- For other patterns, a new `ProtectionEngine` instance is created to match repository or volume names against the pattern.

**When/Why to Use:**
This function should be used when applying predefined pruning rules (presets) to Docker images and volumes. It helps in automating the process of identifying non-protected resources that can be safely pruned, ensuring compliance with organizational policies.

**Patterns and Gotchas:**
- The `protection` parameter is optional but crucial for determining if an image or volume should be protected.
- Patterns like "buildcache" are not directly handled by the function; they require additional logic within the `ProtectionEngine`.
- The use of goroutines could improve performance, especially when dealing with large lists of images and volumes.

---

*Generated by CodeWorm on 2026-02-28 21:24*
