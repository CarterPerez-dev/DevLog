# checkSecurityOptions

**Repository:** Cybersecurity-Projects
**File:** PROJECTS/docker-security-audit/internal/analyzer/container.go
**Language:** go
**Lines:** 226-297
**Complexity:** 13.0

---

## Source Code

```go
func (a *ContainerAnalyzer) checkSecurityOptions(
	target finding.Target,
	info types.ContainerJSON,
) finding.Collection {
	var findings finding.Collection

	hasAppArmor := false
	hasSeccomp := false
	hasNoNewPrivileges := false
	seccompDisabled := false

	for _, opt := range info.HostConfig.SecurityOpt {
		if strings.HasPrefix(opt, "apparmor=") {
			hasAppArmor = true
		}
		if strings.HasPrefix(opt, "seccomp=") {
			hasSeccomp = true
			if opt == "seccomp=unconfined" {
				seccompDisabled = true
			}
		}
		if opt == "no-new-privileges" || opt == "no-new-privileges:true" {
			hasNoNewPrivileges = true
		}
	}

	if !hasAppArmor && !info.HostConfig.Privileged {
		control, _ := benchmark.Get("5.1")
		f := finding.New("CIS-5.1", control.Title, finding.SeverityHigh, target).
			WithDescription(control.Description).
			WithCategory(string(CategoryContainerRuntime)).
			WithRemediation(control.Remediation).
			WithReferences(control.References...).
			WithCISControl(control.ToCISControl())
		findings = append(findings, f)
	}

	if seccompDisabled {
		control, _ := benchmark.Get("5.21")
		f := finding.New("CIS-5.21", control.Title, finding.SeverityHigh, target).
			WithDescription(control.Description).
			WithCategory(string(CategoryContainerRuntime)).
			WithRemediation(control.Remediation).
			WithReferences(control.References...).
			WithCISControl(control.ToCISControl())
		findings = append(findings, f)
	}

	if !hasSeccomp && !info.HostConfig.Privileged {
		control, _ := benchmark.Get("5.21")
		f := finding.New("CIS-5.21", "No seccomp profile set", finding.SeverityMedium, target).
			WithDescription("Container is running without an explicit seccomp profile. While Docker applies a default profile, it's recommended to explicitly set one.").
			WithCategory(string(CategoryContainerRuntime)).
			WithRemediation(control.Remediation).
			WithReferences(control.References...).
			WithCISControl(control.ToCISControl())
		findings = append(findings, f)
	}

	if !hasNoNewPrivileges {
		control, _ := benchmark.Get("5.25")
		f := finding.New("CIS-5.25", control.Title, finding.SeverityHigh, target).
			WithDescription(control.Description).
			WithCategory(string(CategoryContainerRuntime)).
			WithRemediation(control.Remediation).
			WithReferences(control.References...).
			WithCISControl(control.ToCISControl())
		findings = append(findings, f)
	}

	return findings
}
```

---

## Documentation

### Documentation for `checkSecurityOptions` Function

**Purpose and Behavior:**
The `checkSecurityOptions` function in the `ContainerAnalyzer` struct evaluates a container's security options, such as AppArmor, Seccomp, and No New Privileges settings. It generates findings based on these configurations to ensure compliance with cybersecurity standards.

**Key Implementation Details:**
- The function iterates over `info.HostConfig.SecurityOpt`, checking for specific security options.
- It sets boolean flags (`hasAppArmor`, `hasSeccomp`, `hasNoNewPrivileges`) and handles Seccomp-specific cases, including the "unconfined" state.
- Finding objects are created using predefined controls from a benchmark, which include titles, severities, descriptions, categories, remediations, references, and CIS control mappings.

**When/Why to Use:**
This function is used in security audits of Docker containers. It helps identify potential vulnerabilities by ensuring that critical security options like AppArmor, Seccomp, and No New Privileges are properly configured. This is crucial for maintaining the integrity and security of containerized applications.

**Patterns and Gotchas:**
- The use of `strings.HasPrefix` to check for specific prefixes in security options.
- Error handling is minimal; the function assumes that calls to `benchmark.Get` will not fail, which could lead to panics if not handled properly.
- The function relies on predefined controls from a benchmark, so any changes or additions to these controls must be reflected here.

---

*Generated by CodeWorm on 2026-01-14 14:56*
