# checkResourceLimits

**Repository:** Cybersecurity-Projects
**File:** PROJECTS/docker-security-audit/internal/analyzer/compose.go
**Language:** go
**Lines:** 327-394
**Complexity:** 10.0

---

## Source Code

```go
func (a *ComposeAnalyzer) checkResourceLimits(
	target finding.Target,
	serviceName string,
	node *yaml.Node,
) finding.Collection {
	var findings finding.Collection

	deployNode := findNode(node, "deploy")
	var resourcesNode *yaml.Node
	if deployNode != nil {
		resourcesNode = findNode(deployNode, "resources")
	}

	memLimitNode := findNode(node, "mem_limit")
	cpuLimitNode := findNode(node, "cpus")
	pidsLimitNode := findNode(node, "pids_limit")

	hasMemLimit := memLimitNode != nil
	hasCpuLimit := cpuLimitNode != nil
	hasPidsLimit := pidsLimitNode != nil

	if resourcesNode != nil {
		limitsNode := findNode(resourcesNode, "limits")
		if limitsNode != nil {
			if findNode(limitsNode, "memory") != nil {
				hasMemLimit = true
			}
			if findNode(limitsNode, "cpus") != nil {
				hasCpuLimit = true
			}
			if findNode(limitsNode, "pids") != nil {
				hasPidsLimit = true
			}
		}
	}

	if !hasMemLimit {
		loc := &finding.Location{Path: a.path, Line: node.Line}
		f := finding.New("CIS-5.10", "Service '"+serviceName+"' has no memory limit", finding.SeverityMedium, target).
			WithDescription("Without memory limits, a container can exhaust all available host memory.").
			WithCategory(string(CategoryCompose)).
			WithLocation(loc).
			WithRemediation("Set mem_limit or deploy.resources.limits.memory for the service.")
		findings = append(findings, f)
	}

	if !hasCpuLimit {
		loc := &finding.Location{Path: a.path, Line: node.Line}
		f := finding.New("CIS-5.11", "Service '"+serviceName+"' has no CPU limit", finding.SeverityMedium, target).
			WithDescription("Without CPU limits, a container can consume all available CPU resources.").
			WithCategory(string(CategoryCompose)).
			WithLocation(loc).
			WithRemediation("Set cpus or deploy.resources.limits.cpus for the service.")
		findings = append(findings, f)
	}

	if !hasPidsLimit {
		loc := &finding.Location{Path: a.path, Line: node.Line}
		f := finding.New("CIS-5.28", "Service '"+serviceName+"' has no PIDs limit", finding.SeverityMedium, target).
			WithDescription("Without PIDs limits, a container can fork-bomb and exhaust process table.").
			WithCategory(string(CategoryCompose)).
			WithLocation(loc).
			WithRemediation("Set pids_limit or deploy.resources.limits.pids for the service.")
		findings = append(findings, f)
	}

	return findings
}
```

---

## Documentation

### Documentation for `checkResourceLimits` Function

**Purpose and Behavior:**
The `checkResourceLimits` function in the `ComposeAnalyzer` struct checks Docker Compose files for resource limits (memory, CPU, and PIDs) on services. It returns a collection of findings if any required limits are missing.

**Key Implementation Details:**
- The function iterates through nodes in a YAML document to locate specific keys like "deploy", "resources", and subkeys like "mem_limit", "cpus", "pids_limit".
- If no memory, CPU, or PIDs limit is found, it generates a `finding` object with details about the missing limit and suggests remediation.
- The findings are collected in a `finding.Collection`.

**When/Why to Use:**
This function should be used during security audits of Docker Compose files. Ensuring resource limits are set helps prevent containers from consuming too many system resources, which can lead to performance issues or even crashes.

**Patterns and Gotchas:**
- The function uses nested conditional checks (`if` statements) to traverse the YAML structure, which can make it complex.
- It relies on helper functions like `findNode` for node traversal, which should be well-defined elsewhere in the codebase.
- Missing resource limits are flagged with medium severity, indicating they are important but not critical.

---

*Generated by CodeWorm on 2026-01-16 21:24*
