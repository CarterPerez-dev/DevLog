# CategorizeImage

**Type:** Documentation
**Repository:** Yoshi-Audit
**File:** internal/docker/categorize.go
**Language:** go
**Lines:** 19-38
**Complexity:** 7.0

---

## Source Code

```go
func CategorizeImage(img ImageInfo, protectionPatterns []string) SafetyCategory {
	if img.Dangling && img.Containers == 0 {
		return CategorySafe
	}

	if img.Containers > 0 {
		return CategoryDoNotTouch
	}

	pe := NewProtectionEngine(protectionPatterns)
	fullName := img.Repository
	if img.Tag != "<none>" {
		fullName = img.Repository + ":" + img.Tag
	}
	if pe.MatchesPattern(fullName) || pe.MatchesPattern(img.Repository) {
		return CategoryDoNotTouch
	}

	return CategoryProbablySafe
}
```

---

## Documentation

### Documentation for `CategorizeImage` Function

**Purpose and Behavior:**
The `CategorizeImage` function categorizes a Docker image based on its properties and protection patterns. It returns one of three categories: `CategorySafe`, `CategoryDoNotTouch`, or `CategoryProbablySafe`.

- **CategorySafe**: The image is considered safe if it has no dangling status and zero containers.
- **CategoryDoNotTouch**: The image is categorized as "do not touch" if it has active containers, matches a protection pattern, or both.
- **CategoryProbablySafe**: If none of the above conditions are met, the image is classified as probably safe.

**Key Implementation Details:**
1. The function takes an `ImageInfo` struct and a slice of `string` patterns for protection.
2. It first checks if the image has no dangling status and zero containers to return `CategorySafe`.
3. If the image has active containers, it immediately returns `CategoryDoNotTouch`.
4. A `ProtectionEngine` is instantiated with the provided patterns.
5. The function constructs a full repository name by appending the tag (if not "<none>"). 
6. It checks if the full or base repository matches any protection pattern using the `MatchesPattern` method.
7. Based on these checks, it returns one of the three safety categories.

**When/Why to Use:**
Use this function when you need to categorize Docker images based on their properties and protection patterns in a Go application. It helps in deciding whether an image should be modified or left untouched during automated audits.

**Patterns/Gotchas:**
- The function relies heavily on the `ProtectionEngine` for pattern matching, so ensure it is correctly implemented.
- Be cautious with the order of conditions; the early return for active containers ensures that subsequent checks are not performed unnecessarily.

---

*Generated by CodeWorm on 2026-03-01 00:59*
