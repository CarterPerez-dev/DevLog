# Prune

**Repository:** angelamos-operations
**File:** Docker-Kentros/internal/docker/system.go
**Language:** go
**Lines:** 150-202
**Complexity:** 9.0

---

## Source Code

```go
func (c *Client) Prune(
	ctx context.Context,
	pruneImages, pruneVolumes, pruneBuildCache bool,
) (uint64, error) {
	c.mu.RLock()
	defer c.mu.RUnlock()

	var totalReclaimed uint64

	containerReport, err := c.cli.ContainersPrune(ctx, filters.Args{})
	if err != nil {
		return 0, fmt.Errorf("pruning containers: %w", err)
	}
	totalReclaimed += containerReport.SpaceReclaimed

	if pruneImages {
		imageReport, err := c.cli.ImagesPrune(
			ctx,
			filters.NewArgs(filters.Arg("dangling", "false")),
		)
		if err != nil {
			return totalReclaimed, fmt.Errorf("pruning images: %w", err)
		}
		totalReclaimed += imageReport.SpaceReclaimed
	}

	if pruneVolumes {
		volumeReport, err := c.cli.VolumesPrune(ctx, filters.Args{})
		if err != nil {
			return totalReclaimed, fmt.Errorf("pruning volumes: %w", err)
		}
		totalReclaimed += volumeReport.SpaceReclaimed
	}

	if pruneBuildCache {
		buildReport, err := c.cli.BuildCachePrune(
			ctx,
			build.CachePruneOptions{All: true},
		)
		if err != nil {
			return totalReclaimed, fmt.Errorf("pruning build cache: %w", err)
		}
		totalReclaimed += buildReport.SpaceReclaimed
	}

	networkReport, err := c.cli.NetworksPrune(ctx, filters.Args{})
	if err != nil {
		return totalReclaimed, fmt.Errorf("pruning networks: %w", err)
	}
	_ = networkReport

	return totalReclaimed, nil
}
```

---

## Documentation

### Documentation for `Prune` Function

**Purpose and Behavior:**
The `Prune` function in the `Client` struct is designed to clean up unused Docker resources, including containers, images, volumes, build cache, and networks. It accepts a context, flags for pruning different types of resources, and returns the total reclaimed space along with any potential errors.

**Key Implementation Details:**
- The function uses read-write locking (`mu.RLock`/`RUnlock`) to ensure thread safety.
- It prunes containers by default using `ContainersPrune`, and conditionally prunes images, volumes, build cache, and networks based on the input flags.
- Each pruning operation is wrapped in error handling to ensure that any failures are properly reported.

**When/Why to Use:**
This function should be used when managing a Docker environment where unused resources need to be cleaned up to free up disk space. It provides flexibility by allowing selective pruning of different resource types, making it suitable for various maintenance scenarios.

**Patterns and Gotchas:**
- The use of `context.Context` ensures that the operation can be canceled or timed out.
- Error handling is consistent throughout, ensuring all operations report errors appropriately.
- The function returns a total reclaimed space value, which can help in monitoring resource cleanup effectiveness. However, note that unused resources like networks are pruned but not immediately reported as reclaimed due to their nature.

This code follows Go idioms for error handling and provides a robust mechanism for cleaning up Docker resources efficiently.

---

*Generated by CodeWorm on 2026-01-23 13:32*
