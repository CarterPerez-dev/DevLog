# checkSecrets

**Repository:** Cybersecurity-Projects
**File:** PROJECTS/docker-security-audit/internal/analyzer/dockerfile.go
**Language:** go
**Lines:** 201-270
**Complexity:** 14.0

---

## Source Code

```go
func (a *DockerfileAnalyzer) checkSecrets(
	target finding.Target,
	ast *parser.Node,
) finding.Collection {
	var findings finding.Collection

	for _, node := range ast.Children {
		cmd := strings.ToUpper(node.Value)
		if cmd != "ENV" && cmd != "ARG" && cmd != "RUN" && cmd != "LABEL" {
			continue
		}

		line := getFullLine(node)

		if cmd == "ENV" || cmd == "ARG" {
			varName := ""
			varValue := ""
			if node.Next != nil {
				parts := strings.SplitN(node.Next.Value, "=", 2)
				varName = parts[0]
				if len(parts) > 1 {
					varValue = parts[1]
				}
			}
			if rules.IsSensitiveEnvName(varName) {
				control, _ := benchmark.Get("4.10")
				loc := &finding.Location{Path: a.path, Line: node.StartLine}
				f := finding.New("CIS-4.10", "Sensitive variable in "+cmd+": "+varName, finding.SeverityHigh, target).
					WithDescription(control.Description).
					WithCategory(string(CategoryDockerfile)).
					WithLocation(loc).
					WithRemediation(control.Remediation).
					WithReferences(control.References...).
					WithCISControl(control.ToCISControl())
				findings = append(findings, f)
			}

			if varValue != "" &&
				rules.IsHighEntropyString(
					varValue,
					config.MinSecretLength,
					config.MinEntropyForSecret,
				) {
				loc := &finding.Location{Path: a.path, Line: node.StartLine}
				f := finding.New("DS-HIGH-ENTROPY", "High entropy string in "+cmd+" (potential secret)", finding.SeverityMedium, target).
					WithDescription("Value in " + varName + " has high entropy, indicating a potential hardcoded secret or key.").
					WithCategory(string(CategoryDockerfile)).
					WithLocation(loc).
					WithRemediation("Use Docker secrets, build arguments, or environment variables at runtime instead of hardcoding sensitive values.")
				findings = append(findings, f)
			}
		}

		secrets := rules.DetectSecrets(line)
		for _, secret := range secrets {
			control, _ := benchmark.Get("4.10")
			loc := &finding.Location{Path: a.path, Line: node.StartLine}
			f := finding.New("CIS-4.10", "Potential "+string(secret.Type)+" detected in Dockerfile", finding.SeverityHigh, target).
				WithDescription(secret.Description + ". " + control.Description).
				WithCategory(string(CategoryDockerfile)).
				WithLocation(loc).
				WithRemediation(control.Remediation).
				WithReferences(control.References...).
				WithCISControl(control.ToCISControl())
			findings = append(findings, f)
		}
	}

	return findings
}
```

---

## Documentation

### Documentation for `checkSecrets` Function

**Purpose and Behavior:**
The `checkSecrets` function in the DockerfileAnalyzer checks for potential secrets within a Dockerfile by analyzing commands like `ENV`, `ARG`, `RUN`, and `LABEL`. It identifies sensitive environment variables, high-entropy strings (indicative of hardcoded secrets), and other detected secrets. The findings are categorized based on severity and include remediation advice.

**Key Implementation Details:**
1. **Command Analysis:** The function iterates through the AST nodes to identify commands such as `ENV`, `ARG`, `RUN`, and `LABEL`.
2. **Sensitive Variable Detection:** For `ENV` and `ARG` commands, it checks if variable names match predefined sensitive patterns and evaluates high entropy in values.
3. **Secret Detection:** It uses a rules engine to detect secrets within lines of the Dockerfile, categorizing them based on their type.

**When/Why to Use:**
This function is crucial for security audits of Dockerfiles, helping identify hardcoded secrets that could pose security risks. It's particularly useful in CI/CD pipelines or manual reviews where ensuring compliance with security standards like CIS benchmarks is critical.

**Patterns and Gotchas:**
- **Error Handling:** The code assumes proper error handling from the `rules.IsSensitiveEnvName` function.
- **Performance Considerations:** The function may be slow on large Dockerfiles due to its thorough analysis, so consider optimizing for performance in production environments.

---

*Generated by CodeWorm on 2026-01-16 13:34*
