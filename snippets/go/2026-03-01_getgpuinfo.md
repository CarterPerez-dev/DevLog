# GetGPUInfo

**Type:** Documentation
**Repository:** Yoshi-Audit
**File:** internal/system/gpu.go
**Language:** go
**Lines:** 31-67
**Complexity:** 6.0

---

## Source Code

```go
func GetGPUInfo() (GPUInfo, error) {
	out, err := exec.Command(
		"nvidia-smi",
		"--query-gpu=utilization.gpu,memory.used,memory.total",
		"--format=csv,noheader,nounits",
	).Output()
	if err != nil {
		return GPUInfo{}, fmt.Errorf("nvidia-smi failed: %w", err)
	}

	line := strings.TrimSpace(string(out))
	parts := strings.Split(line, ",")
	if len(parts) < 3 {
		return GPUInfo{}, fmt.Errorf("unexpected nvidia-smi output: %q", line)
	}

	util, err := strconv.ParseFloat(strings.TrimSpace(parts[0]), 64)
	if err != nil {
		return GPUInfo{}, fmt.Errorf("failed to parse utilization: %w", err)
	}

	usedMiB, err := strconv.ParseUint(strings.TrimSpace(parts[1]), 10, 64)
	if err != nil {
		return GPUInfo{}, fmt.Errorf("failed to parse used memory: %w", err)
	}

	totalMiB, err := strconv.ParseUint(strings.TrimSpace(parts[2]), 10, 64)
	if err != nil {
		return GPUInfo{}, fmt.Errorf("failed to parse total memory: %w", err)
	}

	return GPUInfo{
		Utilization: util,
		UsedVRAM:    usedMiB * 1024 * 1024,
		TotalVRAM:   totalMiB * 1024 * 1024,
	}, nil
}
```

---

## Documentation

### Documentation for `GetGPUInfo`

**Purpose and Behavior:**
The `GetGPUInfo` function retrieves GPU utilization, used memory, and total memory from an NVIDIA GPU using the `nvidia-smi` utility. It returns a structured `GPUInfo` object along with any encountered errors.

**Key Implementation Details:**
- The function uses `exec.Command` to run `nvidia-smi` with specific query parameters.
- It parses the output, splitting it into utilization and memory values.
- Each value is parsed from string to float64 or uint64 as needed.
- Errors are handled using `fmt.Errorf`, ensuring error messages include context.

**When/Why to Use:**
Use this function in applications that require monitoring GPU usage. It's particularly useful for performance analysis, resource management, and system diagnostics where real-time GPU metrics are necessary.

**Patterns/Gotchas:**
- The function relies on the `nvidia-smi` utility being available and correctly configured.
- Error handling is robust but assumes the format of the output remains consistent; any changes could break parsing logic.
- Memory usage is converted to bytes for consistency, though this might not be necessary depending on application requirements.

---

*Generated by CodeWorm on 2026-03-01 07:03*
