# ListCollections

**Repository:** angelamos-operations
**File:** CertGamesDB-Argos/go-backend/internal/mongodb/collections.go
**Language:** go
**Lines:** 93-151
**Complexity:** 12.0

---

## Source Code

```go
func (r *CollectionsRepository) ListCollections(ctx context.Context, dbName string) ([]CollectionInfo, error) {
	db := r.client.client.Database(dbName)

	cursor, err := db.ListCollections(ctx, bson.D{})
	if err != nil {
		return nil, fmt.Errorf("list collections: %w", err)
	}
	defer cursor.Close(ctx)

	var collections []CollectionInfo
	for cursor.Next(ctx) {
		var result bson.M
		if err := cursor.Decode(&result); err != nil {
			continue
		}

		name, _ := result["name"].(string)
		collType, _ := result["type"].(string)

		if collType == "" {
			collType = "collection"
		}

		info := CollectionInfo{
			Name: name,
			Type: collType,
		}

		count, _ := db.Collection(name).EstimatedDocumentCount(ctx)
		info.DocumentCount = count

		var stats bson.M
		if err := db.RunCommand(ctx, bson.D{{"collStats", name}}).Decode(&stats); err == nil {
			if size, ok := stats["size"].(int32); ok {
				info.SizeBytes = int64(size)
			} else if size, ok := stats["size"].(int64); ok {
				info.SizeBytes = size
			}
			if avgSize, ok := stats["avgObjSize"].(int32); ok {
				info.AvgDocSize = int64(avgSize)
			} else if avgSize, ok := stats["avgObjSize"].(int64); ok {
				info.AvgDocSize = avgSize
			} else if avgSize, ok := stats["avgObjSize"].(float64); ok {
				info.AvgDocSize = int64(avgSize)
			}
			if nindexes, ok := stats["nindexes"].(int32); ok {
				info.IndexCount = int(nindexes)
			}
		}

		collections = append(collections, info)
	}

	sort.Slice(collections, func(i, j int) bool {
		return collections[i].DocumentCount > collections[j].DocumentCount
	})

	return collections, nil
}
```

---

## Documentation

### Documentation for `ListCollections` Function

**Purpose and Behavior:**
The `ListCollections` function retrieves information about all collections in a specified database using the MongoDB Go driver. It returns a list of `CollectionInfo` structs containing details such as collection names, types, document counts, sizes, average document sizes, and index counts.

**Key Implementation Details:**
- The function takes a context (`ctx`) and a database name (`dbName`) as parameters.
- It uses the MongoDB client to query collections, decode their metadata, and calculate additional statistics like size and index count.
- Error handling is robust, using `fmt.Errorf` for error propagation and ensuring all errors are properly checked before proceeding with further operations.

**When/Why to Use:**
Use this function when you need a comprehensive overview of the collections within a specific MongoDB database. It's particularly useful for monitoring or reporting purposes where detailed collection statistics are required.

**Patterns and Gotchas:**
- The use of `bson.M` for decoding cursor results is idiomatic in Go when working with dynamic JSON-like data.
- Error handling is thorough, ensuring that any failure during the process stops further execution to maintain data integrity.
- The sorting logic at the end may impact performance on large datasets; consider optimizing if this function is called frequently.

---

*Generated by CodeWorm on 2026-01-23 02:59*
