# checkPorts

**Repository:** Cybersecurity-Projects
**File:** PROJECTS/docker-security-audit/internal/analyzer/compose.go
**Language:** go
**Lines:** 477-539
**Complexity:** 15.0

---

## Source Code

```go
func (a *ComposeAnalyzer) checkPorts(
	target finding.Target,
	serviceName string,
	node *yaml.Node,
) finding.Collection {
	var findings finding.Collection

	portsNode := findNode(node, "ports")
	if portsNode == nil {
		return findings
	}

	for _, portNode := range portsNode.Content {
		var portSpec string
		switch portNode.Kind {
		case yaml.ScalarNode:
			portSpec = portNode.Value
		case yaml.MappingNode:
			publishedNode := findNode(portNode, "published")
			hostIPNode := findNode(portNode, "host_ip")
			if publishedNode != nil {
				portSpec = publishedNode.Value
			}
			if hostIPNode != nil && hostIPNode.Value == "0.0.0.0" {
				loc := &finding.Location{Path: a.path, Line: hostIPNode.Line}
				f := finding.New("DS-COMPOSE-BIND", "Service '"+serviceName+"' explicitly binds to 0.0.0.0", finding.SeverityInfo, target).
					WithDescription("Binding to 0.0.0.0 exposes the port on all network interfaces.").
					WithCategory(string(CategoryCompose)).
					WithLocation(loc).
					WithRemediation("Consider binding to 127.0.0.1 for local-only access.")
				findings = append(findings, f)
			}
		}

		if portSpec == "" {
			continue
		}

		parts := strings.Split(portSpec, ":")
		var hostPort string
		if len(parts) >= 2 {
			hostPort = parts[0]
			if strings.Contains(hostPort, ".") {
				hostPort = parts[1]
			}
		}

		if hostPort != "" {
			portNum, err := strconv.Atoi(hostPort)
			if err == nil && portNum > 0 && portNum < 1024 {
				loc := &finding.Location{Path: a.path, Line: portNode.Line}
				f := finding.New("DS-COMPOSE-PRIVPORT", "Service '"+serviceName+"' exposes privileged port "+hostPort, finding.SeverityInfo, target).
					WithDescription("Privileged ports (below 1024) typically require root privileges on the host.").
					WithCategory(string(CategoryCompose)).
					WithLocation(loc).
					WithRemediation("Consider using non-privileged ports (>1024) with port mapping.")
				findings = append(findings, f)
			}
		}
	}

	return findings
}
```

---

## Documentation

### Documentation for `checkPorts` Function

**Purpose and Behavior:**
The `checkPorts` function analyzes Docker Compose files to identify potential security issues related to port bindings and privileged ports. It checks if services bind to all network interfaces (`0.0.0.0`) or expose privileged ports (below 1024), which can be risky.

**Key Implementation Details:**
- The function iterates over the "ports" section of a Docker Compose file, extracting port specifications.
- For each port specification, it checks if the service binds to `0.0.0.0`, logging this as an informational finding with remediation advice.
- It also checks for privileged ports (below 1024) and logs findings if such ports are exposed without proper justification.

**When/Why to Use:**
Use this function in security audits of Docker Compose files to ensure that services do not bind to all network interfaces unnecessarily or expose potentially dangerous privileged ports. This is crucial for maintaining the security posture of containerized applications.

**Patterns and Gotchas:**
- The use of `yaml.Node` manipulation is idiomatic in Go, but requires careful handling of node kinds.
- The function assumes familiarity with the `finding` package, which manages findings and their descriptions.
- Beware of potential errors during string parsing (e.g., when splitting port specifications) and ensure robust error handling.

---

*Generated by CodeWorm on 2026-01-16 02:41*
