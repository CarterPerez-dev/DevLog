# Report

**Type:** Documentation
**Repository:** Cybersecurity-Projects
**File:** PROJECTS/intermediate/secrets-scanner/internal/reporter/sarif.go
**Language:** go
**Lines:** 75-155
**Complexity:** 8.0

---

## Source Code

```go
func (s *SARIF) Report(
	w io.Writer, result *types.ScanResult,
) error {
	ruleMap := make(map[string]bool)
	var sarifRules []sarifRule

	for _, f := range result.Findings {
		if ruleMap[f.RuleID] {
			continue
		}
		ruleMap[f.RuleID] = true
		sarifRules = append(sarifRules, sarifRule{
			ID:               f.RuleID,
			ShortDescription: sarifMessage{Text: f.Description},
			DefaultConfig: sarifRuleConfig{
				Level: severityToSARIF(f.Severity),
			},
		})
	}

	var results []sarifResult
	for _, f := range result.Findings {
		r := sarifResult{
			RuleID:  f.RuleID,
			Level:   severityToSARIF(f.Severity),
			Message: sarifMessage{Text: f.Description},
			Locations: []sarifLocation{
				{
					PhysicalLocation: sarifPhysicalLocation{
						ArtifactLocation: sarifArtifactLocation{
							URI: f.FilePath,
						},
						Region: sarifRegion{
							StartLine: f.LineNumber,
						},
					},
				},
			},
		}

		props := make(map[string]any)
		if f.CommitSHA != "" {
			props["commit"] = f.CommitSHA
		}
		if f.Entropy > 0 {
			props["entropy"] = f.Entropy
		}
		if f.HIBPStatus == types.HIBPBreached {
			props["hibp_breached"] = true
			props["breach_count"] = f.BreachCount
		}
		if len(props) > 0 {
			r.Properties = props
		}

		results = append(results, r)
	}

	log := sarifLog{
		Version: "2.1.0",
		Schema: "https://raw.githubusercontent.com/" +
			"oasis-tcs/sarif-spec/main/sarif-2.1/" +
			"schema/sarif-schema-2.1.0.json",
		Runs: []sarifRun{
			{
				Tool: sarifTool{
					Driver: sarifDriver{
						Name:    "portia",
						Version: "1.0.0",
						Rules:   sarifRules,
					},
				},
				Results: results,
			},
		},
	}

	enc := json.NewEncoder(w)
	enc.SetIndent("", "  ")
	return enc.Encode(log)
}
```

---

## Documentation

### Documentation for `Report` Function in SARIF Reporter

**Purpose and Behavior:**
The `Report` function generates a SARIF (Static Analysis Results Interchange Format) log from a `types.ScanResult`. It processes findings to create rules and results, then encodes the log into JSON format.

**Key Implementation Details:**
1. **Rule Aggregation:** The function aggregates unique rule IDs from findings to avoid duplicates.
2. **Result Construction:** For each finding, it constructs a SARIF result with properties like commit SHA, entropy, and HIBP breach status.
3. **JSON Encoding:** Uses `json.NewEncoder` to serialize the log into JSON format, indented for readability.

**When/Why to Use:**
This function is used when integrating static analysis results from a scan into a SARIF-compliant report. It's particularly useful for tools that need to export findings in a standardized format for integration with other security and DevOps tools.

**Patterns/Gotchas:**
- **Error Handling:** The function returns an error, which should be checked to handle any issues during JSON encoding.
- **Dynamic Properties:** The `Properties` map dynamically includes additional details based on the finding's attributes, making it flexible but requiring careful handling of keys and values.

---

*Generated by CodeWorm on 2026-02-28 08:40*
