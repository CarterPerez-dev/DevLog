# GetCollectionStats

**Repository:** angelamos-operations
**File:** CertGamesDB-Argos/go-backend/internal/mongodb/collections.go
**Language:** go
**Lines:** 153-206
**Complexity:** 15.0

---

## Source Code

```go
func (r *CollectionsRepository) GetCollectionStats(ctx context.Context, dbName, collName string) (*CollectionStats, error) {
	db := r.client.client.Database(dbName)

	var stats bson.M
	if err := db.RunCommand(ctx, bson.D{{"collStats", collName}}).Decode(&stats); err != nil {
		return nil, fmt.Errorf("get collection stats: %w", err)
	}

	result := &CollectionStats{
		Name: collName,
	}

	if count, ok := stats["count"].(int32); ok {
		result.DocumentCount = int64(count)
	} else if count, ok := stats["count"].(int64); ok {
		result.DocumentCount = count
	}

	if size, ok := stats["size"].(int32); ok {
		result.SizeBytes = int64(size)
	} else if size, ok := stats["size"].(int64); ok {
		result.SizeBytes = size
	}

	if avgSize, ok := stats["avgObjSize"].(int32); ok {
		result.AvgDocSize = int64(avgSize)
	} else if avgSize, ok := stats["avgObjSize"].(int64); ok {
		result.AvgDocSize = avgSize
	} else if avgSize, ok := stats["avgObjSize"].(float64); ok {
		result.AvgDocSize = int64(avgSize)
	}

	if storageSize, ok := stats["storageSize"].(int32); ok {
		result.StorageSize = int64(storageSize)
	} else if storageSize, ok := stats["storageSize"].(int64); ok {
		result.StorageSize = storageSize
	}

	if nindexes, ok := stats["nindexes"].(int32); ok {
		result.IndexCount = int(nindexes)
	}

	if totalIndexSize, ok := stats["totalIndexSize"].(int32); ok {
		result.TotalIndexSize = int64(totalIndexSize)
	} else if totalIndexSize, ok := stats["totalIndexSize"].(int64); ok {
		result.TotalIndexSize = totalIndexSize
	}

	if capped, ok := stats["capped"].(bool); ok {
		result.Capped = capped
	}

	return result, nil
}
```

---

## Documentation

### Documentation for `GetCollectionStats`

**Purpose and Behavior:**
The `GetCollectionStats` function retrieves statistics about a MongoDB collection, including document count, size, average object size, index information, and storage details. It takes a context (`ctx`), database name (`dbName`), and collection name (`collName`) as input parameters.

**Key Implementation Details:**
- The function uses the `RunCommand` method to execute a MongoDB command for collecting statistics.
- It decodes the response into a `bson.M` map, then extracts specific fields like `count`, `size`, `avgObjSize`, and others to populate a `CollectionStats` struct.
- Error handling is robust, using `fmt.Errorf` to provide meaningful error messages.

**When/Why to Use:**
This function should be used when you need detailed information about the state of a MongoDB collection. It's particularly useful for monitoring or reporting purposes where specific metrics are required.

**Patterns and Gotchas:**
- The function handles multiple types (int32, int64, float64) for fields like `avgObjSize` to ensure compatibility with different data types returned by the MongoDB command.
- Error handling is crucial as it ensures that any issues during the database operation are properly reported. 
- The use of type assertions (`ok := stats["count"].(int32)`) can lead to panics if the type does not match, so always validate the type before accessing fields.

This function adheres to Go idioms by using context for asynchronous operations and error handling with `fmt.Errorf`.

---

*Generated by CodeWorm on 2026-01-22 17:31*
